extends /auth/base.pug
block vars
  - ctrl.authpanel = true;
  - ctrl.navtop.placeholder = false;
block content
  h1(t) 密碼重設完成。
  p #[a(href="#",onclick="lda.auth.show('login')",t) 讓我們試試] #[span(t) 您是否可以使用新密碼成功登入吧。]
  img(src="/dash/assets/img/p/auth/reset/key.svg")
  p 
    div(t) 還是不能登入嗎？
    div #[a(href="/dash/auth/reset/",t) 您可以再重設一次] ， #[a(href="#",onclick="lda.ldcvmgr.toggle('contact')",t) 或直接聯絡我們]。
  .ldcv.ldcvmgr(data-name="logged-in",data-lock="true"): .base.w-640.rwd: .inner.card: .card-body.text-center: .p-4
    h1(t) 您已經登入。
    p.mb-2 #[span(t) 現在就將您重導至首頁]...
    br
    .ld.ldld.bare.running.em-1.m-auto
block script
  script: :lsc
    ldc.register <[auth ldcvmgr]>, ({auth, ldcvmgr}) ->
      ensure = ->
        auth.ensure!
          .then -> window.location.href= \/
          .catch -> ensure!
      auth.get!then ->
        if it.{}user.key =>
          lda.ldcvmgr.toggle("logged-in")
          debounce 2000 .then -> window.location.href = \/
        else debounce 2000 .then -> if !(lda.auth.is-on!) => ensure!
