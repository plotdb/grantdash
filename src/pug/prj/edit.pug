extends /base.pug
block body
  //-include /ui/data/sample.pug
  include /modules/mixins/index.pug
  include /form/timeline.pug
  +css("/assets/lib/handsontable/handsontable.min.css")
  +script("/assets/lib/handsontable/handsontable.min.js")
  +script("/assets/lib/ldui/ldui.min.js")
  +script("/js/reblock/form-reblock.js")

  +scope("prj-diff").ldcv.scroll.ldcvmgr(data-name="prj-diff"): .base.w-640(style="height:90%"): .inner.card.h-100
    .sticky.z-fixed(style="top:0")
      .closebtn(data-ldcv-set="")
      .card-header.bg-white.rounded
        .text-center
          h4 修改紀錄
          .d-flex.justify-content-center.text-sm
            .text-removed.mx-2.py-1.px-2.rounded 舊版中被刪的字
            .text-added.mx-2.py-1.px-2.rounded 新版中增加的字
      .card-header.bg-light.text-dark.shadow-sm
        .row.text-sm
          .col-md.text-left.border-right #[i.i-dart-left] 左方 : 2020/04/20 12:30:25
          .col-md.text-right 2020/04/21 05:59:33 : 右方 #[i.i-dart-right]

    .card-body.h-100(style="overflow-y:scroll")
      .mb-4.pb-4(ld-each="diffs")
        div: b(ld="title")
        .text-sm.text-muted(ld="desc")
        .p-4.bg-light.mt-2.rounded: .row.no-gutters(ld="row")
          .col-md.border-right: .pr-4.value(style="white-space:pre-wrap")
          .col-md: .pl-4.value(style="white-space:pre-wrap")

  .w-1024.mx-auto.rwd.typeset.heading-contrast
    +scope("prj-form-use").d-flex
      .mr-4.p-4.rounded.border(style="background:linear-gradient(315deg,#f4f5f6,#fff);min-height:calc(100vh - 7em)")
        .pb-4.mb-4.h-100
          h3.my-0.d-none(ld="nview") 編輯提案
          h3.my-0(ld="view") 預覽提案
          hr
          //-+prj-card-sm(data.prj).shadow-sm.mb-4
          //-
            .mb-4.text-center
              .d-flex.justify-content-center
                .btn.btn-sm.btn-primary.rounded-pill.px-3.mx-1 分享 #[i.i-link]
                .btn.btn-sm.btn-primary.rounded-pill.px-3.mx-1 追蹤 #[i.i-eye]
                .btn.btn-sm.btn-primary.rounded-pill.px-3.mx-1 列印 #[i.i-print]
            hr

          .sticky(style="width:250px")
            .mb-4
              .d-flex.align-items-center.mb-2
                .flex-grow-1 編輯紀錄 
                //-.text-sm.text-success.ld.ld-fall-ttb-in 已自動存檔.
              select.form-control(ld="history")
                option 2020/04/08 12:30:12
                option 2020/04/08 12:30:11
                option 2020/04/08 12:30:02
                option 2020/04/08 12:20:12
                option 2020/04/08 11:10:54
                option 2020/04/06 04:52:15
            //- shown in view mode
            .mb-4
              .btn.btn-block.btn-primary(ld="view viewing") 編輯提案 #[i.i-pen]
              .btn.btn-block.btn-primary.d-none(ld="nview viewing") 預覽提案 #[i.i-pen]
            //- shown in edit mode
            .mb-4.d-none(ld="nview")
              .d-flex.align-items-center.mb2
                .flex-grow-1 編輯進度
                a.text-sm.text-danger(ld="invalid",href="#") 尚有 #[span(ld="remain") 1] 項待補 #[i.i-dart-right]
                .text-sm.text-success.d-none(ld="valid") 欄位均已填妥
              .progress
                .progress-bar.progress-bar-striped.progress-bar-animated(ld="progress",style="width:0%")

            .mb-4
              label.mb-1 提案人
              .d-flex.align-items-center
                +user.mr-2
                span Kirby Wu
            .mb-4
              label.mb-1 所屬分組
              .text-muted(ld="brd-name")
              .text-muted(ld="grp-name")


            //-.mb-4
              label.mb-1 追蹤者
              .d-flex.flex-wrap
                each i in [1,2,3,4,5]
                  +user.mr-2



      .flex-grow-1
        .d-none(ld="form-sample"): include /form/subblock.pug
        .d-none(ld="view"): div(ld="form-answer"): .mb-4.pb-4(ld-each="answer")
          h4.mb-1(ld="title") 提問的標題
          p.text-muted.mb-2(ld="desc") 提問的簡短描述 ...
          .mb-4.text-break.bg-light.rounded.p-4(ld="content")
        .d-none(ld="nview"): div(ld="form-list"): div(ld-each="block")
        .w-100.h-100(pd="init-loader",style="background-image:url(/assets/img/c/placeholder/content.svg);background-position:top center;background-repeat:repeat-y;")
        .d-none(ld="nview")
          .d-flex.align-items-center.ml-4
            .btn.btn-lg.btn-primary.mr-4.disabled(ld="submit") 儲存並發布
            .text-sm.text-danger(ld="invalid") #[i.i-close] 在能發布之前，您尚有 #[span(ld="remain") 1] 個項目未完成。#[a.text-danger.text-underline(href="#") 跳至待編修項目]
            .text-sm.text-success.d-none(ld="valid") 您已填完所有項目，可別忘了儲存並發布喔！

block script
  +script("/assets/lib/sharedb-wrapper/client.bundle.min.js")
  +script("/assets/lib/dompurify/2.0.11/purify.min.js")
  +script("/assets/lib/jsdiff/diff.min.js")
  +script("/js/form/sample-data.js")
  +script("/js/form/index.js")
  +script("/js/form/block.js")
  +script("/js/form/criteria.js")
  +script("/js/form/validator.js")
  +script("/js/util/sdb-adapter.js")
  +script("/js/util/hub.js")
  +script("/js/prj/edit.js")
