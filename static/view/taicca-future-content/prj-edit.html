<!DOCTYPE html><html><head><link rel="stylesheet" type="text/css" href="/dash/assets/felib/bootstrap/main/dist/css/bootstrap.min.css"><link rel="stylesheet" type="text/css" href="/dash/assets/felib/@loadingio/bootstrap.ext/main/index.min.css"><link rel="stylesheet" type="text/css" href="/dash/assets/felib/ldcover/main/index.min.css"><link rel="stylesheet" type="text/css" href="/dash/assets/felib/ldloader/main/index.min.css"></head><body><script src="https://browser.sentry-cdn.com/5.23.0/bundle.tracing.min.js" integrity="sha384-lSZkoLgJeNT+V/zBEZAchPik9VPNr9wvgAY6mwoMK5SO/cMsK/whVXKKdQOL1oiw" crossorigin="anonymous"></script><script type="text/javascript" src="/dash/assets/lib/moment.js/2.25.3/moment.min.js" defer></script><script type="text/javascript" src="/dash/assets/lib/moment-timezone.js/0.5.31/moment-timezone.min.js" defer></script><script type="text/javascript" src="/dash/assets/lib/ldui/ldui.min.js" defer></script><script type="text/javascript" src="/dash/assets/lib/ldc/ldc.min.js" defer></script><script type="text/javascript" src="/dash/assets/lib/ldsite/0.0.2/ldsite.min.js" defer></script><script type="text/javascript" src="/dash/js/util/stage.js" defer></script><script type="text/javascript" src="/dash/js/ldsite.js" defer></script><script type="text/javascript" src="/dash/js/site.js" defer></script><script type="text/javascript" src="/dash/assets/felib/proxise/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/@loadingio/debounce.js/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/@loadingio/ldquery/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/i18next/main/dist/umd/i18next.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/i18next-browser-languagedetector/main/dist/umd/i18nextBrowserLanguageDetector.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/ldview/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/ldcover/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/ldloader/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/@plotdb/semver/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/@plotdb/rescope/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/@plotdb/csscope/main/index.min.js" defer></script><script type="text/javascript" src="/dash/assets/felib/@plotdb/block/main/index.min.js" defer></script><script type="module">// Generated by LiveScript 1.3.0
ldc.register("blockbase", ['viewLocals', 'auth', 'ldNotify', 'error', 'notify'], function(arg$){
  var viewLocals, auth, error, notify;
  viewLocals = arg$.viewLocals, auth = arg$.auth, error = arg$.error, notify = arg$.notify;
  return {
    init: function(arg$){
      var mainBlock, host, lc, this$ = this;
      mainBlock = arg$.mainBlock, host = arg$.host;
      lc = {};
      return i18next.init({
        supportedLng: ['en', 'zh-TW'],
        fallbackLng: 'zh-TW',
        fallbackNS: '',
        defaultNS: ''
      }).then(function(){
        return i18next.use(i18nextBrowserLanguageDetector);
      }).then(function(){
        console.log("use language: ", navigator.language) || navigator.userLanguage;
        return i18next.changeLanguage(navigator.language) || navigator.userLanguage;
      }).then(function(){
        return block.i18n.use(i18next);
      }).then(function(){
        var mgr;
        lc.manager = mgr = new block.manager({
          registry: function(arg$){
            var name, version, path, type;
            name = arg$.name, version = arg$.version, path = arg$.path, type = arg$.type;
            return type === 'block'
              ? "/dash/assets/felib/" + name + "/" + (version || 'main') + "/" + (path || 'index.html')
              : "/dash/assets/felib/" + name + "/" + (version || 'main') + "/" + (path || 'index.min.js');
          }
        });
        return mgr.get(mainBlock).then(function(bc){
          return bc.create();
        }).then(function(bi){
          return bi.attach({
            root: document.body
          }).then(function(){
            return bi['interface']();
          }).then(function(itf){
            itf.adapt(host);
            return itf.pubsub.on('change-language', function(it){
              i18next.changeLanguage(it);
              return bi.transform('i18n');
            });
          });
        }).then(function(){
          return console.log('ok');
        });
      });
    }
  };
});</script><script type="module">// Generated by LiveScript 1.3.0
ldc.register("blockuploader", ['viewLocals', 'auth', 'ldNotify', 'error', 'notify'], function(arg$){
  var viewLocals, auth, error, notify, uploader;
  viewLocals = arg$.viewLocals, auth = arg$.auth, error = arg$.error, notify = arg$.notify;
  uploader = function(opt){
    opt == null && (opt = {});
    this.brd = opt.brd;
    this.owner = opt.owner;
    return this;
  };
  uploader.prototype = import$(Object.create(Object.prototype), {
    getSignedUrl: function(opt){
      opt == null && (opt = {});
      return ld$.fetch("/dash/api/gcs/upload", {
        method: 'POST'
      }, {
        json: opt,
        type: 'json'
      });
    },
    upload: function(arg$){
      var file, progress, field, opt, this$ = this;
      file = arg$.file, progress = arg$.progress, field = arg$.field;
      opt = {
        filename: file.name,
        size: file.size,
        field: field,
        owner: this.owner,
        brd: this.brd
      };
      return this.getSignedUrl(opt).then(function(arg$){
        var signedUrl, id;
        signedUrl = arg$.signedUrl, id = arg$.id;
        return ld$.xhr(signedUrl, {
          method: 'PUT',
          body: file,
          headers: {
            "Content-Type": file.type
          }
        }, {
          noDefaultHeaders: true,
          progress: function(it){
            if (progress) {
              return progress(it);
            }
          }
        }).then(function(){
          if (progress) {
            progress({
              percent: 1
            });
          }
          console.log('done');
          return {
            filename: file.name,
            size: file.size,
            modifiedtime: file.lastModified,
            url: "/dash/gcs/upload/" + id
          };
        });
      });
    }
  });
  return uploader;
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}</script><script type="module">// Generated by LiveScript 1.3.0
ldc.register(['blockbase', 'blockuploader', 'viewLocals', 'auth', 'ldNotify', 'error', 'notify'], function(arg$){
  var blockbase, blockuploader, viewLocals, auth, error, notify, mainBlock, uploadr, host;
  blockbase = arg$.blockbase, blockuploader = arg$.blockuploader, viewLocals = arg$.viewLocals, auth = arg$.auth, error = arg$.error, notify = arg$.notify;
  mainBlock = {
    name: '@taicca/future-content',
    version: 'dev'
  };
  uploadr = new blockuploader({
    brd: 'future-content',
    owner: 0
  });
  host = {
    upload: function(it){
      return uploadr.upload(it);
    }
  };
  return blockbase.init({
    mainBlock: mainBlock,
    host: host
  })['catch'](function(it){
    console.log('failed: ', it);
    return Promise.reject(it);
  });
});</script></body></html>