<div><div class="application"><div class="inner"><div class="main"><plug name="form"></plug></div><div class="side print-hide"><div class="sticky"><plug name="toc"></plug><div class="mb-4"><div class="text-sm mb-1" t>編輯進度</div><div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" ld="progress"></div></div></div><div class="d-flex flex-column g-2"><div class="btn btn-outline-secondary btn-sm d-block d-flex justify-content-around" ld="save"><span t>暫存</span> <i class="i-save"></i></div><div class="btn btn-primary btn-sm d-block d-flex justify-content-around" ld="submit"><span t>送件</span> <i class="i-upload"></i></div><div class="btn btn-primary btn-sm d-block d-flex justify-content-around" ld="print"><span t>列印</span> <i class="i-print"></i></div><div class="btn btn-primary btn-sm d-block d-flex justify-content-around" ld="invalid-check"><span t>偵錯</span> <i class="i-exclamation-circle"></i></div><div class="text-sm" ld="invalid-info"></div></div><div class="my-4"><hr></div><div><div class="text-sm" t>距離截止還有</div><div class="text-lg font-weight-bold">5 天</div></div></div></div></div></div><div class="print-hide"><div class="mb-2 text-secondary text-center text-sm text-uppercase">powered by grantdash</div><br></div><div class="ldcv for-print" ld="print-modal"><div class="base"><div class="inner"><iframe></iframe><div class="position-fixed d-flex g-4 justify-content-start bg-white w-100 p-4 border-top" style="bottom:0em;left:0em"><div class="btn btn-lg btn-primary px-4" data-ldcv-set="print">確認列印 <i class="i-print"></i></div><div class="btn btn-lg btn-outline-secondary" data-ldcv-set="">取消</div></div></div></div></div><style type="text/css">html,body{width:100%;height:auto}body{background:red}:scope{height:100%;background:#f5f6f7}.application{position:relative;width:100%;background:#f5f6f7;padding:3.5em 1.5em 1.5em;margin:0}.application:before{display:block;content:" ";position:fixed;width:17px;height:160px;left:1em;top:1em}.application .inner{display:flex;width:1024px;margin:auto;background:#fff;border:1px solid #d5d6d7;box-shadow:0 6px 12px rgba(0,0,0,0.1);border-radius:.25em}.application .main{flex:1 0 0}.application .sect{padding:3em 3em 0 3em}.application .side{min-width:10em;border-left:1px solid #e6e7e8;padding:3em 1.5em 3em 1.5em}.application .side .sticky{top:1em}.application h1{font-size:2.2em}.application h2{font-size:1.7em}.application h3{font-size:1.5em}.application h4{font-size:1.3em}.application h5{font-size:1.2em}.application h6{font-size:1.15em}.application .form-group{margin-bottom:1.5em}.application .card{break-inside:avoid;box-shadow:0 3px 6px rgba(0,0,0,0.075);margin:2em 0 3em;position:relative;padding-left:.5em;padding-right:.5em}.application .card:before{position:absolute;width:.5em;height:100%;top:0;left:0;background:repeating-linear-gradient(45deg,#e6e7e8,#e6e7e8 10px,#b6b7b8 10px,#b6b7b8 20px);content:" ";display:block;border-radius:.25em 0 0 .25em}.application .card .head{display:inline-block;font-size:1.33em;padding:0 .5em;background:#fff;margin-top:-0.66em;margin:-0.66em 0 0 1em;width:fit-content}:scope.printing .print-hide{display:none}:scope.printing .application{padding:2em 0 8em 0}:scope.printing .application .inner{border:0;box-shadow:none;border-radius:0}.ldcv.for-print .base{width:96%;height:96%}.ldcv.for-print .inner{overflow:scroll}.ldcv.for-print iframe{position:fixed;width:100%;height:100%;min-width:960px;margin:auto;top:0;bottom:0}</style><script type="@plotdb/block">var mod,slice$=[].slice;module.exports={pkg:{name:"@taiccadash/base",dependencies:[{name:"ldview"},{name:"ldcover"},{name:"@loadingio/debounce.js"},{name:"@plotdb/form"}]},interface:function(){return this.view},init:function(t){var n,r,o,a,s,e,u=this;n=t.root,r=t.ctx,o=t.manager,a=t.pubsub,s=t.i18n;e=new Promise(function(i,t){return a.on("init",function(t){var e;t==null&&(t={});u.view=e=new mod;e.pubsub=a;return e.init({root:n,ctx:r,manager:o,pubsub:a,i18n:s},t).then(function(){return i()})})});return e}};mod=function(){this._evthdr={};return this};mod.prototype=import$(Object.create(Object.prototype),{on:function(t,i){var n=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=n._evthdr)[t]||(e[t]=[])).push(i)})},fire:function(t){var e,i,n,r,o,a,s,u=[];i=[];for(n=1,r=arguments.length;n<r;++n){i.push(arguments[n])}e=i;for(n=0,a=(o=this._evthdr[t]||[]).length;n<a;++n){s=o[n];u.push(s.apply(this,e))}return u},init:function(t,e){var n,i,r,o,a,s,u,l,d,c,f,h,m,p=this;n=t.root,i=t.ctx,r=t.manager,o=t.pubsub,a=t.i18n;s=i.ldview,u=i.ldcover,l=i.form,d=i.debounce;this._invalid={list:[]};this._submod=e;this._save=d(function(t,e){t==null&&(t=true);e==null&&(e={});return p.save(t,e)});c={mode:"edit"};this.formmgr=f=new l.manager({mod:{afterCheck:function(){}}});this._invalid.check=d(function(r){var t;r==null&&(r=false);t=r?f.check(null,true):Promise.resolve();return t.then(function(t){var e,i,n;if(Array.isArray(t)){p._invalid.list=t}t=p._invalid.list.map(function(t){return t.widget.root()});if(r){e=!p._invalid.node?t[0]:t[(t.indexOf(p._invalid.node)+1)%t.length];p._invalid.node=e;if(e){i=e.getBoundingClientRect();if(true||(i.top<0||i.top+i.height>window.innerHeight)){n=i.top+window.pageYOffset-60;window.scrollTo({top:n,behavior:"smooth"})}}}return m.render("invalid-info")})});f.on("readystatechange",function(){return m.render("submit")});f.on("status",function(e){var t;if(e.status===2&&!p._invalid.list.filter(function(t){return t.path===e.path}).length){p._invalid.list.push(e);p._invalid.check()}else if(t=p._invalid.list.filter(function(t){return t.path===e.path})[0]){p._invalid.list.splice(p._invalid.list.indexOf(t),1);p._invalid.check()}return m.render("progress")});f.on("change",function(t){var e,i,n;e=t.widget,i=t.path,n=t.value;p._submod.render();return p._save()});h=r;this._ldview=m=new s({root:document.body,action:{click:{preview:function(){c.mode=c.mode==="edit"?"view":"edit";return f.mode(c.mode)},save:function(){return p._save(false,{submit:false}).now()},"invalid-check":function(){return p._invalid.check(true).now()},print:function(){var t,e,i;f.mode("view");t=c.ldcv.get(true);partialize$.apply(this,[setTimeout,[void 8,350],[0]]);e='<html><head><base href="'+window.location.protocol+"//"+window.location.host+'"/></head><body>';e+=n.outerHTML;ld$.find("link").map(function(t){return e+=t.outerHTML});ld$.find("style").map(function(t){return e+=t.outerHTML});e+='<script type="text/javascript">\ndocument.querySelector("[scope]").classList.add("printing");\n<\/script>\n</body></html>';i=URL.createObjectURL(new Blob([e],{type:"text/html"}));c.ldcv.root().querySelector("iframe").src=i;f.mode("edit");return t.then(function(t){if(t!=="print"){return}return c.ldcv.root().querySelector("iframe").contentWindow.print()})},submit:function(t){var e;e=t.node;if(f.status()!==0){return}return p._save(false,{submit:true}).now()},lng:function(t){var e,i,n,r,o,a=[];e=t.node;i=e.getAttribute("data-name");i18next.changeLanguage(i);for(n in r=p._submod.info.fields){o=r[n];o.bi.transform("i18n");a.push(o.itf.render())}return a}}},handler:{print:function(t){var e;e=t.node;return e.classList.toggle("disabled",f.status()!==0)},submit:function(t){var e;e=t.node;return e.classList.toggle("disabled",f.status()!==0)},progress:function(t){var e;e=t.node;return e.style.width=f.progress().percent*100+"%"},"invalid-info":function(t){var e,i;e=t.node;if(!(p._invalid.list!=null)){return e.innerText=""}i=p._invalid.list.length;e.classList.toggle("text-danger",i);e.classList.toggle("text-success",!i);return e.innerText=i?"找到 "+i+" 個錯誤":f.status()===0?"沒有錯誤，可以送件。":""}},init:{"print-modal":function(t){var e;e=t.node;return c.ldcv=new u({root:e})},block:function(t){var e,i,n;e=t.node;i=e.getAttribute("data-name");n=p._submod.info.fields[i];if(!n.meta.title){n.meta.title=i}return h.get({name:n.type||"@makeform/input",version:"main"}).then(function(t){return t.create()}).then(function(t){return t.attach({root:e,data:n.meta}).then(function(){n.bi=t;n.itf=t["interface"]();return f.add({widget:n.itf,path:i})})})}}});return m.init().then(function(){p.adapt();return e.init(p)})},load:function(t){var e,i,n;t==null&&(t={});this.data=t;e=this._submod.info.subset||"";if(t){this.formmgr.value(i=(e?t[e]:t)||{},{init:true})}n=localStorage.getItem("@taicca/"+this.prj.brd+"/prj/"+this.prj.slug+"/"+e);if(n){n=JSON.parse(n);if(!i||!i._modifiedtime||n._modifiedtime>i._modifiedtime){this.formmgr.value(n,{init:true})}}this._ldview.render();this._submod.render();this.pubsub.fire("after.load");return this.fire("after.load")},save:function(t,e){var i,n;t==null&&(t=true);e==null&&(e={});i=this._submod.info.subset||"";n=this.formmgr.value();n._modifiedtime=Date.now();if(!i){this.data=n}else{this.data[i]=n}localStorage.setItem("@taicca/"+this.prj.brd+"/prj/"+this.prj.slug+"/"+i,JSON.stringify(n));console.log("saved locally.");if(!this.host||t){return}return this.host.save(import$(import$({data:this.data,submit:false},this._submod.brief()),e)).then(function(t){import$(this.prj,t);return console.log("saved remotely.")})},adapt:function(t){var e,i,n,r=[],o=this;if(t!=null){this.host=t}if(!this.host){return}this.prj=t.info.prj;for(e in i=this._submod.info.fields){n=i[e];if(!n.itf){continue}r.push(a(e,n))}return r;function a(n,t){return t.itf.adapt({upload:function(t){var e,i;e=t.file,i=t.progress;return o.host.upload({file:e,progress:i,field:n})}})}}});function import$(t,e){var i={}.hasOwnProperty;for(var n in e)if(i.call(e,n))t[n]=e[n];return t}function partialize$(a,s,u){var l=this;return function(){var t=slice$.call(arguments),e,i=t.length,n=u.length,r=s?s.concat():[],o=u?u.concat():[];for(e=0;e<i;++e){r[o[0]]=t[e];o.shift()}return i<n&&i?partialize$.apply(l,[a,r,o]):a.apply(l,r)}}</script></div>