<div><div class="ldcv print-hide" ld="ldcv" data-name="application-closed" data-lock="true"><div class="base w-480 rwd"><div class="inner card"><div class="card-body"><div class="p-4"><div class="text-center"><h2 t>案件修改已經截止</h2><br></div><p t>現在已經過了表定的開放時間，您已無法再做任何修改。若您有任何問題，請洽承辦人員。</p><br><div class="btn btn-lg btn-block btn-outline-secondary" t ld="print">列印</div></div></div></div></div></div><div class="application"><div class="inner"><div class="main"><plug name="form"></plug></div><div class="side print-hide embed-hide z-float" ld="side"><div class="side-head"><div class="d-flex justify-content-between p-1 align-items-center" ld="side-toggle"><i class="i-bars"></i><i class="i-close"></i><div class="flex-grow-1 ml-3">表單功能 ...</div><div class="font-weight-bold text-center" ld="is-side-hidden state"></div></div></div><div class="sticky"><plug name="toc"></plug><div class="border rounded-sm p-2 mb-2 position-relative"><div class="text-sm bg-white px-2 position-absolute" t style="width:fit-content;top:-.75em;">狀態</div><div class="font-weight-bold text-center" ld="state"></div></div><div class="mb-4 d-none" ld="is-pending"><div class="text-sm mb-1" t>編輯進度</div><div class="progress"><div class="progress-bar progress-bar-striped progress-bar-animated" ld="progress"></div></div></div><div class="d-flex flex-column functions"><div class="mb-2 btn btn-outline-secondary btn-sm position-relative has-tips has-dirty d-none" ld="save is-pending has-dirty"><div class="text-danger dirty-dot ld ld-pulse">●</div><span class="flex-grow-1" t>暫存</span><i class="i-save"></i><div class="hover-tip left text-left" t>您有尚未存檔的更新，建議定時暫存</div></div><div class="mb-2 btn btn-primary btn-sm d-none" ld="submit locked is-pending"><span class="flex-grow-1" t>送件</span> <i class="i-upload"></i></div><div class="mb-2 btn btn-primary btn-sm" ld="print"><span class="flex-grow-1" t>列印</span> <i class="i-print"></i></div><div class="mb-2 btn btn-primary btn-sm d-none" ld="invalid-check is-pending"><span class="flex-grow-1" t>檢查</span> <i class="i-exclamation-circle"></i></div><div class="text-sm d-none" ld="invalid-info locked is-pending"></div></div><div class="my-4"><hr></div><div class="d-none" ld="is-pending"><div class="mb-4" ld="countdown"></div></div><plug name="side-ext"></plug></div></div></div></div><div class="print-hide embed-hide"><div class="mb-2 text-secondary text-center text-sm text-uppercase">powered by grantdash</div><br></div><div class="ldcv for-print" ld="print-modal"><div class="base"><div class="inner"><iframe></iframe><div class="position-fixed d-flex _g-4 justify-content-start bg-white w-100 p-4 border-top" style="bottom:0em;left:0em"><div class="btn btn-lg btn-primary px-4" t data-ldcv-set="print">確認列印 <i class="i-print"></i></div><div class="btn btn-lg btn-outline-secondary" t data-ldcv-set="">取消</div></div></div></div></div><style type="text/css">html,body{width:100%;height:auto}body{background:#fff}:scope{height:100%;background:#f5f6f7}.application{position:relative;width:100%;background:#f5f6f7;padding:3.5em 1.5em 1.5em;margin:0}.application *[t]:first-letter {text-transform:uppercase}.application:before{display:block;content:" ";position:fixed;width:17px;height:160px;left:1em;top:1em}.application>.inner{display:flex;width:1024px;margin:auto;background:#fff;border:1px solid #d5d6d7;box-shadow:0 6px 12px rgba(0,0,0,0.1);border-radius:.25em}.application .main{flex:1 0 0}.application .sect{padding:3em 3em 0 3em}.application .chapter{margin:1em 0;padding:0}.application .chapter .head{margin:2erm;text-align:center}.application .chapter .head h1,.application .chapter .head h2,.application .chapter .head h3,.application .chapter .head h4,.application .chapter .head h5,.application .chapter .head h6{margin:0}.application .chapter .body{padding:2em;margin:2em;border:1px solid #d5d6d7;border-radius:.25em;box-shadow:0 4px 6px rgba(0,0,0,0.1)}.application .chapter .sect{padding:3em 0}.application .side{min-width:10em;max-width:14em;border-left:1px solid #e6e7e8;padding:3em 1.5em 3em 1.5em}.application .side .side-head{display:none}.application .side .sticky{top:1em}.application .side .has-dirty .dirty-dot{position:absolute;display:none;left:.5em}.application .side .has-dirty .hover-tip{display:none !important}.application .side .has-dirty.dirty .dirty-dot{display:block}.application .side .has-dirty.dirty .hover-tip{display:block !important;pointer-events:none}.application h1{font-size:2.2em}.application h2{font-size:1.7em}.application h3{font-size:1.5em}.application h4{font-size:1.3em}.application h5{font-size:1.2em}.application h6{font-size:1.15em}.application .form-group{margin-bottom:1.5em}.application .page{break-inside:avoid;break-before:always;break-after:always}.application .card{break-inside:avoid;box-shadow:0 3px 6px rgba(0,0,0,0.075);margin:2em 0 3em;position:relative;padding-left:.5em;padding-right:.5em}.application .card:before{position:absolute;width:.5em;height:100%;top:0;left:0;background:repeating-linear-gradient(45deg,#e6e7e8,#e6e7e8 10px,#b6b7b8 10px,#b6b7b8 20px);content:" ";display:block;border-radius:.25em 0 0 .25em}.application .card .head{display:inline-block;font-size:1.33em;padding:0 .5em;background:#fff;margin-top:-0.66em;margin:-0.66em 0 0 1em;width:fit-content}.application .functions>.btn{display:flex;justify-content:space-around}:scope.printing{background:#fff}:scope.printing .print-hide{display:none !important}:scope.printing .application{padding:2em 0 8em 0;background:#fff}:scope.printing .application .inner{border:0;box-shadow:none;border-radius:0}:scope.embedded .embed-hide{display:none !important}:scope.embedded .application{padding:0}:scope.embedded .application .inner{width:100%;border:0;border-radius:0;box-shadow:0 0}.ldcv.for-print .base{width:96%;height:96%}.ldcv.for-print .inner{overflow:scroll}.ldcv.for-print iframe{position:fixed;width:100%;height:100%;min-width:960px;margin:auto;top:0;bottom:0}@media(max-width:960px){.application{padding:0}.application .inner{max-width:100%}.application .sect{padding:1em}.application .side{max-width:100%;font-size:1.3em;overflow-y:scroll;position:fixed;bottom:0;width:100%;padding:1em;background:#fff;border-top:1px solid #d5d6d7;box-shadow:0 -1px 2px rgba(0,0,0,0.1)}.application .side .btn{font-size:1em}.application .side i.i-bars{display:block}.application .side i.i-close{display:none}.application .side .sticky{position:static;display:none;margin-top:2em}.application .side .side-head{display:block;cursor:pointer}.application .side.on{height:100%}.application .side.on i.i-bars{display:none}.application .side.on i.i-close{display:block}.application .side.on .sticky{position:static;display:block}.application .side.on .sticky,.application .side.on .side-head{max-width:480px;margin-left:auto;margin-right:auto}}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@grantdash/prj.base",dependencies:[{name:"ldview"},{name:"ldcover"},{name:"ldcover",path:"index.min.css",global:true},{name:"ldloader"},{name:"ldcvmgr"},{name:"@loadingio/debounce.js"},{name:"@plotdb/form"}],i18n:{en:{"檢查":"validate","列印":"print","已送件":"submitted","狀態":"status","尚未送件":"work in progress","送件":"submit","暫存":"save","編輯進度":"editing progress","取消":"cancel","確認列印":"confirm and print","沒有錯誤，可以送件":"ready to submit","找到":"found","個錯誤":"error(s)","您有尚未存檔的更新，建議定時暫存":"You have unsaved updates. Save to keep your progress","案件修改已經截止":"Applications are now closed.","現在已經過了表定的開放時間，您已無法再做任何修改。若您有任何問題，請洽承辦人員。":"Applications are now closed. You can no longer edit / save this project. Please contact our staff for any questions."},"zh-TW":{"檢查":"檢查","列印":"列印","已送件":"已送件","狀態":"狀態","尚未送件":"尚未送件","送件":"送件","暫存":"暫存","編輯進度":"編輯進度","取消":"取消","確認列印":"確認列印","沒有錯誤，可以送件":"沒有錯誤，可以送件","找到":"找到","個錯誤":"個錯誤","您有尚未存檔的更新，建議定時暫存":"您有尚未存檔的更新，建議定時暫存","現在已經過了表定的開放時間，您已無法再做任何修改。若您有任何問題，請洽承辦人員。":"現在已經過了表定的開放時間，您已無法再做任何修改。若您有任何問題，請洽承辦人員。"}}},interface:function(){return this.view},init:function(t){var i,r,o,a,s,d,u,e,l=this;i=t.root,r=t.ctx,o=t.manager,a=t.pubsub,s=t.i18n,d=t.t,u=t.data;e=new Promise(function(n,t){return a.on("init",function(t){var e;t==null&&(t={});l.view=e=new mod;e.pubsub=a;return e.init({root:i,ctx:r,manager:o,pubsub:a,i18n:s,t:d,data:u},t).then(function(){return n()})})});return e}};mod=function(){this._evthdr={};return this};mod.prototype=import$(Object.create(Object.prototype),{on:function(t,n){var i=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=i._evthdr)[t]||(e[t]=[])).push(n)})},fire:function(t){var e,n,i,r,o,a,s,d=[];n=[];for(i=1,r=arguments.length;i<r;++i){n.push(arguments[i])}e=n;for(i=0,a=(o=this._evthdr[t]||[]).length;i<a;++i){s=o[i];d.push(s.apply(this,e))}return d},init:function(t,e){var o,n,i,r,a,s,d,u,l,c,f,m,h,g,p,_,b,w=this;o=t.root,n=t.ctx,i=t.manager,r=t.pubsub,a=t.i18n,s=t.t,d=t.data;u=n.ldview,l=n.ldcvmgr,c=n.ldcover,f=n.form,m=n.debounce;this._blockopt=d;o.classList.toggle("embedded",!!this._blockopt.isEmbedded);this._admin=false;this._expired=false;this.data=null;this._L=null;this._invalid={list:[]};this._ldcv={};this._submod=e;this._save=m(function(t,e){t==null&&(t=true);e==null&&(e={});return w.save(t,e)});this._ldcvmgr=new l({manager:i});h={saved:{name:"@grantdash/prj.base",path:"covers/saved.html"},"submit-confirm":{name:"@grantdash/prj.base",path:"covers/submit-confirm.html"},submitting:{name:"@grantdash/prj.base",path:"covers/submitting.html"},"print-timeout":{name:"@grantdash/prj.base",path:"covers/print-timeout.html"},saving:{name:"@grantdash/prj.base",path:"covers/saving.html"},submitted:{name:"@grantdash/prj.base",path:"covers/submitted.html"},invalid:{name:"@grantdash/prj.base",path:"covers/invalid.html"}};this.ldcvmgr={toggle:function(t,e,n){var i;i=w._submod.ldcvmgr?w._submod.ldcvmgr.toggle(t,e,n):null;if(i){return i}else if(h[t]){return w._ldcvmgr.toggle(h[t],e,n)}else{return null}},get:function(t,e){var n;n=w._submod.ldcvmgr?w._submod.ldcvmgr.get(t,e):void 8;if(n){return n}else if(h[t]){return w._ldcvmgr.get(h[t],v,e)}else{return null}}};this.dirty=false;this._changeLanguage=function(t){var e,n,i;this._lng=t;if(!this.host){return}this.host.changeLanguage(t);for(e in n=this._submod.info.fields){i=n[e];if(!i.bi){continue}i.bi.transform("i18n");i.itf.render()}this._countdown.instance.transform("i18n");return this._ldview.render("t")};r.on("change-language",function(t){return w._changeLanguage(t)});this._state={locked:function(){return(w.formmgr.status()!==0||w.prj.state==="active"||w._expired)&&!w._admin},valid:function(){return w.formmgr.status()===0},active:function(){return w.prj&&w.prj.state==="active"}};this._lc=g={mode:this._blockopt.mode||"view"};this.formmgr=p=new f.manager;this._invalid.check=m(function(r){var t;r==null&&(r=false);t=r?p.check(null,true):Promise.resolve();return t.then(function(t){var e,n,i;if(Array.isArray(t)){w._invalid.list=t}t=w._invalid.list.map(function(t){return t.widget.root()});if(r){e=!w._invalid.node?t[0]:t[(t.indexOf(w._invalid.node)+1)%t.length];w._invalid.node=e;if(e){n=e.getBoundingClientRect();if(true||(n.top<0||n.top+n.height>window.innerHeight)){i=n.top+window.pageYOffset-60;window.scrollTo({top:i,behavior:"smooth"})}}}return b.render("invalid-info")})});p.on("readystatechange",function(){return b.render(["submit","print","invalid-info","save"])});p.on("status",function(e){var t;if(e.status===2&&!w._invalid.list.filter(function(t){return t.path===e.path}).length){w._invalid.list.push(e);w._invalid.check()}else if(t=w._invalid.list.filter(function(t){return t.path===e.path})[0]){w._invalid.list.splice(w._invalid.list.indexOf(t),1);w._invalid.check()}return b.render("progress")});p.on("change",function(t){var e,n,i;e=t.widget,n=t.path,i=t.value;if(e.isEqual(i,w._L[n])){return}w._submod.render();return w._save()});_=i;this._ldview=b=new u({initRender:false,root:o,action:{click:{"side-toggle":function(){b.get("side").classList.toggle("on");return b.render("is-side-hidden")},preview:function(){if(w._state.active()){return}return w.viewmode(g.mode==="edit"?"view":"edit")},save:function(){return w._save(false,{submit:false}).now()},dump:function(){return w._save(false,{submit:false,dump:true}).now()},"invalid-check":function(){return w._invalid.check(true).now()},print:function(){var n,i,r;w.render();n=p.mode();i="";r=g.ldcv.get(true);return p.mode("view").then(function(){i+='<!DOCTYPE html>\n<html><head><meta charset="utf-8">\n<base href="'+window.location.protocol+"//"+window.location.host+'"/>\n</head><body style="display:none">';i+=o.outerHTML;return Promise.all(ld$.find("link").filter(function(t){return t.getAttribute("rel")==="stylesheet"&&t.hasAttribute("href")}).map(function(t){return ld$.fetch(t.getAttribute("href"),{method:"GET"},{type:"text"}).then(function(t){return'<style type="text/css">'+t+"</style>"})["catch"](function(){})}))}).then(function(t){var e;i+=t.join("");ld$.find("style").map(function(t){return i+=t.outerHTML});i+='<script type="text/javascript">\ndocument.querySelector("[scope]").classList.add("printing");\ndocument.body.style.display = "block";\n<\/script>\n</body></html>';e=URL.createObjectURL(new Blob([i],{type:"text/html"}));g.ldcv.root().querySelector("iframe").src=e;p.mode(n||"edit");return r.then(function(t){if(t!=="print"){return}return g.ldcv.root().querySelector("iframe").contentWindow.print()})})},submit:function(t){var e;e=t.node;return w._invalid.check(true).now().then(function(){if(!w._state.valid()){return w.ldcvmgr.get("invalid")}return w._save(false,{submit:true}).now()})},lng:function(t){var e;e=t.node;return w._changeLanguage(e.getAttribute("data-name"))}}},text:{autofill:function(t){var e,n,i,r;e=t.node,n=t.views;i=e.getAttribute("data-name");if(!(r=w._submod.info.fields[i])){return""}if(!r._autofill){r.itf.on("change",(r._autofill||(r._autofill={})).handler=function(){return n[0].render("autofill")})}return r.itf.content()}},handler:{"is-side-hidden":function(t){var e;e=t.node;return e.classList.toggle("d-none",b.get("side").classList.contains("on"))},t:function(t){var e,n;e=t.node;n=e.getAttribute("data-lng")||"";return e.classList.toggle("d-none",!n.startsWith(a.getLanguage()))},"@":function(){return w.formmgr.mode(w._state.active()?"view":w._lc.mode||"edit")},"has-dirty":function(t){var e;e=t.node;return e.classList.toggle("dirty",!!w._dirty)},state:function(t){var e;e=t.node;return e.innerText=s(w._state.active()?"已送件":"尚未送件")},submit:function(t){var e;e=t.node;return e.classList.toggle("d-none",w._state.active())},progress:function(t){var e;e=t.node;return e.style.width=p.progress().percent*100+"%"},submitted:function(t){var e;e=t.node;return e.classList.toggle("d-none",!w._state.active())},locked:function(t){var e;e=t.node;return e.classList.toggle("disabled",w._state.locked())},"is-pending":function(t){var e;e=t.node;return e.classList.toggle("d-none",w._state.active())||w._blockopt.mode==="view"},"invalid-info":function(t){var e,n;e=t.node;if(!(w._invalid.list!=null)){return e.innerText=""}n=w._invalid.list.length;e.classList.toggle("text-danger",n);e.classList.toggle("text-success",!n);return e.innerText=n?s("找到")+(" "+n+" ")+s("個錯誤"):p.status()===0?s("沒有錯誤，可以送件"):""},block:function(t){var e,n,i;e=t.node;n=e.getAttribute("data-name");i=w._submod.info.fields[n];i.itf.render();return e.classList.toggle("d-none",false)}},init:{"print-modal":function(t){var e;e=t.node;return g.ldcv=new c({root:e})},ldcv:function(t){var e,n,i;e=t.node;n=e.getAttribute("data-name");i=e.getAttribute("data-lock");return w._ldcv[n]=new c({root:e,lock:i===true})},countdown:function(t){var e,n;e=t.node;n={config:{deadline:w._submod.info.deadline||Date.now()}};return _.from({name:"@makeform/countdown"},{root:e,data:n}).then(function(t){return w._countdown=t})},block:function(t){var e,n,i;e=t.node;n=e.getAttribute("data-name");i=w._submod.info.fields[n];if(!i){return console.warn("config not found for field "+n)}if(!i.meta.title){i.meta.title=n}e.classList.toggle("d-none",true);return _.from({name:i.type||"@makeform/input",version:"main"},{root:e,data:i.meta}).then(function(t){i.itf=t["interface"];i.bi=t.instance;i.root=e;return p.add({widget:i.itf,path:n})})["catch"](function(t){return Promise.reject(t)})}}});return b.init().then(function(){w.adapt();e.init(w);w._countdown["interface"].on("status",function(t){w._expired=t===2;if(t===2&&w._blockopt.mode!=="view"&&!w._admin){w._ldcv["application-closed"].get()}return b.render()});return b.render()})},load:function(t){var e,n,i,r,o=this;t==null&&(t={});this.data=t;e=this._submod.info.subset||"";n=t?(e?t[e]:t)||{}:null;i=localStorage.getItem("@grantdash/prj.base/"+this.prj.brd+"/prj/"+this.prj.slug+"/"+e);if(i){i=JSON.parse(i)}console.log("load but skip local data...");r=!n||!n._modifiedtime||i&&i._modifiedtime>n._modifiedtime?r=i:n;r=n;this._L=r||{};this._dirty=r===i;if(!r){return}return this.formmgr.value(r,{init:true}).then(function(){o.pubsub.fire("after.load");o.fire("after.load");return o.render()})},save:function(r,o){var a=this;r==null&&(r=true);o==null&&(o={});if((this._blockopt.isEmbedded||this._blockopt.mode==="view"||this._expired)&&!this._admin){return}return Promise.resolve().then(function(){var t;if(a._state.active()&&!a._admin){return}t=o.submit?a._invalid.check(true).now().then(function(){if(a._state.locked()){return o.submit=false}}):Promise.resolve(true);return t.then(function(){var t,e,n,i;t=a._submod.info.subset||"";a._L=e=a.formmgr.value();if(window._grantdashimporter){console.log("use local data from window._grantdashimporter");a._L=e=t?window._grantdashimporter.data[t]:window._grantdashimporter.data}e._modifiedtime=Date.now();if(!t){a.data=e}else{a.data[t]=e}localStorage.setItem("@grantdash/prj.base/"+a.prj.brd+"/prj/"+a.prj.slug+"/"+t,JSON.stringify(e));console.log("saved locally.");a._dirty=true;a.render("has-dirty");if(!a.host||r){return}n=import$(import$({data:a.data,submit:false},a._submod.brief()),o);if(o.dump){return ldfile.download({data:JSON.stringify({data:a.data})})}i=!n.submit?Promise.resolve("yes"):a.ldcvmgr.get("submit-confirm");return i.then(function(t){if(t==="no"){return}return a.host.save(n).then(function(t){if(window._grantdashimporter){window.location.reload()}import$(a.prj,t);a._dirty=false;return a.render()})})})})},viewmode:function(t){if(!(t==="edit"||t==="view")){return}this._lc.mode=t;return this.formmgr.mode(this._lc.mode)},adapt:function(t){var e,n,i,r,o=this;if(t!=null){this.host=t}if(!this.host){return}if(e=this._submod.info.defaultLanguage){this._changeLanguage(e)}this.prj=t.info.prj;this._admin=in$("admin",(n=t.info).role||(n.role=[]));for(i in n=this._submod.info.fields){r=n[i];if(!r.itf){continue}a(i,r)}if(this._countdown["interface"].status()===2){this._expired=true;if(this._blockopt.mode!=="view"&&!this._admin){return this._ldcv["application-closed"].get()}}function a(i,t){return t.itf.adapt({upload:function(t){var e,n;e=t.file,n=t.progress;return o.host.upload({file:e,progress:n,field:i})}})}},render:function(){this._ldview.render();return this._submod.render()}});function import$(t,e){var n={}.hasOwnProperty;for(var i in e)if(n.call(e,i))t[i]=e[i];return t}function in$(t,e){var n=-1,i=e.length>>>0;while(++n<i)if(t===e[n])return true;return false}</script></div>