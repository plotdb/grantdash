var ldcvmgr;function import$(t,r){var e,n={}.hasOwnProperty;for(e in r)n.call(r,e)&&(t[e]=r[e]);return t}(ldcvmgr=function(t){var r;return this.opt=t=null==t?{}:t,this.evtHandler={},this.path=t.path||"/modules/cover","string"==typeof this.path&&(this.path=this.path.replace(/\/$/,"")),this.loader=(r=t.loader)?r:new ldloader({className:"ldld full",autoZ:!0}),this.mgr=t.manager||null,this.covers={},this.workers={},this.errorHandling=!1,this.prepareProxy=proxise(function(t){}),t.autoInit&&this.init(),this}).prototype=import$(Object.create(Object.prototype),{on:function(t,r){var e;return((e=this.evtHandler)[t]||(e[t]=[])).push(r)},fire:function(t){for(var r,e,n,o,i=[],c=[],a=1,s=arguments.length;a<s;++a)c.push(arguments[a]);for(r=c,a=0,n=(e=this.evtHandler[t]||[]).length;a<n;++a)o=e[a],i.push(o.apply(this,r));return i},error:function(t,r){return null==r&&(r={}),"error"===(t=null==t?"":t)?alert("something is wrong; please reload and try again"):(this.errorHandling=!0,this.toggle("error")),console.log(r.message||r)},_id:function(t){return"object"==typeof t?this.mgr.id(t):t},prepare:function(t){var e=this,n=this._id(t);return this.covers[n]?Promise.resolve():this.workers[n]?this.prepareProxy(n):(this.errorHandling?(this.loader.on(),this.errorHandling=!1):this.loader.on(1e3),("object"==typeof t?this.workers[n]=this.mgr.get(t).then(function(t){return t.create()}).then(function(t){return t.attach({root:document.body}).then(function(){return e.covers[n]=t.interface(),t.dom()})}):(t=document.querySelector(".ldcvmgr[data-name="+n+"]"))?Promise.resolve(t):(t="function"==typeof this.path?this.path(n):this.path+"/"+n+".html",this.workers[n]=fetch(t).then(function(t){if(!t||!t.ok)throw new Error("modal '"+(n||"<no-name>")+"' load failed.");return t.text()}).then(function(t){var r;return document.body.appendChild(r=ld$.create({name:"div"})),r.innerHTML=t,ld$.find(r,"script").map(function(t){var r=ld$.create({name:"script",attr:{type:"text/javascript"}});return r.text=t.textContent,t.parentNode.replaceChild(r,t)}),r.querySelector(".ldcv")}))).finally(function(){return e.loader.cancel(!1)}).then(function(t){var r;return e.covers[n]||(e.covers[n]=new ldcover({root:t,lock:"true"===t.getAttribute("data-lock")})),e.prepareProxy.resolve(),t=(r=e.workers)[n],delete r[n],t}).catch(function(t){throw e.prepareProxy.reject(t),delete e.workers[n],t}))},purge:function(t){var r,e=this._id(t);return null!=e?(t=(r=this.covers)[e],delete r[e],t):this.covers={}},lock:function(t,r){var e=this,n=this._id(t);return this.prepare(t).then(function(){return e.covers[n].lock()}).then(function(){return e.covers[n].toggle(!0)}).catch(function(t){return e.error(n,t)})},toggle:function(t,r,e){var n=this,o=this._id(t);return this.prepare(t).then(function(){return n.covers[o].toggle(r)}).then(function(){return n.fire(n.covers[o].isOn()?"on":"off",{node:n.covers[o],param:e,name:o})}).catch(function(t){return n.error(o,t)})},getcover:function(t){var r=this,e=this._id(t);return this.prepare(t).then(function(){return r.covers[e]})},getdom:function(t){var r=this,e=this._id(t);return this.prepare(t).then(function(){return r.covers[e].root()})},isOn:function(t){t=this._id(t);return this.covers[t]&&this.covers[t].isOn()},set:function(t,r){var e=this,n=this._id(t);return this.prepare(t).then(function(){return e.covers[n].set(r)})},get:function(t,r){var e=this,n=this._id(t);return this.prepare(t).then(function(){return e.fire("on",{node:e.covers[n],param:r,name:n})}).then(function(){return e.covers[n].get()}).catch(function(t){return e.error(n,t)})},init:function(t){var e=this;return ld$.find(t||document.body,".ldcvmgr").map(function(t){var r;if((r=t.getAttribute("data-name"))&&!e.covers[r])return e.covers[r]=new ldcover({root:t,lock:"true"===t.getAttribute("data-lock")})}),document.body.addEventListener("click",function(t){var r;if((t=ld$.parent(t.target,"[data-ldcvmgr-toggle]"))&&(r=t.getAttribute("data-ldcvmgr-toggle")))return e.toggle(/:/.exec(r)?e.mgr.id2obj(r):r)})}}),"undefined"!=typeof module&&null!==module?module.exports=ldcvmgr:"undefined"!=typeof window&&null!==window&&(window.ldcvmgr=ldcvmgr);
