(function(){function n(n,t){var e={}.hasOwnProperty;for(var r in t)e.call(t,r)&&(n[r]=t[r]);return n}var t,e,r,i,o,u,c;t="undefined"!=typeof window&&null!==window?window.fetch:"undefined"!=typeof module&&null!==module&&"undefined"!=typeof require&&null!==require?require("node-fetch"):null,i=function(e,r){return t(e,r).then(function(t){var e;return t&&t.ok?t.text():t?t.clone().text().then(function(e){var r,i,o,u;r=t.status||404,(o=new Error(r+" "+e)).name="lderror",o.id=r,o.message=e,i=o;try{(u=JSON.parse(e))&&"lderror"===u.name&&(n(i,u).json=u)}catch(n){n}return Promise.reject(i)}):Promise.reject((e=new Error("404"),e.name="lderror",e.id=404,e))})},(o=function(n){var t,i,o,u,c=this;return null==n&&(n={}),this.lc=n.context||{},this.id=Math.random().toString(36).substring(2),n.iframe?this.iframe=n.iframe:(this.iframe=t=r.createElement("iframe"),(i=t.style).position="absolute",i.top=0,i.left=0,i.width=0,i.height=0,i.pointerEvents="none",i.opacity=0,t.setAttribute("title","rescope script loader"),t.setAttribute("name","pdb-proxin-"+this.id),t.setAttribute("sandbox","allow-same-origin allow-scripts"),r.body.appendChild(t)),o=Object.fromEntries(Reflect.ownKeys(this.iframe.contentWindow).map(function(n){return[n,!0]})),u={},this._proxy=new Proxy(n.target||e,{get:function(n,t,e){if(null!=c.lc[t])return c.lc[t];if(null!=u[t])return u[t];if(null!=o[t])return"function"==typeof n[t]?u[t]=n[t].bind(n):n[t]},set:function(n,t,e){return o[t]?(n[t]=e,!0):(c.lc[t]=e,!0)}}),this}).prototype=(u=Object.create(Object.prototype),u.proxy=function(){return this._proxy},u.ctx=function(){return this.lc},u),(c=function(n){var t,e;return null==n&&(n={}),this.id=Math.random().toString(36).substring(2),this.iframe=t=r.createElement("iframe"),this._cache={},this.proxy=new o,this.registry(n.registry||"/assets/lib/"),e=t.style,e.position="absolute",e.top=0,e.left=0,e.width=0,e.height=0,e.pointerEvents="none",e.opacity=0,t.setAttribute("title","rescope script loader"),t.setAttribute("name","pdb-rescope-"+this.id),t.setAttribute("sandbox","allow-same-origin allow-scripts"),r.body.appendChild(t),t.contentWindow.document.body.innerHTML=(n.preloads||[]).map(function(n){return'<script type="text/javascript" src="'+n+'"><\/script>'}).join(""),this}).env=function(n){var t;return t=[n,n.document],e=t[0],r=t[1],t},c.prop={legacy:{webkitStorageInfo:!0}},c.id=function(n){return n.id||n.url||n.name+"@"+n.version+"/"+n.path},c._cache={},c.cache=function(t){var e;return"string"==typeof t&&(t={url:t}),t.id||(t.id=c.id(t)),(e=c._cache[t.id])?e:c._cache[t.id]=n({},t)},c.prototype=(u=Object.create(Object.prototype),u.peekScope=function(){return!1},u.init=function(){return Promise.resolve()},u._url=function(n){var t;return"string"==typeof n?n:(t=n.url)?t:this._reg(n)},u.registry=function(n){return"string"==typeof n?("/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),this._reg=function(n){return function(t){return n+"/"+t.name+"/"+(t.version||"main")+"/"+(t.path||"index.min.js")}}(n)):this._reg=n},u.cache=function(t){var e,r;return"string"==typeof t&&(t={url:t}),t.id||(t.id=c.id(t)),(e=this._cache[t.id])?e:(r=c._cache[t.id])?this._cache[t.id]=r:this._cache[t.id]=n({},t)},u.bundle=function(n){var t=this;return null==n&&(n=[]),n=(Array.isArray(n)?n:[n]).map(function(n){return t.cache(n)}),this.load(n,null,!0).then(function(){var e;return e=n.filter(function(n){return n.code}).map(function(n){var e;return e=t._wrap(n,{},{codeOnly:!0}),"{"+(n.url?"url: '"+n.url+"',":"")+"id: '"+n.id+"',gen: "+e+"}"}),Promise.resolve("["+e.join(",")+"].forEach(function(o){rescope.cache(o);})")})},u.exports=function(n){var t,e,r,i,o,u,c=[];null==n&&(n={}),t=n.ctx||{},e="string"==typeof n.libs?[n.libs]:n.libs||[],i=(r=[{},this.iframe.contentWindow])[0],o=r[1];for(u in t)i[u]=o[u],o[u]=t[u];this._exports(e,0,t);for(u in i)c.push(o[u]=i[u]);return c},u._exports=function(t,e,r){var i,o,u,l,s,a,p,f,d=[];if(null==e&&(e=0),null==r&&(r={}),i=t[e]){if(i=this.cache(i),o=[{},i.fprop,this.iframe.contentWindow],u=o[0],l=o[1],s=o[2],l)for(a in l)u[a]=s[a],s[a]=l[a];else if(i.fprop=l={},i.prop={},i.propIniting=!0,i.gen)n(l,i.gen.apply(s,[s,s,s])),i.prop=Object.fromEntries(function(){var n=[];for(a in l)n.push([a,null]);return n}());else{p=Object.fromEntries(Reflect.ownKeys(s).filter(function(n){return!c.prop.legacy[n]}).map(function(n){return[n,!0]}));for(a in p)u[a]=s[a];s.eval(i.code),f=Object.fromEntries(Reflect.ownKeys(s).filter(function(n){return!c.prop.legacy[n]}).map(function(n){return[n,!0]}));for(a in f)s[a]!==u[a]&&"NaN"!==a&&(l[a]=s[a],i.prop[a]=null)}for(a in l)r[a]=l[a];this._exports(t,e+1);for(a in l)d.push(s[a]=u[a]);return d}},u._wrap=function(n,t,e){var r,i,o;null==n&&(n={}),null==t&&(t={}),null==e&&(e={}),r=n.prop||{},i="var window, global, globalThis, self, __ret = {}; __win = {};\nwindow = global = globalThis = window = scope;";for(o in r)i+="var "+o+"; __win['"+o+"'] = win['"+o+"']; win['"+o+"'] = undefined;";for(o in t)i+="var "+o+" = window['"+o+"'] = ctx['"+o+"'];";i+=n.code+";";for(o in r)i+="__ret['"+o+"'] = "+o+" || window['"+o+"'] || win['"+o+"'] || this['"+o+"'];\nwin['"+o+"'] = __win['"+o+"'];";return i+="return __ret;",e.codeOnly?"function(scope, ctx, win){"+i+"}":new Function("scope","ctx","win",i)},u.load=function(t,e,r){var u,c,l,s,a=this;return null==e&&(e={}),null==r&&(r=!1),t=(Array.isArray(t)?t:[t]).map(function(n){return a.cache(n)}),u=t.px?t.px:t.px=e&&e.p?e.p:new o,c=u.ctx(),l=u.proxy(),s=t.map(function(n){return!n.code&&!n.gen||r?i(a._url(n),{method:"GET"}).then(function(t){return n.code=t}):Promise.resolve()}),Promise.all(s).then(function(){return a.exports({libs:t,ctx:e.f}),t.map(function(t){return t.propIniting&&(t.gen||(t.gen=a._wrap(t,c)),t.prop=t.gen.apply(l,[l,c,window]),t.propIniting=!1),n(c,t.prop)})}).then(function(){return c})},u.context=function(n,t,e){var r;return"function"!=typeof t&&(t=(r=[e,t])[0],e=r[1]),this.load(n,e).then(function(n){return t?t(n):n})},u),c.env("undefined"!=typeof self&&null!==self?self:globalThis),c.proxin=o,c.dualContext=function(){return{p:new o,f:{},ctx:function(){return this.p.ctx()}}},"undefined"!=typeof module&&null!==module?module.exports=c:"undefined"!=typeof window&&null!==window&&(window.rescope=c)}).call(this);
