<div><div plug="widget"><table class="table"><tr><th ld-each="head"></th><th>&nbsp;</th></tr><tr ld="no-data"><td class="text-muted" colspan="99" t>無資料</td></tr><tr ld-each="row"><td style="vertical-align:middle;" ld-each="editor-field"></td><td><div class="btn btn-block btn-outline-secondary text-nowrap" t ld="delete">刪除</div></td></tr><tr><td ld-each="adder-field"></td><td><div class="btn btn-block btn-outline-secondary text-nowrap" t ld="add">加入</div></td></tr></table></div><style type="text/css">label{white-space:nowrap}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/table",extend:{name:"@makeform/base"},i18n:{en:{"加入":"Add","刪除":"Delete","無資料":"No data"},zh:{"加入":"加入","刪除":"刪除","無資料":"無資料"}}},init:function(t){return t.pubsub.fire("init",{mod:mod(t)})}};mod=function(t){var e,n,r,i,a,d,f,l,o,s,v;e=t.root,n=t.ctx,r=t.data,i=t.parent,a=t.t,d=t.manager;f=n.ldview;l={data:[]};o={fields:[]};s={};v=function(t){return l.meta=t,l.cfg=t.config,l};v(r);return{render:function(){return this.view.render()},isEmpty:function(t){return!Array.isArray(t)||!t.length},init:function(){var c,u,t=this;this.on("meta",function(){return v(t.serialize())});this.on("change",function(t){t==null&&(t=[]);l.data=t;return this.view.render()});c=function(){return t.value(l.data)};u=function(t,e){return t.alias||t.key||t.title||e};return this.view=new f({root:e,action:{click:{add:function(t){var e;e=t.views;l.data.push({list:l.cfg.fields.map(function(t,e){var n;n=u(t,e);return{key:n,value:o.fields[n].itf.value()}}),key:Math.round(Date.now()+Math.random()*65535).toString(36).substring(2)});c();return e[0].render()}}},handler:{"no-data":function(t){var e;e=t.node;return e.classList.toggle("d-none",l.data&&l.data.length)},head:{list:function(){return l.cfg.fields.map(function(t,e){return{cfg:t,key:u(t,e)}})},key:function(t){return t.key},text:function(t){var e;e=t.data;return a(e.cfg.meta.title||"untitled")}},row:{list:function(){return l.data},key:function(t){return t.key},view:{action:{click:{delete:function(t){var e,n,r;e=t.views,n=t.ctx;r=l.data.map(function(t){return t.key}).indexOf(n.key);if(r===-1){return}l.data.splice(r,1);c();return e[1].render()}}},handler:{"editor-field":{list:function(t){var e;e=t.ctx;return e.list},key:function(t){return t.key},view:{init:{"@":function(t){var e,f,o,n,r,i,a;e=t.node,f=t.ctx,o=t.ctxs;n=Object.fromEntries(l.cfg.fields.map(function(t,e){return[u(t,e),t]}));r=n[f.key]||{},i=r.type,a=r.meta;if(!a){return}return d.from({name:i},{root:e,data:a}).then(function(t){var e,n,r,i,a,u;e=((e=s[i=o[0].key]||(s[i]={}))[r=n!=null?n:f.key]||(e[r]={}),e[n]={bi:t.instance,itf:t["interface"]}),a=e.bi,u=e.itf;u.value(f.value);return u.on("change",function(){f.value=u.value();return c()})})}},render:{"@":function(t){var e,n;e=t.ctx,n=t.ctxs;return s[n[0].key][e.key].itf.value(e.value)}}}}}}},"adder-field":{list:function(){return l.cfg.fields.map(function(t,e){return{cfg:t,key:u(t,e)}})},key:function(t){return t.key},view:{init:{"@":function(t){var e,n,r,i,a;e=t.ctx,n=t.node;r=e.cfg,i=r.type,a=r.meta;return d.get({name:i||"input"}).then(function(t){return t.create()}).then(function(t){return t.attach({root:n,data:a}).then(function(){return o.fields[e.key]={bi:t,itf:t["interface"]()}})})}},handler:{"@":function(t){var e,n,r,i;e=t.ctx;n=o.fields[e.key]||{},r=n.bi,i=n.itf;if(!i){return}i.deserialize(e.cfg.meta);r.transform("i18n");return i.render()}}}}}})}}};</script></div>