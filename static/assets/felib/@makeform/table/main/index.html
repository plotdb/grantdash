<div><div plug="widget"><table class="table"><tr><th ld-each="head"></th><th>&nbsp;</th></tr><tr ld="no-data"><td class="text-muted" colspan="99">無資料</td></tr><tr ld-each="row"><td style="vertical-align:middle;" ld-each="field"></td><td><div class="btn btn-outline-secondary text-nowrap" t ld="delete">刪除</div></td></tr><tr><td ld-each="field"></td><td><div class="btn btn-outline-secondary text-nowrap" t ld="add">加入</div></td></tr></table></div><style type="text/css">label{white-space:nowrap}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/table",extend:{name:"@makeform/base"},i18n:{en:{"加入":"Add"}}},init:function(n){return n.pubsub.fire("init",{mod:mod(n)})}};mod=function(n){var e,t,r,i,o,a,u,s,m;e=n.root,t=n.ctx,r=n.data,i=n.parent,o=n.t,a=n.manager;u=t.ldview;s={rows:[]};m=r||{};return{init:function(){var r,n=this;this.on("change",function(n){var e,t,r,i,o,a,u,f,c,d,l=[];n==null&&(n=[]);e=n.map(function(n){return n.map(function(n,e){return{value:n,field:m.config.fields[e],idx:e}})});for(t=0,r=e.length;t<r;++t){i=t;o=[];for(a=0,u=e[i].length;a<u;++a){f=a;if(s.rows[i]&&s.rows[i][f]){d=e[i][f];d["interface"]=(c=s.rows[i][f])["interface"];d.instance=c.instance;o.push(this.view.render())}}l.push(o)}return l});r=function(){return n.value(s.rows.map(function(n){return n.map(function(n){return{value:n["interface"]?n["interface"].value():n.value,idx:n.idx}})}))};return this.view=new u({root:e,action:{click:{add:function(n){var e;e=n.views;s.rows=s.rows.concat([m.config.fields.map(function(n,e){return{field:n,value:n.meta.itf.value(),idx:e}})]);r();return e[0].render()}}},handler:{"no-data":function(n){var e;e=n.node;return e.classList.toggle("d-none",s.rows&&s.rows.length)},head:{list:function(){return m.config.fields.map(function(n,e){return{config:n,key:e}})},key:function(n){return n.key},text:function(n){var e;e=n.data;return o(e.config.meta.title||"untitled")}},row:{list:function(){return s.rows.map(function(n,e){return{list:n,idx:e}})},key:function(n){return n.idx},view:{action:{click:{delete:function(n){var e,t;e=n.views,t=n.ctx;s.rows.splice(t.idx,1);r();return e[1].render()}}},handler:{field:{list:function(n){var e;e=n.ctx;return e.list},key:function(n){return n.idx},view:{init:{"@":function(n){var e,t;e=n.node,t=n.ctx;return a.from({name:t.field.type},{root:e,data:t.field.meta}).then(function(n){import$(t,n);t["interface"].value(t.value);return t["interface"].on("change",r)})}},render:{"@":function(n){var e,t;e=n.node,t=n.ctx;return t["interface"].value(t.value)}}}}}}},field:{list:function(){return m.config.fields.map(function(n,e){return{config:n,key:e}})},key:function(n){return n.key},view:{init:{"@":function(n){var e,t,r;e=n.ctx,t=n.node;r=e.config;return a.get({name:r.type||"input"}).then(function(n){return n.create()}).then(function(n){return n.attach({root:t,data:r.meta}).then(function(){r.meta.bi=n;return r.meta.itf=n["interface"]()})})}},handler:{"@":function(n){var e;e=n.ctx;if(!e.config.meta.itf){return}e.config.meta.bi.transform("i18n");return e.config.meta.itf.render()}}}}}})},render:function(){return this.view.render()},isEmpty:function(n){return!Array.isArray(n)||!n.length}}};function import$(n,e){var t={}.hasOwnProperty;for(var r in e)if(t.call(e,r))n[r]=e[r];return n}</script></div>