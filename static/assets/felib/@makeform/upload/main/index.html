<div><style type="text/css">.variant{display:none}.has-variant .variant{display:inline}</style><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/upload",extend:{name:"@makeform/common"},i18n:{en:{"未命名的文件":"unnamed file","上傳":"upload","上傳中":"uploading","尚未上傳文件":"no file uploaded yet","檔案大小":"File Size","上傳時間":"Upload Time"},"zh-TW":{"未命名的文件":"未命名的文件","上傳":"上傳","上傳中":"上傳中","尚未上傳文件":"尚未上傳文件","檔案大小":"檔案大小","上傳時間":"上傳時間"}},dependencies:[{url:"https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js",async:false},{url:"https://cdn.jsdelivr.net/npm/moment-timezone@0.5.34/builds/moment-timezone-with-data.min.js"}]},ext:function(e){return import$(this._ext,e)},init:function(e){this._ext={};return e.pubsub.fire("subinit",{mod:mod(e,this._ext)})}};mod=function(e,t){var n,i,r,o,l,d,u,a,s,c;n=e.root,i=e.ctx,r=e.data,o=e.parent,l=e.pubsub,d=e.t,u=e.i18n;a=i.ldview,s=i.moment;c={uploading:false};return{init:function(){var o,l,u,f=this;o=function(e,n){c.uploading=e;c.percent=n;return u.render(["file-uploading","no-file"])};this.on("change",function(e){c.file=e;f.mod.child.view.render(["file-info","no-file"]);if(f.mod.child.view){f.mod.child.view.render()}if(t.view){t.view.setCtx(c);return t.view.render()}});l=function(e){return o(true,e.percent)};return this.mod.child.view=u=new a({root:n,action:{change:{input:function(e){var r,n;r=e.node;if(!f.mod.child._upload){return}return n=Promise.all(Array.from(r.files).map(function(e){if(!t.isSupported){return{supported:true}}else{return t.isSupported(e)}})).then(function(e){var n;if(!e.filter(function(e){return!e.supported}).length){return}return Promise.reject((n=new Error,n.name="lderror",n.id=1020,n))}).then(function(){var e,n,t,i;e=u.get("button");e.classList.toggle("running",true);if(!f.mod.info.config.multiple){n=(r.files||[])[0];t=!n?Promise.resolve().then(function(){return c.file=null}):(o(true,0),f.mod.child._upload({file:n,progress:l}).then(function(e){return c.file=e}))}else{i=function(n){var e;e=(r.files||[])[n];if(!e){return Promise.resolve()}o(true,0);return f.mod.child._upload({file:e,progress:l}).then(function(e){if(!c.file){c.file=[]}else if(!Array.isArray(c.file)){c.file=[c.file]}c.file.push(e);return i(n+1)})};t=i(0)}return t["finally"](function(){r.value=null;e.classList.toggle("running",false);return o(false,1)}).then(function(){return f.value(c.file)}).then(function(){return u.render(["file-info","no-file"])})["catch"](function(e){f.fire("upload-failed",e);return Promise.reject(e)})})["catch"](function(e){alert(d("檔案不支援"));return console.log(e)})}}},handler:{"file-uploading":function(e){var n;n=e.node;n.classList.toggle("d-none",!c.uploading);return n.innerText=d("上傳中")+" / "+Math.floor((c.percent||0)*1e4)/100+"%"},"no-file":function(e){var n,t;n=e.node;t=!(Array.isArray(c.file)?c.file.filter(function(e){return e}).length:!!c.file);return n.classList.toggle("d-none",!t||c.uploading)},"file-info":{list:function(){var e;e=Array.isArray(c.file)?c.file:c.file?[c.file]:[];return e.filter(function(e){return e})},view:{action:{click:{delete:function(e){var n;n=e.ctx;if(!!f.mod.info.meta.readonly){return}return Promise.resolve().then(function(){var e;if(!Array.isArray(c.file)){return f.value(c.file=null)}if(!~(e=c.file.indexOf(n))){return}c.file.splice(e,1);return f.value(c.file)}).then(function(){return u.render(["file-info","no-file"])})}}},handler:{delete:function(e){var n;n=e.node;return n.classList.toggle("d-none",!!f.mod.info.meta.readonly)},size:function(e){var n,t,i;n=e.node,t=e.ctx;i=t.size||0;i=i<1024?i+"bytes":i<1048576?(i/1024).toFixed(2)+"KB":i<1024*1024*1024?(i/1048576).toFixed(2)+"MB":(i/(1024*1024*1024)).toFixed(2)+"GB";return n.innerText=i},time:function(e){var n,t;n=e.node,t=e.ctx;return n.innerText=s(t.modifiedtime).tz("Asia/Taipei").format("YYYY-MM-DD hh:mm:ss")},filename:function(e){var n,t,i;n=e.node,t=e.ctx;if(!t){n.innerText=d("尚未上傳文件")}i=t.filename||d("未命名的文件");if(i.length>40){i=i.substring(0,40)+"..."}return n.innerText=i},detail:function(e){var n,t;n=e.node,t=e.ctx;if(t){n.setAttribute("href",t.url)}else{n.removeAttribute("href")}return n.classList.toggle("text-danger",!t)}}}},input:function(e){var n,t,i;n=e.node;if(!f.mod.child._upload||!!f.mod.info.meta.readonly){n.setAttribute("disabled",true)}else{n.removeAttribute("disabled")}if(f.mod.info.config.multiple){n.setAttribute("multiple","multiple")}else{n.removeAttribute("multiple")}t=(f.mod.info.meta.term||[]).filter(function(e){return e.opset==="file"&&e.op==="extension"})[0];if(t){i=(t.config.str||"").split(",").filter(function(e){return e.length}).map(function(e){return"."+e}).join(",");return n.setAttribute("accept",i)}else{return n.removeAttribute("accept")}},button:function(e){var n,t;n=e.node;t=!f.mod.child._upload||!!f.mod.info.meta.readonly;return n.classList.toggle("disabled",t)}}})},render:function(){if(this.mod.child.view){this.mod.child.view.render()}if(t.view){return t.view.render()}},adapt:function(e){this.mod.child._upload=e.upload;return this.render()},isEmpty:function(e){if(typeof e==="undefined"){return true}if(Array.isArray(e)){return e.length===0}return!e}}};function import$(e,n){var t={}.hasOwnProperty;for(var i in n)if(t.call(n,i))e[i]=n[i];return e}</script><div class="form-group" plug="widget" ld="base"><label class="d-flex align-items-end"><div ld="display" data-display="block"><span ld="label"></span><span class="variant text-sm ml-2">(<span ld="variant"></span>)</span><span class="text-danger ml-2" ld="is-required">*</span></div><div class="flex-grow-1"></div><div class="m-edit"><div class="text-danger text-sm" ld="limitation"></div></div></label><div class="text-sm text-muted" ld="display" data-display="block"><div ld="desc" style="margin:-.6em 0 .7em"></div></div><div class="d-flex align-items-start mb-2"><div class="m-edit btn btn-primary btn-upload mr-2 px-4 ld-ext-right" ld="button"><span t>上傳</span><input type="file" ld="input"><div class="ld ld-spin ld-spinner"></div></div><div class="d-flex flex-column"><div class="d-flex flex-column _g-2"><div class="btn d-flex _g-3 align-items-start" ld-each="file-info"><span>&#8227;</span><div class="text-left"><a ld="detail" rel="noopener noreferrer" target="_blank"><div ld="filename">...</div><div class="d-flex" style="font-size:12px"><div><span t>檔案大小</span><span class="mr-1">:</span><span ld="size"></span></div><div class="mx-2">/</div><div><span t>上傳時間</span><span class="mr-1">:</span><span ld="time"></span></div></div></a></div><i class="m-edit i-trashcan text-danger text-sm clickable" ld="delete"></i></div></div><div class="text-danger btn" t ld="no-file">尚未上傳文件</div><div class="text-danger btn d-none pl-4 text-left" t ld="file-uploading"></div></div></div><div class="text-danger m-edit mb-2" ld="error-root"><div ld-each="error"><i class="i-exclamation-circle"></i> <span ld="text"></span></div></div><div class="text-danger text-sm m-edit"><div ld-each="note"></div></div></div></div>