<div><div class="form-group" plug="widget"><label class="text-capitalize d-flex align-items-end"><div><span ld="label"></span></div><div class="flex-grow-1"></div><div class="m-edit"><div class="text-danger text-sm" ld="limitation"></div></div></label><div class="text-sm text-muted" ld="display" data-display="block"><div ld="desc" style="margin:-.6em 0 .7em"></div></div><div class="d-flex align-items-start mb-2"><div class="m-edit btn btn-primary btn-upload mr-2 px-4 ld-ext-right" ld="button"><span t>上傳</span><input type="file" ld="input"><div class="ld ld-spin ld-spinner"></div></div><div class="d-flex flex-column"><div class="d-flex flex-column _g-2"><div class="btn d-flex _g-2 align-items-center" ld-each="file-info"><span>&#8227;</span><a ld="detail" rel="noopener noreferrer" target="_blank">...</a><i class="m-edit i-trashcan text-danger text-sm clickable" ld="delete"></i></div></div><div class="text-danger btn" t ld="no-file">尚未上傳文件</div><div class="text-danger btn d-none pl-4 text-left" t ld="file-uploading"></div></div></div><div class="text-danger m-edit mb-2" ld="error-root"><div ld-each="error"><i class="i-exclamation-circle"></i> <span ld="text"></span></div></div><div class="text-danger text-sm m-edit"><div ld-each="note"></div></div></div><script type="@plotdb/block">var mod;module.exports={pkg:{name:"@makeform/upload",extend:{name:"@makeform/base"},i18n:{en:{"上傳":"upload","上傳中":"uploading","尚未上傳文件":"no file uploaded yet"}},dependencies:[{url:"https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js",async:false},{url:"https://cdn.jsdelivr.net/npm/moment-timezone@0.5.34/builds/moment-timezone-with-data.min.js"}]},init:function(e){return e.pubsub.fire("init",{mod:mod(e)})}};mod=function(e){var n,t,r,i,s,u,c,d,m,p;n=e.root,t=e.ctx,r=e.data,i=e.parent,s=e.t,u=e.i18n;c=t.ldview,d=t.moment;m={uploading:false};p=function(e){m.meta=e;return m.cfg=e.config||{}};p(r);return{init:function(){var o,l,f,a=this;o=function(e,n){m.uploading=e;m.percent=n;return f.render(["file-uploading","no-file"])};this.on("meta",function(){return p(a.serialize())});this.on("change",function(e){m.file=e;return a.view.render(["file-info","no-file"])});l=function(e){return o(true,e.percent)};return this.view=f=new c({root:n,text:{label:function(){return s(m.meta.title||"untitled")}},action:{change:{input:function(e){var t,n,r,i,u;t=e.node;if(!a._upload){return}n=f.get("button");n.classList.toggle("running",true);if(!m.cfg.multiple){r=(t.files||[])[0];i=!r?Promise.resolve().then(function(){return m.file=null}):(o(true,0),a._upload({file:r,progress:l}).then(function(e){return m.file=e}))}else{u=function(n){var e;e=(t.files||[])[n];if(!e){return Promise.resolve()}o(true,0);return a._upload({file:e,progress:l}).then(function(e){if(!m.file){m.file=[]}else if(!Array.isArray(m.file)){m.file=[m.file]}m.file.push(e);return u(n+1)})};i=u(0)}return i["finally"](function(){t.value=null;n.classList.toggle("running",false);return o(false,1)}).then(function(){return a.value(m.file)}).then(function(){return f.render(["file-info","no-file"])})["catch"](function(e){a.fire("upload-failed",e);return Promise.reject(e)})}}},handler:{desc:function(e){var n;n=e.node;n.classList.toggle("d-none",!m.meta.desc);return n.innerText=s(m.meta.desc||"")||""},"file-uploading":function(e){var n;n=e.node;n.classList.toggle("d-none",!m.uploading);return n.innerText=s("上傳中")+" / "+Math.floor((m.percent||0)*1e4)/100+"%"},"no-file":function(e){var n,t;n=e.node;t=!(Array.isArray(m.file)?m.file.length:!!m.file);return n.classList.toggle("d-none",!t||m.uploading)},"file-info":{list:function(){if(Array.isArray(m.file)){return m.file}else if(m.file){return[m.file]}else{return[]}},view:{action:{click:{delete:function(e){var n;n=e.ctx;return Promise.resolve().then(function(){var e;if(!Array.isArray(m.file)){return a.value(m.file=null)}if(!~(e=m.file.indexOf(n))){return}m.file.splice(e,1);return a.value(m.file)}).then(function(){return f.render(["file-info","no-file"])})}}},handler:{detail:function(e){var n,t,r,i,u,o;n=e.node,t=e.ctx;if(!(r=t)){n.removeAttribute("href");n.innerText=s("尚未上傳文件")}else{i=d(r.modifiedtime).tz("Asia/Taipei").format("YYYY-MM-DD hh:mm:ss");u=r.filename||"untitled";if(u.length>20){u=u.substring(0,20)+"..."}o=u+" / "+Math.round(r.size/1024)+"KB / "+i;n.innerText=o;n.setAttribute("href",r.url)}return n.classList.toggle("text-danger",!r)}}}},limitation:{list:function(){return m.cfg.limitation||[]},key:function(e){return e},handler:function(e){var n,t;n=e.node,t=e.data;return n.innerText="* "+s(t)}},input:function(e){var n,t,r;n=e.node;if(!a._upload||!!m.meta.readonly){n.setAttribute("disabled",true)}else{n.removeAttribute("disabled")}if(m.cfg.multiple){n.setAttribute("multiple","multiple")}else{n.removeAttribute("multiple")}t=(m.meta.term||[]).filter(function(e){return e.opset==="file"&&e.op==="extension"})[0];if(t){r=(t.config.str||"").split(",").filter(function(e){return e.length}).map(function(e){return"."+e}).join(",");return n.setAttribute("accept",r)}else{return n.removeAttribute("accept")}},button:function(e){var n,t;n=e.node;t=!a._upload||!!m.meta.readonly;return n.classList.toggle("disabled",t)},note:{list:function(){if(Array.isArray(m.cfg.note)){return m.cfg.note}else if(m.cfg.note){return[m.cfg.note]}else{return[]}},key:function(e){return e},handler:function(e){var n,t;n=e.node,t=e.data;return n.innerText="* "+s(t)}},"error-root":function(e){var n;n=e.node;return n.classList.toggle("d-none",!!a.errors.length)},error:{list:function(){var e;if((e=a.status())!==2){return[]}return a._errors.slice(0,1).concat(a._errors.length>1?["..."]:[])},view:{text:{text:function(e){var n;n=e.ctx;return s(n)}}}}}})},render:function(){if(this.view){return this.view.render()}},adapt:function(e){this._upload=e.upload;return this.render()},isEmpty:function(e){if(typeof e==="undefined"){return true}if(Array.isArray(e)){return e.length===0}return!e}}};</script></div>