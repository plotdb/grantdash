// Generated by LiveScript 1.3.0
ldc.register(['error', 'ldcvmgr', 'notify', 'loader'], function(arg$){
  var error, ldcvmgr, notify, loader, view;
  error = arg$.error, ldcvmgr = arg$.ldcvmgr, notify = arg$.notify, loader = arg$.loader;
  return view = new ldView({
    root: '[ld-scope=profile]',
    action: {
      click: {
        'delete': function(arg$){
          var node, slug;
          node = arg$.node;
          if (!(slug = node.getAttribute('data-slug'))) {
            return;
          }
          return ldcvmgr.get('confirm-deletion').then(function(it){
            if (it !== 'yes') {
              return;
            }
            loader.on();
            return ld$.fetch("/dash/api/prj/" + slug, {
              method: 'delete'
            })['finally'](function(){
              return loader.off();
            }).then(function(){
              return notify.send('success', "提案已刪除");
            }).then(function(){
              var n;
              if (n = ld$.parent(node, '.prj', view.root)) {
                return ld$.remove(n);
              }
            })['catch'](error());
          });
        }
      }
    },
    handler: {
      prettydate: function(arg$){
        var node, date;
        node = arg$.node;
        date = moment(node.getAttribute('data-value')).format("YYYY.MM.DD");
        return node.innerText = date;
      }
    }
  });
});