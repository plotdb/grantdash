ldc.register("change-password",["auth","notify"],function(e){var n,t;return n=e.auth,t=e.notify,{},console.log("undefined"!=typeof ClipboardJS&&null!==ClipboardJS),n.get({authed:!0}).then(function(e){var n,r,s;return e,n=new ldForm({root:".form[data-name=passwd]",submit:".btn[ld=update-password]",afterCheck:function(e){var n,t,r,s,a,i,d,o,u,c;if(n=[this.fields.newpasswd1.value,this.fields.newpasswd2.value],t=n[0],r=n[1],1!==e.newpasswd1&&t.length<6&&(e.newpasswd1=2,e.newpasswd2=1),t!==r&&(1!==e.newpasswd2||r&&0===e.newpasswd1)&&(e.newpasswd2=2),s=ld$.find(this.root,"[data-node]",0),1!==e.newpasswd1)return a=Math.round(t.length),i=a<8?"不妙":a<10?"還好":"不錯",d=100*(a<12?a:12)/12,o=a<8?"danger":a<10?"warning":"success",ld$.find(s,"label",0).textContent="長度: "+i,u=ld$.find(s,".progress-bar",0),u.style.width=d+"%",c=u.getAttribute("class"),c=c.replace(/bg-\S+/,"").trim()+" bg-"+o,u.setAttribute("class",c)}}),r=ld$.find(document,".form[data-name=passwd] .btn[ld=update-password]",0),s=new ldLoader({root:r}),r.addEventListener("click",function(){var e;if(!r.classList.contains("disabled"))return s.on(),e=n.values(),ld$.fetch("/d/me/passwd/",{method:"put",body:JSON.stringify({o:e.oldpasswd,n:e.newpasswd1}),headers:{"Content-Type":"application/json; charset=UTF-8"}},{}).finally(function(){return s.off()}).then(function(){return t.send("success","Password updated."),n.reset()}).catch(function(){return t.send("danger","Update password failed.")})})})}),ldc.register(["auth","ldcvmgr","change-password","notify"],function(e){var n,t,r,s;return n=e.auth,t=e.ldcvmgr,e.changePassword,r=e.notify,s={},n.get({authed:!0}).catch(function(){return t.toggle("auth-required")}).then(function(e){return s.g=e,n.userinfo(e.user)}).then(function(e){var a;return s.user=e,a=new ldForm({root:".form[data-name=basic]",submit:".btn[ld=updateBasicData]",afterCheck:function(e){if(e.description=0,e.title=0,e.tags=0,this.fields.displayname.value)return e.displayname=0}}),new Tagify(a.fields.tags,{originalInputValueFormat:function(e){return e.map(function(e){return e.value}).join(",")}}),new ldView({root:document.body,handler:{updateBasicData:function(e){var i,d;return i=e.node,d=new ldLoader({root:i}),i.addEventListener("click",function(){var e,i;return d.on(),e=a.values(),ld$.fetch("/d/user/"+((i=s.g).user||(i.user={})).key,{method:"PUT"},{json:{description:e.description,displayname:e.displayname,title:e.title,tags:e.tags},type:"text"}).catch(function(e){return t.toggle("error"),console.log(e)}).then(function(){return n.fetch({renew:!0})}).then(function(){return debounce(500)}).then(function(){return r.send("success","updated.")}).then(function(){return debounce(500)}).then(function(){return d.off()})})},mailVerify:function(e){var n,r;return n=e.node,r=new ldLoader({root:n}),s.user.verified?n.innerText="Verified in "+moment(s.user.verified.date).format("YYYY/MM/DD"):n.addEventListener("click",function(){if(r.on(),!n.classList.contains("disabled"))return ld$.fetch("/d/me/mail/verify",{method:"POST"}).catch(function(){return t.toggle("error")}).then(function(){return debounce(1e3)}).then(function(){return r.off()}).then(function(){return t.toggle("verification-mail-sent")})})},sendResetLink:function(e){var n;return(n=e.node).addEventListener("click",function(){if(!n.classList.contains("disabled"))return ld$.fetch("/d/me/passwd/reset",{method:"POST",body:JSON.stringify({email:s.g.user.username}),headers:{"Content-Type":"application/json; charset=UTF-8"}},{}).then(function(){return n.innerHTML='Link Sent.<i class="i-check"></i>',n.classList.add("disabled")})})},copyUid:function(e){var n;return n=e.node,new ClipboardJS(n).on("success",function(){return n.classList.add("tip-on"),debounce(2e3).then(function(){return n.classList.remove("tip-on")})})}}})})});