// Generated by LiveScript 1.3.0
ldc.register(['prjForm', 'loader', 'ldcvmgr'], function(arg$){
  var prjForm, loader, ldcvmgr, sdb, hubs, lc;
  prjForm = arg$.prjForm, loader = arg$.loader, ldcvmgr = arg$.ldcvmgr;
  loader.on();
  console.log("initializing ...");
  sdb = sdb = new sharedbWrapper({
    url: {
      scheme: window.location.protocol.replace(':', ''),
      domain: window.location.host
    }
  });
  sdb.on('close', function(){
    loader.on();
    return sdb.reconnect().then(function(){
      return prepare();
    }).then(function(){
      return loader.off();
    });
  });
  hubs = {
    brd: new Hub({
      sdb: sdb
    }),
    prj: new Hub({
      sdb: sdb
    })
  };
  console.log("fetch brd-4 snapshot ...");
  lc = {};
  return sdb.getSnapshot({
    id: 'brd-4'
  }).then(function(s){
    lc.snapshot = s.data;
    console.log(s);
    return sdb.get({
      id: "prj-sample",
      watch: function(ops, source){
        return hubs.prj.fire('change', {
          ops: ops,
          source: source
        });
      }
    });
  }).then(function(doc){
    var grp, k, v, form;
    hubs.prj.doc = doc;
    grp = (function(){
      var ref$, results$ = [];
      for (k in ref$ = lc.snapshot.group) {
        v = ref$[k];
        results$.push(v);
      }
      return results$;
    }())[0] || {};
    form = new prjForm({
      root: '[ld-scope=prj-form]',
      viewMode: true,
      form: (grp.form || (grp.form = {})).list || [],
      grp: grp,
      brd: lc.snapshot
    });
    form.adapt({
      hub: hubs.prj,
      path: ['content']
    });
    console.log("adapted");
    return loader.off();
  })['catch'](function(it){
    console.log(it);
    loader.off();
    return ldcvmgr.toggle('error');
  });
});