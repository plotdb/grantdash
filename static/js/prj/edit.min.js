function import$(n,t){var r={}.hasOwnProperty;for(var e in t)r.call(t,e)&&(n[e]=t[e]);return n}ldc.register(["general","auth","prjForm","loader","ldcvmgr","error"],function(n){var t,r,e,o,i,c,u,s,h;return n.general,t=n.auth,r=n.prjForm,e=n.loader,o=n.ldcvmgr,i=n.error,c=function(n){return this.ldcv=new ldCover({root:"[ld-scope=prj-diff]"}),this.view=new ldView({global:!0,initRender:!1,root:"[ld-scope=prj-form-use]",handler:{"init-loader":function(n){return n.node.classList.toggle("d-none",!0)},content:function(n){return n.node.classList.toggle("d-none",!1)}}}),this.slug=n.prj,this.prj={},this},c.prototype=import$(Object.create(Object.prototype),{fetch:function(){var n=this;return console.log("fetching project information ..."),console.log("fetching board form ..."),ld$.fetch("/dash/api/prj/"+this.slug,{method:"GET"},{type:"json"}).then(function(t){return n.prj=t,ld$.fetch("/dash/api/brd/"+n.prj.brd+"/form",{method:"GET"},{type:"json"})}).then(function(t){return n.brd=t,n.grp=n.brd.detail.group[0]||{}})},sharedb:function(){var n,t=this;return console.log("initializing sharedb connection ..."),this.sdb=n=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),n.on("error",function(){return o.toggle("not-sync")}),n.on("close",function(){return e.on(),n.reconnect().then(function(){return t.getdoc()}).then(function(){return t.adapt()}).then(function(){return t.render()}).then(function(){return console.log("re-inited.")}).then(function(){return e.off()})}),this.hubs={prj:new Hub({sdb:n})}},getdoc:function(){var n=this;return console.log("get project document ..."),this.sdb.get({id:"prj/"+this.slug,watch:function(t,r){return n.hubs.prj.fire("change",{ops:t,source:r})},create:function(){var t,r,e,o;return t={answer:{}},r=(e=n.grp).form||(e.form={}),((e=t.answer)[o=(r.purpose||(r.purpose={})).title||"title"]||(e[o]={})).content=n.prj.name,((e=t.answer)[o=r.purpose.description||"description"]||(e[o]={})).content=n.prj.description,t}}).then(function(t){return n.hubs.prj.doc=t})},adapt:function(){return this.ctrlForm.adapt({hub:this.hubs.prj,path:[]})},initForm:function(){var n,t=this;return this.ctrlForm=new r({root:"[ld-scope=prj-form-use]",viewMode:!0,form:(n=this.grp).form||(n.form={}),grp:this.grp,brd:this.brd,prj:this.prj}),this.ctrlForm.on("submit",function(n){var r;return r={payload:n,type:"prj",slug:t.prj.slug},o.toggle("publishing",!0),ld$.fetch("/dash/api/detail",{method:"PUT"},{json:r,type:"json"}).finally(function(){return o.toggle("publishing",!1)}).then(function(){return t.prj.detail=JSON.parse(JSON.stringify(n))}).then(function(){return t.ctrlForm.render()}).then(function(){return o.toggle("published",!0)}).then(function(){return debounce(2e3)}).finally(function(){return o.toggle("published",!1)}).catch(i())}),this.adapt()},render:function(){return this.view.render()}}),u=/^\/(?:dash\/)?prj\/([^/]+)\/edit/.exec(window.location.pathname)||[],u[0],s=u[1],h=new c({prj:s}),t.get().then(function(){return h.fetch()}).then(function(){return h.sharedb()}).then(function(){return h.getdoc()}).then(function(){return h.initForm()}).then(function(){return h.render()}).then(function(){return console.log("inited.")}).then(function(){return e.off()}).catch(i())});