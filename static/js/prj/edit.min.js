function import$(t,r){var n={}.hasOwnProperty;for(var e in r)n.call(r,e)&&(t[e]=r[e]);return t}ldc.register(["auth","prjForm","loader","ldcvmgr","error"],function(t){var r,n,e,o,i,c,u,s,h;return r=t.auth,n=t.prjForm,e=t.loader,o=t.ldcvmgr,i=t.error,c=function(t){return this.ldcv=new ldCover({root:"[ld-scope=prj-diff]"}),this.view=new ldView({global:!0,initRender:!1,root:"[ld-scope=prj-form-use]",handler:{"init-loader":function(t){return t.node.classList.toggle("d-none",!0)}}}),this.slug=t.prj,this.prj={},this},c.prototype=import$(Object.create(Object.prototype),{fetch:function(){var t=this;return console.log("fetching project information ..."),console.log("fetching board form ..."),ld$.fetch("/d/p/"+this.slug,{method:"GET"},{type:"json"}).then(function(r){return t.prj=r,ld$.fetch("/d/b/"+t.prj.brdslug+"/form",{method:"GET"},{type:"json"})}).then(function(r){return t.brd=r,t.grp=t.brd.detail.group[0]||{}})},sharedb:function(){var t;return console.log("initializing sharedb connection ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}}),t.on("close",function(){return e.on(),t.reconnect().then(function(){}).then(function(){return e.off()})}),this.hubs={prj:new Hub({sdb:t})}},getdoc:function(){var t=this;return console.log("get project document ..."),this.sdb.get({id:"prj-"+this.slug,watch:function(r,n){return t.hubs.prj.fire("change",{ops:r,source:n})},create:function(){var r,n,e,o;return r={},n=(e=t.grp).form||(e.form={}),(r[o=(n.purpose||(n.purpose={})).title||"title"]||(r[o]={})).content=t.prj.name,(r[o=n.purpose.description||"description"]||(r[o]={})).content=t.prj.description,r}}).then(function(r){return t.hubs.prj.doc=r})},initForm:function(){var t,r=this;return this.ctrlForm=new n({root:"[ld-scope=prj-form-use]",viewMode:!0,form:(t=this.grp).form||(t.form={}),grp:this.grp,brd:this.brd}),this.ctrlForm.adapt({hub:this.hubs.prj,path:["content"]}),this.ctrlForm.on("submit",function(t){var n;return n={payload:t,type:"prj",slug:r.prj.slug},o.toggle("publishing",!0),ld$.fetch("/d/detail",{method:"PUT"},{json:n,type:"json"}).finally(function(){return o.toggle("publishing",!1)}).then(function(){return o.toggle("published",!0)}).then(function(){return debounce(2e3)}).finally(function(){return o.toggle("published",!1)}).catch(i())})},render:function(){return this.view.render()}}),u=/^\/p\/([^/]+)\/edit/.exec(window.location.pathname)||[],u[0],s=u[1],h=new c({prj:s}),r.get().then(function(){return h.fetch()}).then(function(){return h.sharedb()}).then(function(){return h.getdoc()}).then(function(){return h.initForm()}).then(function(){return h.render()}).then(function(){return e.off()}).catch(i())});