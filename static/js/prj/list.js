// Generated by LiveScript 1.3.0
ldc.register(['util', 'viewLocals'], function(arg$){
  var util, viewLocals, fullCount, prj, cur, ref$, ref1$, lc, query, buildQuerystring, badge, activeTags, tags, view;
  util = arg$.util, viewLocals = arg$.viewLocals;
  fullCount = (viewLocals[0] || {}).full_count;
  prj = viewLocals[0] || {};
  cur = {
    offset: util.parseQuerystring("offset"),
    limit: (ref$ = (ref1$ = +util.parseQuerystring("limit") || 500) > 1 ? ref1$ : 1) < 500 ? ref$ : 500
  };
  lc = {};
  query = util.parseQuerystring();
  buildQuerystring = function(obj, overwrite){
    var k, v;
    obj == null && (obj = {});
    overwrite == null && (overwrite = {});
    return "?" + (function(){
      var ref$, results$ = [];
      for (k in ref$ = import$(import$({}, obj), overwrite)) {
        v = ref$[k];
        results$.push(k + "=" + v);
      }
      return results$;
    }()).join('&');
  };
  badge = (query.badge || '').split(',').filter(function(it){
    return it;
  });
  activeTags = (query.tag || '').split(',').filter(function(it){
    return it;
  });
  tags = Array.from(new Set(ld$.find("[data-type=tag]").map(function(it){
    return it.getAttribute('data-name');
  }).filter(function(it){
    return it;
  })));
  return view = new ldView({
    root: '[ld-scope=project-list]',
    action: {
      click: {
        "all-tag": function(){
          return window.location.href = window.location.pathname;
        },
        search: function(){
          var name;
          name = view.get("search-input").value || '';
          if (name) {
            return window.location.href = window.location.pathname + ("?keyword=" + name);
          }
        },
        "badge-btn": function(arg$){
          var node, n;
          node = arg$.node;
          n = node.getAttribute('data-name');
          return window.location.href = window.location.pathname + buildQuerystring(n === 'all'
            ? {}
            : {
              badge: n
            });
        }
      }
    },
    handler: {
      "badge-btn": function(arg$){
        var node, n, active;
        node = arg$.node;
        n = node.getAttribute('data-name');
        active = n !== 'all'
          ? in$(n, badge)
          : !badge.length;
        return node.classList.toggle('active', active);
      },
      "search-input": function(arg$){
        var node;
        node = arg$.node;
        return node.value = util.parseQuerystring("keyword") || '';
      },
      pagination: {
        list: function(){
          var i$, to$, results$ = [];
          for (i$ = 0, to$ = Math.ceil(fullCount / cur.limit); i$ < to$; ++i$) {
            results$.push(i$);
          }
          return results$;
        },
        handler: function(arg$){
          var node, data, offset;
          node = arg$.node, data = arg$.data;
          node.innerText = data + 1;
          offset = data * cur.limit;
          return node.setAttribute('href', ("/dash/brd/" + prj.brd + "/list") + buildQuerystring(query, {
            offset: offset
          }));
        }
      },
      tags: function(arg$){
        var node;
        node = arg$.node;
        return node.classList.toggle('d-none', !tags.length);
      },
      "tag-btn": {
        list: function(){
          return tags;
        },
        handler: function(arg$){
          var node, data, active, qs;
          node = arg$.node, data = arg$.data;
          node.innerText = data;
          active = in$(data, activeTags) && tags.length;
          qs = active
            ? ""
            : buildQuerystring({
              tag: data
            });
          node.classList.toggle('active', active);
          return node.addEventListener('click', function(){
            return window.location.href = window.location.pathname + qs;
          });
        }
      }
    }
  });
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}
function in$(x, xs){
  var i = -1, l = xs.length >>> 0;
  while (++i < l) if (x === xs[i]) return true;
  return false;
}