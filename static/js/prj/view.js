// Generated by LiveScript 1.3.0
ldc.register('prjView', ['auth', 'error', 'viewLocals'], function(arg$){
  var auth, error, viewLocals;
  auth = arg$.auth, error = arg$.error, viewLocals = arg$.viewLocals;
  return auth.get().then(function(g){
    var prj, grp, answers, ref$, blocks, bhash, view;
    prj = viewLocals.prj, grp = viewLocals.grp;
    answers = (ref$ = prj.detail || (prj.detail = {})).answer || (ref$.answer = {});
    blocks = (ref$ = grp.form || (grp.form = {})).list || (ref$.list = []);
    bhash = {};
    blocks.map(function(it){
      return bhash[it.key] = it;
    });
    return view = new ldView({
      root: document.body,
      init: {
        "btn-share": function(arg$){
          var node, local;
          node = arg$.node, local = arg$.local;
          local.clipboard = new ClipboardJS(node, {
            text: function(t){
              return window.location.href;
            }
          });
          return local.clipboard.on('success', function(){
            clearTimeout(local.h);
            node.classList.add('tip-on');
            return local.h = setTimeout(function(){
              return node.classList.remove('tip-on');
            }, 1000);
          });
        }
      },
      handler: {
        "btn-edit": function(arg$){
          var node;
          node = arg$.node;
          return node.classList.toggle('d-none', g.user.key !== viewLocals.owner);
        },
        answer: function(arg$){
          var node, key, block, answer, list;
          node = arg$.node;
          key = node.getAttribute('data-key');
          block = bhash[key];
          if (!(answer = answers[key] || {}) || !(block = bhash[key])) {
            return;
          }
          if (answer.content) {
            if (answer.useMarkdown) {
              return node.innerHTML = DOMPurify.sanitize(marked(answer.content));
            } else {
              return node.innerText = answer.content;
            }
          } else if (answer.list) {
            list = answer.list.concat(answer.otherValue && answer.other
              ? [answer.otherValue]
              : []);
            return node.innerHTML = DOMPurify.sanitize(list.join("<br>"));
          }
        }
      }
    });
  })['catch'](error());
});
ldc.app('prjView');