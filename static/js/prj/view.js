// Generated by LiveScript 1.3.0
ldc.register('prjView', ['auth', 'error', 'stage', 'viewLocals', 'discussView', 'prjViewSimple'], function(arg$){
  var auth, error, stage, discussView, discussEdit, viewLocals, prjViewSimple, lc, prj, brd, grp;
  auth = arg$.auth, error = arg$.error, stage = arg$.stage, discussView = arg$.discussView, discussEdit = arg$.discussEdit, viewLocals = arg$.viewLocals, prjViewSimple = arg$.prjViewSimple;
  lc = {};
  prj = viewLocals.prj, brd = viewLocals.brd, grp = viewLocals.grp;
  return auth.get().then(function(g){
    lc.global = g;
    return stage.get({
      brd: brd.slug
    });
  }).then(function(ret){
    var answers, ref$, blocks, bhash, discuss, view, prjView;
    ret == null && (ret = {});
    lc.stage = ret.config || {};
    answers = (ref$ = prj.detail || (prj.detail = {})).answer || (ref$.answer = {});
    blocks = (ref$ = grp.form || (grp.form = {})).list || (ref$.list = []);
    bhash = {};
    blocks.map(function(it){
      return bhash[it.key] = it;
    });
    if (discussView) {
      discuss = new discussView({
        root: '[ld-scope=discuss]'
      });
      discuss.init();
    }
    view = new ldView({
      global: true,
      root: document.body,
      handler: {
        "stage-ctrl": function(arg$){
          var node, n;
          node = arg$.node;
          n = node.getAttribute('data-name');
          return node.classList.toggle('d-none', !lc.stage[n]);
        }
      }
    });
    view = new ldView({
      root: document.body,
      init: {
        "btn-share": function(arg$){
          var node, local;
          node = arg$.node, local = arg$.local;
          local.clipboard = new ClipboardJS(node, {
            text: function(t){
              return window.location.href;
            }
          });
          return local.clipboard.on('success', function(){
            clearTimeout(local.h);
            node.classList.add('tip-on');
            return local.h = setTimeout(function(){
              return node.classList.remove('tip-on');
            }, 1000);
          });
        }
      },
      handler: {
        "btn-edit": function(arg$){
          var node;
          node = arg$.node;
          return node.classList.toggle('d-none', lc.global.user.key !== prj.owner);
        }
      }
    });
    return prjView = new prjViewSimple({
      root: '[ld-scope=form-answer]',
      prj: prj.slug,
      brd: brd.slug,
      org: brd.org,
      form: grp.form,
      answer: answers
    });
  })['catch'](error());
});
ldc.app('prjView');