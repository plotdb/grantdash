function import$(t,e){var n={}.hasOwnProperty;for(var i in e)n.call(e,i)&&(t[i]=e[i]);return t}function in$(t,e){for(var n=-1,i=e.length>>>0;++n<i;)if(t===e[n])return!0;return!1}var slice$=[].slice;!function(){var t,e,n;if(t={running:!1,alpha:4,dur:250,box:{},init:function(e){var n,i,r,o,a;if(n=e.src,i=e.des,r=e.cb,!this.running)return this.src=n,this.des=i,this.running=!0,import$(this.box,{s1:(a={},a.x=(o=n.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a),d1:(a={},a.x=(o=i.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a)}),this.box.s1.x===(o=this.box.s1.y)&&o===(o=this.box.s1.width)&&o===(o=this.box.s1.height)&&0===o&&(this.box.s1=this.box.d1),r(),import$(this.box,{s2:(a={},a.x=(o=n.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a),d2:(a={},a.x=(o=i.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a)}),requestAnimationFrame(function(e){return t.handle(e)})},handle:function(e){var n,i,r,o,a,s,d,h,c,u,l,g;return null==this.start&&(this.start=e),n=[this.alpha,this.dur],i=n[0],r=n[1],n=this.box,o=n.s1,a=n.s2,s=n.d1,d=n.d2,h=e=(e-this.start)/r,e=1-Math.pow(e,i)/(Math.pow(e,i)+Math.pow(1-e,i)),n=[(o.x-a.x)*e,(o.y-a.y)*e],c=n[0],u=n[1],n=[(s.x-d.x)*e,(s.y-d.y)*e],l=n[0],g=n[1],this.src.style.transform="translate("+c+"px,"+u+"px)",this.des.style.transform="translate("+l+"px,"+g+"px)",h<1?requestAnimationFrame(function(e){return t.handle(e)}):(this.src.style.transform="",this.des.style.transform="",delete this.start,this.running=!1)}},e=function(t){return null==t&&(t={}),this.opt=t,this.action=t.action||{},this.reorder={check:!1},this.node={editing:null,dragging:null,injecting:null},this.drag={},this.selected=[],this.evtHandler={},this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this.data=t.data,this.blockmgr=t.blockManager,this.init(),this.ready=proxise(function(){}),this},e.prototype=import$(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){var e,n,i,r,o,a=[];for(e=slice$.call(arguments,1),n=0,r=(i=this.evtHandler[t]||[]).length;n<r;++n)o=i[n],a.push(o.apply(this,e));return a},init:function(){var t=this;return document.addEventListener("click",function(e){var n,i;for(n=i=e.target;i&&i!==t.root;)i=i.parentNode;if(i)return t.select(n.hasAttribute&&(n.hasAttribute("repeat-item")||n.hasAttribute("block"))?n:null)}),this.root.addEventListener("dragover",function(e){var n,i,r,o;if(!t.node.dragging){for((n=t.node.injecting?t.node.injecting:t.node.injecting=document.createElement("div")).classList.add("ghost"),i=e.target;i&&(r=i.parentNode);){if(r.hasAttribute&&r.hasAttribute("hostable")){o=r;break}if(i.hasAttribute&&i.hasAttribute("hostable")){o=i;break}i=r}if(o&&(o===i&&(i=null),(!o.childNodes.length||i)&&i!==n))return n.parentNode&&n.parentNode.removeChild(n),o.insertBefore(n,i)}}),document.addEventListener("dragover",function(t){return t.preventDefault()}),document.addEventListener("drop",function(e){var n,i;if(t.node.injecting&&((n=t.node.injecting.parentNode)&&n.removeChild(t.node.injecting),t.node.injecting=null),i=e.dataTransfer.getData("text/plain"))return t.inject({node:e.target,name:i}).then(function(){return e.preventDefault(),e.stopPropagation()}).catch(function(t){return console.log(t)})}),this.root.addEventListener("drop",function(){return t.reorder.check=0,t.node.dragging=null}),this.root.addEventListener("dragstart",function(e){return t.node.dragging=e.target,e.dataTransfer.setDragImage(n,10,10)}),this.root.addEventListener("dragover",function(e){var n,i,r,o,a,s,d,h;if(e.preventDefault(),(n=t.node.dragging)&&(i=e.target)){if(t.action.beforeMove)i=t.action.beforeMove(n,i);else for(;i&&i.parentNode!==n.parentNode;)i=i.parentNode;if(i&&n!==i&&(i===n.nextSibling,r=[n.getBoundingClientRect(),i.getBoundingClientRect()],o=r[0],a=r[1],s=o.x===a.x?0:e.clientX-a.x,d=o.y===a.y?0:e.clientY-a.y,t.reorder.check||((r=t.reorder).x=e.clientX,r.y=e.clientY,r.check=1),h=s&&e.clientX-t.reorder.x>0||d&&e.clientY-t.reorder.y>0,!(Math.abs(s?e.clientX-t.reorder.x:e.clientY-t.reorder.y)<(s?a.width:a.height)/5)))return t.action.moving&&(i=t.action.moving(n,i,h)),t.move(n,i,h),t.action.afterMove&&t.action.afterMove(n,i,h),t.reorder.check=0}}),this.root.addEventListener("mousedown",function(t){var e,n=[];for(e=t.target;e&&(!e.hasAttribute||!e.hasAttribute("repeat-item"));)e=e.parentNode;if(e){for(e.setAttribute("draggable",!0);e=e.parentNode;)e.setAttribute&&n.push(e.setAttribute("draggable",!1));return n}}),this.root.addEventListener("click",function(e){return t.edit(e.target)}),this.root.addEventListener("keydown",function(e){var n,i,r;if(9===e.keyCode){if(!e.target.hasAttribute||!e.target.hasAttribute("editable"))return;return n=Array.from(t.root.querySelectorAll("[editable]")),((i=n.indexOf(e.target)+(e.shiftKey?-1:1))<0||!(r=n[i]))&&(r=e.target),t.edit(r),e.preventDefault()}}),this.root.addEventListener("input",function(e){var n;if((n=e.target)&&n.hasAttribute&&n.getAttribute("editable"))return t.action.input?t.action.input({node:n}):void 0})},select:function(t,e){if(null==e&&(e=!1),this.selected.map(function(t){return t.removeAttribute("selected")}),e||this.selected.splice(0,this.selected.length),t)return Array.isArray(t)||(t=[t]),this.selected=this.selected.concat(t),t.map(function(t){return t.setAttribute("selected",!0)})},edit:function(t){var e;if(t&&t.hasAttribute&&t.hasAttribute("editable")&&(!(e=t.getAttribute("edit-type"))||in$("text",e.split(" "))))return this.node.editing&&this.node.editing.setAttribute("contenteditable",!1),this.node.editing=t,t.setAttribute("contenteditable",!0),t.focus()},clone:function(){var t=this;return this.select(this.selected.map(function(e){var n;return e.parentNode.insertBefore(n=e.cloneNode(!0),e.nextSibling),t.action.clone&&t.action.clone({node:n,src:e}),n}))},delete:function(){var t,e,n=this;if(t=(e=this.selected)[e.length-1])return t=t.nextSibling||t.previousSibling,this.selected.map(function(t){return n.action.delete&&n.action.delete({node:t}),t.parentNode.removeChild(t)}),this.select(t)},move:function(e,n,i){var r,o,a=this;if(e!==(r=i?n.nextSibling:n))return o=[e.parentNode,e.nextSibling],o[0],o[1],t.init({src:e,des:n,cb:function(){if(a.action.beforeMoveNode&&a.action.beforeMoveNode({src:e,des:n,ib:r}),e.parentNode.removeChild(e),n.parentNode.insertBefore(e,r),a.action.afterMoveNode)return a.action.afterMoveNode({src:e,des:n,ib:r})}})},inject:function(t){var e,n,i,r,o,a,s,d=this;if(e=t.node,n=t.name,i=t.data,r=t.force,o=e,r)a=o;else{for(;o&&(s=o.parentNode);){if(s.hasAttribute&&s.hasAttribute("hostable")){a=s;break}if(o.hasAttribute&&o.hasAttribute("hostable")){a=o;break}o=s}if(!a)return rej(new Error(""))}return a===o&&(o=null),i&&!n&&(n=i.name),new Promise(function(t,e){return d.blockmgr.get(n).then(function(t){var e,r;return a.insertBefore(t,o),d.action.inject&&d.action.inject({parent:a,node:t,sibling:o,data:i,name:n}),e=window.getComputedStyle(t),r=e.height,t.style.height="0px",t.style.transition="height .15s ease-in-out",setTimeout(function(){return t.style.height=r},0),debounce(150).then(function(){return t.style.transition="",t.style.height=""})}).then(function(){return t()}).catch(function(t){return e(t)})})}}),e.ghost=n=new Image,n.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="15" viewBox="0 0 20 15">\n  <rect x="0" y="0" width="20" height="15" fill="rgba(0,0,0,.5)"/>\n</svg>'),"undefined"!=typeof window&&null!==window&&(window.reblock=e),"undefined"!=typeof module&&null!==module)module.exports=e}();