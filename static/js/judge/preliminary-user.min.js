function import$(t,e){var r={}.hasOwnProperty;for(var n in e)r.call(e,n)&&(t[n]=e[n]);return t}ldc.register("judgePreliminaryUser",["error","loader","auth","ldcvmgr","sdbAdapter"],function(t){var e,r,n,o,i;return t.error,e=t.loader,r=t.auth,n=t.ldcvmgr,o=t.sdbAdapter,i=function(t){var r,n=this;return this.loader=e,this.brd=t.brd,this.grp=t.grp,this.root=r="string"==typeof t.root?document.querySelector(t.root):t.root,this.prjs=[],this.data={},this.progress=this.getProgress(),this._update=debounce(function(){if(n.user)return n.opsOut(function(){return n.data})}),this.view=new ldView({root:r,handler:{progress:function(t){var e;return e=t.node,e.innerText=Math.round(100*n.progress.done/n.progress.total)},"progress-accept":function(t){var e;return e=t.node,e.style.width=100*n.progress.accept/n.progress.total+"%"},"progress-pending":function(t){var e;return e=t.node,e.style.width=100*n.progress.pending/n.progress.total+"%"},"progress-reject":function(t){var e;return e=t.node,e.style.width=100*n.progress.reject/n.progress.total+"%"},prj:{list:function(){return n.prjs},init:function(t){var e,r,o;return e=t.node,r=t.data,o=t.local,o.view=new ldView({context:r,root:e,action:{click:{option:function(t){var e,r,o,i,s;return e=t.node,r=t.context,o=e.getAttribute("data-name"),((i=n.data)[s=r.slug]||(i[s]={})).value=o,n.render(),n.update()},comment:function(){}}},text:{name:function(t){return t.node,t.context.name},ownername:function(t){return t.node,t.context.ownername}},handler:{option:function(t){var e,r,o,i,s,u,a;return e=t.node,t.local,r=t.context,o=e.getAttribute("data-name"),i={accept:"bg-success",pending:"bg-warning",reject:"bg-danger"}[o],s=((u=n.data)[a=r.slug]||(u[a]={})).value===o?"add":"remove",e.classList[s].apply(e.classList,[i,"text-white"])}}})},handler:function(t){var e,r;return t.node,e=t.data,(r=t.local).view.setContext(e),r.view.render()}}}}),this},i.prototype=import$(import$(Object.create(Object.prototype),o.interface),{render:function(){return this.progress=this.getProgress(),this.view.render()},update:function(t){return null==t&&(t={}),t.debounced?this._update():this._update().now()},getProgress:function(){var t,e,r,n;t={done:0,accept:0,pending:0,reject:0,total:this.prjs.length||1};for(e in r=this.data)(n=r[e]).value&&t[n.value]++;return t.done=t.accept+t.pending+t.reject||0,console.log(JSON.stringify(t)),t},fetch:function(){var t=this;return console.log("get project list ... "),ld$.fetch("/dash/api/brd/test-brd/list",{method:"GET"},{type:"json"}).then(function(e){return t.prjs=e,t.render()})},sharedb:function(){var t,e=this;return console.log("prepare sharedb ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),this.hub=new Hub({sdb:t}),t.on("error",function(){return n.toggle("not-sync")}),t.on("close",function(){return n.toggle("offline-retry",!0),t.reconnect().then(function(){return e.getdoc()}).then(function(){return e.adapt()}).then(function(){return console.log("admin initialized.")}).then(function(){return n.toggle("offline-retry",!1)})}),t.ready()},getdoc:function(){var t=this;return console.log("get judge document ... "),this.hub.doc=null,this.sdb.get({id:"brd/"+this.brd+"/grp/"+this.grp+"/judge/preliminary",watch:function(e,r){return t.hub.fire("change",{ops:e,source:r})},create:function(){return{}}}).then(function(e){return t.hub.doc=e,e.on("op",function(){return t.render()}),t.user?t.adapt({hub:t.hub,path:["user",t.user.key]}):t.adapt({hub:t.hub,path:[]})}).catch(function(t){return console.log("getdoc failed.",t)})},opsIn:function(t){var e;if(e=t.data,t.ops,!t.source)return this.data=JSON.parse(JSON.stringify(e)),this.render()}}),r.get().then(function(t){var e;return e=new i({user:t.user,root:document.body,brd:"test-brd",grp:"4jUmMh07zZ05kl0Col03v-Bhu"}),Promise.resolve().then(function(){return e.fetch()}).then(function(){return e.sharedb()}).then(function(){return e.getdoc()}).then(function(){return console.log("initied.")})})});