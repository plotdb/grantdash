function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}ldc.register("judgeCriteriaUser",["error","loader","auth","ldcvmgr","sdbAdapter"],function(t){var e,n,r,o,i,c,a;return t.error,e=t.loader,n=t.auth,r=t.ldcvmgr,o=t.sdbAdapter,i=[["i-check","text-success"],["i-circle","text-warning"],["i-close","text-danger"]],c=function(t,e){var n,r;return n=i[e],(r=Array.from(t.classList)).length&&t.classList.remove.apply(t.classList,r),t.classList.add.apply(t.classList,n)},a=function(t){var n,r,o=this;return this.loader=e,this.brd=t.brd,this.grp=t.grp,this.root=n="string"==typeof t.root?document.querySelector(t.root):t.root,this.prjs=[],this.data={},this.user=t.user,this.criteria=[{name:"開源",key:1},{name:"協作",key:2},{name:"參與",key:3}],this._update=debounce(function(){return o.opsOut(function(){return o.data})}),this.ldcv={comment:new ldCover({root:ld$.find(n,"[ld=comment-ldcv]",0)}),detail:new ldCover({root:ld$.find(n,"[ld=detail-ldcv]",0)}),criteria:new ldCover({root:ld$.find(n,"[ld=criteria-ldcv]",0)})},this.view=r=new ldView({root:n,action:{input:{comment:function(t){var e;if(e=t.node,o.active)return o.active.comment=e.value,o.update({debounced:!0})}},click:{detail:function(t){return t.node,o.ldcv.detail.toggle()},criteria:function(t){return t.node,o.ldcv.criteria.toggle()}}},handler:{project:{list:function(){return o.prjs.map(function(){}),o.prjs},init:function(t){var e,n,i;return e=t.node,n=t.local,i=t.data,n.view=new ldView({root:e,context:i,action:{click:{comment:function(t){var e,n,i;return t.node,e=t.context,o.active=(n=o.data)[i=e.slug]||(n[i]={}),r.get("comment").value=o.active.comment||"",o.ldcv.comment.toggle()}}},handler:{state:function(t){var e,n,r;return e=t.node,n=t.context,r=o.criteria.reduce(function(t,e){var r,i,c,a;return r=((i=(c=o.data)[a=n.slug]||(c[a]={})).value||(i.value={}))[e.key],Math.max(t,null!=r?r:1)},0),c(e,r)},name:function(t){var e,n;return e=t.node,n=t.context,e.innerText=n.name},key:function(t){var e,n;return e=t.node,n=t.context,e.innerText=n.key},criteria:{list:function(t){return t.context,o.criteria},init:function(t){var e,n;return e=t.node,n=t.local,n.icon=ld$.find(e,"i",0)},action:{click:function(t){var e,r,i,c,a,u;return t.node,e=t.data,r=t.context,i=((c=(a=o.data)[u=r.slug]||(a[u]={})).value||(c.value={}))[e.key],i=null!=i?i:1,i=(i+2)%3,o.data[r.slug].value[e.key]=i,o.update(),n.view.render()}},handler:function(t){var e,n,r,i,a,u,d;return e=t.local,n=t.data,r=t.context,i=((a=(u=o.data)[d=r.slug]||(u[d]={})).value||(a.value={}))[n.key],i=null!=i?i:1,c(e.icon,i)}}}})},handler:function(t){var e,n;return e=t.local,n=t.data,e.view.setContext(n),e.view.render()}}}}),this},a.prototype=import$(import$(Object.create(Object.prototype),o.interface),{render:function(){return this.view.render()},update:function(t){return null==t&&(t={}),t.debounced?this._update():this._update().now()},fetch:function(){var t=this;return ld$.fetch("/dash/api/brd/sch001/list",{method:"GET"},{type:"json"}).then(function(e){return t.prjs=e,t.render()})},sharedb:function(){var t,e=this;return console.log("prepare sharedb ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),this.hub=new Hub({sdb:t}),t.on("error",function(){return r.toggle("not-sync")}),t.on("close",function(){return e.loader.on(),t.reconnect().then(function(){return e.getdoc()}).then(function(){return e.adapt()}).then(function(){return console.log("admin initialized.")}).then(function(){return e.loader.off()})})},getdoc:function(){var t=this;return this.hub.doc=null,this.sdb.get({id:"brd/"+this.brd+"/grp/"+this.grp+"/judge/criteria",watch:function(e,n){return t.hub.fire("change",{ops:e,source:n})},create:function(){return{}}}).then(function(e){return t.hub.doc=e,e.on("op",function(){return t.render()}),t.adapt({hub:t.hub,path:["user",t.user.key]})}).catch(function(t){return console.log("getdoc failed.",t)})},opsIn:function(t){var e;if(e=t.data,t.ops,!t.source)return this.data=JSON.parse(JSON.stringify(e)),this.render()}}),n.get().then(function(t){var e;return e=new a({user:t.user,root:document.body,brd:"sch001",grp:"4rFUP+03IS05ZD09ku03KMlsh"}),Promise.resolve().then(function(){return e.sharedb()}).then(function(){return e.getdoc()}).then(function(){return e.fetch()})})});