function import$(e,t){var r={}.hasOwnProperty;for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e}ldc.register("judgePreliminaryUser",["error","loader","auth","ldcvmgr","sdbAdapter"],function(e){var t,r,n,o,i;return e.error,t=e.loader,r=e.auth,n=e.ldcvmgr,o=e.sdbAdapter,i=function(e){var r,n=this;return this.loader=t,this.brd=e.brd,this.grp=e.grp,this.user=e.user,this.root=r="string"==typeof e.root?document.querySelector(e.root):e.root,this.prjs=[],this.data={},this.progress=this.getProgress(),this._update=debounce(function(){if(n.user)return n.opsOut(function(){return n.data})}),this.view=new ldView({root:r,handler:{progress:function(e){var t;return t=e.node,t.innerText=Math.round(100*n.progress.done/n.progress.total)},"progress-accept":function(e){var t;return t=e.node,t.style.width=100*n.progress.accept/n.progress.total+"%"},"progress-pending":function(e){var t;return t=e.node,t.style.width=100*n.progress.pending/n.progress.total+"%"},"progress-reject":function(e){var t;return t=e.node,t.style.width=100*n.progress.reject/n.progress.total+"%"},prj:{list:function(){return n.prjs},init:function(e){var t,r,o;return t=e.node,r=e.data,o=e.local,o.view=new ldView({context:r,root:t,action:{click:{option:function(e){var t,r,o,i,s;return t=e.node,r=e.context,o=t.getAttribute("data-name"),((i=n.data)[s=r.slug]||(i[s]={})).value=o,n.render(),n.update()},comment:function(){}}},text:{name:function(e){return e.node,e.context.name},ownername:function(e){return e.node,e.context.ownername}},handler:{option:function(e){var t,r,o,i,s,u,a;return t=e.node,e.local,r=e.context,o=t.getAttribute("data-name"),i={accept:"bg-success",pending:"bg-warning",reject:"bg-danger"}[o],s=((u=n.data)[a=r.slug]||(u[a]={})).value===o?"add":"remove",t.classList[s].apply(t.classList,[i,"text-white"])}}})},handler:function(e){var t,r;return e.node,t=e.data,(r=e.local).view.setContext(t),r.view.render()}}}}),this},i.prototype=import$(import$(Object.create(Object.prototype),o.interface),{render:function(){return this.progress=this.getProgress(),this.view.render()},update:function(e){return null==e&&(e={}),e.debounced?this._update():this._update().now()},getProgress:function(){var e,t,r,n;e={done:0,accept:0,pending:0,reject:0,total:this.prjs.length||1};for(t in r=this.data)(n=r[t]).value&&e[n.value]++;return e.done=e.accept+e.pending+e.reject||0,e},fetch:function(){var e=this;return console.log("get project list ... "),ld$.fetch("/dash/api/brd/test-brd/list",{method:"GET"},{type:"json"}).then(function(t){return e.prjs=t,e.render()})},sharedb:function(){var e,t=this;return console.log("prepare sharedb ..."),this.sdb=e=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),this.hub=new Hub({sdb:e}),e.on("error",function(){return n.toggle("not-sync")}),e.on("close",function(){return n.toggle("offline-retry",!0),e.reconnect().then(function(){return t.getdoc()}).then(function(){return t.adapt({hub:t.hub,path:["user",t.user.key]})}).then(function(){return console.log("admin initialized.")}).then(function(){return n.toggle("offline-retry",!1)})}),e.ready()},getdoc:function(){var e=this;return console.log("get judge document ... "),this.hub.doc=null,this.sdb.get({id:"brd/"+this.brd+"/grp/"+this.grp+"/judge/preliminary",watch:function(t,r){return e.hub.fire("change",{ops:t,source:r})},create:function(){return{}}}).then(function(t){return e.hub.doc=t,t.on("op",function(){return e.render()}),e.adapt({hub:e.hub,path:["user",e.user.key]})}).catch(function(e){return console.log("getdoc failed.",e)})},opsIn:function(e){var t;if(t=e.data,e.ops,!e.source)return this.data=JSON.parse(JSON.stringify(t)),this.render()}}),r.get().then(function(e){var t;return t=new i({user:e.user,root:document.body,brd:"test-brd",grp:"4jUmMh07zZ05kl0Col03v-Bhu"}),Promise.resolve().then(function(){return t.fetch()}).then(function(){return t.sharedb()}).then(function(){return t.getdoc()}).then(function(){return console.log("initied.")})})});