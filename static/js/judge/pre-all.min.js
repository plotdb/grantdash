function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}ldc.register("judgePreliminaryAll",["error","loader","auth","ldcvmgr","sdbAdapter"],function(t){var e,n,r,o;return t.error,t.loader,e=t.auth,n=t.ldcvmgr,r=t.sdbAdapter,o=function(t){var e,n=this;return this.opt=t,this.brd=t.brd,this.grp=t.grp,this.root=e="string"==typeof t.root?document.querySelector(t.root):t.root,this.data={},this._update=debounce(function(){return n.opsOut(function(){return n.data})}),this.view=new ldView({root:e,handler:{prj:{list:function(){return n.prjs},init:function(t){var e,r,o;return e=t.node,r=t.data,o=t.local,o.view=new ldView({context:r,root:e,text:{name:function(t){return t.node,t.context.name},ownername:function(t){return t.node,t.context.ownername}},action:{click:{pick:function(t){var e,r,c,i,u;return t.node,e=t.context,r=(c=(u=n.data).prj||(u.prj={}))[i=e.slug]||(c[i]={}),r.picked=!r.picked,o.view.render(),n.update()}}},handler:{pick:function(t){var e,r,o,c,i,u,a,d;return e=t.node,r=t.context,o=[["i-check","text-white","bg-success"],["i-circle","text-secondary","bg-light"]],c=(i=(a=n.data).prj||(a.prj={}))[u=r.slug]||(i[u]={}),(d=e.classList).add.apply(d,c.picked?o[0]:o[1]),d.remove.apply(d,c.picked?o[1]:o[0])},progress:function(t){var e,n,r;return e=t.node,n=t.context,r=e.getAttribute("data-name"),e.style.width=100*(n.count||(n.count={}))[r]/((n.count||(n.count={})).total||1)+"%"},count:function(t){var e,n,r;return e=t.node,n=t.context,r=e.getAttribute("data-name"),e.innerText=(n.count||(n.count={}))[r]||0}}})},handler:function(t){var e,n;return t.node,e=t.data,(n=t.local).view.setContext(e),n.view.render()}}}}),this},o.prototype=import$(import$(Object.create(Object.prototype),r.interface),{render:function(){return this.view.render()},update:function(t){return null==t&&(t={}),t.debounced?this._update():this._update().now()},fetch:function(){var t=this;return console.log("get project list ... "),ld$.fetch("/dash/api/brd/test-brd/list",{method:"GET"},{type:"json"}).then(function(e){return t.prjs=e,t.render()})},sharedb:function(){var t,e=this;return console.log("prepare sharedb ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),this.hub=new Hub({sdb:t}),t.on("error",function(){return n.toggle("not-sync")}),t.on("close",function(){return n.toggle("offline-retry",!0),t.reconnect().then(function(){return e.getdoc()}).then(function(){return e.adapt({hub:e.hub,path:[]})}).then(function(){return console.log("admin initialized.")}).then(function(){return n.toggle("offline-retry",!1)})}),t.ready()},getdoc:function(){var t=this;return console.log("get judge document ... "),this.hub.doc=null,this.sdb.get({id:"brd/"+this.brd+"/grp/"+this.grp+"/judge/preliminary",watch:function(e,n){return t.hub.fire("change",{ops:e,source:n})},create:function(){return{}}}).then(function(e){return t.hub.doc=e,e.on("op",function(){return t.render()}),t.adapt({hub:t.hub,path:[]})}).catch(function(t){return console.log("getdoc failed.",t)})},opsIn:function(t){var e,n=this;if(e=t.data,t.ops,!t.source)return this.data=JSON.parse(JSON.stringify(e)),console.log(this.data),{accept:0,pending:0,reject:0},this.prjs.map(function(t){var e,r,o;t.count={accept:0,pending:0,reject:0,total:0};for(e in r=n.data.user)o=r[e],t.count[o[t.slug].value]++;return t.count.total=t.count.accept+t.count.pending+t.count.reject}),this.render()}}),e.get().then(function(t){var e;return e=new o({root:document.body,brd:"test-brd",grp:"4jUmMh07zZ05kl0Col03v-Bhu"}),Promise.resolve().then(function(){return e.fetch()}).then(function(){return e.sharedb()}).then(function(){return e.getdoc()}).then(function(){return console.log("initied.")})})});