function import$(e,t){var r={}.hasOwnProperty;for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e}ldc.register("judgeFinalUser",["error","loader","auth","ldcvmgr","sdbAdapter"],function(e){var t,r,n,o,u,i;return e.error,t=e.loader,r=e.auth,n=e.ldcvmgr,o=e.sdbAdapter,u=function(e){var r=this;return this.loader=t,this.brd=e.brd,this.grp=e.grp,this.user=e.user,this.root="string"==typeof e.root?document.querySelector(e.root):e.root,this.prjs=[],this.data={},this._update=debounce(function(){return r.opsOut(function(){return r.data})}),this},u.prototype=import$(import$(Object.create(Object.prototype),o.interface),{render:function(){},update:function(e){return null==e&&(e={}),e.debounced?this._update():this._update().now()},initSheet:function(){var e=this;return console.log("init sheet ... "),this.sheet=i({afterChange:function(t){return null==t&&(t=[]),t.map(function(t){var r,n,o,u,i;return r=t[0],n=t[1],t[2],o=t[3],((u=e.data.value)[i=r-1]||(u[i]={}))[n-3]=o}),e.update()}})},fetch:function(){var e=this;return console.log("get project list ... "),ld$.fetch("/dash/api/brd/test-brd/list",{method:"GET"},{type:"json"}).then(function(t){var r;return e.prjs=t,r=e.prjs.map(function(e,t){return[t,0,e.name,0,0,0,0,1,""]}),r=[["編號","評論","名稱","創意","技術","設計","總分","排名","評論"]].concat(r),e.sheet.loadData(r),e.sheet.render(),e.render()})},sharedb:function(){var e,t=this;return console.log("prepare sharedb ..."),this.sdb=e=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),this.hub=new Hub({sdb:e}),e.on("error",function(){return n.toggle("not-sync")}),e.on("close",function(){return n.toggle("offline-retry",!0),e.reconnect().then(function(){return t.getdoc()}).then(function(){return t.adapt({hub:t.hub,path:["user",t.user.key]})}).then(function(){return console.log("admin initialized.")}).then(function(){return n.toggle("offline-retry",!1)})}),e.ready()},getdoc:function(){var e=this;return console.log("get judge document ... "),this.hub.doc=null,this.sdb.get({id:"brd/"+this.brd+"/grp/"+this.grp+"/judge/final",watch:function(t,r){return e.hub.fire("change",{ops:t,source:r})},create:function(){return{}}}).then(function(t){return e.hub.doc=t,t.on("op",function(){return e.render()}),e.user?e.adapt({hub:e.hub,path:["user",e.user.key]}):e.adapt({hub:e.hub,path:[]})}).catch(function(e){return console.log("getdoc failed.",e)})},opsIn:function(e){var t,r,n,o,u,i,s;if(t=e.data,e.ops,!e.source){this.data=JSON.parse(JSON.stringify(t)),n=[];for(o in(u=this.data).value||(u.value={})){i=[];for(s in(u=this.data.value)[o]||(u[o]={}))i.push(this.data.value[o][s]||0);n.push(i)}return r=n,this.sheet.populateFromArray(1,3,r),this.render()}}}),r.get().then(function(e){var t;return t=new u({user:e.user,root:document.body,brd:"test-brd",grp:"4jUmMh07zZ05kl0Col03v-Bhu"}),Promise.resolve().then(function(){return t.initSheet()}).then(function(){return t.fetch()}).then(function(){return t.sharedb()}).then(function(){return t.getdoc()}).then(function(){return console.log("initied.")})}),i=function(e){var t;return t=edit,Handsontable.renderers.registerRenderer("myrenderer",function(e,t,r,n,o,u,i){return Handsontable.renderers.TextRenderer.apply(this,arguments)}),new Handsontable(t,import$({rowHeaders:!0,colHeaders:!0,filters:!0,dropdownMenu:!0,rowHeights:25,colWidths:[40,50,180,50,50,50,50,50,250],minRows:50,minCols:15,stretchH:"all",fixedRowsTop:1,fixedColumnsLeft:3,cells:function(e,t){return{renderer:"myrenderer"}}},e))}});