function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}function in$(e,t){for(var n=-1,r=t.length>>>0;++n<r;)if(e===t[n])return!0;return!1}ldc.register("judgeFinalUser",["notify","judgeBase","error","loader","auth","ldcvmgr","sdbAdapter"],function(e){var t,n,r,i;return e.notify,t=e.judgeBase,n=e.error,e.loader,e.auth,e.ldcvmgr,e.sdbAdapter,r=function(e){var n,r=this;return import$(this,new t(e)),this.data={prj:{}},this.active=null,this.view.local=n=new ldView({initRender:!1,root:this.root,action:{click:{sort:function(e){var t;return t=e.node,r.sort(t.getAttribute("data-name"),t.getAttribute("data-value"))}}},text:{count:function(e){var t;return t=e.node,r.progress[t.getAttribute("data-name")]||0}},handler:{"comment-name":function(e){var t;if(t=e.node,r.active)return t.innerText=r.active.name||""},progress:function(e){var t,n,i,a;return t=e.node,n=e.names,i=r.progress,in$("progress-bar",n)?(a=t.getAttribute("data-name"),t.style.width=100*i[a]/i.total+"%"):in$("progress-percent",n)?t.innerText=Math.round(100*i.done/i.total):void 0},"header-criteria":{list:function(){return r.criteria},action:{click:function(e){var t;return e.node,t=e.data,r.sort("criteria",t.key)}},handler:function(e){var t,n;return t=e.node,n=e.data,t.innerText=n.name}},project:{key:function(e){return e.slug},list:function(){return r.prjs},init:function(e){var t,i,a,o;return t=e.node,i=e.local,a=e.data,o=t,t.classList.remove("d-none"),i.view=new ldView({initRender:!1,root:t,context:a,action:{click:{option:function(e){var t,n,a,o,s;return t=e.node,n=e.context,a=t.getAttribute("data-name"),((o=r.data.prj)[s=n.slug]||(o[s]={})).value=a,i.view.render(),r.getProgress(),r.view.local.render(["progress"]),r.update({debounced:10})},name:function(e){var t;return e.node,t=e.context,n.get("iframe").setAttribute("src","/dash/prj/"+t.slug+"?simple"),n.get("iframe-placeholder").classList.add("d-none"),this.activeNode&&this.activeNode.classList.remove("active"),this.activeNode=o,this.activeNode.classList.add("active")}}},text:{name:function(e){return e.context.name||""},ownername:function(e){var t;return(t=e.context).info.teamname||t.ownername||""},key:function(e){return e.context.key||""},budget:function(e){var t;return(t=e.context).info.budget?Math.round(t.info.budget/1e4)+"萬":""}},handler:{"has-comment":function(e){var t,n,i,a;return t=e.node,n=e.context,t.classList.toggle("invisible",!((i=r.data.prj)[a=n.slug]||(i[a]={})).comment)},option:function(e){var t,n,i,a,o,s,u;return t=e.node,e.local,n=e.context,i=t.getAttribute("data-name"),a={accept:"bg-success",pending:"bg-warning",reject:"bg-danger"}[i],o=((s=r.data.prj)[u=n.slug]||(s[u]={})).value===i?"add":"remove",t.classList[o].apply(t.classList,[a,"text-white"])}}})},handler:function(e){var t,n;return e.node,t=e.local,n=e.data,t.view.setContext(n),r.getState(n),t.view.render()}}}}),this},r.prototype=import$(import$({},t.prototype),{opsIn:function(e){var t,n,r,i,a,o,s;if(t=e.data,e.ops,!e.source){this.data=JSON.parse(JSON.stringify(t)),(n=this.data).prj||(n.prj={}),i=[];for(a in(n=this.data).value||(n.value={})){o=[];for(s in(n=this.data.value)[a]||(n[a]={}))o.push(this.data.value[a][s]||0);i.push(o)}return r=i,this.sheet.populateFromArray(1,3,r),this.render()}},render:function(){return this.getProgress(),this.view.base.render(),this.view.local.render()},initSheet:function(){var e,t=this;return console.log("init sheet ... "),this.sheet=i({root:edit,afterChange:function(e){return null==e&&(e=[]),e.map(function(e){var n,r,i,a,o;return n=e[0],r=e[1],e[2],i=e[3],((a=t.data.value)[o=n-1]||(a[o]={}))[r-3]=i}),t.update()}}),e=this.prjs.map(function(e,t){return[t,0,e.name,0,0,0,0,1,""]}),e=[["編號","評論","名稱","創意","技術","設計","總分","排名","評論"]].concat(e),this.sheet.loadData(e),this.sheet.render(),this.render()},init:function(){var e=this;return Promise.resolve().then(function(){return e.auth()}).then(function(){return e.initView()}).then(function(){return e.user=e.global.user}).then(function(){return e.fetchInfo()}).then(function(){return e.fetchPrjs()}).then(function(){return e.initSheet()}).then(function(){return e.sharedb()}).then(function(){return e.getdoc()}).then(function(){return e.sort("name",null,!1)}).then(function(){return console.log("initied.")}).catch(n)},getState:function(e){var t=this;return e.state=this.criteria.reduce(function(n,r){var i,a,o,s;return i=((a=(o=t.data.prj)[s=e.slug]||(o[s]={})).value||(a.value={}))[r.key],Math.max(n,null!=i?i:1)},0)},getProgress:function(){var e,t=this;return this.progress=e={done:0,accept:0,pending:0,reject:0,total:this.prjs.length||1},this.prjs.map(function(n){var r,i,a;if(r=((i=t.data.prj)[a=n.slug]||(i[a]={})).value)return e[r]++}),e.done=e.accept+e.pending+e.reject||0}}),new r({root:document.body}).init(),i=function(e){return Handsontable.renderers.registerRenderer("myrenderer",function(e,t,n,r,i,a,o){return Handsontable.renderers.TextRenderer.apply(this,arguments)}),new Handsontable(e.root,import$({rowHeaders:!0,colHeaders:!0,filters:!0,dropdownMenu:!0,rowHeights:25,colWidths:[40,50,220,50,50,50,50,50,250],minRows:50,minCols:15,stretchH:"all",fixedRowsTop:1,fixedColumnsLeft:3,cells:function(e,t){return{renderer:"myrenderer"}}},e))}});