function import$(e,t){var r={}.hasOwnProperty;for(var a in t)r.call(t,a)&&(e[a]=t[a]);return e}var folderData,backup,apply,root,itemSample,folderSample,render,path,host,rebind,reb;folderData=[{name:"歷屆活動",toggle:!0,children:[{name:"2018春季"},{name:"2018秋季"}]}],backup=JSON.parse(JSON.stringify(folderData)),apply=function(e){return console.log(JSON.stringify(e),JSON.stringify(backup)),otJson0.type.apply(backup,e),console.log("result: ",JSON.stringify(backup))},root=ld$.find("#root",0),itemSample=ld$.find("#item-sample",0),folderSample=ld$.find("#folder-sample",0),itemSample.removeAttribute("id"),folderSample.removeAttribute("id"),(render=function(e,t){return e.map(function(e){var r,a;return r=itemSample.cloneNode(!0),ld$.find(r,"[name=name]",0).value=e.name||"",ld$.find(r,"[name=url]",0).value=e.url||"",r.data=e,e.children?(r.classList.add("folder-toggle"),r.removeAttribute("draggable"),a=folderSample.cloneNode(!0),a.data=e,a.insertBefore(r,a.childNodes[0]),t.appendChild(a),render(e.children,ld$.find(a,".folder-menu",0))):t.appendChild(r)})})(folderData,root),path=function(e){var t,r,a;for(t=[];;){for(a=((r=host(e).data).children||r).indexOf(e.data),t=(r.children?["children"]:[]).concat([a],t);e&&(e=e.parentNode)!==root&&!e.data;);if(!e||!e.data)break}return t},host=function(e){for(;e&&(e=e.parentNode)!==root&&e&&!e.data;);return{node:e,data:e&&e.data?e.data:folderData}},root.addEventListener("input",function(e){var t,r,a,n,o,d,l,i;if((t=e.target)&&t.getAttribute)return r=host(t),a=r.node,n=r.data,r=[t.getAttribute("name"),t.value],o=r[0],d=r[1],l=n[o],n[o]=d,i=[import$({p:path(a).concat([o]),oi:d},l?{od:l}:{})],console.log(i),apply(i)}),rebind=function(e,t){if(e.data=t,e.classList.contains("folder"))return Array.from(ld$.find(e,".folder-menu",0).childNodes).map(function(e,r){return rebind(e,t.children[r])})},reb=new reblock({root:"#root",action:{beforeMoveNode:function(e){var t,r,a,n;return t=e.src,e.des,e.ib,r=path(t),a=host(t).data,(a=a.children||a).splice(a.indexOf(t),1),n=[{p:r,ld:t.data}],console.log(")",r,t.data),apply(n)},afterMoveNode:function(e){var t,r,a,n,o,d,l,i;return t=e.src,r=e.des,a=e.ib,n=host(t),n.node,o=n.data,console.log(o),d=a?Array.from(r.childNodes).indexOf(a):r.childNodes.length,console.log(d),(o.children||o).splice(d,0,t.data),l=path(t),l[l.length-1]=d,i=[{p:l,li:t.data}],apply(i)},clone:function(e){var t,r,a,n,o,d;return t=e.node,r=e.src,a=JSON.parse(JSON.stringify(r.data)),rebind(t,a),n=path(r),n[n.length-1]+=1,((o=host(t).data).children||o).splice(n[n.length-1],0,a),t.data=a,d=[{p:n,li:a}],apply(d)},delete:function(e){var t,r,a,n,o,d;return t=e.node,r=host(t).data,a=path(t),n=r.children||r,o=n.indexOf(t.data),n.splice(o,1),d=[{p:a,ld:t.data}],apply(d)},input:function(){},beforeMove:function(e,t){var r;if(t.classList.contains("folder"))return null;for(;t;){if(!t.parentNode.classList)return null;if(t.classList.contains("folder-toggle")){if(e===t.parentNode)return null;if(r=ld$.find(t.parentNode,".folder-menu",0)){r.insertBefore(t=document.createElement("div"),r.childNodes[0]),t.dummy=!0;break}}if(t.parentNode.classList.contains("folder-menu")||t.parentNode.classList.contains("folder-root"))break;if(t.parentNode===e.parentNode)break;t=t.parentNode}return!t||e===t||ld$.parent(t,null,e)?(t.dummy&&t.parentNode.removeChild(t),null):t},moving:function(e,t,r){var a;return 0===r&&t.dummy&&(a=t,t=t.parentNode.parentNode,a.parentNode.removeChild(a)),t},afterMove:function(e,t,r){if(t.dummy)return t.parentNode.removeChild(t)}}}),(root=ld$.find("#root",0)).addEventListener("click",function(e){var t,r,a,n,o,d,l,i,s,c;if(e.target.classList&&(t=ld$.parent(e.target,".folder-item",root))){if(e.target.classList.contains("i-close"))return t.parentNode.classList.contains("folder")&&(t=t.parentNode),reb.select(t),reb.delete();if(e.target.classList.contains("i-clone")){if(t.parentNode.classList.contains("folder")&&(t=t.parentNode),reb.select(t),reb.clone(),t.classList.contains("folder"))return new ldui.Folder({root:t})}else if(e.target.classList.contains("i-radio"))return t.classList.contains("folder-toggle")?(t.classList.remove("folder-toggle"),t.setAttribute("draggable",!0),r=t.parentNode,a=JSON.parse(JSON.stringify(folderData)),t.data=r.data,n=host(r).data,o=n.children||n,d=o.indexOf(t.data)+1,o.splice.apply(o,[d,0].concat(t.data.children)),delete t.data.children,delete t.data.toggle,l=json0OtDiff(a,folderData),apply(l),i=r.parentNode,s=r.nextSibling,c=ld$.find(r,".folder-menu",0),ld$.find(r,".folder-menu > .folder-item").map(function(e){return e.parentNode.removeChild(e),i.insertBefore(e,s)}),c.parentNode.removeChild(c),r.removeChild(t),i.insertBefore(t,r),i.removeChild(r)):(t.classList.add("folder-toggle"),r=ld$.create({name:"div",className:["folder","show"],attr:{draggable:"true"}}),c=ld$.create({name:"div",className:["folder-menu"]}),t.removeAttribute("draggable"),t.parentNode.insertBefore(r,t),t.parentNode.removeChild(t),r.appendChild(t),r.appendChild(c),new ldui.Folder({root:r}))}}),reb.init();