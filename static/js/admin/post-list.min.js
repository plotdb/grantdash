function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}ldc.register("adminPostList",["notify","loader","ldcvmgr","error","adminPanel"],function(t){var e,n,r,o,i,s;return e=t.notify,n=t.loader,r=t.ldcvmgr,o=t.error,i=t.adminPanel,s=function(t){var n,s=this;return this.opt=t,this.root=n="string"==typeof t.root?document.querySelector(t.root):t.root,this.brd=t.brd,this.posts=[],this.view={},this.ldcv={},this.ldld=new ldLoader({root:ld$.find(n,"[ld=loading]",0)}),this.view.list=new ldView({initRender:!1,root:this.root,action:{click:{"new-post":function(){return s.toggleModal()},"sync-list":function(t){var e;return(e=t.node).classList.add("running"),s.fetch().then(function(){return debounce(1e3).then(function(){return e.classList.remove("running")})})}}},handler:{empty:function(t){return t.node.classList.toggle("d-none",s.posts&&s.posts.length)},editor:function(t){return t.node.classList.toggle("d-none",!0)},post:{list:function(){return s.posts||[]},init:function(t){var n,i,d;return n=t.node,i=t.local,d=t.data,n.classList.remove("d-none"),i.view=new ldView({root:n,context:d,action:{click:{edit:function(t){var e;return t.node,e=t.context,s.edit(e.slug)},delete:function(t){var n;return t.node,n=t.context,r.get("confirm-deletion").then(function(t){if("yes"===t)return ld$.fetch("/dash/api/post/"+n.slug,{method:"delete"}).then(function(){return e.send("success","文章已刪除")}).then(function(){var t;if(~(t=s.posts.indexOf(n)))return s.posts.splice(t,1),s.view.list.render()})}).catch(o())}}},handler:{title:function(t){var e,n;return e=t.node,n=t.context,e.innerText=n.title},owner:function(t){var e,n;return e=t.node,n=t.context,e.innerText=n.ownername},date:function(t){var e,n;return e=t.node,n=t.context,e.innerText=moment(n.createdtime).format("YYYY-MM-DD hh:mm:ss")},avatar:function(t){var e,n;return e=t.node,n=t.context,e.style.backgroundImage="url(/s/avatar/"+n.owner+".png)"},view:function(t){var e,n;return e=t.node,n=t.context,e.setAttribute("href","/post/"+n.slug+"/")}}})},handler:function(t){var e,n;return e=t.local,n=t.data,e.view.setContext(n),e.view.render()}}}}),i.on("active",function(t){var e;if(t.nav,e=t.name,t.panel,"brd-post-list"===e)return s.edit(null),s.fetch()}),this},s.prototype=import$(Object.create(Object.prototype),{render:function(){return this.view.list.render()},fetch:function(){var t=this;return this.ldld.on(),ld$.fetch("/dash/api/post/",{method:"GET"},{params:{brd:this.brd.slug},type:"json"}).then(function(e){return t.posts=e,t.render(),t.ldld.off()})},edit:function(t){var e;return e=this.view.list.get("editor"),t&&(e.src="/dash/post/"+t+"/edit"),e.classList.toggle("d-none",!t)},toggleModal:function(){var t,e=this;return(t=this.ldcv.newPost)&&t.toggle(),r.getdom("new-post").then(function(t){return e.form=new ldForm({root:t,submit:"[ld=post]"}),e.view.create=new ldView({root:t,action:{click:{post:function(t){var r;return t.node,n.on(),r={brd:e.brd.slug,title:e.form.values().title},ld$.fetch("/dash/api/post/",{method:"POST"},{json:r,type:"json"}).then(function(t){return e.edit(t.slug),n.off(),e.ldcv.newPost.toggle(!1)}).catch(o())}}}}),r.getcover("new-post")}).then(function(t){return e.ldcv.newPost=t}).then(function(){return e.ldcv.newPost.toggle()})}}),s});