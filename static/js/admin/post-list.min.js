function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}ldc.register("adminPostList",["notify","auth","loader","ldcvmgr","error","adminPanel"],function(t){var e,n,r,o,i,s,c;return e=t.notify,n=t.auth,r=t.loader,o=t.ldcvmgr,i=t.error,s=t.adminPanel,c=function(t){var n,r=this;return this.opt=t,this.root=n="string"==typeof t.root?document.querySelector(t.root):t.root,this.brd=t.brd,this.posts=[],this.view={},this.ldcv={},this.ldld=new ldLoader({root:ld$.find(n,"[ld=loading]",0)}),this.view.list=new ldView({initRender:!1,root:this.root,action:{click:{"new-post":function(){return r.toggleModal()},"sync-list":function(t){var e;return(e=t.node).classList.add("running"),r.fetch().then(function(){return debounce(1e3).then(function(){return e.classList.remove("running")})})}}},handler:{empty:function(t){return t.node.classList.toggle("d-none",r.posts&&r.posts.length)},editor:function(t){return t.node.classList.toggle("d-none",!0)},post:{list:function(){return r.posts||[]},init:function(t){var n,s,c;return n=t.node,s=t.local,c=t.data,n.classList.remove("d-none"),s.view=new ldView({root:n,context:c,action:{click:{edit:function(t){var e;return t.node,e=t.context,r.edit(e.slug)},delete:function(t){var n;return t.node,n=t.context,o.get("confirm-deletion").then(function(t){if("yes"===t)return ld$.fetch("/dash/api/post/"+n.slug,{method:"delete"}).then(function(){return e.send("success","文章已刪除")}).then(function(){var t;if(~(t=r.posts.indexOf(n)))return r.posts.splice(t,1),r.view.list.render()})}).catch(i())}}},handler:{title:function(t){var e,n;return e=t.node,n=t.context,e.innerText=n.title},owner:function(t){var e,n;return e=t.node,n=t.context,e.innerText=n.ownername},date:function(t){var e,n;return e=t.node,n=t.context,e.innerText=moment(n.createdtime).format("YYYY-MM-DD hh:mm:ss")},avatar:function(t){var e,n;return e=t.node,n=t.context,e.style.backgroundImage="url(/dash/s/avatar/"+n.owner+".png)"},view:function(t){var e,n;return e=t.node,n=t.context,e.setAttribute("href","/dash/post/"+n.slug+"/")}}})},handler:function(t){var e,n;return e=t.local,n=t.data,e.view.setContext(n),e.view.render()}}}}),s.on("active",function(t){var e;if(t.nav,e=t.name,t.panel,"brd-post-list"===e)return r.edit(null),r.fetch()}),this},c.prototype=import$(Object.create(Object.prototype),{render:function(){return this.view.list.render()},fetch:function(){var t=this;return this.ldld.on(),ld$.fetch("/dash/api/post/",{method:"GET"},{params:{brd:this.brd.slug},type:"json"}).then(function(e){return t.posts=e,t.render(),t.ldld.off()})},edit:function(t){var e;return e=this.view.list.get("editor"),t&&(e.src="/dash/post/"+t+"/edit"),e.classList.toggle("d-none",!t)},toggleModal:function(){var t,e=this;return(t=this.ldcv.newPost)&&t.toggle(),o.getdom("new-post").then(function(t){return e.form=new ldForm({root:t,submit:"[ld=post]"}),e.view.create=new ldView({root:t,action:{click:{post:function(t){var o;return t.node,r.on(),o={brd:e.brd.slug,title:e.form.values().title},n.recaptcha.get().then(function(t){return o.recaptcha=t,ld$.fetch("/dash/api/post/",{method:"POST"},{json:o,type:"json"})}).then(function(t){return e.edit(t.slug),r.off(),e.ldcv.newPost.toggle(!1)}).catch(i())}}}}),o.getcover("new-post")}).then(function(t){return e.ldcv.newPost=t}).then(function(){return e.ldcv.newPost.toggle()})}}),c});