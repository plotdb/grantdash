function import$(t,e){var n={}.hasOwnProperty;for(var i in e)n.call(e,i)&&(t[i]=e[i]);return t}ldc.register("adminStage",["sdbAdapter"],function(t){var e,n;return e=t.sdbAdapter,n=function(t){var e,n,i,r,a,u,o=this;return this.opt=t,this.root=e="string"==typeof t.root?document.querySelector(t.root):t.root,this.obj=n={cfg:null,update:function(){return o.opsOut(function(){return o.obj.cfg})}},this.view=i={},this.view.update=function(){return o.view.all.render(),o.view.updateStage().now()},this.view.updateStage=debounce(100,function(){return o.reb.node.dragging?o.view.updateStage():o.view.stage.render()}),r=function(t){var e;return!!t&&(!(!(e=a.get())||e.name!==t)||!~n.cfg.list.map(function(t){return t.name}).indexOf(t))},this.stage=a={list:function(){var t;return(t=n.cfg).list||(t.list=[])},key:"default",_key:function(t){return t=null!=t?t:this.key||"default"},init:function(){if(!Array.isArray(n.cfg.list))return n.cfg.list=[{key:"default"}]},is:function(t){return this._key()===t},isDefault:function(){return"default"===this._key()},insertBefore:function(t,e){var i,r,a,u;return i=n.cfg.list,r=i.map(function(t){return t.key}).indexOf(t),a=i.splice(r,1)[0],u=null!=e?i.map(function(t){return t.key}).indexOf(e):i.length,i.splice(u,0,a)},get:function(t){var e=this;return n.cfg.list.filter(function(n){return n.key===e._key(t)})[0]},add:function(t){if(null==t&&(t={}),!this.get(t.key))return n.cfg.list.push(t),this.key=t.key},del:function(t){var e,i;if("default"!==(t=this._key(t)))return e=n.cfg.list.map(function(t){return t.key}).indexOf(t),n.cfg.list.splice(e,1),t===this.key?this.key=((i=n.cfg.list)[i.length-1]||{}).key||"default":void 0},val:function(t){var e,i,r,a;if(e=t.name,i=t.value,r=t.key,r=this._key(r),a=n.cfg.list.filter(function(t){return t.key===r})[0])return null!=i?a[e]=i:a[e]},use:function(t){return this.key=t}},u={root:e,init:{},handler:{},action:{click:{},input:{}},initRender:!1},import$(u.action.input,{"stage-name":function(t){var e,u,o;if(e=t.node,u=(e.value||"").trim(),o=!r(u),e.classList.toggle("is-invalid",o),!o)return a.val({name:"name",value:e.value}),n.update(),i.update()}}),import$(u.init,{stages:function(t){var e;return e=t.node,t.evt,o.reb=new reblock({name:"stage",root:e,action:{beforeMoveNode:function(t){t.src,t.des,t.ib},afterMoveNode:function(t){var e,i;return e=t.src,t.des,i=t.ib,a.insertBefore(e._data.key||"default",i?i._data.key:null),n.update()}}})}}),import$(u.action.click,{stages:function(t){var e,r,u,o;if(t.node,e=t.evt,r=e.target,u=r.getAttribute("data-type"))return"new-stage"===u?(o=suuid(),a.add({name:"新階段",key:o,desc:"自訂時段",config:{}}),n.update()):a.use(r.getAttribute("data-key")),i.update()},"delete-stage":function(t){return t.node,t.evt,a.del(),n.update(),i.update()}}),import$(u.handler,{"default-view":function(t){return t.node.classList.toggle("d-none",!a.isDefault())},"custom-view":function(t){return t.node.classList.toggle("d-none",a.isDefault())},"stage-name":function(t){var e,n;return e=t.node,e.value=a.val({name:"name"})||"預設",n=(e.value||"").trim(),e.classList.toggle("is-invalid",!r(n))}}),import$(u.action.input,{time:function(t){var e;return e=t.node,e.value=moment(e.value).format(),a.val({name:e.getAttribute("data-name"),value:moment(e.value).format()}),n.update()}}),import$(u.init,{time:function(t){var e;return e=t.node,tail.DateTime(e,{time12h:!0})}}),import$(u.handler,{time:function(t){var e;return e=t.node,e.value=a.val({name:e.getAttribute("data-name")})||""}}),import$(u.action.click,{switch:function(t){var e,i,r;return(e=t.node).classList.toggle("on"),i=(r=a.get()).config||(r.config={}),i[e.getAttribute("data-name")]=e.classList.contains("on"),n.update()}}),import$(u.handler,{switch:function(t){var e,n;return e=t.node,n=a.val({name:"config"})||{},e.classList.toggle("on",!!n[e.getAttribute("data-name")])}}),this.view.all=new ldView(u),this.view.stage=new ldView({root:e,initRender:!1,handler:{stage:{list:function(){return a.list()},handler:function(t){var e,n,i,r;return e=t.node,n=t.data,t.idx,i=n.key||"default",r=ld$.find(e,"a",0),r.innerText=n.name||"預設",r.classList.toggle("active",a.is(i)),r.setAttribute("data-key",i),r.setAttribute("data-type","tab"),r}}}}),this},n.prototype=import$(import$(Object.create(Object.prototype),e.interface),{opsIn:function(t){var e;if(e=t.data,t.ops,!t.source)return this.obj.cfg=JSON.parse(JSON.stringify(e||{})),this.stage.init(),this.view.update()}}),n});