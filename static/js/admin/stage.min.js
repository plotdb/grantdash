function import$(t,e){var n={}.hasOwnProperty;for(var i in e)n.call(e,i)&&(t[i]=e[i]);return t}ldc.register("adminStage",["sdbAdapter"],function(t){var e,n;return e=t.sdbAdapter,n=function(t){var e,n,i,a,r,u,o=this;return this.opt=t,this.root=e="string"==typeof t.root?document.querySelector(t.root):t.root,this.obj=n={cfg:null,update:function(){return o.opsOut(function(){return o.obj.cfg})}},this.view=i={},this.view.update=function(){return o.view.all.render(),o.view.updateStage().now()},this.view.updateStage=debounce(100,function(){return o.reb.node.dragging?o.view.updateStage():o.view.stage.render()}),a=function(t){var e;return!!t&&(!(!(e=r.get())||e.name!==t)||!~n.cfg.stage.map(function(t){return t.name}).indexOf(t))},this.stage=r={list:function(){var t;return(t=n.cfg).stage||(t.stage=[])},key:"default",_key:function(t){return t=null!=t?t:this.key||"default"},init:function(){if(!Array.isArray(n.cfg.stage))return n.cfg.stage=[{key:"default"}]},is:function(t){return this._key()===t},isDefault:function(){return"default"===this._key()},insertBefore:function(t,e){var i,a,r,u;return i=n.cfg.stage,a=i.map(function(t){return t.key}).indexOf(t),r=i.splice(a,1)[0],u=null!=e?i.map(function(t){return t.key}).indexOf(e):i.length,i.splice(u,0,r)},get:function(t){var e=this;return n.cfg.stage.filter(function(n){return n.key===e._key(t)})[0]},add:function(t){if(null==t&&(t={}),!this.get(t.key))return n.cfg.stage.push(t),this.key=t.key},del:function(t){var e,i;if("default"!==(t=this._key(t)))return e=n.cfg.stage.map(function(t){return t.key}).indexOf(t),n.cfg.stage.splice(e,1),t===this.key?this.key=((i=n.cfg.stage)[i.length-1]||{}).key||"default":void 0},val:function(t){var e,i,a,r;if(e=t.name,i=t.value,a=t.key,a=this._key(a),r=n.cfg.stage.filter(function(t){return t.key===a})[0])return null!=i?r[e]=i:r[e]},use:function(t){return this.key=t}},u={root:e,init:{},handler:{},action:{click:{},input:{}},initRender:!1},import$(u.action.input,{"stage-name":function(t){var e,u,o;if(e=t.node,u=(e.value||"").trim(),o=!a(u),e.classList.toggle("is-invalid",o),!o)return r.val({name:"name",value:e.value}),n.update(),i.update()}}),import$(u.init,{stages:function(t){var e;return e=t.node,t.evt,o.reb=new reblock({name:"stage",root:e,action:{beforeMoveNode:function(t){t.src,t.des,t.ib},afterMoveNode:function(t){var e,i;return e=t.src,t.des,i=t.ib,r.insertBefore(e._data.key||"default",i?i._data.key:null),n.update()}}})}}),import$(u.action.click,{stages:function(t){var e,a,u,o;if(t.node,e=t.evt,a=e.target,u=a.getAttribute("data-type"))return"new-stage"===u?(o=suuid(),r.add({name:"新階段",key:o,desc:"自訂時段",config:{}}),n.update()):r.use(a.getAttribute("data-key")),i.update()},"delete-stage":function(t){return t.node,t.evt,r.del(),n.update(),i.update()}}),import$(u.handler,{"default-view":function(t){return t.node.classList.toggle("d-none",!r.isDefault())},"custom-view":function(t){return t.node.classList.toggle("d-none",r.isDefault())},"stage-name":function(t){var e,n;return e=t.node,e.value=r.val({name:"name"})||"預設",n=(e.value||"").trim(),e.classList.toggle("is-invalid",!a(n))}}),import$(u.action.input,{time:function(t){var e;return e=t.node,r.val({name:e.getAttribute("data-name"),value:e.value}),n.update()}}),import$(u.init,{time:function(t){var e;return e=t.node,tail.DateTime(e)}}),import$(u.handler,{time:function(t){var e;return e=t.node,e.value=r.val({name:e.getAttribute("data-name")})||""}}),import$(u.action.click,{switch:function(t){var e,i,a;return(e=t.node).classList.toggle("on"),i=(a=r.get()).config||(a.config={}),i[e.getAttribute("data-name")]=e.classList.contains("on"),n.update()}}),import$(u.handler,{switch:function(t){var e,n;return e=t.node,n=r.val({name:"config"})||{},e.classList.toggle("on",!!n[e.getAttribute("data-name")])}}),this.view.all=new ldView(u),this.view.stage=new ldView({root:e,initRender:!1,handler:{stage:{list:function(){return r.list()},handler:function(t){var e,n,i,a;return e=t.node,n=t.data,t.idx,i=n.key||"default",a=ld$.find(e,"a",0),a.innerText=n.name||"預設",a.classList.toggle("active",r.is(i)),a.setAttribute("data-key",i),a.setAttribute("data-type","tab"),a}}}}),this},n.prototype=import$(import$(Object.create(Object.prototype),e.interface),{opsIn:function(t){var e;if(e=t.data,t.ops,!t.source)return this.obj.cfg=JSON.parse(JSON.stringify(e||{})),this.stage.init(),this.view.update()}}),n});