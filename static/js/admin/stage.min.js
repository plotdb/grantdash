function import$(t,e){var n={}.hasOwnProperty;for(var i in e)n.call(e,i)&&(t[i]=e[i]);return t}ldc.register("adminStage",["sdbAdapter"],function(t){var e,n;return e=t.sdbAdapter,n=function(t){var e,n,i,r,a,o,s=this;this.opt=t,this.root=e="string"==typeof t.root?document.querySelector(t.root):t.root,this.obj=n={idx:"default",cfg:null},i=function(){return s.opsOut(function(){return s.obj.cfg})},r=function(t){var e,i;return t&&(!~function(){var t,r=[];for(e in t=n.cfg.stage)i=t[e],r.push(i.name);return r}().indexOf(t)||n.cfg.stage[n.idx].name===t)},import$((a={root:e,init:{},handler:{},action:{click:{},input:{}},initRender:!1}).action.input,{"stage-name":function(t){var e,a,s,u,c;if(e=t.node,a=(e.value||"").trim(),s=!r(a),function(){var t,e=[];for(u in t=n.cfg.stage)c=t[u],e.push(c.name);return e}().indexOf(a),e.classList.toggle("is-invalid",s),!s)return n.cfg.stage[n.idx].name=e.value,i(),o.render()}}),import$(a.action.click,{stages:function(t){var e,r,a,s;if(t.node,e=t.evt,r=e.target,a=r.getAttribute("data-type"))return"new-stage"===a?(s=Math.random().toString(36).substring(2),n.cfg.stage[s]={name:"新階段",key:s,desc:"自訂時段",config:{}},i()):n.idx=r.getAttribute("data-key"),o.render()},"delete-stage":function(t){var e;if(t.node,t.evt,"default"!==n.idx)return delete n.cfg.stage[n.idx],n.idx=function(){var t=[];for(e in n.cfg.stage)t.push(e);return t}()[0]||"default",i(),o.render()}}),import$(a.handler,{"default-view":function(t){return t.node.classList.toggle("d-none","default"!==n.idx)},"custom-view":function(t){return t.node.classList.toggle("d-none","default"===n.idx)},"stage-name":function(t){var e,i;return e=t.node,e.value=n.cfg.stage[n.idx].name||"預設",i=(e.value||"").trim(),e.classList.toggle("is-invalid",!r(i))},stage:{list:function(){var t,e,i,r=[];for(t in e=n.cfg.stage)i=e[t],r.push(i);return r},handler:function(t){var e,i,r,a;return e=t.node,i=t.data,t.idx,r=i.key||"default",a=ld$.find(e,"a",0),a.innerText=i.name||"預設",a.classList.toggle("active",r===n.idx),a.setAttribute("data-key",r),a.setAttribute("data-type","tab"),a}}}),import$(a.action.input,{time:function(t){var e;return e=t.node,n.cfg.stage[n.idx][e.getAttribute("data-name")]=e.value,i()}}),import$(a.init,{time:function(t){var e;return e=t.node,tail.DateTime(e)}}),import$(a.handler,{time:function(t){var e;return e=t.node,e.value=n.cfg.stage[n.idx][e.getAttribute("data-name")]||""}}),import$(a.action.click,{switch:function(t){var e,r,a;if((e=t.node).classList.toggle("on"),r=(a=n.cfg.stage[n.idx]).config||(a.config={}))return r[e.getAttribute("data-name")]=e.classList.contains("on"),i()}}),import$(a.handler,{switch:function(t){var e,i;return(e=t.node).classList.toggle("on",!!((i=n.cfg.stage[n.idx]).config||(i.config={}))[e.getAttribute("data-name")])}}),this.view=o=new ldView(a)},n.prototype=import$(import$(Object.create(Object.prototype),e.interface),{opsIn:function(t){var e,n,i,r;if(e=t.data,t.ops,!t.source)return this.obj.cfg=JSON.parse(JSON.stringify(e||{})),(n=(i=this.obj.cfg).stage||(i.stage={})).default||(n.default={}),this.obj.cfg.stage[this.obj.idx]||(this.obj.idx=function(){var t=[];for(r in this.obj.cfg.stage)t.push(r);return t}.call(this)[0]||"default"),this.view.render()}}),n});