function import$(r,t){var e={}.hasOwnProperty;for(var n in t)e.call(t,n)&&(r[n]=t[n]);return r}ldc.register("adminJudgeFinal",["ldcvmgr","auth","sdbAdapter","error","adminPanel"],function(r){var t,e,n,a;return r.ldcvmgr,r.auth,t=r.sdbAdapter,e=r.error,n=r.adminPanel,a=function(r){var t=this;return null==r&&(r={}),this.opt=r,this.root="string"==typeof r.root?document.querySelector(r.root):r.root,this.path=r.path,this.brd=r.brd,this.grp=null,this.data={},this.obj={},n.on("active",function(r){var n,a;if(n=r.nav,a=r.name,r.panel,"grp-judge"===n&&"final"===a)return t.prepare().then(function(){return t.view.render()}).catch(e())}),this.view=new ldView({root:this.root,init:{ldbar:function(r){var t,e;return t=r.node,e=r.local,e.ldbar=new ldBar(t)}},action:{click:{switch:function(r){var e,n;return e=r.node,n=e.getAttribute("data-name"),e.classList.toggle("on"),t.obj[n]=e.classList.contains("on"),t.update(),t.getProgress(),t.view.render("final-judge")}}},handler:{ldbar:function(r){return r.local.ldbar.set(Math.floor(100*(t.data.progress||0)))},switch:function(r){var e,n;return e=r.node,n=e.getAttribute("data-name"),e.classList.toggle("on",!!t.obj[n])},"final-user-link":function(r){var e;if(e=r.node,t.grp)return e.setAttribute("href","/dash/brd/"+t.brd.slug+"/grp/"+t.grp.key+"/judge/final/user")},"final-all-link":function(r){var e;if(e=r.node,t.grp)return e.setAttribute("href","/dash/brd/"+t.brd.slug+"/grp/"+t.grp.key+"/judge/final/all")},"final-judge":{list:function(){var r;return(r=t.data).users||(r.users=[])},init:function(r){var t,e,n;return t=r.node,e=r.local,n=r.data,t.classList.toggle("d-none",!1),e.view=new ldView({root:t,context:n,handler:{name:function(r){var t,e;return t=r.node,e=r.context,t.innerText=e.name},"progress-bar":function(r){var t,e;return t=r.node,e=r.context,t.style.width=e.percent+"%"}}})},handler:function(r){var t,e;return t=r.local,e=r.data,t.view.setContext(e),t.view.render()}}}}),this},a.prototype=import$(import$(Object.create(Object.prototype),t.interface),{opsIn:function(r){var t;if(t=r.data,r.ops,!r.source)return this.obj=JSON.parse(JSON.stringify(t||{})),this.view.update()},update:function(){var r=this;return this.opsOut(function(){return r.obj})},prepare:function(){var r=this;return ld$.fetch("/dash/api/brd/"+this.brd.slug+"/grp/"+this.grp.key+"/judge/final/all",{method:"GET"},{type:"json"}).then(function(t){var e,n;return r.data=t||{},(e=(n=r.data).data||(n.data={})).user||(e.user={}),r.getProgress()}).catch(e())},getProgress:function(){var r,t,e,n,a,i=this;return r=this.data,t=[],this.obj["filter-criteria"]&&t.push("criteria"),this.obj["filter-primary"]&&t.push("shortlist"),e=r.prjs||(r.prjs=[]),t.length&&(e=(e||[]).filter(function(r){return t.reduce(function(t,e){var n;return t&&((n=r.system||(r.system={})).badge||(n.badge={}))[e]},!0)})),n=((r.users||(r.users=[])).length||1)*(e.length||1),a=0,(r.users||(r.users=[])).map(function(t){var n;return n=e.filter(function(e){var n,a,o,s,u,l,d;return n=(a=(o=(u=(l=r.data.user)[d=t.key]||(l[d]={})).prj||(u.prj={}))[s=e.key]||(o[s]={})).v||(a.v={}),!((a=(o=i.grp).grade||(o.grade={})).entries||(a.entries=[])).filter(function(r){return!(null!=n[r.key])||""===n[r.key]}).length}),t.percent=100*n.length/e.length,a+=n.length}),r.progress=a/n},setData:function(r){var t=this;return this.grp=r,this.prepare().then(function(){return t.view.render()}).catch(e())}}),a});