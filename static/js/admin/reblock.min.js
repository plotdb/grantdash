function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var slice$=[].slice;!function(){var t,e,n;if(t={running:!1,alpha:4,dur:150,box:{},init:function(e){var n,r,i,o,s;if(n=e.src,r=e.des,i=e.cb,!this.running)return this.src=n,this.des=r,this.running=!0,import$(this.box,{s1:(s={},s.x=(o=n.getBoundingClientRect()).x,s.y=o.y,s.width=o.width,s.height=o.height,s),d1:(s={},s.x=(o=r.getBoundingClientRect()).x,s.y=o.y,s.width=o.width,s.height=o.height,s)}),this.box.s1.x===(o=this.box.s1.y)&&o===(o=this.box.s1.width)&&o===(o=this.box.s1.height)&&0===o&&(this.box.s1=this.box.d1),i(),import$(this.box,{s2:(s={},s.x=(o=n.getBoundingClientRect()).x,s.y=o.y,s.width=o.width,s.height=o.height,s),d2:(s={},s.x=(o=r.getBoundingClientRect()).x,s.y=o.y,s.width=o.width,s.height=o.height,s)}),requestAnimationFrame(function(e){return t.handle(e)})},handle:function(e){var n,r,i,o,s,a,d,h,c,u,l,g;return null==this.start&&(this.start=e),n=[this.alpha,this.dur],r=n[0],i=n[1],n=this.box,o=n.s1,s=n.s2,a=n.d1,d=n.d2,h=e=(e-this.start)/i,e=1-Math.pow(e,r)/(Math.pow(e,r)+Math.pow(1-e,r)),n=[(o.x-s.x)*e,(o.y-s.y)*e],c=n[0],u=n[1],n=[(a.x-d.x)*e,(a.y-d.y)*e],l=n[0],g=n[1],this.src.style.transform="translate("+c+"px,"+u+"px)",this.des.style.transform="translate("+l+"px,"+g+"px)",h<1?requestAnimationFrame(function(e){return t.handle(e)}):(this.src.style.transform="",this.des.style.transform="",delete this.start,this.running=!1)}},e=function(t){return null==t&&(t={}),this.opt=t,this.action=t.action||{},this.reorder={check:!1},this.node={editing:null,dragging:null,injecting:null},this.drag={},this.selected=[],this.evtHandler={},this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this.blockmgr=t.blockManager,this},e.prototype=import$(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){var e,n,r,i,o,s=[];for(e=slice$.call(arguments,1),n=0,i=(r=this.evtHandler[t]||[]).length;n<i;++n)o=r[n],s.push(o.apply(this,e));return s},init:function(){var t=this;return this.opt.rootBlock&&this.inject({node:this.root,name:this.opt.rootBlock,force:!0}),document.addEventListener("click",function(e){var n,r;for(n=r=e.target;r&&r!==root;)r=r.parentNode;if(r)return t.select(n.hasAttribute&&(n.hasAttribute("repeat-item")||n.hasAttribute("block"))?n:null)}),this.root.addEventListener("dragover",function(e){var n,r,i,o;if(!t.node.dragging){for((n=t.node.injecting?t.node.injecting:t.node.injecting=document.createElement("div")).classList.add("ghost"),r=e.target;r&&(i=r.parentNode);){if(i.hasAttribute&&i.hasAttribute("hostable")){o=i;break}if(r.hasAttribute&&r.hasAttribute("hostable")){o=r;break}r=i}if(o&&(o===r&&(r=null),(!o.childNodes.length||r)&&r!==n))return n.parentNode&&n.parentNode.removeChild(n),o.insertBefore(n,r)}}),document.addEventListener("dragover",function(t){return t.preventDefault()}),document.addEventListener("drop",function(e){var n;return t.node.injecting&&((n=t.node.injecting.parentNode)&&n.removeChild(t.node.injecting),t.node.injecting=null),t.inject({node:e.target,name:e.dataTransfer.getData("text/plain")}).then(function(){return e.preventDefault(),e.stopPropagation()}).catch(function(){})}),this.root.addEventListener("drop",function(){return t.reorder.check=0,t.node.dragging=null}),this.root.addEventListener("dragstart",function(e){return t.node.dragging=e.target,e.dataTransfer.setDragImage(n,10,10)}),this.root.addEventListener("dragover",function(e){var n,r,i,o,s,a,d,h;if(e.preventDefault(),(n=t.node.dragging)&&(r=e.target)){if(t.action.beforeMove)r=t.action.beforeMove(n,r);else for(;r&&r.parentNode!==n.parentNode;)r=r.parentNode;if(r&&n!==r&&(r===n.nextSibling,i=[n.getBoundingClientRect(),r.getBoundingClientRect()],o=i[0],s=i[1],a=o.x===s.x?0:e.clientX-s.x,d=o.y===s.y?0:e.clientY-s.y,t.reorder.check||((i=t.reorder).x=e.clientX,i.y=e.clientY,i.check=1),h=a&&e.clientX-t.reorder.x>0||d&&e.clientY-t.reorder.y>0,!(Math.abs(a?e.clientX-t.reorder.x:e.clientY-t.reorder.y)<(a?s.width:s.height)/5)))return t.action.moving&&(r=t.action.moving(n,r,h)),t.move(n,r,h),t.action.afterMove&&t.action.afterMove(n,r,h),t.reorder.check=0}}),this.root.addEventListener("mousedown",function(t){var e,n=[];for(e=t.target;e&&(!e.hasAttribute||!e.hasAttribute("repeat-item"));)e=e.parentNode;if(e){for(e.setAttribute("draggable",!0);e=e.parentNode;)e.setAttribute&&n.push(e.setAttribute("draggable",!1));return n}}),this.root.addEventListener("click",function(e){return t.edit(e.target)}),this.root.addEventListener("keydown",function(e){var n,r,i;if(9===e.keyCode){if(!e.target.hasAttribute||!e.target.hasAttribute("editable"))return;return n=Array.from(t.root.querySelectorAll("[editable]")),((r=n.indexOf(e.target)+(e.shiftKey?-1:1))<0||!(i=n[r]))&&(i=e.target),t.edit(i),e.preventDefault()}}),this.root.addEventListener("input",function(t){var e,n,r;if((e=t.target)&&e.hasAttribute&&(n=e.getAttribute("editable"))){for(r=e;r&&!r.block;)r=r.parentNode;if(r)return(r.block||(r.block={})).data[n]=e.innerText}})},edit:function(t){if(t&&t.hasAttribute&&t.hasAttribute("editable"))return this.node.editing&&this.node.editing.setAttribute("contenteditable",!1),this.node.editing=t,t.setAttribute("contenteditable",!0),t.focus()},select:function(t,e){if(null==e&&(e=!1),this.selected.map(function(t){return t.removeAttribute("selected")}),e||this.selected.splice(0,this.selected.length),t)return Array.isArray(t)||(t=[t]),this.selected=this.selected.concat(t),t.map(function(t){return t.setAttribute("selected",!0)})},clone:function(){return this.select(this.selected.map(function(t){var e;return t.parentNode.insertBefore(e=t.cloneNode(!0),t.nextSibling),e}))},delete:function(){var t,e;if(t=(e=this.selected)[e.length-1])return t=t.nextSibling||t.previousSibling,this.selected.map(function(t){return t.parentNode.removeChild(t)}),this.select(t)},move:function(e,n,r){var i;if(e!==(i=r?n.nextSibling:n))return t.init({src:e,des:n,cb:function(){return e.parentNode.removeChild(e),n.parentNode.insertBefore(e,i)}})},inject:function(t){var e,n,r,i=this;return e=t.node,n=t.name,r=t.force,new Promise(function(t,o){var s,a,d;if(s=e,r)a=s;else{for(;s&&(d=s.parentNode);){if(d.hasAttribute&&d.hasAttribute("hostable")){a=d;break}if(s.hasAttribute&&s.hasAttribute("hostable")){a=s;break}s=d}if(!a)return o(new Error(""))}return a===s&&(s=null),n&&i.blockmgr?i.blockmgr.get(n).then(function(t){var e,n,r,o=[];for((e=document.createElement("div")).innerHTML=t,n=0,r=e.childNodes.length;n<r;++n)n,o.push(Promise.resolve(e.childNodes[0]).then(function(t){var e,n,r;for(t.parentNode.removeChild(t),a.insertBefore(t,s),e=window.getComputedStyle(t),n=e.height,t.style.height="0px",t.style.transition="height .15s ease-in-out",setTimeout(function(){return t.style.height=n},0),t.block={data:{},dom:{list:[],node:t}},r=a;r&&!r.block;)r=r.parentNode;return r&&r.block?r.block.dom.list.push(t.block.dom):i.block.dom.list.push(t.block.dom),debounce(150).then(function(){return t.style.transition="",t.style.height=""})}));return o}).then(function(){return t()}).catch(function(t){return o(t)}):new Error("inject block: no name, or no blockmgr")})}}),e.ghost=n=new Image,n.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="15" viewBox="0 0 20 15">\n  <rect x="0" y="0" width="20" height="15" fill="rgba(0,0,0,.5)"/>\n</svg>'),"undefined"!=typeof window&&null!==window&&(window.reblock=e),"undefined"!=typeof module&&null!==module)module.exports=e}();