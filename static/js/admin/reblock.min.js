function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}var slice$=[].slice;!function(){var t,e,n;if(t={running:!1,alpha:4,dur:150,box:{},init:function(e){var n,r,i,o,a;if(n=e.src,r=e.des,i=e.cb,!this.running)return this.src=n,this.des=r,this.running=!0,import$(this.box,{s1:(a={},a.x=(o=n.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a),d1:(a={},a.x=(o=r.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a)}),this.box.s1.x===(o=this.box.s1.y)&&o===(o=this.box.s1.width)&&o===(o=this.box.s1.height)&&0===o&&(this.box.s1=this.box.d1),i(),import$(this.box,{s2:(a={},a.x=(o=n.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a),d2:(a={},a.x=(o=r.getBoundingClientRect()).x,a.y=o.y,a.width=o.width,a.height=o.height,a)}),requestAnimationFrame(function(e){return t.handle(e)})},handle:function(e){var n,r,i,o,a,s,d,h,u,c,l,g;return null==this.start&&(this.start=e),n=[this.alpha,this.dur],r=n[0],i=n[1],n=this.box,o=n.s1,a=n.s2,s=n.d1,d=n.d2,h=e=(e-this.start)/i,e=1-Math.pow(e,r)/(Math.pow(e,r)+Math.pow(1-e,r)),n=[(o.x-a.x)*e,(o.y-a.y)*e],u=n[0],c=n[1],n=[(s.x-d.x)*e,(s.y-d.y)*e],l=n[0],g=n[1],this.src.style.transform="translate("+u+"px,"+c+"px)",this.des.style.transform="translate("+l+"px,"+g+"px)",h<1?requestAnimationFrame(function(e){return t.handle(e)}):(this.src.style.transform="",this.des.style.transform="",delete this.start,this.running=!1)}},e=function(t){return null==t&&(t={}),this.opt=t,this.action=t.action||{},this.reorder={check:!1},this.node={editing:null,dragging:null,injecting:null},this.drag={},this.selected=[],this.evtHandler={},this.root="string"==typeof t.root?document.querySelector(t.root):t.root,this.data=t.data,this.blockmgr=t.blockManager,this.init(),this.ready=proxise(function(){}),this},e.prototype=import$(Object.create(Object.prototype),{on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){var e,n,r,i,o,a=[];for(e=slice$.call(arguments,1),n=0,i=(r=this.evtHandler[t]||[]).length;n<i;++n)o=r[n],a.push(o.apply(this,e));return a},init:function(){var t=this;return document.addEventListener("click",function(e){var n,r;for(n=r=e.target;r&&r!==root;)r=r.parentNode;if(r)return t.select(n.hasAttribute&&(n.hasAttribute("repeat-item")||n.hasAttribute("block"))?n:null)}),this.root.addEventListener("dragover",function(e){var n,r,i,o;if(!t.node.dragging){for((n=t.node.injecting?t.node.injecting:t.node.injecting=document.createElement("div")).classList.add("ghost"),r=e.target;r&&(i=r.parentNode);){if(i.hasAttribute&&i.hasAttribute("hostable")){o=i;break}if(r.hasAttribute&&r.hasAttribute("hostable")){o=r;break}r=i}if(o&&(o===r&&(r=null),(!o.childNodes.length||r)&&r!==n))return n.parentNode&&n.parentNode.removeChild(n),o.insertBefore(n,r)}}),document.addEventListener("dragover",function(t){return t.preventDefault()}),document.addEventListener("drop",function(e){var n;return t.node.injecting&&((n=t.node.injecting.parentNode)&&n.removeChild(t.node.injecting),t.node.injecting=null),t.inject({node:e.target,name:e.dataTransfer.getData("text/plain")}).then(function(){return e.preventDefault(),e.stopPropagation()}).catch(function(t){return console.log(t)})}),this.root.addEventListener("drop",function(){return t.reorder.check=0,t.node.dragging=null}),this.root.addEventListener("dragstart",function(e){return t.node.dragging=e.target,e.dataTransfer.setDragImage(n,10,10)}),this.root.addEventListener("dragover",function(e){var n,r,i,o,a,s,d,h;if(e.preventDefault(),(n=t.node.dragging)&&(r=e.target)){if(t.action.beforeMove)r=t.action.beforeMove(n,r);else for(;r&&r.parentNode!==n.parentNode;)r=r.parentNode;if(r&&n!==r&&(r===n.nextSibling,i=[n.getBoundingClientRect(),r.getBoundingClientRect()],o=i[0],a=i[1],s=o.x===a.x?0:e.clientX-a.x,d=o.y===a.y?0:e.clientY-a.y,t.reorder.check||((i=t.reorder).x=e.clientX,i.y=e.clientY,i.check=1),h=s&&e.clientX-t.reorder.x>0||d&&e.clientY-t.reorder.y>0,!(Math.abs(s?e.clientX-t.reorder.x:e.clientY-t.reorder.y)<(s?a.width:a.height)/5)))return t.action.moving&&(r=t.action.moving(n,r,h)),t.move(n,r,h),t.action.afterMove&&t.action.afterMove(n,r,h),t.reorder.check=0}}),this.root.addEventListener("mousedown",function(t){var e,n=[];for(e=t.target;e&&(!e.hasAttribute||!e.hasAttribute("repeat-item"));)e=e.parentNode;if(e){for(e.setAttribute("draggable",!0);e=e.parentNode;)e.setAttribute&&n.push(e.setAttribute("draggable",!1));return n}}),this.root.addEventListener("click",function(e){return t.edit(e.target)}),this.root.addEventListener("keydown",function(e){var n,r,i;if(9===e.keyCode){if(!e.target.hasAttribute||!e.target.hasAttribute("editable"))return;return n=Array.from(t.root.querySelectorAll("[editable]")),((r=n.indexOf(e.target)+(e.shiftKey?-1:1))<0||!(i=n[r]))&&(i=e.target),t.edit(i),e.preventDefault()}}),this.root.addEventListener("input",function(t){var e;(e=t.target)&&e.hasAttribute&&e.getAttribute("editable")})},select:function(t,e){if(null==e&&(e=!1),this.selected.map(function(t){return t.removeAttribute("selected")}),e||this.selected.splice(0,this.selected.length),t)return Array.isArray(t)||(t=[t]),this.selected=this.selected.concat(t),t.map(function(t){return t.setAttribute("selected",!0)})},edit:function(t){var e;if(t&&t.hasAttribute&&t.hasAttribute("editable")&&(!(e=t.getAttribute("edit-type"))||in$("text",e.split(" "))))return this.node.editing&&this.node.editing.setAttribute("contenteditable",!1),this.node.editing=t,t.setAttribute("contenteditable",!0),t.focus()},clone:function(){return this.select(this.selected.map(function(t){var e;return t.parentNode.insertBefore(e=t.cloneNode(!0),t.nextSibling),e}))},delete:function(){var t,e;if(t=(e=this.selected)[e.length-1])return t=t.nextSibling||t.previousSibling,this.selected.map(function(t){return t.parentNode.removeChild(t)}),this.select(t)},move:function(e,n,r){var i;if(e!==(i=r?n.nextSibling:n))return t.init({src:e,des:n,cb:function(){return e.parentNode.removeChild(e),n.parentNode.insertBefore(e,i)}})},inject:function(t){var e,n,r,i=this;return e=t.node,n=t.name,r=t.force,new Promise(function(t,o){var a,s,d;if(a=e,r)s=a;else{for(;a&&(d=a.parentNode);){if(d.hasAttribute&&d.hasAttribute("hostable")){s=d;break}if(a.hasAttribute&&a.hasAttribute("hostable")){s=a;break}a=d}if(!s)return o(new Error(""))}return s===a&&(a=null),n&&i.blockmgr?i.blockmgr.get(n).then(function(t){var e,n;return s.insertBefore(t,a),Array.from(s.childNodes).indexOf(a),e=window.getComputedStyle(t),n=e.height,t.style.height="0px",t.style.transition="height .15s ease-in-out",setTimeout(function(){return t.style.height=n},0),debounce(150).then(function(){return t.style.transition="",t.style.height=""})}).then(function(){return t()}).catch(function(t){return o(t)}):o(new Error("inject block: no name, or no blockmgr"))})}}),e.ghost=n=new Image,n.src="data:image/svg+xml,"+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="20" height="15" viewBox="0 0 20 15">\n  <rect x="0" y="0" width="20" height="15" fill="rgba(0,0,0,.5)"/>\n</svg>'),"undefined"!=typeof window&&null!==window&&(window.reblock=e),"undefined"!=typeof module&&null!==module)module.exports=e}();