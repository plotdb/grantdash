// Generated by LiveScript 1.3.0
ldc.register('adminPrjDetail', ['sdbAdapter', 'prjViewSimple', 'adminPanel', 'ldcvmgr'], function(arg$){
  var sdbAdapter, prjViewSimple, adminPanel, ldcvmgr, Ctrl;
  sdbAdapter = arg$.sdbAdapter, prjViewSimple = arg$.prjViewSimple, adminPanel = arg$.adminPanel, ldcvmgr = arg$.ldcvmgr;
  Ctrl = function(opt){
    var root, showPrj, this$ = this;
    this.opt = opt;
    this.root = root = typeof opt.root === 'string'
      ? document.querySelector(opt.root)
      : opt.root;
    this.prj = {};
    showPrj = function(){
      return ldcvmgr.getdom('prj-view').then(function(dom){
        if (this$.viewPrjContent) {
          return;
        }
        return this$.viewPrjContent = new ldView({
          initRender: false,
          root: dom,
          handler: {
            iframe: function(arg$){
              var node;
              node = arg$.node;
              return node.setAttribute('src', "/dash/prj/" + this$.prj.slug + "?simple");
            },
            "iframe-placeholder": function(arg$){
              var node;
              node = arg$.node;
              return node.classList.add('d-none');
            }
          }
        });
      }).then(function(){
        this$.viewPrjContent.render();
        return ldcvmgr.toggle('prj-view', true);
      });
    };
    adminPanel.on('active', function(arg$){
      var nav, name, panel;
      nav = arg$.nav, name = arg$.name, panel = arg$.panel;
      if (name === 'prj-view') {
        return showPrj();
      }
    });
    this.view = new ldView({
      root: root,
      text: {
        name: function(){
          return this$.prj.name || '(未命名的提案)';
        },
        ownername: function(){
          var ref$;
          return ((ref$ = this$.prj).info || (ref$.info = {})).teamname || this$.prj.ownername || '';
        },
        email: function(){
          return this$.prj.owneremail || '';
        }
      },
      handler: {
        id: function(arg$){
          var node;
          node = arg$.node;
          return node.value = this$.prj.slug;
        },
        username: function(arg$){
          var node;
          node = arg$.node;
          node.href = "/dash/user/" + this$.prj.owner;
          return node.innerText = this$.prj.ownername || '';
        },
        avatar: function(arg$){
          var node;
          node = arg$.node;
          return node.style.background = "url(/s/avatar/" + this$.prj.owner + ".png)";
        }
      },
      action: {
        click: {
          "show-prj": function(){
            return showPrj();
          }
        }
      }
    });
    return this;
  };
  Ctrl.prototype = import$(import$(Object.create(Object.prototype), sdbAdapter['interface']), {
    setPrj: function(it){
      this.prj = it;
      return this.view.render();
    },
    opsIn: function(arg$){
      var data, ops, source;
      data = arg$.data, ops = arg$.ops, source = arg$.source;
    }
  });
  return Ctrl;
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}