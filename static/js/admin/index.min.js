ldc.register("admin",["viewLocals","orgInfo","orgPerm","brdInfo","prjInfo","loader","util"],function(o){var n,r,e,t,d,i,a,c,u,f,l,p,s,g,b;return o.viewLocals,n=o.orgInfo,r=o.orgPerm,e=o.brdInfo,t=o.prjInfo,d=o.loader,i=o.util,d.on(),a={},(c=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return d.on(),c.reconnect().then(function(){return s()}).then(function(){return d.off()})}),u=function(o,e){return n.watch({ops:o,source:e}),r.watch({ops:o,source:e})},f=/o\/([0-9]+)/.exec(window.location.pathname),(l=!f&&i.parseQuerystring("o"))&&(f=["",l]),f&&(p="org-"+(f?f[1]:"demo"),(s=function(){return d.on(),c.get({id:p,watch:u}).then(function(o){return a.doc=o,console.log(o.data),n.init({doc:o,sdb:c}),r.init({doc:o,sdb:c}),d.off()})})()),g=new ldView({initRender:!1,root:".project-groups",action:{click:{"project-group-add":function(o){var n,r;return o.node,((n=JSON.parse(JSON.stringify(a.docbrd.data))).group||(n.group=[])).push({key:(n.group||(n.group=[])).length+1,name:"新分組"}),r=c.json.diff(a.docbrd.data,n),a.docbrd.submitOp(r),g.render()}}},handler:{"nav-tab":function(o){o.node},"project-group":{list:function(){return a.docbrd.data.group||[]},init:function(o){var n;return n=o.node,new ldView({root:n,action:{click:{"nav-tab":function(o){var n,r,e,d;if(n=o.node,r=ld$.parent(n,".folder",this.root))return e=r.getAttribute("data-key"),d=0,a.docbrd.data.group.map(function(o,n){if(o.key===+e)return d=n}),console.log(">",d),t.set({path:["group",d]})}}}})},handler:function(o){var n,r,e;if(n=o.node,r=o.data,e=ld$.find(n,"[ld=name]",0),n.setAttribute("data-key",r.key),e.innerText=r.name,n.folder||(n.folder=new ldui.Folder({root:n})),!n.nav)return n.nav=new ldui.Nav(n)}}}}),b=function(o,n){return e.watch({ops:o,source:n}),t.watch({ops:o,source:n}),g.render()},f=/b\/([0-9]+)/.exec(window.location.pathname),(l=!f&&i.parseQuerystring("b"))&&(f=["",l]),f&&(p="board-"+(f?f[1]:"demo"),function(){return d.on(),c.get({id:p,watch:b}).then(function(o){return a.docbrd=o,e.init({doc:a.docbrd,sdb:c}),t.init({doc:a.docbrd,sdb:c}),g.render(),d.off()})}()),d.off()}),ldc.app("admin");