ldc.register("admin",["viewLocals","orgInfo","orgPerm","brdInfo","prjInfo","loader","util"],function(o){var n,r,e,t,d,i,c,a,u,f,p,s,l,b,g;return o.viewLocals,n=o.orgInfo,r=o.orgPerm,e=o.brdInfo,t=o.prjInfo,d=o.loader,i=o.util,d.on(),c={},(a=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return d.on(),a.reconnect().then(function(){return l()}).then(function(){return d.off()})}),u=function(o,e){return n.watch({ops:o,source:e}),r.watch({ops:o,source:e})},f=/o\/([0-9]+)/.exec(window.location.pathname),(p=!f&&i.parseQuerystring("o"))&&(f=["",p]),f&&(s="org-"+(f?f[1]:"demo"),(l=function(){return d.on(),a.get({id:s,watch:u}).then(function(o){return c.doc=o,n.init({doc:o,sdb:a}),r.init({doc:o,sdb:a}),d.off()})})()),b=new ldView({initRender:!1,root:".project-groups",action:{click:{"project-group-add":function(o){var n,r;return o.node,((n=JSON.parse(JSON.stringify(c.docbrd.data))).group||(n.group=[])).push({key:(n.group||(n.group=[])).length+1,name:"新分組"}),r=a.json.diff(c.docbrd.data,n),c.docbrd.submitOp(r),b.render()}}},handler:{"nav-tab":function(o){o.node},"project-group":{list:function(){return c.docbrd.data.group||[]},init:function(o){var n;return n=o.node,new ldView({root:n,action:{click:{"nav-tab":function(o){var n,r,e,d;if(n=o.node,r=ld$.parent(n,".folder",this.root))return e=r.getAttribute("data-prj-key"),d=0,c.docbrd.data.group.map(function(o,n){if(o.key===+e)return d=n}),t.set({path:["group",d]})}}}})},handler:function(o){var n,r,e;if(n=o.node,r=o.data,e=ld$.find(n,"[ld=name]",0),n.setAttribute("data-prj-key",r.key),e.innerText=r.name,!n.folder)return n.folder=new ldui.Folder({root:n})}}}}),g=function(o,n){return e.watch({ops:o,source:n}),t.watch({ops:o,source:n}),b.render()},f=/b\/([0-9]+)/.exec(window.location.pathname),(p=!f&&i.parseQuerystring("b"))&&(f=["",p]),f&&(s="board-"+(f?f[1]:"demo"),function(){return d.on(),a.get({id:s,watch:g}).then(function(o){return c.docbrd=o,e.init({doc:c.docbrd,sdb:a}),t.init({doc:c.docbrd,sdb:a}),b.render(),d.off()})}()),d.off()}),ldc.app("admin");