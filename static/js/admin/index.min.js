ldc.register("admin",["permctrl","navbar","adminNavigation","viewLocals","orgInfo","brdInfo","prjInfo","loader","util"],function(n){var r,o,e,t,a,d,i,c,p,u,l,f,s,b,m,g,h,v,w,j,y,k,I;return r=n.permctrl,o=n.navbar,n.adminNavigation,n.viewLocals,e=n.orgInfo,t=n.brdInfo,a=n.prjInfo,d=n.loader,i=n.util,d.on(),c={},p=ld$.find("[ld~=nav-panel][data-nav=brd-config][data-name=perm]  [ld-scope=permission-panel]",0),["perm"],u={root:p,path:["perm"]},l=r.prepare(u),console.log(l),p=ld$.find("[ld~=nav-panel][data-nav=org-config][data-name=perm]  [ld-scope=permission-panel]",0),["perm"],f={root:p,path:["perm"]},s=r.prepare(f),b=ld$.find("[ld~=nav-panel][data-nav=main][data-name=brd-navbar]  [ld-scope=navbar-editor]",0),m={root:b,path:["page","navbar"]},o.prepare(m),(g=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return d.on(),g.reconnect().then(function(){return y()}).then(function(){return d.off()})}),h=function(n,r){return e.watch({ops:n,source:r}),s.watch({ops:n,source:r})},v=/o\/([0-9]+)/.exec(window.location.pathname),(w=!v&&i.parseQuerystring("o"))&&(v=["",w]),v&&(j="org-"+(v?v[1]:"demo"),(y=function(){return d.on(),g.get({id:j,watch:h}).then(function(n){return c.doc=n,e.init({doc:n,sdb:g}),s.init({doc:n,sdb:g}),d.off()})})()),k=new ldView({initRender:!1,root:".project-groups",action:{click:{"project-group-add":function(n){var r,o;return n.node,((r=JSON.parse(JSON.stringify(c.docbrd.data))).group||(r.group=[])).push({key:(r.group||(r.group=[])).length+1,name:"新分組"}),o=g.json.diff(c.docbrd.data,r),c.docbrd.submitOp(o),k.render()}}},handler:{"nav-tab":function(n){n.node},"project-group":{list:function(){return c.docbrd.data.group||[]},init:function(n){var r;return r=n.node,new ldView({root:r,action:{click:{"nav-tab":function(n){var r,o,e,t;if(r=n.node,o=ld$.parent(r,".folder",this.root))return e=o.getAttribute("data-prj-key"),t=0,c.docbrd.data.group.map(function(n,r){if(n.key===+e)return t=r}),a.set({path:["group",t]})}}}})},handler:function(n){var r,o,e;if(r=n.node,o=n.data,e=ld$.find(r,"[ld=name]",0),r.setAttribute("data-prj-key",o.key),e.innerText=o.name,!r.folder)return r.folder=new ldui.Folder({root:r})}}}}),I=function(n,r){return t.watch({ops:n,source:r}),a.watch({ops:n,source:r}),k.render()},v=/b\/([0-9]+)/.exec(window.location.pathname),(w=!v&&i.parseQuerystring("b"))&&(v=["",w]),v&&(j="board-"+(v?v[1]:"demo"),function(){return d.on(),g.get({id:j,watch:I}).then(function(n){return c.docbrd=n,t.init({doc:c.docbrd,sdb:g}),a.init({doc:c.docbrd,sdb:g}),l.init({doc:c.docbrd,sdb:g}),k.render(),d.off()})}()),d.off()}),ldc.app("admin");