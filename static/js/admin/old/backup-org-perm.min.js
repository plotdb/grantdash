function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("orgPerm",[],function(){var e,n,t,r,i,o,a,l,c;return e={type:"list"},n={idx:-1,cfg:{roles:[{name:"管理員",desc:"擁有管理此活動的所有權限，包含設定權限、更改任何設定等。",list:[{name:"Kirby Wu"},{name:"David Jones"},{name:"Beetle Juice"}]},{name:"評審",desc:"活動的提案評審，擁有個人的評審頁面，其評分表並會匯入評選大表中。",list:[{name:"clkao"},{name:"ipa chiu"}]}]}},t=function(){var t,r,i,o;return t=n.cfg.roles[r=n.idx],i=t?t.name:"",o=~r?"role":"list",e.idx=r,e.role=t,e.name=i,e.type=o,e},r=function(){return t(),c.render()},i=function(e){return e?o():a.update(n)},o=debounce(function(){return a.update(n)}),a=new ctrlz({obj:JSON.parse(JSON.stringify(n))}),l={root:"[ld-scope=permission-panel]",action:{click:{},keyup:{}},handler:{}},import$(l.action.click,{roles:function(e){var t;return e.node,t=e.evt,n.idx=n.cfg.roles.map(function(e){return e.name}).indexOf(t.target.getAttribute("data-name")),i(),r()},"new-role":function(e){var t,o,a,l,c;for(e.node,t=e.evt,o=n.cfg.roles.map(function(e){return e.name}),a=1;a<100&&(l=a,~o.indexOf("角色"+l));++a);return c="角色"+(l<100?l:Math.round(100*Math.random())+100),n.cfg.roles.push({name:c,desc:"自訂角色",list:[]}),n.idx=n.cfg.roles.length-1,i(),r(),t.stopPropagation()},"delete-role":function(){return n.cfg.roles.length<=1?alert("最少要有一個角色"):~n.idx?(n.cfg.roles.splice(n.idx,1),n.idx=-1,i(),r()):void 0}}),import$(l.action.keyup,{"role-name":function(t){var o,a,l;if(o=t.node,e.role){if(a=o.value,l=~n.cfg.roles.map(function(e){return e.name}).indexOf(a)&&e.name!==a,o.classList.toggle("is-invalid",l),l)return;return e.role.name=o.value,i(),r()}}}),import$(l.handler,{"list-view":function(n){return n.node.classList.toggle("d-none","list"!==e.type)},"role-view":function(n){return n.node.classList.toggle("d-none","role"!==e.type)},role:{list:function(){return n.cfg.roles},handler:function(n){var t,r,i;return t=n.node,r=n.data,(i=ld$.find(t,".nav-link",0)).classList.toggle("active",r.name===e.name),i.setAttribute("data-name",r.name),i.setAttribute("data-type","role"),i.innerText=r.name}},"role-name":function(t){var r,i;return(r=t.node).classList.toggle("d-none",!~n.idx),e.role&&(r.value=e.name),i=r.value,r.classList.toggle("is-invalid",~n.cfg.roles.map(function(e){return e.name}).indexOf(i)&&e.name!==i)},"role-desc":{list:function(){return n.cfg.roles},action:{keyup:function(e){var n,t;return n=e.node,t=e.data,t.desc=n.innerText,i(!0)}},handler:function(n){var t,r;return t=n.node,r=n.data,t.innerText=r.desc||"",t.setAttribute("data-name",r.name),t.classList.toggle("d-none",r.name!==e.name)}},"role-all":function(n){return n.node.classList.toggle("active","list"===e.type)},"role-desc-all":function(n){return n.node.classList.toggle("d-none","list"!==e.type)}}),import$(l.action.click,{switch:function(e){var t,r,o;if(t=e.node,e.evt,t.classList.toggle("on"),r=(o=n.cfg.roles[n.idx]).config||(o.config={}))return r[t.getAttribute("data-name")]=t.classList.contains("on"),i()}}),import$(l.handler,{switch:function(n){var t,r;if(t=n.node,e.role)return t.classList.toggle("on",!!((r=e.role).config||(r.config={}))[t.getAttribute("data-name")])}}),import$(l.handler,{user:{list:function(){return e.role?(e.role.list||[]).map(function(n){return n.perm=e.role.name,n}):n.cfg.roles.map(function(e){return e.list.map(function(n){return n.perm=e.name,n})}).reduce(function(e,n){return e.concat(n)},[])},handler:function(e){var n,t,r;if(n=e.node,t=e.data,ld$.find(n,"b",0).innerText=t.name,r=ld$.find(n,".text-muted",0))return r.innerText=t.perm},action:{click:function(e){var t,o,a;if(e.node,t=e.data,e.evt.target.classList.contains("i-close")&&~(o=n.cfg.roles.map(function(e){return e.name}).indexOf(t.perm))&&~(a=n.cfg.roles[o].list).indexOf(t))return a.splice(a.indexOf(t),1),i(),r()}}}}),import$(l.action.click,{"newuser-toggle":function(e){return e.node,c.getAll("newuser").map(function(e){return e.classList.toggle("d-none")})},"newuser-add":function(t){var o,a;return t.node,t.evt,o=("list"===e.type?e.pickedRole:e.role)||n.cfg.roles[0]||{name:""},a=c.get("newuser-name").value,~n.cfg.roles.map(function(e){return e.list}).reduce(function(e,n){return e.concat(n)},[]).map(function(e){return e.name}).indexOf(a)?alert("user already exist"):(o.list.push({name:a,perm:o.name}),c.get("newuser-name").value="",i(),r())}}),import$(l.handler,{"newuser-role-picked":function(t){var r;return r=t.node,e.pickedRole||(e.pickedRole=n.cfg.roles[0]),r.innerText=e.pickedRole.name},"newuser-role-option":{list:function(){return n.cfg.roles},action:{click:function(n){var t;return n.node,t=n.data,e.pickedRole=t,c.render("newuser-role-picked")}},handler:function(e){var n,t;return n=e.node,t=e.data,n.innerText=t.name}}}),c=new ldView(l),document.addEventListener("keydown",function(e){var t;if(90===e.keyCode&&(e.metaKey||e.ctrlKey))return e.shiftKey?a.redo():a.undo(),t=JSON.parse(JSON.stringify(a.get())),n.idx=t.idx,n.cfg=t.cfg,r()})}),ldc.app("orgPerm");