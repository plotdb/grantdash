function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var slice$=[].slice;ldc.register("adminPrjList",["error","loader","notify","ldcvmgr","auth","sdbAdapter","adminPanel"],function(t){var e,n,r,a,o,i;return e=t.error,n=t.loader,r=t.notify,a=t.ldcvmgr,t.auth,t.sdbAdapter,o=t.adminPanel,i=function(t){var i,c=this;return this.toc=t.toc,this.evtHandler={},this.data=[],o.on("active",function(t){var n;if(t.nav,n=t.name,t.panel,"grp-list"===n)return ld$.fetch("/dash/api/brd/"+c.toc.brd.slug+"/list",{method:"GET"},{params:{grp:c.grp.key},type:"json"}).then(function(t){return c.data=t,c.data.map(function(t){return t.info=t.detail.info}),c.view.render()}).catch(e())}),i={},debounce(function(){return c.view.render("prj")}),this.view=new ldView({root:t.root,action:{input:{"search-input":function(t){var e;return e=t.node,i.keyword=e.value}},keypress:{"search-input":function(t){if(t.node,13===t.evt.keyCode)return c.view.render()}},click:{search:function(){return c.view.render()},download:function(t){var n,r;return n=t.node,r=n.getAttribute("data-name"),ld$.fetch("/dash/api/brd/"+c.toc.brd.slug+"/grp/"+c.grp.key+"/prjs",{method:"GET"},{type:"json"}).then(function(t){var e,n,a;return null==t&&(t={}),"mail"===r&&(t=t.map(function(t){return{username:t.username,name:t.name}})),e=new Blob([JSON.stringify(t)],{type:"application/json"}),n=URL.createObjectURL(e),a=ld$.create({name:"a",attr:{href:n,download:"projects-"+r+".json"}}),document.body.appendChild(a),a.click(),document.body.removeChild(a),a.remove()}).catch(e())}}},handler:{empty:function(t){return t.node.classList.toggle("d-none",c.data.filter(function(t){return t.slug}).length)},prj:{list:function(){return c.data.filter(function(t){return t.slug&&(!i.keyword||~[t.name,(t.info||(t.info={})).teamname,t.username,t.ownername].filter(function(t){return t}).join(" ").indexOf(i.keyword))})},handler:function(t){var e,n,r,a;return e=t.node,n=t.local,r=t.data,n.view.setContext(r),n.view.render(),"active"===r.state?(a=e.style,a.color="auto",a):(a=e.style,a.color="rgba(0,0,0,.6)",a)},init:function(t){var i,u,s;return i=t.node,u=t.local,s=t.data,u.view=new ldView({context:s,root:i,action:{click:{"set-state":function(t){var e,a,o,i;return e=t.node,a=t.context,o=e.getAttribute("data-name"),i={value:o},n.on(),debounce(500).then(function(){return ld$.fetch("/dash/api/prj/"+a.slug+"/state",{method:"PUT"},{type:"json",json:i})}).finally(function(){return n.off()}).then(function(){return r.send("success","更新成功"),a.state=o,u.view.render("state")}).catch(function(){return r.send("danger","更新失敗")})},delete:function(t){var n,o;if(n=t.node,o=t.context,!n.classList.contains("running"))return a.get("confirm-deletion").then(function(t){if("yes"===t)return n.classList.toggle("running",!0),ld$.fetch("/dash/api/prj/"+o.slug,{method:"delete"},{type:"json"}).finally(function(){return n.classList.toggle("running",!1)}).then(function(){var t;return r.send("success","成功刪除了「"+o.name+"」提案"),~(t=c.data.indexOf(o))&&c.data.splice(t,1),c.view.render()}).catch(e())})},name:function(t){var e;return t.node,e=t.context,o.toggle({nav:"main",name:"grp-detail"}),c.setPrj(e)}}},init:{state:function(t){var e;return e=t.node,new Dropdown(e.parentNode)}},text:{name:function(t){return t.context.name||"(未命名的提案)"},index:function(t){return t.context.key},state:function(t){return"active"===t.context.state?"已送件":"編輯中"},ownername:function(t){var e;return((e=t.context).info||(e.info={})).teamname||e.ownername||""},username:function(t){return t.context.ownername||""}},handler:{edit:function(t){var e,n;return e=t.node,n=t.context,e.setAttribute("href","/dash/prj/"+n.slug+"/edit")},state:function(t){var e,n;return e=t.node,n=t.context,e.classList.toggle("text-success","active"===n.state),e.classList.toggle("text-warning","active"!==n.state)},"budget-consume":function(t){t.node,t.context},"budget-detail":function(t){t.node,t.context},avatar:function(t){var e,n;return e=t.node,n=t.context,e.style.background="url(/s/avatar/"+n.owner+".png)"}}})}}}}),this},i.prototype=import$(Object.create(Object.prototype),{setData:function(t){return this.grp=t},setPrj:function(t){return this.fire("set-prj",t)},on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){var e,n,r,a,o,i=[];for(e=slice$.call(arguments,1),n=0,a=(r=this.evtHandler[t]||[]).length;n<a;++n)o=r[n],i.push(o.apply(this,e));return i}}),i});