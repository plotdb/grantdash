function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}var slice$=[].slice;ldc.register("adminPrjList",["error","loader","notify","ldcvmgr","auth","sdbAdapter","adminPanel"],function(e){var t,n,r,a,o;return t=e.error,e.loader,n=e.notify,r=e.ldcvmgr,e.auth,e.sdbAdapter,a=e.adminPanel,o=function(e){var o,i=this;return this.toc=e.toc,this.evtHandler={},this.data=[],a.on("active",function(e){var n;if(e.nav,n=e.name,e.panel,"grp-list"===n)return ld$.fetch("/dash/api/brd/"+i.toc.brd.slug+"/list",{method:"GET"},{params:{grp:i.grp.key},type:"json"}).then(function(e){return i.data=e,i.data.map(function(e){return e.info=e.detail.info}),i.view.render()}).catch(t())}),o={},debounce(function(){return i.view.render("prj")}),this.view=new ldView({root:e.root,action:{input:{"search-input":function(e){var t;return t=e.node,o.keyword=t.value}},keypress:{"search-input":function(e){if(e.node,13===e.evt.keyCode)return i.view.render()}},click:{search:function(){return i.view.render()},download:function(e){var n,r;return n=e.node,r=n.getAttribute("data-name"),ld$.fetch("/dash/api/brd/"+i.toc.brd.slug+"/grp/"+i.grp.key+"/prjs",{method:"GET"},{type:"json"}).then(function(e){var t,n,a;return null==e&&(e={}),"mail"===r&&(e=e.map(function(e){return{username:e.username,name:e.name}})),t=new Blob([JSON.stringify(e)],{type:"application/json"}),n=URL.createObjectURL(t),a=ld$.create({name:"a",attr:{href:n,download:"projects-"+r+".json"}}),document.body.appendChild(a),a.click(),document.body.removeChild(a),a.remove()}).catch(t())}}},handler:{empty:function(e){return e.node.classList.toggle("d-none",i.data.filter(function(e){return e.slug}).length)},prj:{list:function(){return i.data.filter(function(e){return e.slug&&(!o.keyword||~[e.name,(e.info||(e.info={})).teamname,e.username,e.ownername].filter(function(e){return e}).join(" ").indexOf(o.keyword))})},handler:function(e){var t,n,r,a;return t=e.node,n=e.local,r=e.data,n.view.setContext(r),n.view.render(),"active"===r.state?(a=t.style,a.color="auto",a):(a=t.style,a.color="rgba(0,0,0,.6)",a)},init:function(e){var o,c,u;return o=e.node,c=e.local,u=e.data,c.view=new ldView({context:u,root:o,action:{click:{delete:function(e){var a,o;if(a=e.node,o=e.context,!a.classList.contains("running"))return r.get("confirm-deletion").then(function(e){if("yes"===e)return a.classList.toggle("running",!0),ld$.fetch("/dash/api/prj/"+o.slug,{method:"delete"},{type:"json"}).finally(function(){return a.classList.toggle("running",!1)}).then(function(){var e;return n.send("success","成功刪除了「"+o.name+"」提案"),~(e=i.data.indexOf(o))&&i.data.splice(e,1),i.view.render()}).catch(t())})},name:function(e){var t;return e.node,t=e.context,a.toggle({nav:"main",name:"grp-detail"}),i.setPrj(t)}}},text:{name:function(e){return e.context.name||"(未命名的提案)"},index:function(e){return e.context.key},state:function(e){return"active"===e.context.state?"已送件":"編輯中"},ownername:function(e){var t;return((t=e.context).info||(t.info={})).teamname||t.ownername||""},username:function(e){return e.context.ownername||""}},handler:{state:function(e){var t,n;return t=e.node,n=e.context,t.classList.toggle("text-success","active"===n.state),t.classList.toggle("text-warning","active"!==n.state)},"budget-consume":function(e){e.node,e.context},"budget-detail":function(e){e.node,e.context},avatar:function(e){var t,n;return t=e.node,n=e.context,t.style.background="url(/s/avatar/"+n.owner+".png)"}}})}}}}),this},o.prototype=import$(Object.create(Object.prototype),{setData:function(e){return this.grp=e},setPrj:function(e){return this.fire("set-prj",e)},on:function(e,t){var n;return((n=this.evtHandler)[e]||(n[e]=[])).push(t)},fire:function(e){var t,n,r,a,o,i=[];for(t=slice$.call(arguments,1),n=0,a=(r=this.evtHandler[e]||[]).length;n<a;++n)o=r[n],i.push(o.apply(this,t));return i}}),o});