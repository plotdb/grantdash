function import$(n,e){var t={}.hasOwnProperty;for(var r in e)t.call(e,r)&&(n[r]=e[r]);return n}var slice$=[].slice;ldc.register("adminPrjList",["error","loader","notify","ldcvmgr","auth","sdbAdapter","adminPanel"],function(n){var e,t,r,i;return e=n.error,n.loader,t=n.notify,n.ldcvmgr,n.auth,n.sdbAdapter,r=n.adminPanel,i=function(n){var i,o=this;return this.toc=n.toc,this.evtHandler={},this.data=[],r.on("active",function(n){var t;if(n.nav,t=n.name,n.panel,"grp-list"===t)return ld$.fetch("/dash/api/brd/"+o.toc.brd.slug+"/list",{method:"GET"},{type:"json"}).then(function(n){return o.data=n,o.data.map(function(n){return n.info=n.detail.info}),o.view.render()}).catch(e())}),i={},debounce(function(){return o.view.render("prj")}),this.view=new ldView({root:n.root,action:{input:{"search-input":function(n){var e;return e=n.node,i.keyword=e.value}},keypress:{"search-input":function(n){if(n.node,13===n.evt.keyCode)return o.view.render()}},click:{search:function(){return o.view.render()}}},handler:{empty:function(n){return n.node.classList.toggle("d-none",o.data.filter(function(n){return n.slug}).length)},prj:{list:function(){return o.data.filter(function(n){return n.slug&&(!i.keyword||~[n.name,(n.info||(n.info={})).teamname,n.username,n.ownername].filter(function(n){return n}).join(" ").indexOf(i.keyword))})},init:function(n){var i,a,c;return i=n.node,a=n.local,c=n.data,a.view=new ldView({context:c,root:i,action:{click:{delete:function(n){var r,i;if(r=n.node,i=n.context,!r.classList.contains("running"))return r.classList.toggle("running",!0),ld$.fetch("/dash/api/prj/"+i.slug,{method:"delete"},{type:"json"}).finally(function(){return r.classList.toggle("running",!1)}).then(function(){var n;return t.send("success","成功刪除了「"+i.name+"」提案"),~(n=o.data.indexOf(i))&&o.data.splice(n,1),o.view.render()}).catch(e())},name:function(n){var e;return n.node,e=n.context,r.toggle({nav:"main",name:"grp-detail"}),o.setPrj(e)}}},text:{name:function(n){return n.context.name},index:function(n){return n.context.key},ownername:function(n){var e;return((e=n.context).info||(e.info={})).teamname||e.ownername||""},username:function(n){return n.context.ownername||""}},handler:{"budget-consume":function(n){n.node,n.context},"budget-detail":function(n){n.node,n.context},avatar:function(n){var e,t;return e=n.node,t=n.context,e.style.background="url(/s/avatar/"+t.owner+".png)"}}})}}}}),this},i.prototype=import$(Object.create(Object.prototype),{setPrj:function(n){return this.fire("set-prj",n)},on:function(n,e){var t;return((t=this.evtHandler)[n]||(t[n]=[])).push(e)},fire:function(n){var e,t,r,i,o,a=[];for(e=slice$.call(arguments,1),t=0,i=(r=this.evtHandler[n]||[]).length;t<i;++t)o=r[t],a.push(o.apply(this,e));return a}}),i});