function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}var slice$=[].slice;ldc.register("adminPrjList",["error","loader","notify","ldcvmgr","auth","sdbAdapter","adminPanel"],function(t){var e,n,r,a,o;return e=t.error,t.loader,n=t.notify,r=t.ldcvmgr,t.auth,t.sdbAdapter,a=t.adminPanel,o=function(t){var o,i=this;return this.toc=t.toc,this.evtHandler={},this.data=[],a.on("active",function(t){var n;if(t.nav,n=t.name,t.panel,"grp-list"===n)return ld$.fetch("/dash/api/brd/"+i.toc.brd.slug+"/list",{method:"GET"},{params:{grp:i.grp.key},type:"json"}).then(function(t){return i.data=t,i.data.map(function(t){return t.info=t.detail.info}),i.view.render()}).catch(e())}),o={},debounce(function(){return i.view.render("prj")}),this.view=new ldView({root:t.root,action:{input:{"search-input":function(t){var e;return e=t.node,o.keyword=e.value}},keypress:{"search-input":function(t){if(t.node,13===t.evt.keyCode)return i.view.render()}},click:{search:function(){return i.view.render()},download:function(t){var n,r;return n=t.node,r=n.getAttribute("data-name"),ld$.fetch("/dash/api/brd/"+i.toc.brd.slug+"/grp/"+i.grp.key+"/prjs",{method:"GET"},{type:"json"}).then(function(t){var e,n,a;return null==t&&(t={}),"mail"===r&&(t=t.map(function(t){return{username:t.username,name:t.name}})),e=new Blob([JSON.stringify(t)],{type:"application/json"}),n=URL.createObjectURL(e),a=ld$.create({name:"a",attr:{href:n,download:"projects-"+r+".json"}}),document.body.appendChild(a),a.click(),document.body.removeChild(a),a.remove()}).catch(e())}}},handler:{empty:function(t){return t.node.classList.toggle("d-none",i.data.filter(function(t){return t.slug}).length)},prj:{list:function(){return i.data.filter(function(t){return t.slug&&(!o.keyword||~[t.name,(t.info||(t.info={})).teamname,t.username,t.ownername].filter(function(t){return t}).join(" ").indexOf(o.keyword))})},handler:function(t){var e,n,r,a;return e=t.node,n=t.local,r=t.data,n.view.setContext(r),n.view.render(),"active"===r.state?(a=e.style,a.color="auto",a):(a=e.style,a.color="rgba(0,0,0,.6)",a)},init:function(t){var o,c,u;return o=t.node,c=t.local,u=t.data,c.view=new ldView({context:u,root:o,action:{click:{delete:function(t){var a,o;if(a=t.node,o=t.context,!a.classList.contains("running"))return r.get("confirm-deletion").then(function(t){if("yes"===t)return a.classList.toggle("running",!0),ld$.fetch("/dash/api/prj/"+o.slug,{method:"delete"},{type:"json"}).finally(function(){return a.classList.toggle("running",!1)}).then(function(){var t;return n.send("success","成功刪除了「"+o.name+"」提案"),~(t=i.data.indexOf(o))&&i.data.splice(t,1),i.view.render()}).catch(e())})},name:function(t){var e;return t.node,e=t.context,a.toggle({nav:"main",name:"grp-detail"}),i.setPrj(e)}}},text:{name:function(t){return t.context.name||"(未命名的提案)"},index:function(t){return t.context.key},state:function(t){return"active"===t.context.state?"已送件":"編輯中"},ownername:function(t){var e;return((e=t.context).info||(e.info={})).teamname||e.ownername||""},username:function(t){return t.context.ownername||""}},handler:{edit:function(t){var e,n;return e=t.node,n=t.context,e.setAttribute("href","/dash/prj/"+n.slug+"/edit")},state:function(t){var e,n;return e=t.node,n=t.context,e.classList.toggle("text-success","active"===n.state),e.classList.toggle("text-warning","active"!==n.state)},"budget-consume":function(t){t.node,t.context},"budget-detail":function(t){t.node,t.context},avatar:function(t){var e,n;return e=t.node,n=t.context,e.style.background="url(/s/avatar/"+n.owner+".png)"}}})}}}}),this},o.prototype=import$(Object.create(Object.prototype),{setData:function(t){return this.grp=t},setPrj:function(t){return this.fire("set-prj",t)},on:function(t,e){var n;return((n=this.evtHandler)[t]||(n[t]=[])).push(e)},fire:function(t){var e,n,r,a,o,i=[];for(e=slice$.call(arguments,1),n=0,a=(r=this.evtHandler[t]||[]).length;n<a;++n)o=r[n],i.push(o.apply(this,e));return i}}),o});