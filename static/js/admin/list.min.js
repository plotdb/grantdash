function import$(n,e){var t={}.hasOwnProperty;for(var r in e)t.call(e,r)&&(n[r]=e[r]);return n}var slice$=[].slice;ldc.register("adminPrjList",["error","loader","notify","ldcvmgr","auth","sdbAdapter","adminPanel"],function(n){var e,t,r,o,a;return e=n.error,n.loader,t=n.notify,r=n.ldcvmgr,n.auth,n.sdbAdapter,o=n.adminPanel,a=function(n){var a,i=this;return this.toc=n.toc,this.evtHandler={},this.data=[],o.on("active",function(n){var t;if(n.nav,t=n.name,n.panel,"grp-list"===t)return ld$.fetch("/dash/api/brd/"+i.toc.brd.slug+"/list",{method:"GET"},{params:{grp:i.grp.key},type:"json"}).then(function(n){return i.data=n,i.data.map(function(n){return n.info=n.detail.info}),i.view.render()}).catch(e())}),a={},debounce(function(){return i.view.render("prj")}),this.view=new ldView({root:n.root,action:{input:{"search-input":function(n){var e;return e=n.node,a.keyword=e.value}},keypress:{"search-input":function(n){if(n.node,13===n.evt.keyCode)return i.view.render()}},click:{search:function(){return i.view.render()},download:function(n){var t,r;return t=n.node,r=t.getAttribute("data-name"),ld$.fetch("/dash/api/brd/"+i.toc.brd.slug+"/grp/"+i.grp.key+"/prjs",{method:"GET"},{type:"json"}).then(function(n){var e,t,o;return null==n&&(n={}),"mail"===r&&(n=n.map(function(n){return{username:n.username,name:n.name}})),e=new Blob([JSON.stringify(n)],{type:"application/json"}),t=URL.createObjectURL(e),o=ld$.create({name:"a",attr:{href:t,download:"projects-"+r+".json"}}),document.body.appendChild(o),o.click(),document.body.removeChild(o),o.remove()}).catch(e())}}},handler:{empty:function(n){return n.node.classList.toggle("d-none",i.data.filter(function(n){return n.slug}).length)},prj:{list:function(){return i.data.filter(function(n){return n.slug&&(!a.keyword||~[n.name,(n.info||(n.info={})).teamname,n.username,n.ownername].filter(function(n){return n}).join(" ").indexOf(a.keyword))})},init:function(n){var a,c,u;return a=n.node,c=n.local,u=n.data,c.view=new ldView({context:u,root:a,action:{click:{delete:function(n){var o,a;if(o=n.node,a=n.context,!o.classList.contains("running"))return r.get("confirm-deletion").then(function(n){if("yes"===n)return o.classList.toggle("running",!0),ld$.fetch("/dash/api/prj/"+a.slug,{method:"delete"},{type:"json"}).finally(function(){return o.classList.toggle("running",!1)}).then(function(){var n;return t.send("success","成功刪除了「"+a.name+"」提案"),~(n=i.data.indexOf(a))&&i.data.splice(n,1),i.view.render()}).catch(e())})},name:function(n){var e;return n.node,e=n.context,o.toggle({nav:"main",name:"grp-detail"}),i.setPrj(e)}}},text:{name:function(n){return n.context.name||"(未命名的提案)"},index:function(n){return n.context.key},ownername:function(n){var e;return((e=n.context).info||(e.info={})).teamname||e.ownername||""},username:function(n){return n.context.ownername||""}},handler:{"budget-consume":function(n){n.node,n.context},"budget-detail":function(n){n.node,n.context},avatar:function(n){var e,t;return e=n.node,t=n.context,e.style.background="url(/s/avatar/"+t.owner+".png)"}}})}}}}),this},a.prototype=import$(Object.create(Object.prototype),{setData:function(n){return this.grp=n},setPrj:function(n){return this.fire("set-prj",n)},on:function(n,e){var t;return((t=this.evtHandler)[n]||(t[n]=[])).push(e)},fire:function(n){var e,t,r,o,a,i=[];for(e=slice$.call(arguments,1),t=0,o=(r=this.evtHandler[n]||[]).length;t<o;++t)a=r[t],i.push(a.apply(this,e));return i}}),a});