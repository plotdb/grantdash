function import$(n,e){var t={}.hasOwnProperty;for(var r in e)t.call(e,r)&&(n[r]=e[r]);return n}var slice$=[].slice;ldc.register("adminPrjList",["error","loader","notify","ldcvmgr","auth","sdbAdapter","adminPanel"],function(n){var e,t,r,o;return e=n.error,n.loader,t=n.notify,n.ldcvmgr,n.auth,n.sdbAdapter,r=n.adminPanel,o=function(n){var o,a=this;return this.toc=n.toc,this.evtHandler={},this.data=[],r.on("active",function(n){var t;if(n.nav,t=n.name,n.panel,"grp-list"===t)return ld$.fetch("/dash/api/brd/"+a.toc.brd.slug+"/list",{method:"GET"},{type:"json"}).then(function(n){return a.data=n,a.data.map(function(n){return n.info=n.detail.info}),a.view.render()}).catch(e())}),o={},debounce(function(){return a.view.render("prj")}),this.view=new ldView({root:n.root,action:{input:{"search-input":function(n){var e;return e=n.node,o.keyword=e.value}},keypress:{"search-input":function(n){if(n.node,13===n.evt.keyCode)return a.view.render()}},click:{search:function(){return a.view.render()},download:function(n){var t,r;return t=n.node,r=t.getAttribute("data-name"),ld$.fetch("/dash/api/brd/"+a.toc.brd.slug+"/grp/"+a.grp.key+"/prjs",{method:"GET"},{type:"json"}).then(function(n){var e,t,o;return null==n&&(n={}),"mail"===r&&(n=n.map(function(n){return{username:n.username,name:n.name}})),e=new Blob([JSON.stringify(n)],{type:"application/json"}),t=URL.createObjectURL(e),o=ld$.create({name:"a",attr:{href:t,download:"projects-"+r+".json"}}),document.body.appendChild(o),o.click(),document.body.removeChild(o),o.remove(),console.log(t)}).catch(e())}}},handler:{empty:function(n){return n.node.classList.toggle("d-none",a.data.filter(function(n){return n.slug}).length)},prj:{list:function(){return a.data.filter(function(n){return n.slug&&(!o.keyword||~[n.name,(n.info||(n.info={})).teamname,n.username,n.ownername].filter(function(n){return n}).join(" ").indexOf(o.keyword))})},init:function(n){var o,i,c;return o=n.node,i=n.local,c=n.data,i.view=new ldView({context:c,root:o,action:{click:{delete:function(n){var r,o;if(r=n.node,o=n.context,!r.classList.contains("running"))return r.classList.toggle("running",!0),ld$.fetch("/dash/api/prj/"+o.slug,{method:"delete"},{type:"json"}).finally(function(){return r.classList.toggle("running",!1)}).then(function(){var n;return t.send("success","成功刪除了「"+o.name+"」提案"),~(n=a.data.indexOf(o))&&a.data.splice(n,1),a.view.render()}).catch(e())},name:function(n){var e;return n.node,e=n.context,r.toggle({nav:"main",name:"grp-detail"}),a.setPrj(e)}}},text:{name:function(n){return n.context.name},index:function(n){return n.context.key},ownername:function(n){var e;return((e=n.context).info||(e.info={})).teamname||e.ownername||""},username:function(n){return n.context.ownername||""}},handler:{"budget-consume":function(n){n.node,n.context},"budget-detail":function(n){n.node,n.context},avatar:function(n){var e,t;return e=n.node,t=n.context,e.style.background="url(/s/avatar/"+t.owner+".png)"}}})}}}}),this},o.prototype=import$(Object.create(Object.prototype),{setData:function(n){return this.grp=n},setPrj:function(n){return this.fire("set-prj",n)},on:function(n,e){var t;return((t=this.evtHandler)[n]||(t[n]=[])).push(e)},fire:function(n){var e,t,r,o,a,i=[];for(e=slice$.call(arguments,1),t=0,o=(r=this.evtHandler[n]||[]).length;t<o;++t)a=r[t],i.push(a.apply(this,e));return i}}),o});