function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}function import$(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}ldc.register("adminInfo",["error","loader","notify","ldcvmgr","auth","sdbAdapter"],function(t){var c=t.error,s=t.loader,f=(t.notify,t.ldcvmgr),p=t.auth,e=t.sdbAdapter,t=function(t){var i,e,o,r,a,l,n,u,d=this;if(this.opt=t,this.type=i=t.type||null,("org"===(e=!i)||"brd"===e||"grp"===e||"prh"===e)&&!i)throw new ldError(1015,"admin-info: malform type.");return this.root=e="string"==typeof t.root?document.querySelector(t.root):t.root,this.data=t.data,this.toc=t.toc,o={},r=debounce(500,function(t,e,n){var r=ld$.parent(l.fields[t],".form-group");return r.classList.add("running"),ld$.fetch("/dash/api/slug-check/"+i,{method:"POST"},{json:{slug:e},type:"json"}).finally(function(){return debounce(1e3).then(function(){return r.classList.remove("running")})}).then(function(t){return o[e]="free"!==(t=null==t?{}:t).result}).catch(function(){return o[e]=!0}).then(function(){return l.check({n:"slug"})})}),a=(this.data||{}).slug,this.form=l=new ldForm({root:e,values:a?{slug:a}:{},submit:"[ld=submit]",afterCheck:function(n,e){var t=["name","slug","description","brd","grp"].filter(function(t){return e[t]});return["brd","grp"].map(function(t){return n[t]=e[t]&&e[t].value?0:2}),n.all=t.reduce(function(t,e){return t&&0===n[e]},!0)?0:2},verify:function(e,n,t){return"description"===e&&n&&500<=n.length?2:("starttime"!==e&&"endtime"!==e||(n=moment(n).format()),in$(e,["slug"])||d.opsOut(function(t){return t[e]=n,t}),in$(e,["slug"])?/^[a-zA-Z0-9-]+$/.exec(n)?null!=o[n]?o[n]?2:0:(r(e,n,t),1):2:in$(e,["limit"])?1:n?0:2)}}),n={},this.view=u=new ldView({root:e,init:{"tail-datetime":function(t){t=t.node;return tail.DateTime(t,{time12h:!0})},orgs:function(){var e={type:"org"};return p.get().then(function(t){return ld$.fetch("/dash/api/me/list/",{method:"POST"},{json:e,type:"json"})}).then(function(t){return n.list=t,u.render()}).catch(function(t){return console.log(t)})}},handler:{"group-key":function(t){return t.node.value=d.data?d.data.key:""},bg:function(t){var e=t.node,t=e.getAttribute("data-name"),t="org"===i?"url(/dash/org/"+a+"/upload/"+d.form.values()[t]+")":"brd"===i?"url(/dash/org/"+d.toc.org.slug+"/brd/"+a+"/upload/"+d.form.values()[t]+")":"none";return e.style.backgroundImage=t},org:{key:function(t){return t.key},list:function(){return n.list&&n.list.length?n.list:[{name:"ç„¡",key:null}]},handler:function(t){var e=t.node,t=t.data;return e.innerText=t.name+(t.slug?" ( "+t.slug+" )":""),e.setAttribute("value",t.slug||"")}},"delete-group":function(t){var e=t.node,t=!(d.adapter&&d.adapter.doc&&d.adapter.doc.data.group&&1<d.adapter.doc.data.group.length);return e.classList.toggle("disabled",t)}},action:{change:{file:function(t){var e,n,r,o=t.node,u=o.getAttribute("data-name");if(("thumb"===u||"banner"===u)&&(e=ld$.parent(o,".bg"))&&(n=ld$.parent(o,".btn"))&&o.files.length)return ldFile.fromFile(o.files[0],"dataurl").then(function(t){return e.style.backgroundImage="url("+t.result+")"}),n.classList.toggle("running",!0),(r=new FormData).append(i,a),r.append(u+"[]",o.files[0]),p.recaptcha.get().then(function(t){return r.append("recaptcha",t),ld$.fetch("/dash/api/upload",{method:"POST",body:r},{type:"json"})}).finally(function(){return debounce(1e3).then(function(){return n.classList.toggle("running",!1)})}).then(function(t){return o.value="",l.field(u).value=t[0].fn,l.check({n:u,now:!0}),console.log("uploaded",t)}).catch(function(t){return console.log(t),c()(t)})}},click:{"delete-brd":function(t){t.node;return f.get("brd-deletion").then(function(t){if("yes"===t)return console.log("delete...")})},"delete-group":function(t){var e,t=t.node;if(!t.classList.contains("disabled")&&(e=d.adapter.doc.data.group[d.adapter.path[1]]))return d.opt.deleteGroup(e.key)},"clone-group":function(t){t.node;if(t=d.adapter.doc.data.group[d.adapter.path[1]])return d.opt.cloneGroup(t.key)},submit:function(t){if(!t.node.classList.contains("disabled"))return p.ensure().then(function(){if("prj"===i)return p.consent({type:"tos",timing:"prj-create",force:!0})}).then(function(){return p.recaptcha.get()}).then(function(t){var e;return s.on(),(e=l.getfd()).append("recaptcha",t),ld$.fetch("/dash/api/"+i+"/",{method:"POST",body:e},{type:"json"}).then(function(t){return s.off(),f.toggle("redirect"),debounce(1e3).then(function(){return window.location.href="prj"===i?"/dash/prj/"+t.slug+"/edit":"/dash/"+i+"/"+l.values().slug+"/admin"})}).catch(function(){return s.off(),f.toggle("error")})}).catch(c())}}}}),this};return t.prototype=import$(import$(Object.create(Object.prototype),e.interface),{setData:function(t){return this.data=t,this.view.render("group-key")},opsIn:function(t){var e,n,r=t.data;t.ops;if(!t.source){for(e in n=this.form.fields)n[e],in$(e,["slug"])||"file"!==this.form.fields[e].getAttribute("type")&&(this.form.fields[e].value=r[e]||"");return this.view.render()}}}),t});