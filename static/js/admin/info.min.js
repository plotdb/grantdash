function in$(t,n){for(var e=-1,r=n.length>>>0;++e<r;)if(t===n[e])return!0;return!1}function import$(t,n){var e={}.hasOwnProperty;for(var r in n)e.call(n,r)&&(t[r]=n[r]);return t}ldc.register("adminInfo",["error","loader","notify","ldcvmgr","auth","sdbAdapter"],function(t){var n,e,r,o,u,i;return n=t.error,e=t.loader,t.notify,r=t.ldcvmgr,o=t.auth,u=t.sdbAdapter,i=function(t){var u,i,a,l,c,d,s,f,p,g=this;if(this.opt=t,this.type=u=t.type||null,("org"===(i=!u)||"brd"===i||"grp"===i||"prh"===i)&&!u)throw new ldError(1015,"admin-info: malform type.");return this.root=a="string"==typeof t.root?document.querySelector(t.root):t.root,this.data=t.data,l={},c=debounce(500,function(t,n,e){var r;return(r=ld$.parent(s.fields[t],".form-group")).classList.add("running"),ld$.fetch("/dash/api/slug-check/"+u,{method:"POST"},{json:{slug:n},type:"json"}).finally(function(){return debounce(1e3).then(function(){return r.classList.remove("running")})}).then(function(t){return null==t&&(t={}),l[n]="free"!==t.result}).catch(function(){return l[n]=!0}).then(function(){return s.check({n:"slug"})})}),d=(this.data||{}).slug,this.form=s=new ldForm({root:a,values:d?{slug:d}:{},submit:"[ld=submit]",afterCheck:function(t,n){var e;return e=["name","slug","description","brd","grp"].filter(function(t){return n[t]}),["brd","grp"].map(function(e){return t[e]=n[e]&&n[e].value?0:2}),t.all=e.reduce(function(n,e){return n&&0===t[e]},!0)?0:2},verify:function(t,n,e){return in$(t,["slug"])||g.opsOut(function(e){return e[t]=n,e}),in$(t,["slug"])?/^[a-zA-Z0-9-]+$/.exec(n)?null!=l[n]?l[n]?2:0:(c(t,n,e),1):2:n?0:2}}),f={},p=new ldView({root:a,init:{"tail-datetime":function(t){var n;return n=t.node,tail.DateTime(n)},orgs:function(){var t;return t={type:"org"},o.get().then(function(n){return ld$.fetch("/dash/api/me/list/",{method:"POST"},{json:t,type:"json"})}).then(function(t){return f.list=t,p.render()}).catch(function(t){return console.log(t)})}},handler:{org:{key:function(t){return t.key},list:function(){return(f.list||[]).concat([{name:"ç„¡",key:null}])},handler:function(t){var n,e;return n=t.node,e=t.data,n.innerText=e.name+(e.slug?" ( "+e.slug+" )":""),n.setAttribute("value",e.slug||"")}}},action:{change:{file:function(t){var e,r,o,i,a;if(e=t.node,("thumb"===(r=e.getAttribute("data-name"))||"banner"===r)&&(o=ld$.parent(e,".bg"))&&(i=ld$.parent(e,".btn"))&&e.files.length)return ldFile.fromFile(e.files[0],"dataurl").then(function(t){return o.style.backgroundImage="url("+t.result+")"}),i.classList.toggle("running",!0),(a=new FormData).append(u,d),a.append(r+"[]",e.files[0]),a.append("files",JSON.stringify([{name:r,type:r}])),ld$.fetch("/dash/api/upload",{method:"POST",body:a},{type:"json"}).finally(function(){return debounce(1e3).then(function(){return i.classList.toggle("running",!1)})}).then(function(t){return e.value="",console.log("uploaded",t)}).catch(function(t){return console.log(t),n()(t)})}},click:{delete:function(){var t,n;if("group"===(t=g.adapter.path)[0]&&1!==((n=g.adapter.doc.data).group||(n.group=[])).length)return g.adapter.doc.submitOp([{p:["group",t[1]],od:g.adapter.doc.data.group[t[1]]}]),g.setPath(["group",0,"info"]),g.opt.setGroup(g.adapter.doc.data.group[0])},submit:function(t){if(!t.node.classList.contains("disabled"))return o.ensure().then(function(){var t;return e.on(),t=s.getfd(),ld$.fetch("/dash/api/"+u+"/",{method:"POST",body:t},{type:"json"}).then(function(t){return e.off(),r.toggle("redirect"),debounce(1e3).then(function(){return window.location.href="prj"===u?"/dash/prj/"+t.slug+"/edit":"/dash/"+u+"/"+s.values().slug+"/admin"})}).catch(function(){return e.off(),r.toggle("error")})}).catch(function(){return lda.ldcvmgr.toggle("auth-required")})}}}}),this},i.prototype=import$(import$(Object.create(Object.prototype),u.interface),{opsIn:function(t){var n,e,r,o=[];if(n=t.data,t.ops,!t.source){for(e in r=this.form.fields)if(r[e],!in$(e,["slug"])){if("file"===this.form.fields[e].getAttribute("type"))continue;o.push(this.form.fields[e].value=n[e]||"")}return o}}}),i});