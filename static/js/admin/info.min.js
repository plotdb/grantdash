function in$(t,n){for(var e=-1,r=n.length>>>0;++e<r;)if(t===n[e])return!0;return!1}function import$(t,n){var e={}.hasOwnProperty;for(var r in n)e.call(n,r)&&(t[r]=n[r]);return t}ldc.register("adminInfo",["loader","notify","ldcvmgr","auth","sdbAdapter"],function(t){var n,e,r,u,o,i;return n=t.loader,e=t.notify,r=t.ldcvmgr,u=t.auth,o=t.sdbAdapter,i=function(t){var o,i,a,c,l,d=this;return this.opt=t,this.type=o="org"===t.type?"o":"b",i=t.root,this.root=i="string"==typeof i?document.querySelector(i):i,a={},c=debounce(500,function(t,n,e){var r;return(r=ld$.parent(l.fields[t],".form-group")).classList.add("running"),ld$.fetch("/d/slug-check/"+o,{method:"POST"},{json:{slug:n},type:"json"}).finally(function(){return debounce(1e3).then(function(){return r.classList.remove("running")})}).then(function(t){return null==t&&(t={}),a[n]="free"!==t.result}).catch(function(){return a[n]=!0}).then(function(){return l.check({n:"slug"})})}),this.form=l=new ldForm({root:i,submit:"[ld=submit]",afterCheck:function(t,n){var e;if(n.thumbnail.value){if(!(e=ld$.parent(n.thumbnail,".bg")))return;ldFile.fromFile(n.thumbnail.files[0],"dataurl").then(function(t){return e.style.backgroundImage="url("+t.result+")"})}return t.all=["name","slug","description"].reduce(function(n,e){return n&&0===t[e]},!0)?0:2},verify:function(t,n,e){return d.adapter&&d.adapter.update(function(e){return e[t]=n,e}),in$(t,["slug"])?/^[a-zA-Z0-9-]+$/.exec(n)?null!=a[n]?a[n]?2:0:(c(t,n,e),1):2:n?0:2}}),new ldView({root:i,init:{"tail-datetime":function(t){var n;return n=t.node,tail.DateTime(n)}},action:{click:{submit:function(t){return t.node,u.ensure().then(function(){var t;return n.on(),t=l.getfd(),ld$.fetch("/d/"+o+"/",{method:"POST",body:t},{type:"json"}).then(function(t){return e.send("success","建立完成，將您導向主控台 ..."),debounce(1e3).then(function(){return window.location.href="/"+o+"/"+l.values().slug+"/admin"})}).catch(function(){return n.off(),r.toggle("error")})}).catch(function(){})}}}}),this},i.prototype=import$(Object.create(Object.prototype),{adapt:function(t){var n,e,r,u;return n=t.sdb,e=t.doc,this.adapter=r=new o({path:["info"]}),u=this.form,r.on("change",function(){var t,n,e,r=[];for(t in n=this.data)e=n[t],r.push(u.fields[t].value=e);return r}),r.init({sdb:n,doc:e}),r}}),i});