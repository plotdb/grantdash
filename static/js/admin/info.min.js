function in$(t,e){for(var n=-1,r=e.length>>>0;++n<r;)if(t===e[n])return!0;return!1}function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}ldc.register("adminInfo",["error","loader","notify","ldcvmgr","auth","sdbAdapter"],function(t){var e,n,r,o,a,u;return e=t.error,n=t.loader,t.notify,r=t.ldcvmgr,o=t.auth,a=t.sdbAdapter,u=function(t){var a,u,i,l,c,d,s,f,p,g=this;if(this.opt=t,this.type=a=t.type||null,("org"===(u=!a)||"brd"===u||"grp"===u||"prh"===u)&&!a)throw new ldError(1015,"admin-info: malform type.");return this.root=i="string"==typeof t.root?document.querySelector(t.root):t.root,this.data=t.data,this.toc=t.toc,l={},c=debounce(500,function(t,e,n){var r;return(r=ld$.parent(s.fields[t],".form-group")).classList.add("running"),ld$.fetch("/dash/api/slug-check/"+a,{method:"POST"},{json:{slug:e},type:"json"}).finally(function(){return debounce(1e3).then(function(){return r.classList.remove("running")})}).then(function(t){return null==t&&(t={}),l[e]="free"!==t.result}).catch(function(){return l[e]=!0}).then(function(){return s.check({n:"slug"})})}),d=(this.data||{}).slug,this.form=s=new ldForm({root:i,values:d?{slug:d}:{},submit:"[ld=submit]",afterCheck:function(t,e){var n;return n=["name","slug","description","brd","grp"].filter(function(t){return e[t]}),["brd","grp"].map(function(n){return t[n]=e[n]&&e[n].value?0:2}),t.all=n.reduce(function(e,n){return e&&0===t[n]},!0)?0:2},verify:function(t,e,n){return in$(t,["slug"])||g.opsOut(function(n){return n[t]=e,n}),in$(t,["slug"])?/^[a-zA-Z0-9-]+$/.exec(e)?null!=l[e]?l[e]?2:0:(c(t,e,n),1):2:in$(t,["limit"])?1:e?0:2}}),f={},this.view=p=new ldView({root:i,init:{"tail-datetime":function(t){var e;return e=t.node,tail.DateTime(e)},orgs:function(){var t;return t={type:"org"},o.get().then(function(e){return ld$.fetch("/dash/api/me/list/",{method:"POST"},{json:t,type:"json"})}).then(function(t){return f.list=t,p.render()}).catch(function(t){return console.log(t)})}},handler:{"group-key":function(t){var e;return e=t.node,e.value=g.data?g.data.key:""},bg:function(t){var e,n,r;return e=t.node,n=e.getAttribute("data-name"),r="org"===a?"url(/dash/org/"+d+"/upload/"+g.form.values()[n]+")":"brd"===a?"url(/dash/org/"+g.toc.org.slug+"/brd/"+d+"/upload/"+g.form.values()[n]+")":"none",e.style.backgroundImage=r},org:{key:function(t){return t.key},list:function(){return f.list&&f.list.length?f.list:[{name:"ç„¡",key:null}]},handler:function(t){var e,n;return e=t.node,n=t.data,e.innerText=n.name+(n.slug?" ( "+n.slug+" )":""),e.setAttribute("value",n.slug||"")}},"delete-group":function(t){var e,n;return e=t.node,n=!(g.adapter&&g.adapter.doc&&g.adapter.doc.data.group&&g.adapter.doc.data.group.length>1),e.classList.toggle("disabled",n)}},action:{change:{file:function(t){var n,r,u,i,l;if(n=t.node,("thumb"===(r=n.getAttribute("data-name"))||"banner"===r)&&(u=ld$.parent(n,".bg"))&&(i=ld$.parent(n,".btn"))&&n.files.length)return ldFile.fromFile(n.files[0],"dataurl").then(function(t){return u.style.backgroundImage="url("+t.result+")"}),i.classList.toggle("running",!0),(l=new FormData).append(a,d),l.append(r+"[]",n.files[0]),o.recaptcha.get().then(function(t){return l.append("recaptcha",t),ld$.fetch("/dash/api/upload",{method:"POST",body:l},{type:"json"})}).finally(function(){return debounce(1e3).then(function(){return i.classList.toggle("running",!1)})}).then(function(t){return n.value="",s.field(r).value=t[0].fn,s.check({n:r,now:!0}),console.log("uploaded",t)}).catch(function(t){return console.log(t),e()(t)})}},click:{"delete-group":function(t){var e;if(!t.node.classList.contains("disabled")&&(e=g.adapter.doc.data.group[g.adapter.path[1]]))return g.opt.deleteGroup(e.key)},"clone-group":function(t){var e;if(t.node,e=g.adapter.doc.data.group[g.adapter.path[1]])return g.opt.cloneGroup(e.key)},submit:function(t){if(!t.node.classList.contains("disabled"))return o.ensure().then(function(){if("prj"===a)return o.consent({type:"tos",timing:"prj-create",force:!0})}).then(function(){return o.recaptcha.get()}).then(function(t){var e;return n.on(),(e=s.getfd()).append("recaptcha",t),ld$.fetch("/dash/api/"+a+"/",{method:"POST",body:e},{type:"json"}).then(function(t){return n.off(),r.toggle("redirect"),debounce(1e3).then(function(){return window.location.href="prj"===a?"/dash/prj/"+t.slug+"/edit":"/dash/"+a+"/"+s.values().slug+"/admin"})}).catch(function(){return n.off(),r.toggle("error")})}).catch(e())}}}}),this},u.prototype=import$(import$(Object.create(Object.prototype),a.interface),{setData:function(t){return this.data=t,this.view.render("group-key")},opsIn:function(t){var e,n,r;if(e=t.data,t.ops,!t.source){for(n in r=this.form.fields)if(r[n],!in$(n,["slug"])){if("file"===this.form.fields[n].getAttribute("type"))continue;this.form.fields[n].value=e[n]||""}return this.view.render()}}}),u});