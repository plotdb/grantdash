function import$(n,r){var t={}.hasOwnProperty;for(var e in r)t.call(r,e)&&(n[e]=r[e]);return n}var slice$=[].slice;ldc.register("adminGuard",["auth","loader","sdbAdapter","adminMenu","adminPanel","adminInfo","adminStage"],function(n){var r,t,e,o,c,a,d,i;return r=n.auth,t=n.loader,n.sdbAdapter,e=n.adminMenu,n.adminPanel,o=n.adminInfo,c=n.adminStage,t.on(),r.fetch().then(function(n){var r,t,e,o;return r=/^\/([ob])\/([^/]+)\/admin/.exec(window.location.pathname)||[],r[0],t=r[1],e=r[2],o=import$({},t?"o"===t?{org:e}:{brd:e}:{}),ld$.fetch("/d/toc/",{method:"POST"},{json:o,type:"json"}).then(function(n){return a(n).catch(function(n){return console.log("admin init error",n),lda.ldcvmgr.toggle("error")})}).catch(function(){return lda.ldcvmgr.lock("create-brd-now")})}).catch(function(){return lda.ldcvmgr.toggle("auth-required")}).then(function(){return t.off()}),a=function(n){return n.doc={},["org","brd","brds","brdsFiltered","grps"].map(function(r){return n[r]=n[r]||[]}),n.brdsFiltered=n.brds||[],console.log(n),i(n).then(function(r){var t;return r.org,t=r.brd,new e({toc:n}).adapt({hub:t,path:["group"]}),new o({root:"[ld-scope=brd-info]",type:"brd"}).adapt({hub:t,path:["info"]}),new c({toc:n,root:"[ld-scope=brd-stage]",type:"brd"}).adapt({hub:t,path:["stage"]})})},d=function(n){return import$((this.evtHandler={},this),n)},d.prototype=import$(Object.create(Object.prototype),{on:function(n,r){var t;return((t=this.evtHandler)[n]||(t[n]=[])).push(r)},fire:function(n){var r,t,e,o,c,a=[];for(r=slice$.call(arguments,1),t=0,o=(e=this.evtHandler[n]||[]).length;t<o;++t)c=e[t],a.push(c.apply(this,r));return a}}),i=function(n){var r,e,o;return(r=r=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return t.on(),r.reconnect().then(function(){return o()}).then(function(){return t.off()})}),e={org:new d({sdb:r}),brd:new d({sdb:r})},function(){},(o=function(){return console.log("preparing sharedb documents ... "),r.get({id:"org-"+n.org.key,watch:function(n,r){return org.fire("change",{ops:n,source:r})}}).then(function(n){return e.org.doc=n}).then(function(){return r.get({id:"brd-"+n.brd.key,watch:function(n,r){return e.brd.fire("change",{source:n.source})}})}).then(function(n){return e.brd.doc=n}).then(function(){return e}).catch(function(){return ldcvmgr.toggle("error")})})()}}),ldc.app("adminGuard");