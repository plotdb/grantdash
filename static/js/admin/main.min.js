function import$(r,n){var e={}.hasOwnProperty;for(var t in n)e.call(n,t)&&(r[t]=n[t]);return r}var slice$=[].slice;ldc.register("adminGuard",["auth","loader","sdbAdapter","adminMenu","adminPanel","adminInfo","adminStage","adminPerm","adminNavbar","prjForm","adminEntry"],function(r){var n,e,t,o,a,d,c,i,u,p,l,h;return n=r.auth,e=r.loader,r.sdbAdapter,t=r.adminMenu,r.adminPanel,o=r.adminInfo,a=r.adminStage,d=r.adminPerm,c=r.adminNavbar,i=r.prjForm,u=r.adminEntry,e.on(),console.log("fetch auth data ..."),n.fetch().then(function(r){var n,e,t,o;return n=/^\/([ob])\/([^/]+)\/admin/.exec(window.location.pathname)||[],n[0],e=n[1],t=n[2],o=import$({},e?"o"===e?{org:t}:{brd:t}:{}),console.log("fetch sidemenu information ... "),ld$.fetch("/d/toc/",{method:"POST"},{json:o,type:"json"}).then(function(r){return console.log("initialization ..."),p(r).catch(function(r){return console.log("admin init error",r),lda.ldcvmgr.toggle("error")})}).catch(function(){return lda.ldcvmgr.lock("create-brd-now")})}).catch(function(){return lda.ldcvmgr.toggle("auth-required")}).then(function(){return e.off()}),p=function(r){var n,e,p;return r.doc={},["org","brd","brds","brdsFiltered","grps"].map(function(n){return r[n]=r[n]||[]}),r.brdsFiltered=r.brds||[],console.log("sidemenu information: ",r),n={},e={},p=function(r){var t;return function(){var r=[];for(t in e)r.push(t);return r}().map(function(t){var o;return o=["group",r.key,t],e[t].adapted()?e[t].setPath(o):e[t].adapt({hub:n.brd,path:o})})},h(r).then(function(l){var h,s;return h=l.org,s=l.brd,n.org=h,n.brd=s,new t({toc:r,setGroup:p}).adapt({hub:s,path:["group"]}),new o({root:"[ld-scope=brd-info]",type:"brd"}).adapt({hub:s,path:["info"]}),new a({toc:r,root:"[ld-scope=brd-stage]"}).adapt({hub:s,path:["stage"]}),new d({toc:r,root:"[ld-scope=brd-perm]"}).adapt({hub:s,path:["perm"]}),new c({toc:r,root:"[ld-scope=navbar-editor]"}).adapt({hub:s,path:["page","navbar"]}),e.form=new i({toc:r,root:"[ld-scope=prj-form]",viewMode:!1}),e.info=new o({root:"[ld-scope=grp-info-panel]",type:"grp",setGroup:p}),e.grade=new u({root:"[ld-scope=grade-panel]"}),e.criteria=new u({root:"[ld-scope=criteria-panel]"})})},l=function(r){return import$((this.evtHandler={},this),r)},l.prototype=import$(Object.create(Object.prototype),{on:function(r,n){var e;return((e=this.evtHandler)[r]||(e[r]=[])).push(n)},fire:function(r){var n,e,t,o,a,d=[];for(n=slice$.call(arguments,1),e=0,o=(t=this.evtHandler[r]||[]).length;e<o;++e)a=t[e],d.push(a.apply(this,n));return d}}),h=function(r){var n,t,o;return console.log("prepare sharedb ..."),(n=n=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return e.on(),n.reconnect().then(function(){return o()}).then(function(){return e.off()})}),t={org:new l({sdb:n}),brd:new l({sdb:n})},(o=function(){return console.log("preparing sharedb document (org) ... "),n.get({id:"org-"+r.org.key,watch:function(r,n){return hub.org.fire("change",{ops:r,source:n})}}).then(function(r){return t.org.doc=r}).then(function(){return console.log("preparing sharedb document (brd) ... ")}).then(function(){return n.get({id:"brd-"+r.brd.key,watch:function(r,n){return t.brd.fire("change",{ops:r,source:n})}})}).then(function(r){return t.brd.doc=r}).then(function(){return t}).catch(function(){return ldcvmgr.toggle("error")})})()}}),ldc.app("adminGuard");