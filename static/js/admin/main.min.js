function import$(n,r){var o={}.hasOwnProperty;for(var e in r)o.call(r,e)&&(n[e]=r[e]);return n}ldc.register("adminGuard",["ldcvmgr","auth","loader","sdbAdapter","error","adminMenu","adminPanel","adminInfo","adminStage","adminPerm","adminNavbar","prjForm","adminEntry"],function(n){var r,o,e,t,a,d,i,c,u,l,p,g,f;return r=n.ldcvmgr,o=n.auth,e=n.loader,n.sdbAdapter,t=n.error,a=n.adminMenu,n.adminPanel,d=n.adminInfo,i=n.adminStage,c=n.adminPerm,u=n.adminNavbar,l=n.prjForm,p=n.adminEntry,e.on(),console.log("fetch auth data ..."),o.fetch().then(function(n){var r,o,e,t;return r=/^\/([ob])\/([^/]+)\/admin/.exec(window.location.pathname)||[],r[0],o=r[1],e=r[2],t=import$({},o?"o"===o?{org:e}:{brd:e}:{}),console.log("fetch sidemenu information ... "),ld$.fetch("/d/toc/",{method:"POST"},{json:t,type:"json"}).then(function(n){return console.log("initialization ..."),g(n).catch(function(n){return console.log("admin init error",n),lda.ldcvmgr.toggle("error")})}).catch(function(){return lda.ldcvmgr.lock("create-brd-now")})}).catch(function(){return lda.ldcvmgr.toggle("auth-required")}).then(function(){return e.off()}),g=function(n){var r,o,e;return n.doc={},["org","brd","brds","brdsFiltered","grps"].map(function(r){return n[r]=n[r]||[]}),n.brdsFiltered=n.brds||[],console.log("sidemenu information: ",n),r={},o={},e=function(n){var e;return function(){var n=[];for(e in o)n.push(e);return n}().map(function(e){var t;return t=["group",n.key,e],o[e].adapted()?o[e].setPath(t):o[e].adapt({hub:r.brd,path:t})})},f(n).then(function(t){var g,f;return g=t.org,f=t.brd,r.org=g,r.brd=f,new a({toc:n,setGroup:e}).adapt({hub:f,path:["group"]}),new d({root:"[ld-scope=brd-info]",type:"brd"}).adapt({hub:f,path:["info"]}),new i({toc:n,root:"[ld-scope=brd-stage]"}).adapt({hub:f,path:["stage"]}),new c({toc:n,root:"[data-nav=brd-config] [ld-scope=perm-panel]"}).adapt({hub:f,path:["perm"]}),new u({toc:n,root:"[ld-scope=navbar-editor]"}).adapt({hub:f,path:["page","navbar"]}),o.form=new l({toc:n,root:"[ld-scope=prj-form]",viewMode:!1}),o.info=new d({root:"[ld-scope=grp-info-panel]",type:"grp",setGroup:e}),o.perm=new c({toc:n,root:"[data-nav=prj-config] [ld-scope=perm-panel]"}),o.grade=new p({root:"[ld-scope=grade-panel]"}),o.criteria=new p({root:"[ld-scope=criteria-panel]"})})},f=function(n){var o,a,d,i,c,u,l;return console.log("prepare sharedb ..."),(o=o=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return e.on(),o.reconnect().then(function(){return l()}).then(function(){return e.off()})}),a=debounce(500,function(){return c.render()}),d={},i=function(){var o;return o=u.brd.doc.data,r.toggle("publishing",!0),ld$.fetch("/d/b/"+n.brd.key+"/detail",{method:"PUT"},{json:{payload:o},type:"json"}).then(function(){return n.brd.detail=o,d.brd=JSON.stringify(o),a()}).then(function(){return r.toggle("publishing",!1),r.toggle("published",!0),debounce(2e3)}).then(function(){return r.toggle("published",!1)}).finally(function(){return r.toggle("publishing",!1)}).catch(t())},c=new ldView({initRender:!1,root:"[ld-scope=admin]",action:{click:{"publish-modification":function(){return i()}}},handler:{"modified-warning":function(n){var r,o;if(r=n.node,u.brd.doc)return o=JSON.stringify(u.brd.doc.data)!==d.brd,r.classList.toggle("d-none",!o)}}}),u={org:new Hub({sdb:o}),brd:new Hub({sdb:o})},(l=function(){return console.log("preparing sharedb document (org) ... "),o.get({id:"org-"+n.org.key,watch:function(n,r){return hub.org.fire("change",{ops:n,source:r})}}).then(function(n){return u.org.doc=n}).then(function(){return console.log("preparing sharedb document (brd) ... ")}).then(function(){return o.get({id:"brd-"+n.brd.key,watch:function(n,r){return u.brd.fire("change",{ops:n,source:r})}})}).then(function(n){return u.brd.doc=n}).then(function(){return d.org=JSON.stringify(u.org.doc.data),d.brd=JSON.stringify(n.brd.detail||""),u.org.doc.on("op",function(){return a()}),u.brd.doc.on("op",function(){return a()}),c.render(),u}).catch(function(){return lda.ldcvmgr.toggle("error")})})()}}),ldc.app("adminGuard");