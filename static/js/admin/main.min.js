function import$(r,n){var t={}.hasOwnProperty;for(var e in n)t.call(n,e)&&(r[e]=n[e]);return r}var slice$=[].slice;ldc.register("adminGuard",["auth","loader","sdbAdapter","adminMenu","adminPanel","adminInfo","adminStage","adminPerm"],function(r){var n,t,e,o,c,a,d,i,u;return n=r.auth,t=r.loader,r.sdbAdapter,e=r.adminMenu,r.adminPanel,o=r.adminInfo,c=r.adminStage,a=r.adminPerm,t.on(),n.fetch().then(function(r){var n,t,e,o;return n=/^\/([ob])\/([^/]+)\/admin/.exec(window.location.pathname)||[],n[0],t=n[1],e=n[2],o=import$({},t?"o"===t?{org:e}:{brd:e}:{}),ld$.fetch("/d/toc/",{method:"POST"},{json:o,type:"json"}).then(function(r){return d(r).catch(function(r){return console.log("admin init error",r),lda.ldcvmgr.toggle("error")})}).catch(function(){return lda.ldcvmgr.lock("create-brd-now")})}).catch(function(){return lda.ldcvmgr.toggle("auth-required")}).then(function(){return t.off()}),d=function(r){return r.doc={},["org","brd","brds","brdsFiltered","grps"].map(function(n){return r[n]=r[n]||[]}),r.brdsFiltered=r.brds||[],console.log(r),u(r).then(function(n){var t;return n.org,t=n.brd,new e({toc:r}).adapt({hub:t,path:["group"]}),new o({root:"[ld-scope=brd-info]",type:"brd"}).adapt({hub:t,path:["info"]}),new c({toc:r,root:"[ld-scope=brd-stage]"}).adapt({hub:t,path:["stage"]}),new a({toc:r,root:"[ld-scope=brd-perm]"}).adapt({hub:t,path:["perm"]})})},i=function(r){return import$((this.evtHandler={},this),r)},i.prototype=import$(Object.create(Object.prototype),{on:function(r,n){var t;return((t=this.evtHandler)[r]||(t[r]=[])).push(n)},fire:function(r){var n,t,e,o,c,a=[];for(n=slice$.call(arguments,1),t=0,o=(e=this.evtHandler[r]||[]).length;t<o;++t)c=e[t],a.push(c.apply(this,n));return a}}),u=function(r){var n,e,o;return(n=n=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return t.on(),n.reconnect().then(function(){return o()}).then(function(){return t.off()})}),e={org:new i({sdb:n}),brd:new i({sdb:n})},function(){},(o=function(){return console.log("preparing sharedb documents ... "),n.get({id:"org-"+r.org.key,watch:function(r,n){return org.fire("change",{ops:r,source:n})}}).then(function(r){return e.org.doc=r}).then(function(){return n.get({id:"brd-"+r.brd.key,watch:function(r,n){return e.brd.fire("change",{source:r.source})}})}).then(function(r){return e.brd.doc=r}).then(function(){return e}).catch(function(){return ldcvmgr.toggle("error")})})()}}),ldc.app("adminGuard");