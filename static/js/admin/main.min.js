function import$(n,r){var e={}.hasOwnProperty;for(var t in r)e.call(r,t)&&(n[t]=r[t]);return n}ldc.register("adminGuard",["auth","loader","adminPanel","sdbAdapter"],function(n){var r,e,t,o,d,i;return r=n.auth,e=n.loader,n.adminPanel,t=n.sdbAdapter,e.on(),r.ensure().then(function(){var n,r,e,t;return n=/^\/([ob])\/([^/]+)\/admin/.exec(window.location.pathname)||[],n[0],r=n[1],e=n[2],t=import$({},r?"o"===r?{org:e}:{brd:e}:{}),ld$.fetch("/d/toc/",{method:"POST"},{json:t,type:"json"}).catch(function(){return lda.ldcvmgr.lock("create-brd-now")}).then(function(n){return o(n)}).catch(function(n){return console.log(n),lda.ldcvmgr.toggle("error")})}).catch(function(){return lda.ldcvmgr.toggle("auth-required")}),o=function(n){return n.doc={},["org","brd","brds","brdsFiltered","grps"].map(function(r){return n[r]=n[r]||[]}),n.brdsFiltered=n.brds||[],d(n).then(function(r){return i(n,r)})},d=function(n){var r,t,o;return(r=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return e.on(),r.reconnect().then(function(){return o()}).then(function(){return e.off()})}),t=function(){},(o=function(){return console.log("preparing sharedb documents ... "),r.get({id:"org-"+n.org.key,watch:t}).then(function(r){return n.doc.org=r}).then(function(){return r.get({id:"brd-"+n.brd.key,watch:t})}).then(function(r){return n.doc.brd=r}).then(function(){return console.log(n.doc.brd.data)}).then(function(){return r}).catch(function(){return ldcvmgr.toggle("error")})})()},i=function(n,r){var o,d,i,u,c,a;return o=function(n){},d=debounce(function(r){return n.brdsFiltered=n.brds.filter(function(n){return~n.name.indexOf(r)}),u.render(),u.get("brd-list").folder.fit()}),i=ld$.find("[ld-scope=admin-menu]",0),u=new ldView({root:i,action:{click:{"brd-bar":function(n){return n.node,u.get("brd-list").folder.toggle(),u.render("brd-list-toggle")},"grp-add":function(r){var e,t;for(r.node,e=0;e<100&&(e,t="grp-"+Math.random().toString(36).substring(2),n.grps[t]);++e);if(n.grps[t])throw new ldError(1011);return n.grps[t]={key:t,name:"新分組"},u.render("grp-entry"),a().now()}},input:{"brd-search":function(n){var r;return r=n.node,d(r.value)}}},text:{"org-name":function(){return n.org.name},"brd-name":function(){return n.brd.name},"brd-progress-text":function(){return"活動進行中"}},init:{folder:function(n){var r;return r=n.node,r.folder=new ldui.Folder({root:r})}},handler:{"org-menu":function(r){return r.node.classList.toggle("d-none",!n.org.key)},"brd-progress":function(n){return n.node.classList.toggle("text-success",!0)},"brd-list-toggle":function(n){var r;if(r=n.node,u)return r.classList.toggle("on",u.get("brd-list").classList.contains("show"))},brd:function(r){var e,t,o;return(e=r.node).classList.toggle("d-none",!(t=!n.brd.key)!=!(o=~e.getAttribute("ld").indexOf("empty"))&&(t||o))},brds:function(r){var e,t,o;return(e=r.node).classList.toggle("d-none",!(t=!n.brds.length)!=!(o=~e.getAttribute("ld").indexOf("empty"))&&(t||o))},"brd-entry":{list:function(){return n.brdsFiltered},action:{click:function(r){var e;return r.node,e=r.data,n.brd=e,u.render()}},handler:function(n){var r,e;return r=n.node,e=n.data,ld$.find(r,"span",0).innerText=e.name,ld$.find(r,".text-sm",0).innerText=e.description}},"grp-entry":{list:function(){var r,e,t,o=[];for(r in e=n.grps||{})t=e[r],o.push(t);return o},init:function(n){var r,e;return r=n.node,e=n.data,r.folder=new ldui.Folder({root:r}),r.view=new ldView({root:r,handler:{name:function(n){var r;return r=n.node,r.innerText=e.name}},action:{click:{"nav-tab":function(n){return n.node,o()}}}})},handler:function(n){var r;return r=n.node,n.data,r.view.render("name")}}}}),e.off(),(c=new t({path:["group"]})).on("change",function(r){if(r.ops,!r.source)return n.grps=c.data?JSON.parse(JSON.stringify(c.data)):{},n.grps||(n.grps={}),u.render()}),a=debounce(500,function(){return c.update(function(){return JSON.parse(JSON.stringify(n.grps))})}),c.init({doc:n.doc.brd,sdb:r})}}),ldc.app("adminGuard");