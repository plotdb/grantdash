function import$(n,r){var e={}.hasOwnProperty;for(var t in r)e.call(r,t)&&(n[t]=r[t]);return n}var slice$=[].slice;ldc.register("adminGuard",["auth","loader","sdbAdapter","adminMenu","adminPanel","adminInfo","adminStage","adminPerm","adminNavbar"],function(n){var r,e,t,o,a,c,d,i,u,l;return r=n.auth,e=n.loader,n.sdbAdapter,t=n.adminMenu,n.adminPanel,o=n.adminInfo,a=n.adminStage,c=n.adminPerm,d=n.adminNavbar,e.on(),console.log("fetch auth data ..."),r.fetch().then(function(n){var r,e,t,o;return r=/^\/([ob])\/([^/]+)\/admin/.exec(window.location.pathname)||[],r[0],e=r[1],t=r[2],o=import$({},e?"o"===e?{org:t}:{brd:t}:{}),console.log("fetch sidemenu information ... "),ld$.fetch("/d/toc/",{method:"POST"},{json:o,type:"json"}).then(function(n){return console.log("initialization ..."),i(n).catch(function(n){return console.log("admin init error",n),lda.ldcvmgr.toggle("error")})}).catch(function(){return lda.ldcvmgr.lock("create-brd-now")})}).catch(function(){return lda.ldcvmgr.toggle("auth-required")}).then(function(){return e.off()}),i=function(n){return n.doc={},["org","brd","brds","brdsFiltered","grps"].map(function(r){return n[r]=n[r]||[]}),n.brdsFiltered=n.brds||[],console.log("sidemenu information: ",n),l(n).then(function(r){var e;return r.org,(e=r.brd).doc.data.page||e.doc.submitOp([{p:["page"],oi:{navbar:{}}}]),new t({toc:n}).adapt({hub:e,path:["group"]}),new o({root:"[ld-scope=brd-info]",type:"brd"}).adapt({hub:e,path:["info"]}),new a({toc:n,root:"[ld-scope=brd-stage]"}).adapt({hub:e,path:["stage"]}),new c({toc:n,root:"[ld-scope=brd-perm]"}).adapt({hub:e,path:["perm"]}),new d({toc:n,root:"[ld-scope=navbar-editor]"}).adapt({hub:e,path:["page","navbar"]})})},u=function(n){return import$((this.evtHandler={},this),n)},u.prototype=import$(Object.create(Object.prototype),{on:function(n,r){var e;return((e=this.evtHandler)[n]||(e[n]=[])).push(r)},fire:function(n){var r,e,t,o,a,c=[];for(r=slice$.call(arguments,1),e=0,o=(t=this.evtHandler[n]||[]).length;e<o;++e)a=t[e],c.push(a.apply(this,r));return c}}),l=function(n){var r,t,o;return console.log("prepare sharedb ..."),(r=r=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return e.on(),r.reconnect().then(function(){return o()}).then(function(){return e.off()})}),t={org:new u({sdb:r}),brd:new u({sdb:r})},(o=function(){return console.log("preparing sharedb document (org) ... "),r.get({id:"org-"+n.org.key,watch:function(n,r){return org.fire("change",{ops:n,source:r})}}).then(function(n){return t.org.doc=n}).then(function(){return console.log("preparing sharedb document (brd) ... ")}).then(function(){return r.get({id:"brd-"+n.brd.key,watch:function(n,r){return t.brd.fire("change",{source:n.source})}})}).then(function(n){return t.brd.doc=n}).then(function(){return t}).catch(function(){return ldcvmgr.toggle("error")})})()}}),ldc.app("adminGuard");