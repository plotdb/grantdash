function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("orgPerm",[],function(){var e,n,t,r,o,i,a,l,c;return e={type:"list"},n={idx:-1,cfg:{roles:[]}},t=function(){var t,r,o,i;return t=n.cfg.roles[r=n.idx],o=t?t.name:"",i=~r?"role":"list",e.idx=r,e.role=t,e.name=o,e.type=i,e},r=function(){return t(),i.render()},o={root:"[ld-scope=permission-panel]",action:{click:{},keyup:{}},handler:{}},import$(o.action.click,{roles:function(e){var t;return e.node,t=e.evt,n.idx=n.cfg.roles.map(function(e){return e.name}).indexOf(t.target.getAttribute("data-name")),c(),r()},"new-role":function(e){var t,o,i,a,l;for(e.node,t=e.evt,o=n.cfg.roles.map(function(e){return e.name}),i=1;i<100&&(a=i,~o.indexOf("角色"+a));++i);return l="角色"+(a<100?a:Math.round(100*Math.random())+100),n.cfg.roles.push({name:l,desc:"自訂角色",list:[]}),n.idx=n.cfg.roles.length-1,c(),r(),t.stopPropagation()},"delete-role":function(){return n.cfg.roles.length<=1?alert("最少要有一個角色"):~n.idx?(n.cfg.roles.splice(n.idx,1),n.idx=-1,c(),r()):void 0}}),import$(o.action.keyup,{"role-name":function(t){var o,i,a;if(o=t.node,e.role){if(i=o.value,a=~n.cfg.roles.map(function(e){return e.name}).indexOf(i)&&e.name!==i,o.classList.toggle("is-invalid",a),a)return;return e.role.name=o.value,c(),r()}}}),import$(o.handler,{"list-view":function(n){return n.node.classList.toggle("d-none","list"!==e.type)},"role-view":function(n){return n.node.classList.toggle("d-none","role"!==e.type)},role:{list:function(){return n.cfg.roles},handler:function(n){var t,r,o;return t=n.node,r=n.data,(o=ld$.find(t,".nav-link",0)).classList.toggle("active",r.name===e.name),o.setAttribute("data-name",r.name),o.setAttribute("data-type","role"),o.innerText=r.name}},"role-name":function(t){var r,o;return(r=t.node).classList.toggle("d-none",!~n.idx),e.role&&(r.value=e.name),o=r.value,r.classList.toggle("is-invalid",~n.cfg.roles.map(function(e){return e.name}).indexOf(o)&&e.name!==o)},"role-desc":{list:function(){return n.cfg.roles},action:{keyup:function(e){var n,t;return n=e.node,t=e.data,t.desc=n.innerText,c(!0)}},handler:function(n){var t,r;return t=n.node,r=n.data,t.innerText=r.desc||"",t.setAttribute("data-name",r.name),t.classList.toggle("d-none",r.name!==e.name)}},"role-all":function(n){return n.node.classList.toggle("active","list"===e.type)},"role-desc-all":function(n){return n.node.classList.toggle("d-none","list"!==e.type)}}),import$(o.action.click,{switch:function(e){var t,r,o;if(t=e.node,e.evt,t.classList.toggle("on"),r=(o=n.cfg.roles[n.idx]).config||(o.config={}))return r[t.getAttribute("data-name")]=t.classList.contains("on"),c()}}),import$(o.handler,{switch:function(n){var t,r;if(t=n.node,e.role)return t.classList.toggle("on",!!((r=e.role).config||(r.config={}))[t.getAttribute("data-name")])}}),import$(o.handler,{user:{list:function(){return e.role?(e.role.list||[]).map(function(n){return n.perm=e.role.name,n}):n.cfg.roles.map(function(e){return e.list.map(function(n){return n.perm=e.name,n})}).reduce(function(e,n){return e.concat(n)},[])},handler:function(e){var n,t,r;if(n=e.node,t=e.data,ld$.find(n,"b",0).innerText=t.name,r=ld$.find(n,".text-muted",0))return r.innerText=t.perm},action:{click:function(e){var t,o,i;if(e.node,t=e.data,e.evt.target.classList.contains("i-close")&&~(o=n.cfg.roles.map(function(e){return e.name}).indexOf(t.perm))&&~(i=n.cfg.roles[o].list).indexOf(t))return i.splice(i.indexOf(t),1),c(),r()}}}}),import$(o.action.click,{"newuser-toggle":function(e){return e.node,i.getAll("newuser").map(function(e){return e.classList.toggle("d-none")})},"newuser-add":function(t){var o,a;return t.node,t.evt,o=("list"===e.type?e.pickedRole:e.role)||n.cfg.roles[0]||{name:""},a=i.get("newuser-name").value,~n.cfg.roles.map(function(e){return e.list}).reduce(function(e,n){return e.concat(n)},[]).map(function(e){return e.name}).indexOf(a)?alert("user already exist"):(o.list.push({name:a,perm:o.name}),i.get("newuser-name").value="",c(),r())}}),import$(o.handler,{"newuser-role-picked":function(t){var r;if(r=t.node,e.pickedRole||(e.pickedRole=n.cfg.roles[0]),e.pickedRole)return r.innerText=e.pickedRole.name},"newuser-role-option":{list:function(){return n.cfg.roles},action:{click:function(n){var t;return n.node,t=n.data,e.pickedRole=t,i.render("newuser-role-picked")}},handler:function(e){var n,t;return n=e.node,t=e.data,n.innerText=t.name}}}),i=new ldView(o),(a=new Adopter({path:["perm"]})).on("change",function(e){if(e.ops,!e.source)return n.cfg=a.data?JSON.parse(JSON.stringify(a.data)):{},n.cfg.roles||(n.cfg.roles=[]),r()}),l=debounce(500,function(){return c()}),c=function(e){return e?l():a.update(function(){return JSON.parse(JSON.stringify(n.cfg))})},a}),ldc.app("orgPerm");