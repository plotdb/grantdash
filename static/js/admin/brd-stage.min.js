function import$(t,e){var n={}.hasOwnProperty;for(var a in e)n.call(e,a)&&(t[a]=e[a]);return t}ldc.register("brdStage",[],function(){var t,e,n,a,i,r;return t={idx:0,cfg:{stage:[{name:"預設",config:{},start:"",end:""}]}},e={root:"[ld-scope=stage-panel]",init:{},handler:{},action:{click:{},input:{}}},import$(e.action.input,{"stage-name":function(e){var a,i,o;if(a=e.node,i=(a.value||"").trim(),o=!i||~t.cfg.stage.map(function(t){return t.name}).indexOf(i)&&t.cfg.stage[t.idx].name!==i,a.classList.toggle("is-invalid",o),!o)return t.cfg.stage[t.idx].name=a.value,r(),n.render()}}),import$(e.action.click,{stages:function(e){var a,i,o,c,g,d,s;if(e.node,a=e.evt,i=a.target,o=i.getAttribute("data-type")){if(c=t.cfg.stage.map(function(t){return t.name}),"new-stage"===o){for(g=1;g<100&&(d=g,~c.indexOf("時段"+d));++g);s="時段"+(d<100?d:Math.round(100*Math.random())+100),t.cfg.stage.push({name:s,desc:"自訂時段",config:{}})}else s=i.getAttribute("data-name"),t.idx=c.indexOf(s);return r(),n.render()}},"delete-stage":function(e){return e.node,e.evt,t.cfg.stage.length<=1?alert("最少要有一個階段"):~t.idx?(t.cfg.stage.splice(t.idx,1),t.idx=0,r(),n.render()):void 0}}),import$(e.handler,{"default-view":function(e){return e.node.classList.toggle("d-none",0!==t.idx)},"custom-view":function(e){return e.node.classList.toggle("d-none",0===t.idx)},"stage-name":function(e){var n,a,i;return n=e.node,n.value=t.cfg.stage[t.idx].name,a=(n.value||"").trim(),i=!a||~t.cfg.stage.map(function(t){return t.name}).indexOf(a)&&t.cfg.stage[t.idx].name!==a,n.classList.toggle("is-invalid",i)},stage:{list:function(){return t.cfg.stage},handle:function(e){var n,a,i,r;return n=e.node,a=e.data,i=e.idx,r=ld$.find(n,"a",0),r.innerText=a.name,r.classList.toggle("active",i===t.idx),r.setAttribute("data-name",a.name),r.setAttribute("data-type","tab"),r}}}),import$(e.action.input,{time:function(e){var n;return n=e.node,t.cfg.stage[t.idx][n.getAttribute("data-name")]=n.value,r()}}),import$(e.init,{time:function(t){var e;return e=t.node,tail.DateTime(e)}}),import$(e.handler,{time:function(e){var n;return n=e.node,n.value=t.cfg.stage[t.idx][n.getAttribute("data-name")]||""}}),import$(e.action.click,{switch:function(e){var n,a,i;if((n=e.node).classList.toggle("on"),a=(i=t.cfg.stage[t.idx]).config||(i.config={}))return a[n.getAttribute("data-name")]=n.classList.contains("on"),r()}}),import$(e.handler,{switch:function(e){var n,a;return(n=e.node).classList.toggle("on",!!((a=t.cfg.stage[t.idx]).config||(a.config={}))[n.getAttribute("data-name")])}}),n=new ldView(e),(a=new Adopter({path:["stage"]})).on("change",function(e){if(e.ops,!e.source)return t.cfg=a.data?JSON.parse(JSON.stringify(a.data)):{},t.cfg.roles||(t.cfg.roles=[]),updateView()}),i=debounce(500,function(){return r()}),r=function(e){return e?i():a.update(function(){return JSON.parse(JSON.stringify(t.cfg))})},a}),ldc.app("brdStage");