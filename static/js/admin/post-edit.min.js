function import$(t,n){var e={}.hasOwnProperty;for(var r in n)e.call(n,r)&&(t[r]=n[r]);return t}ldc.register(["ldcvmgr","sdbAdapter","loader","error"],function(t){var n,e,r,o,i,u,s,c;return n=t.ldcvmgr,e=t.sdbAdapter,r=t.loader,o=t.error,i=function(t){var e=this;return this.opt=t,this.slug=t.slug||suuid(),this.data={},this.update=debounce(function(){var t=this;return this.opsOut(function(){return t.data})}),this.preview=new ldCover({root:"[ld=preview-ldcv]"}),this.view=new ldView({root:document.body,handler:{url:function(t){var n,r;return n=t.node,r="/dash/post/"+e.slug+"/",n.setAttribute("href",r),n.innerText=r},title:function(t){var n;return n=t.node,n.value=e.data.title||" ... "}},action:{click:{preview:function(){return e.preview.toggle(),e.view.get("preview-panel").innerHTML=DOMPurify.sanitize(marked(e.data.content))},publish:function(t){var r;return t.node,r={payload:e.data,type:"post",slug:e.slug},n.toggle("publishing",!0),ld$.fetch("/dash/api/detail",{method:"PUT"},{json:r,type:"json"}).finally(function(){return n.toggle("publishing",!1)}).then(function(){return n.toggle("published",!0),debounce(2e3).then(function(){return n.toggle("published",!1)})}).catch(o())}}}}),this},i.prototype=import$(import$(Object.create(Object.prototype),e.interface),{opsIn:function(t){var n;if(n=t.data,t.ops,!t.source)return this.data=JSON.parse(JSON.stringify(n)),this.quill.root.innerHTML=this.data.content||"",this.view.render()},init:function(){var t=this;return Promise.resolve().then(function(){var n;return t.quill=n=new Quill("#editor",{theme:"snow"}),n.on("text-change",function(e,r,o){return t.data.content=n.root.innerHTML,t.update()})})},fetch:function(){var t=this;return ld$.fetch("/dash/api/post/"+this.slug+"/",{method:"GET"},{type:"json"}).then(function(n){return t.post=n})},render:function(){return this.view.render()},sharedb:function(){var t,e=this;return console.log("initializing sharedb connection ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),t.on("error",function(){return n.toggle("not-sync")}),t.on("close",function(){return r.on(),t.reconnect().then(function(){return e.getdoc()}).then(function(){return e.render()}).then(function(){return console.log("re-inited.")}).then(function(){return r.off()})}),this.hub=new Hub({sdb:t})},getdoc:function(){var t=this;return console.log("get post document ..."),console.log(this.post.detail,this.slug),this.sdb.get({id:"post/"+this.slug,watch:function(n,e){return t.hub.fire("change",{ops:n,source:e})},create:function(){return t.post.detail}}).then(function(n){return t.hub.doc=n})}}),r.on(),u=/^\/dash\/post\/(.+)\/edit$/.exec(window.location.pathname),s=u[1],(c=new i({slug:s})).init().then(function(){return c.fetch()}).then(function(){return c.sharedb()}).then(function(){return c.getdoc()}).then(function(){return c.render()}).then(function(){return c.adapt({hub:c.hub,path:[]})}).then(function(){return r.off()})});