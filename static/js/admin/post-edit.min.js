function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}ldc.register(["auth","ldcvmgr","sdbAdapter","loader","error"],function(t){var e,n,r,o,i,u,c,a,s;return e=t.auth,n=t.ldcvmgr,r=t.sdbAdapter,o=t.loader,i=t.error,u=function(t){var r=this;return this.opt=t,this.slug=t.slug||suuid(),this.data={},this.update=debounce(function(){var t=this;return this.opsOut(function(){return t.data})}),this.preview=new ldCover({root:"[ld=preview-ldcv]"}),this.view=new ldView({root:document.body,handler:{url:function(t){var e,n;return e=t.node,n="/dash/post/"+r.slug+"/",e.setAttribute("href",n),e.innerText=n},title:function(t){var e;return e=t.node,e.value=r.data.title||" ... "}},action:{click:{preview:function(){return r.preview.toggle(),r.view.get("preview-panel").innerHTML=DOMPurify.sanitize(marked(r.data.content))},publish:function(t){var o;return t.node,o={payload:r.data,type:"post",slug:r.slug},n.toggle("publishing",!0),e.recaptcha.get().then(function(t){return o.recaptcha=t,ld$.fetch("/dash/api/detail",{method:"PUT"},{json:o,type:"json"})}).finally(function(){return n.toggle("publishing",!1)}).then(function(){return n.toggle("published",!0),debounce(2e3).then(function(){return n.toggle("published",!1)})}).catch(i())}}}}),this},u.prototype=import$(import$(Object.create(Object.prototype),r.interface),{opsIn:function(t){var e;if(e=t.data,t.ops,!t.source)return this.data=JSON.parse(JSON.stringify(e)),this.quill.root.innerHTML=this.data.content||"",this.view.render()},init:function(){var t=this;return Promise.resolve().then(function(){var e;return t.quill=e=new Quill("#editor",{theme:"snow",modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike","link"],[{align:[]}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],["blockquote","code-block"],["clean"]]}}),e.on("text-change",function(n,r,o){return t.data.content=e.root.innerHTML,t.update()})})},fetch:function(){var t=this;return ld$.fetch("/dash/api/post/"+this.slug+"/",{method:"GET"},{type:"json"}).then(function(e){return t.post=e})},render:function(){return this.view.render()},sharedb:function(){var t,e=this;return console.log("initializing sharedb connection ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),t.on("error",function(){return n.toggle("not-sync")}),t.on("close",function(){return n.toggle("offline-retry",!0),t.reconnect().then(function(){return e.getdoc()}).then(function(){return e.render()}).then(function(){return console.log("re-inited.")}).then(function(){return n.toggle("offline-retry",!1)})}),this.hub=new Hub({sdb:t}),t.ready()},getdoc:function(){var t=this;return console.log("get post document ..."),this.sdb.get({id:"post/"+this.slug,watch:function(e,n){return t.hub.fire("change",{ops:e,source:n})},create:function(){return t.post.detail}}).then(function(e){return t.hub.doc=e})}}),o.on(),c=/^\/dash\/post\/(.+)\/edit$/.exec(window.location.pathname),a=c[1],(s=new u({slug:a})).init().then(function(){return s.fetch()}).then(function(){return s.sharedb()}).then(function(){return s.getdoc()}).then(function(){return s.render()}).then(function(){return s.adapt({hub:s.hub,path:[]})}).then(function(){return o.off()})});