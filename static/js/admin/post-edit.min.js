function import$(t,e){var n={}.hasOwnProperty;for(var r in e)n.call(e,r)&&(t[r]=e[r]);return t}ldc.register(["ldcvmgr","sdbAdapter","loader","error"],function(t){var e,n,r,o,i,u,c,s;return e=t.ldcvmgr,n=t.sdbAdapter,r=t.loader,o=t.error,i=function(t){var n=this;return this.opt=t,this.slug=t.slug||suuid(),this.data={},this.update=debounce(function(){var t=this;return this.opsOut(function(){return t.data})}),this.preview=new ldCover({root:"[ld=preview-ldcv]"}),this.view=new ldView({root:document.body,handler:{url:function(t){var e,r;return e=t.node,r="/dash/post/"+n.slug+"/",e.setAttribute("href",r),e.innerText=r},title:function(t){var e;return e=t.node,e.value=n.data.title||" ... "}},action:{click:{preview:function(){return n.preview.toggle(),n.view.get("preview-panel").innerHTML=DOMPurify.sanitize(marked(n.data.content))},publish:function(t){var r;return t.node,r={payload:n.data,type:"post",slug:n.slug},e.toggle("publishing",!0),ld$.fetch("/dash/api/detail",{method:"PUT"},{json:r,type:"json"}).finally(function(){return e.toggle("publishing",!1)}).then(function(){return e.toggle("published",!0),debounce(2e3).then(function(){return e.toggle("published",!1)})}).catch(o())}}}}),this},i.prototype=import$(import$(Object.create(Object.prototype),n.interface),{opsIn:function(t){var e;if(e=t.data,t.ops,!t.source)return this.data=JSON.parse(JSON.stringify(e)),this.quill.root.innerHTML=this.data.content||"",this.view.render()},init:function(){var t=this;return Promise.resolve().then(function(){var e;return console.log(1),t.quill=e=new Quill("#editor",{theme:"snow",modules:{toolbar:[[{header:[1,2,3,4,5,6,!1]}],["bold","italic","underline","strike","link"],[{align:[]}],[{list:"ordered"},{list:"bullet"}],[{indent:"-1"},{indent:"+1"}],[{color:[]},{background:[]}],["blockquote","code-block"],["clean"]]}}),e.on("text-change",function(n,r,o){return t.data.content=e.root.innerHTML,t.update()})})},fetch:function(){var t=this;return ld$.fetch("/dash/api/post/"+this.slug+"/",{method:"GET"},{type:"json"}).then(function(e){return t.post=e})},render:function(){return this.view.render()},sharedb:function(){var t,n=this;return console.log("initializing sharedb connection ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),t.on("error",function(){return e.toggle("not-sync")}),t.on("close",function(){return e.toggle("offline-retry",!0),t.reconnect().then(function(){return n.getdoc()}).then(function(){return n.render()}).then(function(){return console.log("re-inited.")}).then(function(){return e.toggle("offline-retry",!1)})}),this.hub=new Hub({sdb:t}),t.ready()},getdoc:function(){var t=this;return console.log("get post document ..."),this.sdb.get({id:"post/"+this.slug,watch:function(e,n){return t.hub.fire("change",{ops:e,source:n})},create:function(){return t.post.detail}}).then(function(e){return t.hub.doc=e})}}),r.on(),u=/^\/dash\/post\/(.+)\/edit$/.exec(window.location.pathname),c=u[1],(s=new i({slug:c})).init().then(function(){return s.fetch()}).then(function(){return s.sharedb()}).then(function(){return s.getdoc()}).then(function(){return s.render()}).then(function(){return s.adapt({hub:s.hub,path:[]})}).then(function(){return r.off()})});