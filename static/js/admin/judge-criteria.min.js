function import$(r,t){var e={}.hasOwnProperty;for(var n in t)e.call(t,n)&&(r[n]=t[n]);return r}ldc.register("adminJudgeCriteria",["ldcvmgr","auth","sdbAdapter","error","adminPanel"],function(r){var t,e,n;return r.ldcvmgr,r.auth,r.sdbAdapter,t=r.error,e=r.adminPanel,n=function(r){var t=this;return null==r&&(r={}),this.opt=r,this.root="string"==typeof r.root?document.querySelector(r.root):r.root,this.brd=r.brd,this.grp=null,this.data={},e.on("active",function(r){var e,n;if(e=r.nav,n=r.name,r.panel,"grp-judge"===e&&"criteria"===n)return t.prepare()}),this.view=new ldView({root:this.root,init:{ldbar:function(r){var t,e;return t=r.node,e=r.local,e.ldbar=new ldBar(t)}},action:{click:{sync:function(){return t.prepare()}}},handler:{ldbar:function(r){return r.local.ldbar.set(Math.floor(100*(t.data.progress||0)))},"criteria-user-link":function(r){var e;if(e=r.node,t.grp)return e.setAttribute("href","/dash/brd/"+t.brd.slug+"/grp/"+t.grp.key+"/judge/criteria/user")},"criteria-all-link":function(r){var e;if(e=r.node,t.grp)return e.setAttribute("href","/dash/brd/"+t.brd.slug+"/grp/"+t.grp.key+"/judge/criteria/all")},"criteria-judge":{key:function(r){return r.key},list:function(){var r;return(r=t.data).users||(r.users=[])},init:function(r){var t,e,n;return t=r.node,e=r.local,n=r.data,t.classList.toggle("d-none",!1),e.view=new ldView({root:t,context:n,handler:{name:function(r){var t,e;return t=r.node,e=r.context,t.innerText=e.displayname},"progress-bar":function(r){var t,e,n;return t=r.node,e=r.context,n=+t.getAttribute("data-name"),t.style.width=100*e.count[n]/e.count.total+"%"},percent:function(r){var t,e,n,a;return t=r.node,e=r.context,n=e.count||{},a=Math.floor(100*(n[0]+n[2])/n.total),t.innerText=a+"%"}}})},handler:function(r){var t,e;return t=r.local,e=r.data,t.view.setContext(e),t.view.render()}}}}),this},n.prototype=import$(Object.create(Object.prototype),{prepare:function(){var r=this;return ld$.fetch("/dash/api/brd/"+this.brd.slug+"/grp/"+this.grp.key+"/judge/criteria/all",{method:"GET"},{type:"json"}).then(function(t){var e,n,a,i,o,u;return e={prjs:t.prjs,users:t.users,data:t.data,criteria:t.criteria},n=e.prjs,a=e.users,i=e.data,o=e.criteria,e=[n||[],a||[],i||{},o||{entries:[]}],n=e[0],a=e[1],i=e[2],o=e[3],r.data.users=a,u={0:0,1:0,2:0,total:n.length},a.map(function(r){return r.count={0:0,1:0,2:0,total:n.length}}),n.map(function(r){var t;return t=-1,a.map(function(e){var n,a,u,c,d;if(n=(a=(u=i.user[e.key].prj)[c=r.key]||(u[c]={})).v||(a.v={}),d=o.entries.reduce(function(r,t){return Math.max(r,null!=n[t.key]?n[t.key]:1)},0),r.state=d,e.count[d]++,(0===d||2===d)&&d>t)return t=d}),-1===t&&(t=1),u[t]++}),r.data.progress=(u[0]+u[2])/u.total}).then(function(){return r.view.render()}).catch(t())},setData:function(r){return this.grp=r}}),n});