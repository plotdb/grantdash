// Generated by LiveScript 1.3.0
(function(){
  ldc.register('admin', ['viewLocals', 'orgBasic', 'loader'], function(arg$){
    var viewLocals, orgBasic, loader, lc, sdb, watch, update, ret, id, init;
    viewLocals = arg$.viewLocals, orgBasic = arg$.orgBasic, loader = arg$.loader;
    loader.on();
    lc = {};
    /*
    history = new ctrlz {obj: JSON.parse(JSON.stringify(obj))}
    document.addEventListener \keydown, (e) ->
      if e.keyCode == 90 and (e.metaKey or e.ctrlKey) =>
        if e.shiftKey => history.redo!
        else history.undo!
        payload = JSON.parse(JSON.stringify(history.get!))
        obj.idx = payload.idx
        obj.cfg = payload.cfg
    */
    sdb = new sharedbWrapper({
      url: {
        scheme: window.location.protocol.replace(':', ''),
        domain: window.location.host
      }
    });
    sdb.on('close', function(){
      loader.on();
      return sdb.reconnect().then(function(){
        return init();
      }).then(function(){
        return loader.off();
      });
    });
    watch = function(ops, source){
      return orgBasic.watch({
        ops: ops
      });
    };
    update = function(){};
    ret = /o\/([0-9]+)/.exec(window.location.pathname);
    id = "org-" + (ret ? ret[1] : 'demo');
    init = function(){
      loader.on();
      return sdb.get({
        id: id,
        watch: watch
      }).then(function(doc){
        lc.doc = doc;
        orgBasic.install({
          doc: doc,
          sdb: sdb
        });
        return loader.off();
      });
    };
    init();
    return loader.off();
  });
  return ldc.app('admin');
})();