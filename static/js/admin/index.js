// Generated by LiveScript 1.3.0
(function(){
  ldc.register('admin', ['permctrl', 'entryctrl', 'navbar', 'grpSidemenu', 'adminNavigation', 'viewLocals', 'orgInfo', 'brdInfo', 'prjInfo', 'loader', 'util'], function(arg$){
    var permctrl, entryctrl, navbar, grpSidemenu, adminNavigation, viewLocals, orgInfo, brdInfo, prjInfo, loader, util, lc, permPanel, permctrlOpt, permctrlAdopter, orgPermctrlOpt, orgPermctrlAdopter, prjPermctrlOpt, prjPermctrlAdopter, criteriaPanel, criteriaOpt, criteriaAdopter, gradePanel, gradeOpt, gradeAdopter, navbarPanel, brdNavbarOpt, brdNavbarAdopter, sdb, watch, ret, that, id, init, watchBoard, initBoard;
    permctrl = arg$.permctrl, entryctrl = arg$.entryctrl, navbar = arg$.navbar, grpSidemenu = arg$.grpSidemenu, adminNavigation = arg$.adminNavigation, viewLocals = arg$.viewLocals, orgInfo = arg$.orgInfo, brdInfo = arg$.brdInfo, prjInfo = arg$.prjInfo, loader = arg$.loader, util = arg$.util;
    loader.on();
    lc = {};
    permPanel = ld$.find('[ld~=nav-panel][data-nav=brd-config][data-name=perm]  [ld-scope=permission-panel]', 0);
    permctrlOpt = {
      root: permPanel,
      path: ['perm']
    };
    permctrlAdopter = permctrl.prepare(permctrlOpt);
    permPanel = ld$.find('[ld~=nav-panel][data-nav=org-config][data-name=perm]  [ld-scope=permission-panel]', 0);
    orgPermctrlOpt = {
      root: permPanel,
      path: ['perm']
    };
    orgPermctrlAdopter = permctrl.prepare(orgPermctrlOpt);
    permPanel = ld$.find('[ld~=nav-panel][data-nav=prj-config][data-name=perm]  [ld-scope=permission-panel]', 0);
    prjPermctrlOpt = {
      root: permPanel,
      path: ['group', 0, 'perm']
    };
    prjPermctrlAdopter = permctrl.prepare(prjPermctrlOpt);
    criteriaPanel = ld$.find('[ld~=nav-panel][data-nav=prj-config][data-name=criteria] [ld-scope=criteria-panel]', 0);
    criteriaOpt = {
      root: criteriaPanel,
      path: ['group', 0, 'criteria']
    };
    criteriaAdopter = entryctrl.prepare(criteriaOpt);
    gradePanel = ld$.find('[ld~=nav-panel][data-nav=prj-config][data-name=grade] [ld-scope=grade-panel]', 0);
    gradeOpt = {
      root: gradePanel,
      path: ['group', 0, 'grade']
    };
    gradeAdopter = entryctrl.prepare(gradeOpt);
    navbarPanel = ld$.find('[ld~=nav-panel][data-nav=main][data-name=brd-navbar]  [ld-scope=navbar-editor]', 0);
    brdNavbarOpt = {
      root: navbarPanel,
      path: ['page', 'navbar']
    };
    brdNavbarAdopter = navbar.prepare(brdNavbarOpt);
    sdb = new sharedbWrapper({
      url: {
        scheme: window.location.protocol.replace(':', ''),
        domain: window.location.host
      }
    });
    sdb.on('close', function(){
      loader.on();
      return sdb.reconnect().then(function(){
        return init();
      }).then(function(){
        return loader.off();
      });
    });
    watch = function(ops, source){
      orgInfo.watch({
        ops: ops,
        source: source
      });
      return orgPermctrlAdopter.watch({
        ops: ops,
        source: source
      });
    };
    ret = /o\/([0-9]+)/.exec(window.location.pathname);
    if (that = !ret && util.parseQuerystring('o')) {
      ret = ['', that];
    }
    if (ret) {
      id = "org-" + (ret ? ret[1] : 'demo');
      init = function(){
        loader.on();
        return sdb.get({
          id: id,
          watch: watch
        }).then(function(doc){
          lc.doc = doc;
          orgInfo.init({
            doc: doc,
            sdb: sdb
          });
          orgPermctrlAdopter.init({
            doc: doc,
            sdb: sdb
          });
          return loader.off();
        });
      };
      init();
    }
    grpSidemenu.prepare({
      prjInfo: prjInfo,
      prjPermctrl: prjPermctrlAdopter
    });
    watchBoard = function(ops, source){
      brdInfo.watch({
        ops: ops,
        source: source
      });
      prjInfo.watch({
        ops: ops,
        source: source
      });
      prjPermctrlAdopter.watch({
        ops: ops,
        source: source
      });
      return grpSidemenu.prepare({
        prjInfo: prjInfo,
        prjPermctrl: prjPermctrlAdopter,
        data: lc.docbrd.data
      });
    };
    ret = /b\/([0-9]+)/.exec(window.location.pathname);
    if (that = !ret && util.parseQuerystring('b')) {
      ret = ['', that];
    }
    if (ret) {
      id = "board-" + (ret ? ret[1] : 'demo');
      initBoard = function(){
        loader.on();
        return sdb.get({
          id: id,
          watch: watchBoard
        }).then(function(doc){
          lc.docbrd = doc;
          brdInfo.init({
            doc: lc.docbrd,
            sdb: sdb
          });
          prjInfo.init({
            doc: lc.docbrd,
            sdb: sdb
          });
          prjPermctrlAdopter.init({
            doc: lc.docbrd,
            sdb: sdb
          });
          permctrlAdopter.init({
            doc: lc.docbrd,
            sdb: sdb
          });
          grpSidemenu.prepare({
            prjInfo: prjInfo,
            prjPermctrl: prjPermctrlAdopter,
            data: doc.data
          });
          return loader.off();
        });
      };
      initBoard();
    }
    return loader.off();
  });
  return ldc.app('admin');
})();