// Generated by LiveScript 1.3.0
(function(){
  return ldc.register('grpSidemenu', [], function(){
    var prepare;
    prepare = function(ctrlOpt){
      var lc, i, prjgView;
      lc = {
        data: {}
      };
      lc.data = ctrlOpt.data || {
        group: (function(){
          var i$, results$ = [];
          for (i$ = 1; i$ < 4; ++i$) {
            i = i$;
            results$.push({
              name: "分組" + i,
              key: i
            });
          }
          return results$;
        }())
      };
      lc.prjInfo = ctrlOpt.prjInfo;
      lc.prjPermctrl = ctrlOpt.prjPermctrl;
      return prjgView = new ldView({
        root: ".project-groups",
        action: {
          click: {
            "project-group-add": function(arg$){
              var node, data, ops;
              node = arg$.node;
              data = JSON.parse(JSON.stringify(lc.data));
              (data.group || (data.group = [])).push({
                key: (data.group || (data.group = [])).length + 1,
                name: "新分組"
              });
              ops = sdb.json.diff(lc.data, data);
              lc.docbrd.submitOp(ops);
              return prjgView.render();
            }
          }
        },
        handler: {
          "nav-tab": function(arg$){
            var node;
            node = arg$.node;
          },
          "project-group": {
            list: function(){
              return lc.data.group || [];
            },
            init: function(arg$){
              var node, view;
              node = arg$.node;
              return view = new ldView({
                root: node,
                action: {
                  click: {
                    "nav-tab": function(arg$){
                      var node, p, key, idx;
                      node = arg$.node;
                      if (!(p = ld$.parent(node, '.folder', this.root))) {
                        return;
                      }
                      key = p.getAttribute('data-prj-key');
                      idx = 0;
                      lc.data.group.map(function(d, i){
                        if (d.key === +key) {
                          return idx = i;
                        }
                      });
                      lc.prjInfo.set({
                        path: ['group', idx]
                      });
                      return lc.prjPermctrl.set({
                        path: ['group', idx, 'perm']
                      });
                    }
                  }
                }
              });
            },
            handler: function(arg$){
              var node, data, n;
              node = arg$.node, data = arg$.data;
              n = ld$.find(node, '[ld=name]', 0);
              node.setAttribute('data-prj-key', data.key);
              n.innerText = data.name;
              if (!node.folder) {
                return node.folder = new ldui.Folder({
                  root: node
                });
              }
            }
          }
        }
      });
    };
    return {
      prepare: prepare
    };
  });
})();