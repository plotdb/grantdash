// Generated by LiveScript 1.3.0
ldc.register(['general', 'auth', 'loader', 'navtop'], function(arg$){
  var general, auth, loader, navtop, query, nexturl, method, reload;
  general = arg$.general, auth = arg$.auth, loader = arg$.loader, navtop = arg$.navtop;
  query = (window.location.search || '').replace(/^\?/, '').split('&').map(function(it){
    return decodeURIComponent(it).trim().split('=');
  });
  nexturl = query.filter(function(it){
    return it[0] === 'nexturl';
  }).map(function(it){
    return it[1];
  })[0] || '/';
  method = query.filter(function(it){
    return it[0] === 'auth-method';
  }).map(function(it){
    return it[1];
  })[0] || '/';
  reload = function(){
    loader.on();
    return window.location.href = nexturl;
  };
  auth.init({
    root: '.authpanel'
  });
  if (method) {
    if (method === 'signup') {
      auth['switch']('signup');
    } else {
      auth['switch']('login');
    }
  }
  auth.fetch({
    renew: true
  }).then(function(it){
    if (it.user.key) {
      return reload();
    }
  });
  return auth.on('auth.signin', function(){
    return reload();
  });
});