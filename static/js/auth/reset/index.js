// Generated by LiveScript 1.3.0
(function(){
  return ldc.register(['auth', 'ldcvmgr', 'error', 'loader'], function(arg$){
    var auth, ldcvmgr, error, loader, lc, view, pwResetMail;
    auth = arg$.auth, ldcvmgr = arg$.ldcvmgr, error = arg$.error, loader = arg$.loader;
    lc = {};
    view = new ldView({
      root: '[ld-scope=password-reset]',
      handler: {
        "not-found": function(arg$){
          var node;
          node = arg$.node;
          return lc.ldcv = new ldCover({
            root: node
          });
        },
        "email": function(){}
      },
      action: {
        click: {
          submit: function(arg$){
            var node;
            node = arg$.node;
            loader.on();
            return ld$.fetch('/dash/api/me/passwd/reset', {
              method: 'POST'
            }, {
              json: {
                email: view.get('email').value
              }
            }).then(function(){
              return window.location.href = '/dash/auth/reset/sent/';
            })['catch'](function(e){
              if (e.code === 404) {
                lc.ldcv.toggle();
              } else {
                error()(e);
              }
              return loader.off();
            });
          }
        }
      }
    });
    return pwResetMail = new ldForm({
      names: function(){
        return ['email'];
      },
      submit: '.btn[ld=submit]',
      root: view.root,
      afterCheck: function(s, f){
        if (s.email !== 1 && !/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(f.email.value)) {
          return s.email = 2;
        }
      }
    });
  });
})();