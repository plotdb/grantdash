function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("userSearch",["auth","error"],function(e){var n,t,r;return n=e.auth,t=e.error,r=function(e){var n=this;return this.opt=e,this.root="string"==typeof e.root?document.querySelector(e.root):e.root,this.users=[],this.search=debounce(this.opt.delay||500,function(e){return n._search(e)}),this},r.prototype=import$(Object.create(Object.prototype),{render:function(){return this.view.render()},init:function(){var e=this;return this.view=new ldView({root:this.root,action:{keyup:{input:function(n){if(27===n.evt.keyCode)return e.clear()}},input:{input:function(n){var t;return t=n.node,n.local,n.evt,e.search(t.value)}},click:{clear:function(){return e.clear()}}},handler:{picked:function(n){return n.node.classList.toggle("d-none",!e.picked)},"picked-avatar":function(n){var t;if(t=n.node,e.picked)return t.style.backgroundImage="url(/s/avatar/"+e.picked.key+".png)"},"picked-name":function(n){var t;if(t=n.node,e.picked)return t.innerText=e.picked.displayname},clear:function(n){return n.node.classList.toggle("d-none",!e.picked)},loading:function(n){return n.node.classList.toggle("d-none",!e.loading)},users:function(n){return n.node.classList.toggle("d-none",!e.users.length)},user:{list:function(){return e.users||[]},action:{click:function(n){var t;return n.node,t=n.data,e.users=[],t.empty||(e.picked=t),e.view.get("input").value="",e.render()}},init:function(e){var n,t,r;return n=e.node,t=e.data,r=e.local,r.view=new ldView({context:t,root:n,handler:{avatar:function(e){var n,t;if(n=e.node,t=e.context,n.classList.toggle("d-none",!!t.empty),t.key)return n.style.backgroundImage="url(/s/avatar/"+t.key+".png)"},name:function(e){var n,t;return n=e.node,t=e.context,n.innerText=t.empty?"找不到相似的用戶":t.displayname}}})},render:function(e){var n,t;return n=e.local,t=e.data,n.view.setContext(t),n.view.render()}}}})},get:function(){return this.picked},clear:function(){return this.picked=null,this.users=[],this.view.get("input").value="",this.render()},_search:function(e){var r=this;return e&&e.length>=3?(this.users=[],this.loading=!0,this.render(),n.get().then(function(){var n;return n={name:e},ld$.fetch("/d/account",{method:"POST"},{json:n,type:"json"})}).then(function(e){return e&&e.length?r.users=e:r.users=[{empty:!0}],r.render()}).finally(function(){return debounce(1e3).then(function(){return r.loading=!1})}).then(function(){return r.render()}).catch(t)):(this.users=[],this.loading=!1,this)}}),r});