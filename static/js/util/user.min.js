function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("userSearch",["auth","error"],function(e){var n,t,r;return n=e.auth,t=e.error,r=function(e){var n=this;return this.opt=e,this.root="string"==typeof e.root?document.querySelector(e.root):e.root,this.users=[],this.search=debounce(this.opt.delay||500,function(e){return n._search(e)}),this},r.prototype=import$(Object.create(Object.prototype),{render:function(){return this.view.render()},init:function(){var e,n=this;return this.view=e=new ldView({root:this.root,action:{keyup:{input:function(e){if(27===e.evt.keyCode)return n.clear()}},input:{input:function(e){var t;return t=e.node,e.local,e.evt,n.search(t.value)}},click:{clear:function(){return n.clear()}}},handler:{picked:function(e){return e.node.classList.toggle("d-none",!n.picked)},"picked-avatar":function(e){var t;if(t=e.node,n.picked)return t.style.backgroundImage="email"===n.picked.type?"none":"url(/s/avatar/"+n.picked.key+".png)"},"picked-name":function(e){var t;if(t=e.node,n.picked)return t.innerText=n.picked.displayname},clear:function(e){return e.node.classList.toggle("d-none",!n.picked)},loading:function(e){return e.node.classList.toggle("d-none",!n.loading)},users:function(e){return e.node.classList.toggle("d-none",!n.users.length)},user:{list:function(){return n.users||[]},action:{click:function(e){var t,r,i;return e.node,t=e.data,n.users=[],r=t.empty?t.isEmail?"email":null:"user",n.picked=r?(i={type:r},i.displayname=t.displayname,i.key=t.key,i):null,n.view.get("input").value="",n.render()}},init:function(n){var t,r,i;return t=n.node,r=n.data,i=n.local,i.view=new ldView({context:r,root:t,handler:{avatar:function(e){var n,t;if(n=e.node,t=e.context,n.classList.toggle("d-none",!!t.empty),t.key)return n.style.backgroundImage="url(/s/avatar/"+t.key+".png)"},name:function(n){var t,r,i;return t=n.node,(r=n.context).empty?(t.innerText=r.empty?"找不到相似的用戶":r.displayname,i=e.get("input").value,(r.isEmail=isEmail(i))?(t.innerHTML='<span class="text-primary">透過 email 邀請 '+htmlentities(i)+" 使用</span>",r.displayname=r.key=i):t.innerText="找不到相關的用戶"):t.innerText=r.displayname}}})},render:function(e){var n,t;return n=e.local,t=e.data,n.view.setContext(t),n.view.render()}}}})},get:function(){return JSON.parse(JSON.stringify(this.picked))},clear:function(){return this.picked=null,this.users=[],this.view.get("input").value="",this.render()},_search:function(e){var r=this;return e&&e.length>=1?(this.users=[],this.loading=!0,this.render(),n.get().then(function(){var n;return n={name:e},ld$.fetch("/dash/api/account",{method:"POST"},{json:n,type:"json"})}).then(function(e){return e&&e.length?r.users=e:r.users=[{empty:!0}],r.render()}).finally(function(){return debounce(1e3).then(function(){return r.loading=!1})}).then(function(){return r.render()}).catch(t)):(this.users=[],this.loading=!1,this)}}),r});