function import$(t,a){var r={}.hasOwnProperty;for(var i in a)r.call(a,i)&&(t[i]=a[i]);return t}var slice$=[].slice;ldc.register("sdbAdapter",[],function(){var t;return t=function(t){return null==t&&(t={}),this.doc=null,this.sdb=null,this.data=null,this.evtHandler=JSON.parse(JSON.stringify({})),this.path=t.path||[],this},t.prototype=import$(Object.create(Object.prototype),{on:function(t,a){var r;return((r=this.evtHandler)[t]||(r[t]=[])).push(a)},fire:function(t){var a,r,i,n,s,e=[];for(a=slice$.call(arguments,1),r=0,n=(i=this.evtHandler[t]||[]).length;r<n;++r)s=i[r],e.push(s.apply(this,a));return e},init:function(t,a){var r,i,n=this;return r="array"===a?[]:{},this.hub=t,this.sdb=t.sdb,this.doc=t.doc||{data:r},i=this.getData()||r,this.watch({data:i}),this.hub.on("change",function(t){return n.watch(t)})},getData:function(){var t,a,r,i,n;if(!(t=this.doc.data))return null;for(a=0,i=(r=this.path).length;a<i;++a)if(n=r[a],!(t=t[n]))return null;return t},setDoc:function(t){var a,r,i,n;for(this.doc=t||{data:{}},a=this.doc.data,r=0,n=(i=this.path||[]).length;r<n;++r)a=a[i[r]]||{};return this.watch({data:a})},set:function(t){var a,r,i,n,s;for(a=t.path,this.path=a,r=this.doc.data,i=0,s=(n=this.path).length;i<s;++i)r=r[n[i]]||{};return this.watch({data:r})},update:function(t){var a,r,i,n,s,e,h,o=this;if(this.sdb&&this.doc.submitOp){if("function"==typeof t)return a=t(JSON.parse(JSON.stringify(this.data||{}))),t=this.getData()?[]:[{p:[],oi:Array.isArray(a)?[]:{}}],t=t.concat(this.sdb.json.diff(this.data||{},a)),this.update(t);if(Array.isArray(t)&&t.length){for(t.map(function(t){return t.p=o.path.concat(t.p)}),r=this.doc.data,i=[],n=0,e=(s=this.path).length;n<e;++n)h=s[n],i.push(h),r[h]||(t=[{p:JSON.parse(JSON.stringify(i)),oi:{}}].concat(t)),r=r[h]||{};return this.doc.submitOp(t)}}},watch:function(t){var a,r,i,n,s,e,h;if(a=t.ops,r=t.data,i=t.source,r)this.data=r;else{for(n=this.doc.data,s=0,h=(e=this.path).length;s<h;++s)n=n[e[s]]||{};this.data=n}return this.fire("change",{ops:a,data:r,source:i})}}),t.interface={adapted:function(){return!!this.adapter},adapt:function(a){var r,i,n,s,e=this;return r=a.hub,i=a.path,n=a.type,this.adapter=s=new t({path:i}),s.on("change",function(t){var a,r;return a=t.ops,r=t.source,e.opsIn({data:s.data,ops:a,source:r})}),s.init(r,n),s},setDoc:function(t){if(this.adapter)return this.adapter.setDoc(t)},setPath:function(t){return this.adapter.set({path:t})},opsOut:function(t){if(this.adapter)return this.adapter.update(t)},opsIn:null},t});