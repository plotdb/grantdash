function import$(t,n){var r={}.hasOwnProperty;for(var a in n)r.call(n,a)&&(t[a]=n[a]);return t}var slice$=[].slice;ldc.register("sdbAdapter",["ldcvmgr"],function(t){var n,r;return n=t.ldcvmgr,r=function(t){return null==t&&(t={}),this.doc=null,this.sdb=null,this.data=null,this.evtHandler=JSON.parse(JSON.stringify({})),this.path=t.path||[],this},r.prototype=import$(Object.create(Object.prototype),{on:function(t,n){var r;return((r=this.evtHandler)[t]||(r[t]=[])).push(n)},fire:function(t){var n,r,a,i,e,s=[];for(n=slice$.call(arguments,1),r=0,i=(a=this.evtHandler[t]||[]).length;r<i;++r)e=a[r],s.push(e.apply(this,n));return s},init:function(t,n){var r,a,i=this;return r="array"===n?[]:{},this.hub=t,this.sdb=t.sdb,this.doc=t.doc||{data:r},a=this.getData()||r,this.watch({data:a}),this.hub.on("change",function(t){return i.watch(t)})},getData:function(){var t,n,r,a,i;if(!(t=this.doc.data))return null;for(n=0,a=(r=this.path).length;n<a;++n)if(i=r[n],!(t=t[i]))return null;return t},setDoc:function(t){var n,r,a,i;for(this.doc=t||{data:{}},n=this.doc.data,r=0,i=(a=this.path||[]).length;r<i;++r)n=n[a[r]]||{};return this.watch({data:n})},set:function(t){var n,r,a,i,e;for(n=t.path,this.path=n,r=this.doc.data,a=0,e=(i=this.path).length;a<e;++a)r=r[i[a]]||{};return this.watch({data:r})},update:function(t){var n,r,a,i,e,s,o,h,c,u=this;if(this.sdb&&this.doc.submitOp){if("function"==typeof t)return n=t(JSON.parse(JSON.stringify(this.data||{}))),t=this.sdb.json.diff(this.data||{},n),this.update(t);if(Array.isArray(t)&&t.length){for(t.map(function(t){return t.p=u.path.concat(t.p)}),r=this.doc.data,a=[],i=[],e=0,o=(s=this.path).length;e<o;++e)h=s[e],a.push(h),r[h]||i.push({p:JSON.parse(JSON.stringify(a)),oi:h===(c=this.path)[c.length-1]&&Array.isArray(this.data)?[]:{}}),r=r[h]||{};return t=i.concat(t),this.doc.submitOp(t)}}},watch:function(t){var n,r,a,i,e,s,o;if(n=t.ops,r=t.data,a=t.source,r)this.data=r;else{for(i=this.doc.data,e=0,o=(s=this.path).length;e<o;++e)i=i[s[e]]||{};this.data=i}return this.fire("change",{ops:n,data:r,source:a})}}),r.interface={adapted:function(){return!!this.adapter},sharedb:function(){var t,r=this;return console.log("initializing sharedb connection ..."),this.sdb=t=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host},path:"/dash/ws"}),t.on("error",function(){return n.toggle("not-sync")}),t.on("close",function(){return n.toggle("offline-retry",!0),t.reconnect().then(function(){return r.getdoc()}).then(function(){return r.adapt()}).then(function(){return r.render()}).then(function(){return console.log("re-inited.")}).then(function(){return n.toggle("offline-retry",!1)})}),t.ready()},adapt:function(t){var n,a,i,e,s=this;return n=t.hub,a=t.path,i=t.type,this.adapter=e=new r({path:a}),e.on("change",function(t){var n,r;return n=t.ops,r=t.source,s.opsIn({data:e.data,ops:n,source:r})}),e.init(n,i),e},setDoc:function(t){if(this.adapter)return this.adapter.setDoc(t)},setPath:function(t){return this.adapter.set({path:t})},opsOut:function(t){if(this.adapter)return this.adapter.update(t)},opsIn:null},r});