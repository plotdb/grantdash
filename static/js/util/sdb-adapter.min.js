function import$(t,a){var i={}.hasOwnProperty;for(var r in a)i.call(a,r)&&(t[r]=a[r]);return t}var slice$=[].slice;ldc.register("sdbAdapter",[],function(){var t;return t=function(t){return null==t&&(t={}),this.doc=null,this.sdb=null,this.data=null,this.evtHandler=JSON.parse(JSON.stringify({})),this.path=t.path||[],this},t.prototype=import$(Object.create(Object.prototype),{on:function(t,a){var i;return((i=this.evtHandler)[t]||(i[t]=[])).push(a)},fire:function(t){var a,i,r,n,s,h=[];for(a=slice$.call(arguments,1),i=0,n=(r=this.evtHandler[t]||[]).length;i<n;++i)s=r[i],h.push(s.apply(this,a));return h},init:function(t){var a,i,r,n,s=this;for(this.hub=t,this.sdb=t.sdb,this.doc=t.doc,a=this.doc.data,i=0,n=(r=this.path).length;i<n;++i)a=a[r[i]]||{};return this.watch({data:a}),this.hub.on("change",function(t){return s.watch(t)})},setDoc:function(t){var a,i,r,n;for(this.doc=t,a=this.doc.data,i=0,n=(r=this.path||[]).length;i<n;++i)a=a[r[i]]||{};return this.watch({data:a})},set:function(t){var a,i,r,n,s;for(a=t.path,this.path=a,i=this.doc.data,r=0,s=(n=this.path).length;r<s;++r)i=i[n[r]]||{};return this.watch({data:i})},update:function(t){var a,i,r,n,s,h,e,o=this;if(this.sdb){if("function"==typeof t)return a=t(JSON.parse(JSON.stringify(this.data||{}))),t=this.data?[]:[{p:[],oi:{}}],t=t.concat(this.sdb.json.diff(this.data||{},a)),this.update(t);if(Array.isArray(t)&&t.length){for(t.map(function(t){return t.p=o.path.concat(t.p)}),i=this.doc.data,r=[],n=0,h=(s=this.path).length;n<h;++n)e=s[n],r.push(e),i[e]||(t=[{p:JSON.parse(JSON.stringify(r)),oi:{}}].concat(t)),i=i[e]||{};return this.doc.submitOp(t)}}},watch:function(t){var a,i,r,n,s,h,e;if(a=t.ops,i=t.data,r=t.source,i)this.data=i;else{for(n=this.doc.data,s=0,e=(h=this.path).length;s<e;++s)n=n[h[s]]||{};this.data=n}return this.fire("change",{ops:a,data:i,source:r})}}),t.interface={adapted:function(){return!!this.adapter},adapt:function(a){var i,r,n,s=this;return i=a.hub,r=a.path,this.adapter=n=new t({path:r}),n.on("change",function(t){var a,i;return a=t.ops,i=t.source,s.opsIn({data:n.data,ops:a,source:i})}),n.init(i),n},setDoc:function(t){if(this.adapter)return this.adapter.setDoc(t)},setPath:function(t){return this.adapter.set({path:t})},opsOut:function(t){if(this.adapter)return this.adapter.update(t)},opsIn:null},t});