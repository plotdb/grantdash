// Generated by LiveScript 1.3.0
(function(it){
  return it();
})(function(){
  var win, doc, cookie, engine;
  if (!(typeof i18next != 'undefined' && i18next !== null)) {
    return;
  }
  win = window;
  doc = document;
  cookie = function(k, v, expire){
    var hash;
    if (v) {
      return document.cookie = (k + "=" + v + ";path=/") + (expire ? ";expires=" + expire : "");
    }
    hash = {};
    (document.cookie || '').split(';').map(function(it){
      return it.split('=').map(function(it){
        return it.trim();
      });
    }).map(function(it){
      return hash[decodeURIComponent(it[0])] = decodeURIComponent(it[1]);
    });
    return hash[k];
  };
  window.i18nEngine = engine = {
    _transform: function(node, tag, func){
      var regex, _, wk, this$ = this;
      regex = new RegExp("^" + tag + "-(.+)$");
      _ = function(n){
        var i$, to$, i, ref$, name, value, ret, v, results$ = [];
        if (n.nodeType === win.Element.TEXT_NODE) {
          n.parentNode.setAttribute(tag, n.textContent);
          return n.parentNode.replaceChild(doc.createTextNode(func(n.textContent)), n);
        } else {
          for (i$ = 0, to$ = n.attributes.length; i$ < to$; ++i$) {
            i = i$;
            ref$ = n.attributes[i], name = ref$.name, value = ref$.value;
            if (!(ret = regex.exec(name))) {
              continue;
            }
            n.setAttribute(ret[1], func(value || ''));
          }
          if ((v = n.getAttribute(tag)) && v !== 't') {
            return n.textContent = func(v);
          }
          for (i$ = 0, to$ = n.childNodes.length; i$ < to$; ++i$) {
            i = i$;
            results$.push(_(n.childNodes[i]));
          }
          return results$;
        }
      };
      wk = new WeakMap();
      Array.from(node.querySelectorAll("[" + tag + "]")).map(function(n){
        return _(n);
      });
      return node;
    },
    transform: function(root){
      var this$ = this;
      return this._transform(root, 't', function(it){
        return this$.i18n(it);
      });
    },
    i18n: function(it){
      return i18next.t(it);
    }
  };
  return i18next.init({
    supportedLng: ['en', 'zh-TW'],
    fallbackLng: 'en',
    fallbackNS: '',
    defaultNS: ''
  }).then(function(){
    return i18next.use(i18nextBrowserLanguageDetector);
  }).then(function(){
    var lng, k, ref$, v, view;
    lng = cookie('use-language') || navigator.language || navigator.userLanguage;
    console.log("use language: ", lng);
    i18next.changeLanguage(lng);
    for (k in ref$ = i18nData.en) {
      v = ref$[k];
      (i18nData["zh-TW"] || (i18nData["zh-TW"] = {}))[k] = k;
    }
    for (k in ref$ = i18nData) {
      v = ref$[k];
      i18next.addResourceBundle(k, '', v, true, true);
    }
    engine.transform(document.body);
    return view = new ldView({
      global: true,
      root: document.body,
      action: {
        click: {
          "set-lng": function(arg$){
            var node, lng;
            node = arg$.node;
            lng = node.getAttribute('data-name');
            cookie('use-language', lng);
            return window.location.reload();
          }
        }
      }
    });
  });
});