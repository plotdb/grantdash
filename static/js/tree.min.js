function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}var slice$=[].slice;ldc.register("treemenu",["sharetree","loader","editor"],function(e){var t,n,r,i,a,o,d,c;return t=e.sharetree,e.loader,n=e.editor,r={},(i=new ldLoader({className:"ldld full z-fixed"})).on(),a={children:[{name:"page",children:[{name:"index.html"},{name:"test.html"}]},{name:"style",children:[{name:"index.css"}]},{name:"script",children:[{name:"index.js"}]},{name:"widget",children:[]},{name:"asset",children:[{name:"thumb.png"}]}]},(o=new sharedbWrapper({url:{scheme:window.location.protocol.replace(":",""),domain:window.location.host}})).on("close",function(){return i.on(),o.reconnect().then(function(){return init()}).then(function(){return i.off()})}),d={pages:new Hub({sdb:o}),file:new Hub({sdb:o})},c=function(e){return i.on(),o.get({id:"brd.4.file["+e+"]"}).then(function(t){return console.log("fetch brd.4.file["+e+"]"),d.file.doc&&d.file.doc.destroy(),d.file.doc=t,r.editor.adapter?r.editor.setDoc(t):r.editor.adapt({hub:d.file,path:[]}),i.off()}).catch(function(){return i.off()})},o.get({id:"brd.4.pages"}).then(function(e){var i;return d.pages.doc=e,r.tree=i=new t({root:"[ld-scope=folder]",data:a}),i.adapt({hub:d.pages,path:[]}),r.editor=new n({root:"[ld-scope=editor]"}),i.on("click",function(e){return c(e.name)})}).then(function(){return i.off()})}),ldc.register("editor",["sdbAdapter"],function(e){var t,n;return e.tree,t=e.sdbAdapter,n=function(e){var t,n,r,i,a,o,d=this;return t=e.root,this.root=t="string"==typeof t?document.querySelector(t):t||null,this.el=n={editor:ld$.find(this.root,"[ld-scope=edit]",0),viewer:ld$.find(this.root,"[ld-scope=view]",0)},this.cm=r=CodeMirror(n.editor,{mode:"javascript",lineNumbers:!0,theme:"ayu-mirage",lineWrapping:!0,keyMap:"default",showCursorWhenSelecting:!0,viewportMargin:1/0}),i=n.editor.getBoundingClientRect(),r.setSize(i.width,i.height),r.setValue(""),a=new Sandbox({container:n.viewer,className:"w-100 h-100 border-0",sandbox:"allow-scripts allow-pointer-lock allow-modals"}),r.on("change",function(){return d.opsOut(function(){return d.data.content=r.getValue(),d.data}),o()}),o=function(){var e;return e=r.getValue(),a.load({html:e,css:"",js:""})},this},n.prototype=import$(import$(Object.create(Object.prototype),t.interface),{render:function(){return this.cm.setValue((this.data||{}).content||"")},opsIn:function(e){var t;if(t=e.data,e.ops,!e.source)return this.data=JSON.parse(JSON.stringify(t)),this.render()}}),n}),ldc.register("sharetree",["tree","sdbAdapter"],function(e){var t,n,r;return t=e.tree,n=e.sdbAdapter,r=function(e){var n=this;return this.tree=new t(e),this.evtHandler={},this.tree.on("update",function(){return n.opsOut(function(){return n.data})}),this.tree.on("click",function(e){return n.fire("click",e)}),this},r.prototype=import$(import$(Object.create(Object.prototype),n.interface),{on:function(e,t){var n;return((n=this.evtHandler)[e]||(n[e]=[])).push(t)},fire:function(e){var t,n,r,i,a,o=[];for(t=slice$.call(arguments,1),n=0,i=(r=this.evtHandler[e]||[]).length;n<i;++n)a=r[n],o.push(a.apply(this,t));return o},opsIn:function(e){var t,n=this;if(t=e.data,e.ops,!e.source)return t.children?this.data=JSON.parse(JSON.stringify(t)):(this.data=t={children:[{name:"page",children:[{name:"index.html"},{name:"test.html"}]},{name:"style",children:[{name:"index.css"}]},{name:"script",children:[{name:"index.js"}]},{name:"widget",children:[]},{name:"asset",children:[{name:"thumb.png"}]}]},this.opsOut(function(){return n.data})),this.tree.setData(this.data),this.tree.render()}}),r}),ldc.app("treemenu"),ldc.register("tree",[],function(){var e;return e=function(e){var t;return this.opt=e,this.data=e.data,t=e.root,this.root=t="string"==typeof t?document.querySelector(t):t||null,this.sample={item:ld$.find(t,"[ld-scope=sample-item]",0),folder:ld$.find(t,"[ld-scope=sample-folder]",0)},this.view=this.init({node:this.root,data:this.data}),this.evtHandler={},this.reb=new reblock({root:this.root}),this},e.prototype=import$(Object.create(Object.prototype),{on:function(e,t){var n;return((n=this.evtHandler)[e]||(n[e]=[])).push(t)},fire:function(e){var t,n,r,i,a,o=[];for(t=slice$.call(arguments,1),n=0,i=(r=this.evtHandler[e]||[]).length;n<i;++n)a=r[n],o.push(a.apply(this,t));return o},setData:function(e){return this.view.setContext({data:e}),this.view.render()},render:function(){return this.view.render()},init:function(e){var t,n,r,i,a=this;return t=e.node,n=e.data,r=e.parent,i=function(){return a.fire("update"),a.view.render()},new ldView({context:{data:n,parent:r},root:t,action:{input:function(e){var t;return t=e.node,e.context,e.evt,t.innerText=t.innerText},dblclick:{name:function(e){var t;return t=e.node,e.context,e.evt,t.setAttribute("contenteditable",!0)}},click:{add:function(e){var t,n;return e.node,t=e.context,n=e.evt,t.data.children.push({name:"untitled.html"}),i(),n.stopPropagation()},clone:function(e){var t,n,r,a,o,d,c;for(e.node,t=e.context,e.evt,n=t.parent.children,a=(r=JSON.parse(JSON.stringify(t.data))).name,o=0;o<=100&&(d=o,c=a.replace(/-(\d+)\.([^.]+)$/,"-"+d+".$2"),n.filter(function(e){return e.name===c}).length);++o);return 100===d?alert("clone failed."):(r.name=c,n.splice(n.indexOf(t.data),0,r),i())},delete:function(e){var t,n;return e.node,t=e.context,e.evt,(n=t.parent.children).splice(n.indexOf(t.data),1),i()}}},handler:{name:function(e){var t,n;return t=e.node,n=e.context,t.innerText=n.data.name},icon:function(e){var t,n;return t=e.node,n=e.context,t.classList.toggle("d-none",!!n.children)},list:{list:function(e){return e.context.data.children},action:{click:function(e){var t,n;if(t=e.node,n=e.data,e.context,e.evt,t.classList.contains("folder-item"))return a.active&&a.active.classList.toggle("active",!1),a.active=t,t.classList.toggle("active",!0),a.fire("click",n)}},init:function(e){var t,n,r,i,o;return t=e.node,n=e.data,r=e.local,i=e.context,o=a.sample[n.children?"folder":"item"].childNodes[0],t.setAttribute("class",o.getAttribute("class")),t.setAttribute("draggable",!0),t.innerHTML=o.innerHTML,n.children&&(r.folder=new ldui.Folder({root:t})),r.view=a.init({node:t,data:n,parent:i.data})},handler:function(e){var t,n,r;return t=e.local,n=e.data,r=e.context,t.view.setContext({data:n,parent:r.data}),t.view.render()}}}})}}),e});