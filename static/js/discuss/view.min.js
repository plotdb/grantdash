function import$(t,n){var e,i={}.hasOwnProperty;for(e in n)i.call(n,e)&&(t[e]=n[e]);return t}function in$(t,n){for(var e=-1,i=n.length>>>0;++e<i;)if(t===n[e])return!0;return!1}ldc.register("discussView",["discussEdit","error"],function(t){var i=t.discussEdit,r=t.error,t=function(t){var n,e=this,o=new ldLoader({className:"full ldld"});return this.opt=t,this.markedOptions=t.marked||{},this.root=n="string"==typeof t.root?document.querySelector(t.root):t.root,this.data=import$({url:window.location.pathname},t.data),this.edit=new i({root:ld$.find(n,"[ld-scope=edit]",0)}),this.comments=[],this.edit.init(),this.edit.on("new-comment",function(t){return t.distance=e.comments.length,t.state="active",e.comments.push(t),e.view.render()}),this.view=new ldView({initRender:!1,root:this.root,handler:{loading:function(t){var n=t.node,t=t.names;return n.classList.toggle("d-none",!(!e.loading!=!(t=in$("off",t))&&(e.loading||t)))},title:function(t){var n=t.node,t=e.discuss?e.discuss.title:"";return n.innerText=t||"未命名的討論串"},comment:{list:function(){return e.comments},init:function(t){var n=this,e=t.node,i=t.data,t=t.idx;return e.classList.add("ld","ld-float-ltr-in","xp35"),e.style.animationDelay=.1*t+"s",new ldView({root:e,action:{click:{delete:function(t){t.node;return o.on(),debounce(500).then(function(){return ld$.fetch("/api/discuss/"+i.key,{method:"DELETE"})}).finally(function(){return o.off()}).catch(r())}}},handler:{delete:function(t){return t.node.classList.toggle("d-none",!(i.owner===n.global.user.key||n.global.user.staff))},avatar:function(t){return t.node.style.backgroundImage="url(/dash/s/avatar/"+i.owner+".png)"},author:function(t){return t.node.innerText=i.displayname},role:function(t){t=t.node;return t.classList.toggle("d-none",!i.role),ld$.find(t,"span",0).innerText=i.role},date:function(t){return t.node.innerText=moment(i.createdtime).tz("Asia/Taipei").format("YYYY/MM/DD hh:mm:ss")},content:function(t){var n=t.node;return((t=i.content).config||(t.config={})).useMarkdown?n.innerHTML=marked(i.content.body):n.innerText=i.content.body}}})}}}}),this};return t.prototype=import$(Object.create(Object.prototype),{init:function(){var t,n=this;return this.loading=!0,t=this.data.slug?{slug:this.data.slug}:{url:this.data.url},ld$.fetch("/dash/api/discuss",{method:"GET"},{params:t,type:"json"}).finally(function(){return n.loading=!1}).then(function(t){return n.comments=t.comments,n.discuss=t.discuss,n.comments=t.comments||[],n.discuss=t.discuss||{},n.view.render()})}}),t});