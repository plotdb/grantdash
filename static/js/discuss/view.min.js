function import$(t,n){var e={}.hasOwnProperty;for(var o in n)e.call(n,o)&&(t[o]=n[o]);return t}function in$(t,n){for(var e=-1,o=n.length>>>0;++e<o;)if(t===n[e])return!0;return!1}ldc.register("discussView",["discussEdit"],function(t){var n,e;return n=t.discussEdit,e=function(t){var e,o=this;return this.opt=t,this.markedOptions=t.marked||{},this.root=e="string"==typeof t.root?document.querySelector(t.root):t.root,console.log(1,e,t.root),this.data=import$({url:window.location.pathname},t.data),this.edit=new n({root:ld$.find(e,"[ld-scope=edit]",0)}),this.edit.init(),this.edit.on("new-comment",function(t){return t.distance=o.comments.length,t.state="active",o.comments.push(t),o.view.render()}),this.view=new ldView({initRender:!1,root:this.root,handler:{loading:function(t){var n,e,r;return n=t.node,e=t.names,n.classList.toggle("d-none",!(!o.loading!=!(r=in$("off",e))&&(o.loading||r)))},comment:{list:function(){return o.comments},init:function(t){var n,e,o;return n=t.node,e=t.data,o=t.idx,n.classList.add("ld","ld-float-ltr-in","xp35"),n.style.animationDelay=.1*o+"s",new ldView({root:n,handler:{avatar:function(t){var n;return n=t.node,n.style.backgroundImage="url(/dash/s/avatar/"+e.owner+".png)"},author:function(t){var n;return n=t.node,n.innerText=e.displayname},role:function(t){var n;return(n=t.node).classList.toggle("d-none",!e.role),ld$.find(n,"span",0).innerText=e.role},date:function(t){var n;return n=t.node,n.innerText=moment(e.createdtime).tz("Asia/Taipei").format("YYYY/MM/DD hh:mm:ss")},content:function(t){var n,o;return n=t.node,((o=e.content).config||(o.config={})).useMarkdown?n.innerHTML=marked(e.content.body):n.innerText=e.content.body}}})}}}}),this},e.prototype=import$(Object.create(Object.prototype),{init:function(){var t,n=this;return this.loading=!0,t=this.data.slug?{slug:this.data.slug}:{url:this.data.url},ld$.fetch("/dash/api/discuss",{method:"GET"},{params:t,type:"json"}).finally(function(){return n.loading=!1}).then(function(t){return n.comments=t,console.log("ok"),n.view.render()})}}),e});