function import$(t,n){var e={}.hasOwnProperty;for(var i in n)e.call(n,i)&&(t[i]=n[i]);return t}function in$(t,n){for(var e=-1,i=n.length>>>0;++e<i;)if(t===n[e])return!0;return!1}ldc.register("discussView",["discussEdit"],function(t){var n,e;return n=t.discussEdit,e=function(t){var e,i=this;return this.opt=t,this.markedOptions=t.marked||{},this.root=e="string"==typeof t.root?document.querySelector(t.root):t.root,this.data=import$({url:window.location.pathname},t.data),this.edit=new n({root:ld$.find(e,"[ld-scope=edit]",0)}),this.comments=[],this.edit.init(),this.edit.on("new-comment",function(t){return t.distance=i.comments.length,t.state="active",i.comments.push(t),i.view.render()}),this.view=new ldView({initRender:!1,root:this.root,handler:{loading:function(t){var n,e,r;return n=t.node,e=t.names,n.classList.toggle("d-none",!(!i.loading!=!(r=in$("off",e))&&(i.loading||r)))},title:function(t){var n,e;return n=t.node,e=i.discuss?i.discuss.title:"",n.innerText=e||"未命名的討論串"},comment:{list:function(){return i.comments},init:function(t){var n,e,i;return n=t.node,e=t.data,i=t.idx,n.classList.add("ld","ld-float-ltr-in","xp35"),n.style.animationDelay=.1*i+"s",new ldView({root:n,handler:{avatar:function(t){var n;return n=t.node,n.style.backgroundImage="url(/dash/s/avatar/"+e.owner+".png)"},author:function(t){var n;return n=t.node,n.innerText=e.displayname},role:function(t){var n;return(n=t.node).classList.toggle("d-none",!e.role),ld$.find(n,"span",0).innerText=e.role},date:function(t){var n;return n=t.node,n.innerText=moment(e.createdtime).tz("Asia/Taipei").format("YYYY/MM/DD hh:mm:ss")},content:function(t){var n,i;return n=t.node,((i=e.content).config||(i.config={})).useMarkdown?n.innerHTML=marked(e.content.body):n.innerText=e.content.body}}})}}}}),this},e.prototype=import$(Object.create(Object.prototype),{init:function(){var t,n=this;return this.loading=!0,t=this.data.slug?{slug:this.data.slug}:{url:this.data.url},ld$.fetch("/dash/api/discuss",{method:"GET"},{params:t,type:"json"}).finally(function(){return n.loading=!1}).then(function(t){return n.comments=t.comments,n.discuss=t.discuss,n.comments=t.comments||[],n.discuss=t.discuss||{},n.view.render()})}}),e});