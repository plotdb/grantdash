function in$(e,n){for(var r=-1,t=n.length>>>0;++r<t;)if(e===n[r])return!0;return!1}ldc.register("prjForm",["prjFormCriteria","prjFormBlock","prjFormValidation"],function(e){var n,r,t,o,i,a,d,l,c,u,s,f,v;return e.prjFormCriteria,n=e.prjFormBlock,r=e.prjFormValidation,!0,t={view:!1},o={get:function(e){return new Promise(function(n,r){var t,o;return(t=ld$.find("[data-name="+e+"]",0))||r(new Error("block not found")),(o=ld$.create({name:"div",attr:{draggable:!0}})).appendChild(t.cloneNode(!0)),n(o)})}},i={},a=debounce(function(e){if(e.valid=r.validate(e),l.render(),s)return s.render()}),d=function(e){return i[e.key]=e.value,console.log("[update]",i),a(e)},l=new ldView({root:"#form",handler:{block:{list:function(){return sampleBlocks},init:function(e){var r,t;return r=e.node,t=e.data,o.get(t.name).then(function(e){(e=e.childNodes[0]).parentNode.removeChild(e),r.innerHTML="",r.appendChild(e),n.render({node:r,data:t,viewMode:!0,update:d})})},handler:function(e){var n;if(n=e.node,e.data,n.view)return n.view.block.render()}}}}),(c=ld$.find("[ld-scope=blocksrc]",0))&&new ldView({root:c,action:{dragstart:{block:function(e){var n;return n=e.node,e.evt.dataTransfer.setData("text/plain",n.getAttribute("data-name")+"")}}}}),new reblock({root:"#form",blockManager:o,action:{afterMoveNode:function(e){var n,r;if(n=e.src,e.des,e.ib,n.parentNode.hasAttribute("hostable")){for(r=n.parentNode;r&&!r._data;)r=r.parentNode;if(!r)return;return r._data.data=Array.from(n.parentNode.childNodes).filter(function(e){return 1===e.nodeType}).map(function(e){return e._data}).filter(function(e){return e}),r.view.list.render()}}}}),u=function(){var e,n,r,t;return e=sampleBlocks.filter(function(e){return(e.valid||(e.valid={})).result}).length,n=sampleBlocks.length,r=e/sampleBlocks.length,t=n-e,{remain:t,done:e,total:n,percent:r}},s=new ldView({root:document.body,action:{click:{viewing:function(){return t.view=!t.view,s.render(),v.render()},invalid:function(){var e,n,r,t,o,a,d;n=[];for(r in i)n.push(r);for(e=n,t=0,o=sampleBlocks.length;t<o&&(a=t,in$(sampleBlocks[a].key+"",e));++t);if(d=ld$.find("#block-"+sampleBlocks[a].key,0))return scrollto(d)}}},handler:{nview:function(e){return e.node.classList.toggle("d-none",t.view)},view:function(e){return e.node.classList.toggle("d-none",!t.view)},progress:function(e){var n;return n=e.node,n.style.width=100*u().percent+"%"},invalid:function(e){return e.node.classList.toggle("d-none",0===u().remain)},valid:function(e){return e.node.classList.toggle("d-none",u().remain>0)},remain:function(e){var n;return n=e.node,n.innerText=u().remain},submit:function(e){return e.node.classList.toggle("disabled",u().remain>0)}}}),f={"form-checkpoint":function(e){var n,r,t;return n=e.node,r=e.data,e.block,t=(r.list||[]).map(function(e){return'<div class="item">\n<div class="title">'+e.title+"</div>\n<p>"+e.desc+"</p>\n</div>"}).join(""),n.innerHTML='<div class="timeline-list">'+t+"</div>"},"form-radio":function(e){var n,r;return n=e.node,r=e.data,n.innerText=(r.list||[]).concat(r.other?[r.otherValue||""]:[]).join(", ")},"form-checkbox":function(e){var n,r;return n=e.node,r=e.data,n.innerText=(r.list||[]).concat(r.other?[r.otherValue||""]:[]).join(", ")}},v=new ldView({root:document.body,handler:{answer:{list:function(){return sampleBlocks},init:function(e){var n,r;return n=e.node,r=e.data,n.view=new ldView({root:n,handler:{title:function(e){var n;return n=e.node,n.innerText=r.title||""},desc:function(e){var n;return n=e.node,n.innerText=r.desc||""},content:function(e){var n;return n=e.node,f[r.name]?f[r.name]({node:n,block:r,data:i[r.key]||{}}):n.innerText=(i[r.key]||{}).content||""}}})},handler:function(e){var n;return n=e.node,e.data,n.view.render()}}}})}),ldc.app("prjForm");