function in$(e,n){for(var t=-1,r=n.length>>>0;++t<r;)if(e===n[t])return!0;return!1}function import$(e,n){var t={}.hasOwnProperty;for(var r in n)t.call(n,r)&&(e[r]=n[r]);return e}ldc.register("prjForm",["prjFormCriteria","prjFormBlock","prjFormValidation","sdbAdapter"],function(e){var n,t,r,i,o;return n=e.prjFormCriteria,t=e.prjFormBlock,r=e.prjFormValidation,i=e.sdbAdapter,o=function(e){var i,o,a,d,l,c,u,s,f,v,p,m,h,g,b=this;return this.opt=e,this.viewMode=i=e.viewMode,this.obj=o={list:[]},a={view:!1},d={update:function(e){return i?(c[e.key]=e.value,console.log("[update]",c),u(e)):(console.log("[update]",b.obj.list),b.opsOut(function(){return b.obj.list}),f.render())},render:function(){}},l={get:function(e){return new Promise(function(n,t){var r,i;return(r=ld$.find("[data-name="+e+"]",0))||t(new Error("block not found")),(i=ld$.create({name:"div",attr:{draggable:!0}})).appendChild(r.cloneNode(!0)),n(i)})}},c={},u=debounce(function(e){if(e.valid=r.validate(e),f.render(),m)return m.render()}),s=function(e){return d.update(e)},setInterval(function(){return console.log(o.list.length,JSON.stringify(o.list))},3e3),f=new ldView({root:"#form",handler:{block:{list:function(){return o.list},init:function(e){var r,a;return r=e.node,a=e.data,l.get(a.name).then(function(e){if((e=e.childNodes[0]).parentNode.removeChild(e),r.innerHTML="",r.appendChild(e),t.render({node:r,rootData:o.list,data:a,viewMode:i,update:s}),!i)return n.render({node:r,data:a})})},handler:function(e){var n;if(n=e.node,e.data,n.view)return n.view.block.render()}}}}),(v=ld$.find("[ld-scope=blocksrc]",0))&&new ldView({root:v,action:{dragstart:{block:function(e){var n;return n=e.node,e.evt.dataTransfer.setData("text/plain",n.getAttribute("data-name")+"")}}}}),new reblock({root:"#form",blockManager:l,action:{afterInject:function(e){var n,t,r,i;return n=e.node,t=e.name,r={key:Math.random().toString(36).substring(2),name:t,title:"提問的標題1",desc:"提問的描述",config:{required:!0},criteria:[{type:"number",op:"between",input1:10,input2:20,invalid:"應介於 10 ~ 20 之間"}]},n._data=r,i=Array.from(n.parentNode).indexOf(n),o.list.splice(i,0,r),f.bindEachNode({name:"block",container:n.parentNode,node:n}),f.render()},afterMoveNode:function(e){var n,t,r,i;if(n=e.src,e.des,t=e.ib,n.parentNode.hasAttribute("hostable")){for(r=n.parentNode;r&&!r._data;)r=r.parentNode;return r?(r._data.data=Array.from(n.parentNode.childNodes).filter(function(e){return 1===e.nodeType}).map(function(e){return e._data}).filter(function(e){return e}),r.view.list.render()):(i=o.list.indexOf(n._data),o.list.splice(i,1),t=t?o.list.indexOf(t._data):o.list.length,o.list.splice(t,0,n._data),void f.render())}}}}),i&&(p=function(){var e,n,t,r;return e=o.list.filter(function(e){return(e.valid||(e.valid={})).result}).length,n=o.list.length,t=e/o.list.length,r=n-e,{remain:r,done:e,total:n,percent:t}},m=new ldView({root:document.body,action:{click:{viewing:function(){return a.view=!a.view,m.render(),g.render()},invalid:function(){var e,n,t,r,i,a,d;n=[];for(t in c)n.push(t);for(e=n,r=0,i=o.list.length;r<i&&(a=r,in$(o.list[a].key+"",e));++r);if(d=ld$.find("#block-"+o.list[a].key,0))return scrollto(d)}}},handler:{nview:function(e){return e.node.classList.toggle("d-none",a.view)},view:function(e){return e.node.classList.toggle("d-none",!a.view)},progress:function(e){var n;return n=e.node,n.style.width=100*p().percent+"%"},invalid:function(e){return e.node.classList.toggle("d-none",0===p().remain)},valid:function(e){return e.node.classList.toggle("d-none",p().remain>0)},remain:function(e){var n;return n=e.node,n.innerText=p().remain},submit:function(e){return e.node.classList.toggle("disabled",p().remain>0)}}}),h={"form-checkpoint":function(e){var n,t,r;return n=e.node,t=e.data,e.block,r=(t.list||[]).map(function(e){return'<div class="item">\n<div class="title">'+e.title+"</div>\n<p>"+e.desc+"</p>\n</div>"}).join(""),n.innerHTML='<div class="timeline-list">'+r+"</div>"},"form-radio":function(e){var n,t;return n=e.node,t=e.data,n.innerText=(t.list||[]).concat(t.other?[t.otherValue||""]:[]).join(", ")},"form-checkbox":function(e){var n,t;return n=e.node,t=e.data,n.innerText=(t.list||[]).concat(t.other?[t.otherValue||""]:[]).join(", ")}},g=new ldView({root:document.body,handler:{answer:{list:function(){return o.list},init:function(e){var n,t;return n=e.node,t=e.data,n.view=new ldView({root:n,handler:{title:function(e){var n;return n=e.node,n.innerText=t.title||""},desc:function(e){var n;return n=e.node,n.innerText=t.desc||""},content:function(e){var n;return n=e.node,h[t.name]?h[t.name]({node:n,block:t,data:c[t.key]||{}}):n.innerText=(c[t.key]||{}).content||""}}})},handler:function(e){var n;return n=e.node,e.data,n.view.render()}}}})),this},o.prototype=import$(import$(Object.create(Object.prototype),i.interface),{opsIn:function(e){var n;if(n=e.data,e.ops,!e.source)return console.log(n),this.obj.list=JSON.parse(JSON.stringify(n))}}),o});