function in$(e,n){for(var r=-1,t=n.length>>>0;++r<t;)if(e===n[r])return!0;return!1}function import$(e,n){var r={}.hasOwnProperty;for(var t in n)r.call(n,t)&&(e[t]=n[t]);return e}ldc.register("prjForm",["prjFormCriteria","prjFormBlock","prjFormValidation","sdbAdapter"],function(e){var n,r,t,o,i;return n=e.prjFormCriteria,r=e.prjFormBlock,t=e.prjFormValidation,o=e.sdbAdapter,i=function(e){var o,i,a,d,l,c,u,s,f,p,v,m,k;return this.opt=e,this.viewMode=o=e.viewMode,i={view:!1},a={update:function(e){return o?(l[e.key]=e.value,console.log("[update]",l),c(e)):s.render()},render:function(){}},d={get:function(e){return new Promise(function(n,r){var t,o;return(t=ld$.find("[data-name="+e+"]",0))||r(new Error("block not found")),(o=ld$.create({name:"div",attr:{draggable:!0}})).appendChild(t.cloneNode(!0)),n(o)})}},l={},c=debounce(function(e){if(e.valid=t.validate(e),s.render(),v)return v.render()}),u=function(e){return a.update(e)},setInterval(function(){return console.log(sampleBlocks.length,JSON.stringify(sampleBlocks))},3e3),s=new ldView({root:"#form",handler:{block:{list:function(){return sampleBlocks},init:function(e){var t,i;return t=e.node,i=e.data,d.get(i.name).then(function(e){if((e=e.childNodes[0]).parentNode.removeChild(e),t.innerHTML="",t.appendChild(e),r.render({node:t,rootData:sampleBlocks,data:i,viewMode:o,update:u}),!o)return n.render({node:t,data:i})})},handler:function(e){var n;if(n=e.node,e.data,n.view)return n.view.block.render()}}}}),(f=ld$.find("[ld-scope=blocksrc]",0))&&new ldView({root:f,action:{dragstart:{block:function(e){var n;return n=e.node,e.evt.dataTransfer.setData("text/plain",n.getAttribute("data-name")+"")}}}}),new reblock({root:"#form",blockManager:d,action:{afterInject:function(e){var n,r,t,o;return n=e.node,r=e.name,t={key:Math.random().toString(36).substring(2),name:r,title:"提問的標題1",desc:"提問的描述",config:{required:!0},criteria:[{type:"number",op:"between",input1:10,input2:20,invalid:"應介於 10 ~ 20 之間"}]},n._data=t,o=Array.from(n.parentNode).indexOf(n),sampleBlocks.splice(o,0,t),s.bindEachNode({name:"block",container:n.parentNode,node:n}),s.render()},afterMoveNode:function(e){var n,r,t,o;if(n=e.src,e.des,r=e.ib,n.parentNode.hasAttribute("hostable")){for(t=n.parentNode;t&&!t._data;)t=t.parentNode;return t?(t._data.data=Array.from(n.parentNode.childNodes).filter(function(e){return 1===e.nodeType}).map(function(e){return e._data}).filter(function(e){return e}),t.view.list.render()):(o=sampleBlocks.indexOf(n._data),sampleBlocks.splice(o,1),r=r?sampleBlocks.indexOf(r._data):sampleBlocks.length,sampleBlocks.splice(r,0,n._data),void s.render())}}}}),o&&(p=function(){var e,n,r,t;return e=sampleBlocks.filter(function(e){return(e.valid||(e.valid={})).result}).length,n=sampleBlocks.length,r=e/sampleBlocks.length,t=n-e,{remain:t,done:e,total:n,percent:r}},v=new ldView({root:document.body,action:{click:{viewing:function(){return i.view=!i.view,v.render(),k.render()},invalid:function(){var e,n,r,t,o,i,a;n=[];for(r in l)n.push(r);for(e=n,t=0,o=sampleBlocks.length;t<o&&(i=t,in$(sampleBlocks[i].key+"",e));++t);if(a=ld$.find("#block-"+sampleBlocks[i].key,0))return scrollto(a)}}},handler:{nview:function(e){return e.node.classList.toggle("d-none",i.view)},view:function(e){return e.node.classList.toggle("d-none",!i.view)},progress:function(e){var n;return n=e.node,n.style.width=100*p().percent+"%"},invalid:function(e){return e.node.classList.toggle("d-none",0===p().remain)},valid:function(e){return e.node.classList.toggle("d-none",p().remain>0)},remain:function(e){var n;return n=e.node,n.innerText=p().remain},submit:function(e){return e.node.classList.toggle("disabled",p().remain>0)}}}),m={"form-checkpoint":function(e){var n,r,t;return n=e.node,r=e.data,e.block,t=(r.list||[]).map(function(e){return'<div class="item">\n<div class="title">'+e.title+"</div>\n<p>"+e.desc+"</p>\n</div>"}).join(""),n.innerHTML='<div class="timeline-list">'+t+"</div>"},"form-radio":function(e){var n,r;return n=e.node,r=e.data,n.innerText=(r.list||[]).concat(r.other?[r.otherValue||""]:[]).join(", ")},"form-checkbox":function(e){var n,r;return n=e.node,r=e.data,n.innerText=(r.list||[]).concat(r.other?[r.otherValue||""]:[]).join(", ")}},k=new ldView({root:document.body,handler:{answer:{list:function(){return sampleBlocks},init:function(e){var n,r;return n=e.node,r=e.data,n.view=new ldView({root:n,handler:{title:function(e){var n;return n=e.node,n.innerText=r.title||""},desc:function(e){var n;return n=e.node,n.innerText=r.desc||""},content:function(e){var n;return n=e.node,m[r.name]?m[r.name]({node:n,block:r,data:l[r.key]||{}}):n.innerText=(l[r.key]||{}).content||""}}})},handler:function(e){var n;return n=e.node,e.data,n.view.render()}}}})),this},i.prototype=import$(import$(Object.create(Object.prototype),o.interface),{opsIn:function(e){var n,r,t,o=[];n=e.data;for(r in n)t=n[r],o.push(this.form.fields[r].value=t);return o}}),i});