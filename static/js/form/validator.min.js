function in$(n,t){for(var e=-1,r=t.length>>>0;++e<r;)if(n===t[e])return!0;return!1}ldc.register("prjFormValidation",["prjFormCriteria"],function(n){var t,e,r,u,i,o,c,l;return t=n.prjFormCriteria,e={number:{type:function(n,t,e){return!(isNaN(n)||null!=t&&isNaN(t)||null!=e&&isNaN(e))},convert:function(n,t,e){return[+n,+(t||0),+(e||0)]},gte:function(n,t){return n>=t},lte:function(n,t){return n<=t},ge:function(n,t){return n>t},le:function(n,t){return n<t},eq:function(n,t){return n===t},ne:function(n,t){return n!==t},between:function(n,t,e){return n>=t&&n<=e}},string:{type:function(n,t){return null!=n&&null!=t},convert:function(n,t){return[n+"",t+""]},include:function(n,t){return~n.indexOf(t)},exclude:function(n,t){return!~n.indexOf(t)},email:function(n,t){return/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(n)},url:function(n,t){return/^\s*http(s):\/\/[a-zA-Z0-9-]+/.exec(n)}},count:{type:function(n,t,e){return null!=n&&null!=t&&null!=e},convert:function(n,t,e){var r;return r=Array.isArray(n)?n.length:null!=n?n.length||(n+"").length:0,[r,+(t||0),+(e||0)]},gte:function(n,t){return n>=t},lte:function(n,t){return n<=t},eq:function(n,t){return n===t},between:function(n,t,e){return n>=t&&n<=e}},regex:{match:function(n,t){return new RegExp(t).exec(n)},"not-match":function(n,t){return!new RegExp(t).exec(n)}},smaller:{type:function(n,t,e){return!(isNaN(n)||null!=t&&isNaN(t)||null!=e&&isNaN(e))},convert:function(n,t,e){return[+n,+(t||0),+(e||0)]},le:function(n,t){return n<t}}},r={"form-checkpoint":function(n){return(n.block.value||{}).list||[]},"form-datetime":function(n){return n.block.value||{}},"form-checkbox":function(n){var t,e;return t=n.block,((e=t.value||{}).list||[]).concat(e.other?[e.otherValue]:[])},"form-radio":function(n){var t,e;return t=n.block,((e=t.value||{}).list||[]).concat(e.other?[e.otherValue]:[])},"form-table":function(n){return((n.block.value||{}).sheet||[]).filter(function(n){return n.filter(function(n){return n}).length})}},u={"form-checkpoint":function(n){var t;return n.block,!(t=n.data).length||t.filter(function(n){return n.title&&n.desc&&n.date}).length!==t.length},"form-datetime":function(n){var t,e,r;return t=n.block,e=n.data,r=t.config||{},!(e.start&&(!r.rangeEnabled||e.end))},"form-checkbox":function(n){return n.block,!n.data.filter(function(n){return n}).length},"form-radio":function(n){return n.block,!n.data.filter(function(n){return n}).length},"form-table":function(n){var t;return n.block,!((t=n.data)&&t.length)}},i={empty:{result:!1,criteria:{invalid:"此為必填項目"}},pass:{result:!0}},o=function(n,r){var u,i,o,c,l,f;return n.enabled?(u=t.schema.types[n.type],n.type&&u&&(i=e[u.ops])[n.op]?(o=i.convert(r,n.input1,n.input2),c=o[0],l=o[1],f=o[2],i.type(c,l,f)&&i[n.op](c,l,f)?null:{result:!1,criteria:n}):null):null},c=function(n){var t,e,r,u;return t=n.block,e=n.empty,r=n.force,u=t.config||(t.config={}),e?u.required?u.required&&(t.touched||r)?i.empty:{}:i.pass:(t.touched=!0,null)},l={"form-file":function(n){var t,e,r,u,i,c,l,f;for(t=n.block,n.force,e=(t.value||{}).list||[],r=0,i=(u=t.criteria||[]).length;r<i;++r)if("file-size"===(c=u[r]).type){if(e.map(function(n){return n.size}).filter(function(n){return n>=+c.input1}).length)return{result:!1,criteria:c}}else if("file-format"===c.type){if(l=(c.input1||"").toLowerCase().split(","),e.map(function(n){var t;return((n.name?(t=n.name.split("."))[t.length-1]:void 0)||n.ext||"").toLowerCase()}).filter(function(n){return!in$(n,l)}).length)return{result:!1,criteria:c}}else if("file-count"===c.type&&(f=o(c,e)))return f;return{result:!0}},"form-text":function(){return{result:!0}},"form-budget":function(n){var t,e,r,u,i,l,f,a,s,m,p,g,d;if(t=n.block,e=n.force,r=(t.value||{}).sheet||[],u=r.reduce(function(n,t){return n+ +t[2]+ +t[3]},0),i=!u||isNaN(u),l=c({block:t,empty:i,force:e}))return l;for(f=r.reduce(function(n,t){return n+ +t[2]+ +t[3]},0),s=(a=r.reduce(function(n,t){return n+ +t[3]},0))/(f||1)*100,m=0,g=(p=t.criteria||[]).length;m<g;++m)if("budget-percent"===(d=p[m]).type?u=s:"budget-number"===d.type&&(u=a),l=o(d,u))return l;return{result:!0}}},{validate:function(n,t){var e,f,a,s,m,p,g,d;if(null==t&&(t=!1),e=[n.value||(n.value={}),n.config||(n.config={}),!1],f=e[0],e[1],a=e[2],l[n.name])return l[n.name]({block:n,force:t});if(s=r[n.name]?r[n.name]({block:n}):f.content?f.content:f.list?s=f.list:null,a=u[n.name]?u[n.name]({block:n,data:s}):f.content?!f.content:!f.list||!(f.list&&f.list.length),m=c({block:n,empty:a,force:t}))return m;for(p=0,g=(e=n.criteria||[]).length;p<g;++p)if(d=e[p],m=o(d,s))return m;return i.pass}}});