function in$(e,n){for(var t=-1,r=n.length>>>0;++t<r;)if(e===n[t])return!0;return!1}ldc.register("prjFormValidation",["prjFormCriteria"],function(e){var n,t,r,u,i,o,c,l;return n=e.prjFormCriteria,t={number:{type:function(e,n,t){return!(isNaN(e)||null!=n&&isNaN(n)||null!=t&&isNaN(t))},convert:function(e,n,t){return[+e,+(n||0),+(t||0)]},gte:function(e,n){return e>=n},lte:function(e,n){return e<=n},ge:function(e,n){return e>n},le:function(e,n){return e<n},eq:function(e,n){return e===n},ne:function(e,n){return e!==n},between:function(e,n,t){return e>=n&&e<=t}},string:{type:function(e,n){return null!=e&&null!=n},convert:function(e,n){return[e+"",n+""]},include:function(e,n){return~e.indexOf(n)},exclude:function(e,n){return!~e.indexOf(n)},email:function(e,n){return/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(e)},url:function(e,n){return/^\s*http(s):\/\/[a-zA-Z0-9-]+/.exec(e)}},count:{type:function(e,n,t){return null!=e&&null!=n&&null!=t},convert:function(e,n,t){var r;return r=Array.isArray(e)?e.length:null!=e?e.length||(e+"").length:0,[r,+(n||0),+(t||0)]},gte:function(e,n){return e>=n},lte:function(e,n){return e<=n},eq:function(e,n){return e===n},between:function(e,n,t){return e>=n&&e<=t}},regex:{match:function(e,n){return new RegExp(n).exec(e)},"not-match":function(e,n){return!new RegExp(n).exec(e)}},smaller:{type:function(e,n,t){return!(isNaN(e)||null!=n&&isNaN(n)||null!=t&&isNaN(t))},convert:function(e,n,t){return[+e,+(n||0),+(t||0)]},le:function(e,n){return e<n}}},r={"form-checkpoint":function(e){return(e.block.value||{}).list||[]},"form-datetime":function(e){return e.block.value||{}},"form-checkbox":function(e){var n,t;return n=e.block,((t=n.value||{}).list||[]).concat(t.other?[t.otherValue]:[])},"form-radio":function(e){var n,t;return n=e.block,((t=n.value||{}).list||[]).concat(t.other?[t.otherValue]:[])},"form-table":function(e){return((e.block.value||{}).sheet||[]).filter(function(e){return e.filter(function(e){return e}).length})}},u={"form-checkpoint":function(e){var n;return e.block,!(n=e.data).length||n.filter(function(e){return e.title&&e.desc&&e.date}).length!==n.length},"form-datetime":function(e){var n,t,r;return n=e.block,t=e.data,r=n.config||{},!(t.start&&(!r.rangeEnabled||t.end))},"form-checkbox":function(e){return e.block,!e.data.filter(function(e){return e}).length},"form-radio":function(e){return e.block,!e.data.filter(function(e){return e}).length},"form-table":function(e){var n;return e.block,!((n=e.data)&&n.length)}},i={empty:{result:!1,criteria:{invalid:"此為必填項目"}},pass:{result:!0}},o=function(e,r){var u,i,o,c,l,f;return e.enabled?(u=n.schema.types[e.type],e.type&&u&&(i=t[u.ops])[e.op]?(o=i.convert(r,e.input1,e.input2),c=o[0],l=o[1],f=o[2],i.type(c,l,f)&&i[e.op](c,l,f)?null:{result:!1,criteria:e}):null):null},c=function(e){var n,t,r,u;return n=e.block,t=e.empty,r=e.force,u=n.config||(n.config={}),t?u.required?u.required&&(n.touched||r)?i.empty:{}:i.pass:(n.touched=!0,null)},l={"form-file":function(e){var n,t,r,u,i,l,f,a,s,m,p;if(n=e.block,t=e.force,(!(r=(n.value||{}).list||[])||!r.length)&&(u=c({block:n,empty:!0,force:t})))return u;for(i=0,f=(l=n.criteria||[]).length;i<f;++i)if((a=l[i]).enabled)if("file-size"===a.type){if(s=/^([0-9.,]+)([mk]b)?$/.exec(((a.input1||"0")+"").trim().toLowerCase()),m=s?s[1].replace(",","")*(s[2]?"mb"===s[2]?1048576:1024:1):0,r.map(function(e){return e.size}).filter(function(e){return e>=m}).length)return{result:!1,criteria:a}}else if("file-format"===a.type){if(p=(a.input1||"").toLowerCase().split(","),r.map(function(e){var n;return((e.name?(n=e.name.split("."))[n.length-1]:void 0)||e.ext||"").toLowerCase()}).filter(function(e){return!in$(e,p)}).length)return{result:!1,criteria:a}}else if("file-count"===a.type&&(u=o(a,r)))return u;return{result:!0}},"form-text":function(){return{result:!0}},"form-budget":function(e){var n,t,r,u,i,l,f,a,s,m,p,b,d;if(n=e.block,t=e.force,r=(n.value||{}).sheet||[],u=r.reduce(function(e,n){return e+ +n[2]+ +n[3]},0),i=!u||isNaN(u),l=c({block:n,empty:i,force:t}))return l;for(f=r.reduce(function(e,n){return e+ +n[2]+ +n[3]},0),s=(a=r.reduce(function(e,n){return e+ +n[3]},0))/(f||1)*100,m=0,b=(p=n.criteria||[]).length;m<b;++m)if((d=p[m]).enabled&&("budget-percent"===d.type?u=s:"budget-number"===d.type&&(u=a),l=o(d,u)))return l;return{result:!0}}},{validate:function(e,n){var t,f,a,s,m,p,b,d;if(null==n&&(n=!1),t=[e.value||(e.value={}),e.config||(e.config={}),!1],f=t[0],t[1],a=t[2],l[e.name])return l[e.name]({block:e,force:n});if(s=r[e.name]?r[e.name]({block:e}):f.content?f.content:f.list?s=f.list:null,a=u[e.name]?u[e.name]({block:e,data:s}):f.content?!f.content:!f.list||!(f.list&&f.list.length),m=c({block:e,empty:a,force:n}))return m;for(p=0,b=(t=e.criteria||[]).length;p<b;++p)if(d=t[p],m=o(d,s))return m;return i.pass}}});