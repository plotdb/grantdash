function in$(n,e){for(var t=-1,r=e.length>>>0;++t<r;)if(n===e[t])return!0;return!1}ldc.register("prjFormValidation",["prjFormCriteria"],function(n){var e,t,r,u,i,o,c,l;return e=n.prjFormCriteria,t={number:{type:function(n,e,t){return!(isNaN(n)||null!=e&&isNaN(e)||null!=t&&isNaN(t))},convert:function(n,e,t){return[+n,+(e||0),+(t||0)]},gte:function(n,e){return n>=e},lte:function(n,e){return n<=e},ge:function(n,e){return n>e},le:function(n,e){return n<e},eq:function(n,e){return n===e},ne:function(n,e){return n!==e},between:function(n,e,t){return n>=e&&n<=t}},string:{type:function(n,e){return null!=n&&null!=e},convert:function(n,e){return[n+"",e+""]},include:function(n,e){return~n.indexOf(e)},exclude:function(n,e){return!~n.indexOf(e)},email:function(n,e){return/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(n)},url:function(n,e){return/^\s*http(s):\/\/[a-zA-Z0-9-]+/.exec(n)}},count:{type:function(n,e,t){return null!=n&&null!=e&&null!=t},convert:function(n,e,t){var r;return r=Array.isArray(n)?n.length:null!=n?n.length||(n+"").length:0,[r,+(e||0),+(t||0)]},gte:function(n,e){return n>=e},lte:function(n,e){return n<=e},eq:function(n,e){return n===e},between:function(n,e,t){return n>=e&&n<=t}},regex:{type:function(n,e,t){return[n,e,t].reduce(function(n,e){return n&&"string"==typeof e},!0)},convert:function(n,e,t){return[n,e,t].map(function(n){return n+""})},match:function(n,e){return new RegExp(e).exec(n)},"not-match":function(n,e){return!new RegExp(e).exec(n)}},smaller:{type:function(n,e,t){return!(isNaN(n)||null!=e&&isNaN(e)||null!=t&&isNaN(t))},convert:function(n,e,t){return[+n,+(e||0),+(t||0)]},le:function(n,e){return n<e}}},r={"form-checkpoint":function(n){return(n.block.value||{}).list||[]},"form-datetime":function(n){return n.block.value||{}},"form-checkbox":function(n){var e,t;return e=n.block,((t=e.value||{}).list||[]).concat(t.other?[t.otherValue]:[])},"form-radio":function(n){var e,t;return e=n.block,((t=e.value||{}).list||[]).concat(t.other?[t.otherValue]:[])},"form-table":function(n){return((n.block.value||{}).sheet||[]).filter(function(n){return n.filter(function(n){return n}).length})}},u={"form-checkpoint":function(n){var e;return n.block,!(e=n.data).length||e.filter(function(n){return n.title&&n.desc&&n.date}).length!==e.length},"form-datetime":function(n){var e,t,r;return e=n.block,t=n.data,r=e.config||{},!(t.start&&(!r.rangeEnabled||t.end))},"form-checkbox":function(n){return n.block,!n.data.filter(function(n){return n}).length},"form-radio":function(n){return n.block,!n.data.filter(function(n){return n}).length},"form-table":function(n){var e;return n.block,!((e=n.data)&&e.length)}},i={empty:{result:!1,criteria:{invalid:"此為必填項目"}},pass:{result:!0}},o=function(n,r){var u,i,o,c,l,f;return n.enabled?(u=e.schema.types[n.type],n.type&&u&&(i=t[u.ops])[n.op]?(o=i.convert(r,n.input1,n.input2),c=o[0],l=o[1],f=o[2],i.type(c,l,f)&&i[n.op](c,l,f)?null:{result:!1,criteria:n}):null):null},c=function(n){var e,t,r,u;return e=n.block,t=n.empty,r=n.force,u=e.config||(e.config={}),t?u.required?u.required&&(e.touched||r)?i.empty:{}:i.pass:(e.touched=!0,null)},l={"form-file":function(n){var e,t,r,u,i,l,f,a,s,m,p;if(e=n.block,t=n.force,(!(r=(e.value||{}).list||[])||!r.length)&&(u=c({block:e,empty:!0,force:t})))return u;for(i=0,f=(l=e.criteria||[]).length;i<f;++i)if((a=l[i]).enabled)if("file-size"===a.type){if(s=/^([0-9.,]+)([mk]b)?$/.exec(((a.input1||"0")+"").trim().toLowerCase()),m=s?s[1].replace(",","")*(s[2]?"mb"===s[2]?1048576:1024:1):0,r.map(function(n){return n.size}).filter(function(n){return n>=m}).length)return{result:!1,criteria:a}}else if("file-format"===a.type){if(p=(a.input1||"").toLowerCase().split(","),r.map(function(n){var e;return((n.name?(e=n.name.split("."))[e.length-1]:void 0)||n.ext||"").toLowerCase()}).filter(function(n){return!in$(n,p)}).length)return{result:!1,criteria:a}}else if("file-count"===a.type&&(u=o(a,r)))return u;return{result:!0}},"form-text":function(){return{result:!0}},"form-budget":function(n){var e,t,r,u,i,l,f,a,s,m,p,d,g;if(e=n.block,t=n.force,r=(e.value||{}).sheet||[],u=r.reduce(function(n,e){return n+ +e[2]+ +e[3]},0),i=!u||isNaN(u),l=c({block:e,empty:i,force:t}))return l;for(f=r.reduce(function(n,e){return n+ +e[2]+ +e[3]},0),s=(a=r.reduce(function(n,e){return n+ +e[3]},0))/(f||1)*100,m=0,d=(p=e.criteria||[]).length;m<d;++m)if((g=p[m]).enabled&&("budget-percent"===g.type?u=s:"budget-number"===g.type&&(u=a),l=o(g,u)))return l;return{result:!0}}},{validate:function(n,e){var t,f,a,s,m,p,d,g;if(null==e&&(e=!1),t=[n.value||(n.value={}),n.config||(n.config={}),!1],f=t[0],t[1],a=t[2],l[n.name])return l[n.name]({block:n,force:e});if(s=r[n.name]?r[n.name]({block:n}):f.content?f.content:f.list?s=f.list:null,a=u[n.name]?u[n.name]({block:n,data:s}):f.content?!f.content:!f.list||!(f.list&&f.list.length),m=c({block:n,empty:a,force:e}))return m;for(p=0,d=(t=n.criteria||[]).length;p<d;++p)if(g=t[p],m=o(g,s))return m;return i.pass}}});