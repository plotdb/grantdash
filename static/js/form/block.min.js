ldc.register("prjFormBlock",[],function(){var e,t,n,r;return e=function(e){var t,n,r,i,a,o,u;return t=e.node,n=e.data,r=e.viewMode,i=e.update,"form-checkpoint"===(a=n).name&&r&&((n.value||(n.value={})).list?a.data=n.value.list:(n.value||(n.value={})).list=a.data||(a.data=[]),ld$.find(t,".timeline-list",0).addEventListener("input",function(){return i(n)})),o=function(){var e;return e=ld$.find(t,"[ld=list-input]").map(function(e){return e.checked?e.getAttribute("data-name"):null}).filter(function(e){return e}),(a.value||(a.value={})).list=e,(a.value||(a.value={})).other=!!ld$.find(t,"[ld=list-other-option]",0).checked,i(a)},(t.view||(t.view={})).list=u=new ldView({root:t,action:{input:{"list-other":function(e){var t;return t=e.node,(a.value||(a.value={})).otherValue=t.value||"",i(n)}},click:{"list-add":function(){return(a.data||(a.data=[])).push({title:"新項目",desc:"關於這個項目的描述 ... "}),i(n),u.render()},"list-other-option":function(e){var t;return t=e.node,(a.value||(a.value={})).other=t.checked,o()}}},handler:{"list-other":function(e){var t;return t=e.node,t.value=(a.value||(a.value={})).otherValue||""},"list-other-option":function(e){return e.node.setAttribute("name","radio-"+n.key)},list:{list:function(){return a.data||(a.data=[])},init:function(e){var t,n,i;return t=e.node,n=e.data,!(i=t.hasAttribute("data-user-editable"))&&r&&t.removeAttribute("draggable"),t.view=new ldView({root:t,action:{input:{"list-data":function(e){var t;return t=e.node,n[t.getAttribute("data-name")]=t.innerText},"list-input":function(e){return e.node,o()}}},init:{"list-data":function(e){var t;if((t=e.node).setAttribute("data-name",t.getAttribute("editable")),!i&&r)return t.removeAttribute("editable")}},handler:{"list-input":function(e){var t;return(t=e.node).setAttribute("name","radio-"+a.key),t.setAttribute("data-name",n.title)},"list-data":function(e){var t;return t=e.node,t.innerText=n[t.getAttribute("data-name")]||""}}})},render:function(e){return e.node.render()}}}})},t=function(e){var t,n,r,i,a;return t=e.node,n=e.data,e.viewMode,r=e.update,i={},a=new ldView({root:t,action:{input:{"use-markdown":function(e){var t;return t=e.node,(n.value||(n.value={})).useMarkdown=t.checked,r(n),a.render()},"input-field":function(e){var t;return t=e.node,(n.value||(n.value={})).content=t.value,r(n)},"toggle-preview":function(e){var t;return t=e.node,i.preview=!!t.checked,a.render()}}},handler:{"input-field":function(e){var t;return t=e.node,t.value=(n.value||(n.value={})).content||""},"preview-panel":function(e){var t;if((t=e.node).classList.toggle("d-none",!i.preview),i.preview)return t.innerHTML=marked((n.value||(n.value={})).content||"")},"edit-panel":function(e){return e.node.classList.toggle("d-none",!!i.preview)},"if-markdown":function(e){return e.node.classList.toggle("d-none",!(n.value||(n.value={})).useMarkdown)}}})},n={"form-radio":e,"form-checkbox":e,"form-checkpoint":e,"form-long-answer":t,"form-short-answer":t},r=function(e){var t,r,i,a,o;if(t=e.node,r=e.data,i=e.rootData,a=e.viewMode,o=e.update,t.setAttribute("id","block-"+r.key),(t.view||(t.view={})).block=new ldView({root:t,action:{input:{title:function(e){var t;return t=e.node,e.evt,r.title=t.innerText,o()},desc:function(e){var t;return t=e.node,e.evt,r.desc=t.innerText,updaate()}},click:{switch:function(e){var t;return t=e.node,e.evt,t.classList.toggle("on"),(r.config||(r.config={}))[t.getAttribute("data-name")]=t.classList.contains("on"),o()},delete:function(e){return e.node,e.evt,i.splice(i.indexOf(r),1),o()},clone:function(e){var t;return e.node,e.evt,t=JSON.parse(JSON.stringify(r)),t.key=Math.random().toString(36).substring(2),i.splice(i.indexOf(r),0,t),o()}}},handler:{invalid:function(e){var t,n;return t=e.node,(n=!(null!=(r.valid||(r.valid={})).result)||r.valid.result)||(t.innerText=r.valid.criteria.invalid||"這個欄位格式不符"),t.classList.toggle("d-none",n)},block:function(e){var t,n;return t=e.node,n=!(null!=(r.valid||(r.valid={})).result)||r.valid.result,t.classList.toggle("invalid",!n)},title:function(e){var t;if(t=e.node,t.innerText=r.title,a)return t.removeAttribute("editable")},desc:function(e){var t;if(t=e.node,t.innerText=r.desc,a)return t.removeAttribute("editable")},switch:function(e){var t;return(t=e.node).classList.toggle("on",!!(r.config||(r.config={}))[t.getAttribute("data-name")])},"edit-only":function(e){var t;if(t=e.node,a)return t.remove()},"list-input":function(e){return e.node.setAttribute("name","input-"+r.key)}}}),n[r.name])return n[r.name]({node:t,data:r,viewMode:a,update:o})},{render:r,module:n}});