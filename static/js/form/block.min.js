function in$(e,t){for(var n=-1,r=t.length>>>0;++n<r;)if(e===t[n])return!0;return!1}function import$(e,t){var n={}.hasOwnProperty;for(var r in t)n.call(t,r)&&(e[r]=t[r]);return e}ldc.register("prjFormBlock",["ldcvmgr","error","auth","prjFormCriteria"],function(e){var t,n,r,o,i,a,l,u,c,d,s,f,v,p;return t=e.ldcvmgr,n=e.error,r=e.auth,o=e.prjFormCriteria,i=o.schema,a=function(e,t){if(e.innerText!==t)return e.innerText=t},l={},l["form-text"]={moduleInit:function(){var e,t=this;return this.viewing?this.view.module=e=new ldView({root:this.root,handler:{"is-view":function(e){var t,n;return t=e.node,n=e.names,t.classList.toggle("d-none",in$("not",n))},title:function(e){return e.node.classList.add("d-none")},desc:function(e){return e.node.classList.add("d-none")},text:function(e){var n,r,o,i;return n=e.node,r=t.block.data||{},o=r.content||"",n.innerHTML=r.content,i=r.useMarkdown?marked(o):htmlentities(o),n.innerHTML=DOMPurify.sanitize(i)}}}):this.view.module=e=new ldView({root:this.root,action:{input:{"use-markdown":function(n){var r,o;return r=n.node,((o=t.block).data||(o.data={})).useMarkdown=r.checked,r.checked||(t.preview=!1),t.update(),e.render()},"input-field":function(e){var n,r;return n=e.node,((r=t.block).data||(r.data={})).content=n.value,t.update()},"toggle-preview":function(n){var r;return r=n.node,t.preview=!!r.checked,e.render()}}},handler:{title:function(e){var t;return(t=e.node).removeAttribute("editable"),t.innerText="( 說明文字 - 僅做說明用途，不提供用戶輸入 )"},desc:function(e){return e.node.classList.add("d-none")},"toggle-preview":function(e){var n;return n=e.node,n.checked=t.preview},"is-view":function(e){var t,n;return t=e.node,n=e.names,t.classList.toggle("d-none",!in$("not",n))},"input-field":function(e){var n,r;return n=e.node,n.value=((r=t.block).data||(r.data={})).content||""},"preview-panel":function(e){var n,r;if((n=e.node).classList.toggle("d-none",!t.preview),t.preview)return n.innerHTML=DOMPurify.sanitize(marked(((r=t.block).data||(r.data={})).content||""))},"edit-panel":function(e){return e.node.classList.toggle("d-none",!!t.preview)},"if-markdown":function(e){var n;return e.node.classList.toggle("d-none",!((n=t.block).data||(n.data={})).useMarkdown)}}})}},l["form-table"]={moduleInit:function(){var e,t,n=this;return e=function(){return n.view.module=new ldView({root:n.root,context:{},action:{click:{"new-row":function(e){var t,n,r;return e.node,t=e.context,n=((r=t.hot.getSelected())?r[0]:t.hot.countRows())+1,t.hot.alter("insert_row",n,1)}}},init:{"table-root":function(e){var t,r,o,i,a,l;return t=e.node,r=e.context,o=function(){var e,t,r;return e=Array.isArray(((t=n.block).data||(t.data={})).sheet)?((t=n.block).data||(t.data={})).sheet:[["範例","資料","表格"]],r=Array.isArray(((t=n.block).value||(t.value={})).sheet)?((t=n.block).value||(t.value={})).sheet:[],e.concat(r)},i=function(e){var t;return l&&e.length&&l.loadData(a),n.viewing?n.block.value.sheet=a.slice(1):((t=n.block).data||(t.data={})).sheet=a.slice(0,1),n.update()},a=o(),r.hot=l=new Handsontable(t,{data:a,filters:!0,dropdownMenu:!0,stretchH:"all",rowHeights:25,wordWrap:!1,minRows:3,minCols:3,maxCols:9,afterChange:function(e){return null==e&&(e=[]),i(e)}}),l.updateSettings({contextMenu:{items:{add_row_above:{name:"在上方新增一列",callback:function(e,t){return l.alter("insert_row",l.getSelected()[0][0],1)}},add_row_below:{name:"在下方新增一列",callback:function(e,t){return l.alter("insert_row",l.getSelected()[0][0]+1,1)}},del_row:{name:"刪除列",callback:function(e,t){var r;return r=l.getSelected()[0],l.alter("remove_row",r[0],1),n.block.value.sheet.splice(r[0],1),i([r[0],r[1]])}}}}})}}})},t=function(){return n.root.getBoundingClientRect().width?e():requestAnimationFrame(t)},requestAnimationFrame(t)}},l["form-budget"]={moduleInit:function(){var e,t,n=this;{if(this.viewing)return e=function(){var e;return n.view.module=e=new ldView({root:n.root,context:{},action:{click:{"new-row":function(e){var t,n,r;return e.node,t=e.context,n=((r=t.hot.getSelected())?r[0]:t.hot.countRows())+1,t.hot.alter("insert_row",n,1)}}},text:{value:function(e){var t,n,r;return t=e.node,n=e.context,r=t.getAttribute("data-name"),isNaN(n[r])?"???":n[r]||0}},handler:{"is-view":function(e){var t,n;return t=e.node,n=e.names,t.classList.toggle("d-none",!!in$("not",n))}},init:{"budget-root":function(t){var r,o,i,a,l,u,c,d;return r=t.node,o=t.context,i=[["分類","項目","預估","","","實際","","","執行率"],["","","自籌","補助","總計","自籌","補助","總計",""]],a=function(){var e;return i.concat(((e=n.block).value||(e.value={})).sheet||[["設備","( 範例 ) 電腦",2e4,1e4]])},l=function(t){return o.total=0,o.subsidy=0,d.slice(2).filter(function(e){return e}).map(function(e){return e[4]=u(e[2])||u(e[3])?+e[2]+ +e[3]:"",e[7]=u(e[5])||u(e[6])?+e[5]+ +e[6]:"",o.total+=+e[4],o.subsidy+=u(e[3])?+e[3]:0}),o.percent=(Math.round(1e3*o.subsidy/(o.total||1))/10+"").replace("(.d)d*","$1"),t.length&&c.loadData(d),debounce(10).then(function(){return e.render("total")}),n.block.value.sheet=d.slice(2).filter(function(e){return e}).map(function(e){return e.slice(0,4)}),n.update()},Handsontable.renderers.registerRenderer("budget-renderer",function(e,t,n,r,o,i,a){return Handsontable.renderers.TextRenderer.apply(this,arguments),(n<2||r>=4)&&(a.readOnly=!0),n<2?t.classList.add("head"):r>1?t.classList.add("value"):void 0}),u=function(e){return null!=e&&(e+"").length},o.hot=c=new Handsontable(r,{data:d=a(),filters:!0,dropdownMenu:!0,stretchH:"all",rowHeights:25,wordWrap:!1,minRows:10,minCols:9,maxCols:9,fixedRowsTop:2,mergeCells:[{row:0,col:0,colspan:1,rowspan:2},{row:0,col:1,colspan:1,rowspan:2},{row:0,col:2,colspan:3,rowspan:1},{row:0,col:5,colspan:3,rowspan:1},{row:0,col:8,colspan:1,rowspan:2}],cells:function(e,t){return{renderer:"budget-renderer"}},colWidths:[50,120,55,55,55,55,55,55],afterChange:function(e){return null==e&&(e=[]),l(e)}}),c.updateSettings({contextMenu:{items:{add_row_above:{name:"在上方新增一列",callback:function(e,t){return c.alter("insert_row",c.getSelected()[0][0],1)}},add_row_below:{name:"在下方新增一列",callback:function(e,t){return c.alter("insert_row",c.getSelected()[0][0]+1,1)}},del_row:{name:"刪除列",callback:function(e,t){var r;return r=c.getSelected()[0],c.alter("remove_row",r[0],1),n.block.value.sheet.splice(r[0],1),l([r[0],r[1]])}}}}})}}})},t=function(){return n.root.getBoundingClientRect().width?e():requestAnimationFrame(t)},requestAnimationFrame(t);ld$.find(this.root,'[ld="not is-view"]',0).classList.toggle("d-none",!1)}}},u={moduleInit:function(){var e,o=this;if(this.viewing)return this.view.module=e=new ldView({context:{},root:this.root,init:{"input-file":function(e){var i,a,l,u;return i=e.node,a=e.local,l=e.context,"form-thumbnail"===o.block.name&&i.setAttribute("accept","image/*"),l.loading=!1,a.ldf=u=new ldFile({root:i}),u.on("load",function(e){var a,u,c,d,s;if("form-thubmnail"===o.block.name&&(e=e.filter(function(e){return/^image\//.exec(e.type)&&/\.(gif|png|jpg|jpeg)$/.exec(e.name)})),i.value="",e.length){if(e.filter(function(e){return e.file&&e.file.size>=10485760}).length)return t.toggle("error-413");if(e.length+(((a=o.block).value||(a.value={})).list||[]).length>10)return t.toggle("error-413");for(u=new FormData,c=0,d=e.length;c<d;++c)s=c,u.append("file[]",e[s].file);return u.append("prj",o.prj.slug),l.loading=!0,o.view.module.render(),r.recaptcha.get().then(function(e){return u.append("recaptcha",e),ld$.xhr("/dash/api/upload",{method:"POST",body:u},{type:"json",progress:function(e){var t;return t=e.percent,l.percent=t,o.view.module.render()}})}).then(function(t){var n,r,i,a;if(null==t&&(t=[]),t&&t.length)return n=(r=(i=o.block).value||(i.value={})).list||(r.list=[]),a=e.map(function(e,n){var r,o;return(r=t.filter(function(t){return t.name===e.file.name})[0])?(o={key:suuid()},o.name=r.name,o.size=r.size,o.type=r.type,o.ext=r.ext,o.fn=r.fn,o):null}).filter(function(e){return e}).filter(function(e){return 0===n.filter(function(t){return t.name===e.name&&t.fn===e.fn}).length}),"form-thumbnail"===o.block.name&&o.block.value.list.splice(0),(r=o.block.value).list=r.list.concat(a),o.update()}).finally(function(){return debounce(1e3).then(function(){return l.loading=!1,o.view.module.render()})}).catch(n())}})}},handler:{loading:function(e){var t;return t=e.context,e.node.classList.toggle("d-none",!t.loading)},bar:function(e){var t,n;return t=e.context,n=e.node,n.style.width=100*(t.percent||0)+"%"},"bar-label":function(e){var t,n;return t=e.context,n=e.node,n.innerText=100*(t.percent||0)+"%"},file:{list:function(){var e,t;return(e=(t=o.block).value||(t.value={})).list||(e.list=[])},init:function(t){var n,r,i;return n=t.node,r=t.data,i=t.local,n.classList.toggle("d-none",!1),i.view=new ldView({context:r,root:n,action:{click:{delete:function(t){var n,r,i,a;return t.node,n=t.context,r=(i=o.block.value).list||(i.list=[]),~(a=r.indexOf(n))&&r.splice(a,1),e.render(),o.update()}}},handler:{name:function(e){var t,n;return t=e.node,n=e.context,t.innerText=n.name},type:function(e){var t,n;return t=e.node,n=e.context,t.innerText=n.type},size:function(e){var t,n;return t=e.node,e.context,n=Math.round(10*r.size/1048576)/10,t.innerText=n+"MB"}}})},handler:function(e){return e.node,e.data,e.local.view.render()}}}})}},import$(l,{"form-file":u,"form-thumbnail":u}),l["form-checkpoint"]={moduleInit:function(){var e,t=this;return this.viewing&&(((e=this.block).value||(e.value={})).list?this.block.data=this.block.value.list:((e=this.block).value||(e.value={})).list=(e=this.block).data||(e.data=[]),ld$.find(this.root,".timeline-list",0).addEventListener("input",function(){var e;return((e=t.block).value||(e.value={})).list=t.block.data,t.update()})),this.view.module=new ldView({root:this.root,action:{click:{"list-add":function(){var e;return((e=t.block).data||(e.data=[])).push({title:"",desc:"",key:suuid()}),t.update(),t.render()}}},handler:{list:{key:function(e){return e.key},list:function(){return t.block.data||[]},handler:function(e){var n,r;return n=e.node,r=e.data,n.hasAttribute("data-user-editable"),n.view?n.view.render():n.view=new ldView({root:n,init:{date:function(e){var n;if(n=e.node,t.viewing)return tail.DateTime(n)}},action:{input:{input:function(e){var n,o;return n=e.node,r[n.getAttribute("data-name")]=n.value,((o=t.block).value||(o.value={})).list=t.block.data,t.update()}},click:{delete:function(e){var n;return e.node,n=e.evt,t.block.data.splice(t.block.data.indexOf(r),1),t.update(),t.render(),n.stopPropagation()}}},handler:{input:function(e){var t;return t=e.node,t.value=r[t.getAttribute("data-name")]||""}}})}}}})}},c={moduleInit:function(){var e,t=this;return this.view.module=e=new ldView({root:this.root,action:{click:{"list-add":function(){var e;return((e=t.block).data||(e.data=[])).push({title:"新項目",desc:"關於這個項目的描述 ... ",key:suuid()}),t.update(),t.render()}}},handler:{list:{key:function(e){return e.key},list:function(){var e,n;return e=t.block.data||[],!((n=t.block).config||(n.config={})).otherEnabled&&t.viewing||(e=e.concat([{other:!0,key:"other"}])),e},init:function(e){var n;if(n=e.node,e.data,!n.hasAttribute("data-user-editable")&&t.viewing)return n.removeAttribute("draggable")},action:{click:this.viewing?function(n){var r,o,i,a,l,u;if(n.node,r=n.data,"INPUT"!==n.evt.target.nodeName)return o="form-radio"===t.block.name,i=(a=t.block).value||(a.value={}),r.other?(l=!!o||!i.other,i.other=l,l&&o&&(i.list=[])):(u=i.list||[],l=!!o||!in$(r.title,u),o&&(u=[]),l?(u.push(r.title),o&&(i.other=!1)):u.splice(u.indexOf(r.title),1),i.list=u),e.render(),t.update()}:function(){}},handler:function(e){var n,r,o;return n=e.node,r=e.data,o=n.hasAttribute("data-user-editable"),n.view?n.view.render():n.view=new ldView({root:n,init:{date:function(e){var n;if(n=e.node,t.viewing)return tail.DateTime(n)},data:function(e){var n;if((n=e.node).setAttribute("data-name",n.getAttribute("editable")),!o&&t.viewing)return n.removeAttribute("editable")}},action:{input:{"other-value":function(e){var n,r;return n=e.node,((r=t.block).value||(r.value={})).otherValue=n.value},data:function(e){var n;return n=e.node,r[n.getAttribute("data-name")]=editableInput(n),t.update()}},click:{"other-enabled":function(e){var n,r;return n=e.node,e.evt,((r=t.block).config||(r.config={})).otherEnabled=!((r=t.block).config||(r.config={})).otherEnabled,n.classList.toggle("on",((r=t.block).config||(r.config={})).otherEnabled),t.update(),t.render()},delete:function(e){var n;return e.node,n=e.evt,t.block.data.splice(t.block.data.indexOf(r),1),t.update(),t.render(),n.stopPropagation()}}},handler:{drag:function(e){return e.node.classList.toggle("invisible",!!(t.viewing&&!o||r.other))},state:function(e){var n,o,i,a;return n=e.node,o=(i=t.block).value||(i.value={}),a=r.other&&o.other||!r.other&&in$(r.title,o.list||(o.list=[])),n.classList.toggle("active",a)},"other-value":function(e){var n,r;return n=e.node,n.value=((r=t.block).value||(r.value={})).otherValue||"",((r=t.block).config||(r.config={})).otherEnabled?n.removeAttribute("readonly"):n.setAttribute("readonly","")},delete:function(e){return e.node.classList.toggle("d-none",!!(t.viewing&&!o||r.other))},"other-enabled":function(e){var n,o;return(n=e.node).classList.toggle("d-none",t.viewing||!r.other),n.classList.toggle("on",((o=t.block).config||(o.config={})).otherEnabled)},other:function(e){return e.node.classList.toggle("d-none",!r.other)},data:function(e){var t;return t=e.node,r.other&&(t.removeAttribute("editable"),t.classList.toggle("flex-grow-1",!1)),a(t,(r.other?"其它 / other":r[t.getAttribute("data-name")])||"")}}})}}}})}},import$(l,{"form-radio":c,"form-checkbox":c}),d={moduleInit:function(){var e,t=this;return this.view.module=e=new ldView({root:this.root,action:{input:{"use-markdown":function(n){var r,o;return r=n.node,((o=t.block).value||(o.value={})).useMarkdown=r.checked,t.update(),e.render()},"input-field":function(e){var n,r;return n=e.node,((r=t.block).value||(r.value={})).content=n.value,t.update()},"toggle-preview":function(n){var r;return r=n.node,t.preview=!!r.checked,e.render()}},click:{"markdown-enabled":function(e){var n;return e.node,e.evt,((n=t.block).config||(n.config={})).markdownEnabled=!((n=t.block).config||(n.config={})).markdownEnabled,t.update(),t.render()}}},handler:{"input-field":function(e){var n,r;return n=e.node,n.value=((r=t.block).value||(r.value={})).content||""},"markdown-enabled":function(e){var n;return e.node.classList.toggle("on",((n=t.block).config||(n.config={})).markdownEnabled)},"preview-panel":function(e){var n,r;if((n=e.node).classList.toggle("d-none",!t.preview),t.preview)return n.innerHTML=DOMPurify.sanitize(marked(((r=t.block).value||(r.value={})).content||""))},"edit-panel":function(e){return e.node.classList.toggle("d-none",!!t.preview)},"if-markdown":function(e){var n;return e.node.classList.toggle("d-none",!((n=t.block).value||(n.value={})).useMarkdown)},"if-markdown-enabled":function(e){var n;return e.node.classList.toggle("d-none",!((n=t.block).config||(n.config={})).markdownEnabled)}}})}},import$(l,{"form-long-answer":d,"form-short-answer":d}),l["form-datetime"]={moduleInit:function(){var e=this;return this.view.module=new ldView({root:this.root,action:{change:{"input-field":function(t){var n,r,o,i;return n=t.node,t.local,r=t.names,o=in$("start",r)?"start":"end",((i=e.block).value||(i.value={}))[o]=n.value,e.update()}},click:{"range-enabled":function(t){var n,r;return n=t.node,t.evt,((r=e.block).config||(r.config={})).rangeEnabled=!((r=e.block).config||(r.config={})).rangeEnabled,n.classList.toggle("on",((r=e.block).config||(r.config={})).rangeEnabled),e.update(),e.render()}}},init:{"input-field":function(t){var n;if(n=t.node,t.local,e.viewing)return tail.DateTime(n)}},handler:{"input-field":function(t){var n,r,o;return n=t.node,r=t.names,n.value=(in$("start",r)?((o=e.block).value||(o.value={})).start:((o=e.block).value||(o.value={})).end)||""},"is-range":function(t){var n;return t.node.classList.toggle("d-none",!((n=e.block).config||(n.config={})).rangeEnabled)},"range-enabled":function(t){var n;return t.node.classList.toggle("on",((n=e.block).config||(n.config={})).rangeEnabled)}}})}},l["form-tag"]={moduleInit:function(){var e=this;return this.view.module=new ldView({root:this.root,action:{change:{"input-field":function(t){var n,r;return t.node,n=t.local,((r=e.block).value||(r.value={})).list=n.tagify.value.map(function(e){return e.value}),e.update()}}},init:{"input-field":function(t){var n,r,o;return n=t.node,r=t.local,r.tagify=new Tagify(n,{delimiters:/[,.:;，。：；]/}),r.tagify.addTags(((o=e.block).value||(o.value={})).list||[])}}})}},s={map:{title:{name:"標題",block:["form-short-answer"],get:function(e){return null==e&&(e={}),e.content||""}},description:{name:"簡介",block:["form-short-answer","form-long-answer"],get:function(e){return null==e&&(e={}),e.content||""}},thumb:{name:"縮圖",block:["form-thumbnail"],get:function(e){return null==e&&(e={}),(e.list||[])[0]||""}},tag:{name:"標籤",block:["form-radio"],get:function(e){return null==e&&(e={}),e.list||[]}},category:{name:"分類",block:["form-tag"],get:function(e){return null==e&&(e={}),(e.list||[])[0]||""}},teamname:{name:"團隊名",block:["form-short-answer"],get:function(e){return null==e&&(e={}),e.content||""}},uid:{name:"統編",block:["form-short-answer"],get:function(e){return null==e&&(e={}),e.content||""}},email:{name:"聯絡信箱",block:["form-short-answer"],get:function(e){return null==e&&(e={}),e.content||""}},budget:{name:"預算",block:["form-budget"],get:function(e){var t,n;return null==e&&(e={}),t=(e.sheet||[]).reduce(function(e,t){return e+ +t[2]},0),n=(e.sheet||[]).reduce(function(e,t){return e+ +t[3]},0),{self:t,subsidy:n}}}},match:function(e,t){return in$(t.name,e.block||[])}},s.list=function(){var e,t=[];for(f in e=s.map)v=e[f],t.push([f,v]);return t}().map(function(e){return import$({key:e[0]},e[1])}),p=function(e){var t,n=this;return this.opt=e,this.viewing=e.viewMode,this.root=t="string"==typeof e.root?document.querySelector(e.root):e.root,this.hub=e.hub,this.prj=e.prj,this.view=this.root.view={},this.block=e.data,this.form=e.form||{},this.view.block=new ldView({root:t,action:{input:{title:function(e){var t;return t=e.node,e.evt,n.block.title=editableInput(t),n.update()},desc:function(e){var t;return t=e.node,e.evt,n.block.desc=editableInput(t),n.update()}},click:{switch:function(e){var t,r;return t=e.node,e.evt,t.classList.toggle("on"),((r=n.block).config||(r.config={}))[t.getAttribute("data-name")]=t.classList.contains("on"),n.update()},delete:function(e){return e.node,e.evt,n.delete()},clone:function(e){return e.node,e.evt,n.clone()},"move-up":function(){return n.move(-1)},"move-down":function(){return n.move(1)}}},init:{"purpose-menu":function(e){var t;return t=e.node,new Dropdown(t)}},handler:{purpose:{list:function(){var e;return(e=s.list.filter(function(e){return s.match(e,n.block)})).length||(e=[{name:"無適合用途"}]),e},action:{click:function(e){var t,r,o,i;if(e.node,t=e.data,s.match(t,n.block)){if(((r=n.form).purpose||(r.purpose={}))[t.key]=o=((r=n.form).purpose||(r.purpose={}))[t.key]===n.block.key?null:n.block.key,o)for(i in n.form.purpose)i!==t.key&&n.form.purpose[i]===o&&(n.form.purpose[i]=null);return"title"!==(r=t.key)&&"description"!==r&&"thumb"!==r&&"tag"!==r&&"category"!==r&&"teamname"!==r||(((r=n.block).config||(r.config={})).public=!0),n.update(),n.view.block.render(),n.hub.render()}}},handler:function(e){var t,r,o;return t=e.node,r=e.data,ld$.find(t,".flex-grow-1",0).innerText=r.name,t.classList.toggle("disabled",!s.match(r,n.block)),ld$.find(t,"i",0).classList.toggle("d-none",((o=n.form).purpose||(o.purpose={}))[r.key]!==n.block.key)}},"purpose-menu":function(e){var t,r,o,i;return t=e.node,r=function(){var e,t,n=[];for(o in e=(t=this.form).purpose||(t.purpose={}))i=e[o],n.push({k:o,v:i});return n}.call(n).filter(function(e){return e.v===n.block.key}).map(function(e){return s.map[e.k].name}).join(" / "),ld$.find(t,".btn",0).innerText=r?r+"":"用途"},invalid:function(e){var t,r,o;return t=e.node,(r=!(null!=((o=n.block).valid||(o.valid={})).result)||n.block.valid.result)||a(t,n.block.valid.criteria.invalid||"這個欄位格式不符"),t.classList.toggle("d-none",r)},block:function(e){var t,r,o;return t=e.node,r=!(null!=((o=n.block).valid||(o.valid={})).result)||n.block.valid.result,t.classList.toggle("invalid",!r)},title:function(e){var t;if(t=e.node,a(t,n.block.title||""),n.viewing)return t.removeAttribute("editable")},desc:function(e){var t,r;if(t=e.node,a(t,n.block.desc||""),n.viewing&&t.removeAttribute("editable"),n.viewing&&!((r=n.block).config||(r.config={}))["show-desc"])return t.classList.add("d-none")},switch:function(e){var t,r;return(t=e.node).classList.toggle("on",!!((r=n.block).config||(r.config={}))[t.getAttribute("data-name")])},"edit-only":function(e){var t;if(t=e.node,n.viewing)return t.remove()},"list-input":function(e){return e.node.setAttribute("name","input-"+n.block.key)}}}),this.viewing||(this.view.criteria=new ldView({root:this.root,action:{click:{add:function(){var e;return((e=n.block).criteria||(e.criteria=[])).push({type:o.support[n.block.name][0]||"number"}),n.view.criteria.render()}}},handler:{"has-criteria":function(e){var t;return e.node.classList.toggle("d-none",!((t=n.block).criteria||(t.criteria=[])).length)},criteria:{list:function(){var e;return(e=n.block).criteria||(e.criteria=[])},action:{click:function(e){var t,r,i,a,l,u,c;if(t=e.node,r=e.data,i=e.evt,a=e.local,l=ld$.parent(i.target,".dropdown-item",t))return l.op&&(r.op=l.op),l.type&&r.type!==l.type&&(r.type=l.type,u=(o.schema.types[r.type]||{}).ops,r.op=function(){var e=[];for(c in o.schema.ops[u]||{})e.push(c);return e}()[0]||"?"),n.update(),a.view.render()}},init:function(e){var t,r,o,l,u;return t=e.node,r=e.data,o=e.local,l=function(){return r.type||i.support[n.block.name][0]||"number"},u=function(){var e,t,n;return e=i.ops[i.types[l()].ops],t=function(){var r,o=[];for(n in r=e)t=r[n],o.push(t);return o}()[0],e[r.op]||t||{name:""}},ld$.find(t,".dropdown .dropdown-toggle").map(function(e){return new Dropdown(e)}),o.view=new ldView({context:r,root:t,action:{click:{enabled:function(e){var t,r;return t=e.node,r=e.context,t.classList.toggle("on"),r.enabled=t.classList.contains("on"),n.update(),o.view.render()}},input:{input1:function(e){var t,r;return t=e.node,r=e.context,r.input1=ld$.find(t,"input",0).value,n.update()},input2:function(e){var t,r;return t=e.node,r=e.context,r.input2=ld$.find(t,"input",0).value,n.update()},"input-invalid":function(e){var t,r;return t=e.node,r=e.context,r.invalid=t.value,n.update()}}},handler:{enabled:function(e){var t,n;return t=e.node,n=e.context,t.classList.toggle("on",!!n.enabled)},input1:function(e){var t,n,r;return t=e.node,n=e.context,r=ld$.find(t,"input",0),r.value=n.input1||"",n.enabled?r.removeAttribute("disabled"):r.setAttribute("disabled","")},input2:function(e){var t,n,r;return t=e.node,n=e.context,t.classList.toggle("d-none",(u().field||1)<2),r=ld$.find(t,"input",0),r.value=n.input2||"",n.enabled?r.removeAttribute("disabled"):r.setAttribute("disabled","")},"input-invalid":function(e){var t,n;return t=e.node,(n=e.context).enabled?t.removeAttribute("disabled"):t.setAttribute("disabled",""),t.value=n.invalid||""},type:function(e){var t,n;return t=e.node,n=e.context,t.classList.toggle("disabled",!n.enabled),a(t,i.types[l()].name)},op:function(e){var t,n;return t=e.node,n=e.context,t.classList.toggle("disabled",!n.enabled),t.innerHTML=u().name},types:{list:function(){return i.support[n.block.name]},handler:function(e){var t,n;return t=e.node,n=e.data,a(t,i.types[n].name),t.type=n}},ops:{list:function(){var e,t,n,r=[];for(e in t=i.ops[i.types[l()].ops])n=t[e],r.push([e,n]);return r},handler:function(e){var t,n;return t=e.node,n=e.data,t.innerHTML=n[1].name,t.op=n[0]}}}})},handler:function(e){var t,n;return e.node,t=e.data,(n=e.local).view.setContext(t),n.view.render()}}}})),l[this.block.name]&&(this.moduleInit=l[this.block.name].moduleInit,this.moduleInit()),this},p.prototype=import$(Object.create(Object.prototype),{setData:function(e){return this.block=e},render:function(){if(this.view.block.render(),this.view.module&&this.view.module.render(),this.view.criteria)return this.view.criteria.render()},update:function(){return this.hub.update(this.block)},delete:function(){return this.hub.delete(this.block)},clone:function(){return this.hub.clone(this.block)},move:function(e){return this.hub.move(this.block,e)},schema:i}),p.purpose=s,p});