function in$(e,t){for(var n=-1,i=t.length>>>0;++n<i;)if(e===t[n])return!0;return!1}function import$(e,t){var n={}.hasOwnProperty;for(var i in t)n.call(t,i)&&(e[i]=t[i]);return e}ldc.register("prjFormBlock",[],function(){var e,t,n,i,r,o;return e=function(e,t){if(e.innerText!==t)return e.innerText=t},t={types:{number:{name:"數值",ops:"number"},string:{name:"文字",ops:"string"},length:{name:"長度",ops:"count"},regex:{name:"正規式",ops:"regex"},count:{name:"選項數",ops:"count"},"file-size":{name:"檔案大小",ops:"smaller"},"file-format":{name:"檔案格式",ops:"extension"},"file-count":{name:"檔案數量",ops:"count"}},ops:{extension:{extension:{name:"副檔名"}},regex:{match:{name:"符合"},"not-match":{name:"不符"}},count:{gte:{name:'<div class="s mr-2">&#x2265;</div> 大於或等於'},lte:{name:'<div class="s mr-2">&#x2264;</div> 小於或等於'},eq:{name:'<div class="s mr-2">=</div> 等於'},between:{name:'<div class="s mr-2">&#x223c;</div> 介於',field:2}},string:{include:{name:"包含"},exclude:{name:"不包含"},email:{name:"電子郵件位置"},url:{name:"網址"}},number:{gte:{name:'<div class="s mr-2">&#x2265;</div> 大於或等於'},lte:{name:'<div class="s mr-2">&#x2264;</div> 小於或等於'},ge:{name:'<div class="s mr-2">&gt;</div> 大於'},le:{name:'<div class="s mr-2">&lt;</div> 小於'},eq:{name:'<div class="s mr-2">=</div> 等於'},ne:{name:'<div class="s mr-2">&#x2260;</div> 不等於'},between:{name:'<div class="s mr-2">&#x223c;</div> 介於',field:2}},smaller:{lte:{name:'<div class="s mr-2">&lt;</div> 小於'}}},support:{"form-short-answer":["number","string","length","regex"],"form-long-answer":["string","length","regex"],"form-radio":[],"form-checkbox":["count"],"form-file":["file-size","file-formt","file-count"],"form-budget":["count"],"form-checkpoint":["count"]}},n={},i={moduleInit:function(){var t,n,i=this;return"form-checkpoint"===this.block.name&&this.viewing&&(((t=this.block).value||(t.value={})).list?this.block.data=this.block.value.list:((t=this.block).value||(t.value={})).list=(t=this.block).data||(t.data=[]),ld$.find(this.root,".timeline-list",0).addEventListener("input",function(){var e;return((e=i.block).value||(e.value={})).list=i.block.data,i.update()})),this.view.module=n=new ldView({root:this.root,action:{click:{"list-add":function(){var e;return((e=i.block).data||(e.data=[])).push({title:"新項目",desc:"關於這個項目的描述 ... ",key:Math.random().toString(36).substring(2)}),i.update(),i.render()}}},handler:{list:{key:function(e){return e.key},list:function(){return(i.block.data||[]).concat([{other:!0,key:"other"}])},init:function(e){var t,n;if(t=e.node,n=e.data,!t.hasAttribute("data-user-editable")&&i.viewing&&t.removeAttribute("draggable"),n.other&&"form-checkpoint"===i.block.name)return t.classList.add("d-none")},action:{click:this.viewing?function(e){var t,r,o,a,u,l,d;if(e.node,t=e.data,r=e.evt,"form-checkpoint"!==i.block.name&&"INPUT"!==r.target.nodeName)return o="form-radio"===i.block.name,a=(u=i.block).value||(u.value={}),t.other?(l=!!o||!a.other,a.other=l,l&&o&&(a.list=[])):(d=a.list||[],(l=!!o||!in$(t.title,d))?(d.push(t.title),o&&(a.other=!1)):d.splice(d.indexOf(t.title),1),a.list=d),n.render(),i.update()}:function(){}},handler:function(t){var n,r,o;return n=t.node,r=t.data,o=n.hasAttribute("data-user-editable"),n.view?n.view.render():n.view=new ldView({root:n,init:{data:function(e){var t;if((t=e.node).setAttribute("data-name",t.getAttribute("editable")),!o&&i.viewing)return t.removeAttribute("editable")}},action:{input:{"other-value":function(e){var t,n;return t=e.node,((n=i.block).value||(n.value={})).otherValue=t.value},data:function(e){var t;return t=e.node,r[t.getAttribute("data-name")]=t.innerText}},click:{delete:function(e){var t;return e.node,t=e.evt,i.block.data.splice(i.block.data.indexOf(r),1),i.update(),i.render(),t.stopPropagation()}}},handler:{drag:function(e){return e.node.classList.toggle("d-none",i.viewing)},state:function(e){var t,n,o,a;return t=e.node,n=(o=i.block).value||(o.value={}),a=r.other&&n.other||!r.other&&in$(r.title,n.list||(n.list=[])),t.classList.toggle("active",a)},"other-value":function(e){var t,n;return t=e.node,t.value=((n=i.block).value||(n.value={})).otherValue||""},delete:function(e){return e.node.classList.toggle("d-none",i.viewing||r.other)},other:function(e){return e.node.classList.toggle("d-none",!r.other)},data:function(t){var n;return n=t.node,r.other&&(n.removeAttribute("editable"),n.classList.toggle("flex-grow-1",!1)),e(n,(r.other?"其它":r[n.getAttribute("data-name")])||"")}}})}}}})}},n=import$({},{"form-radio":i,"form-checkbox":i,"form-checkpoint":i}),r={moduleInit:function(){var e,t=this;return this.view.module=e=new ldView({root:this.root,action:{input:{"use-markdown":function(n){var i,r;return i=n.node,((r=t.block).value||(r.value={})).useMarkdown=i.checked,t.update(),e.render()},"input-field":function(e){var n,i;return n=e.node,((i=t.block).value||(i.value={})).content=n.value,t.update()},"toggle-preview":function(n){var i;return i=n.node,t.preview=!!i.checked,e.render()}}},handler:{"input-field":function(e){var n,i;return n=e.node,n.value=((i=t.block).value||(i.value={})).content||""},"preview-panel":function(e){var n,i;if((n=e.node).classList.toggle("d-none",!t.preview),t.preview)return n.innerHTML=marked(((i=t.block).value||(i.value={})).content||"")},"edit-panel":function(e){return e.node.classList.toggle("d-none",!!t.preview)},"if-markdown":function(e){var n;return e.node.classList.toggle("d-none",!((n=t.block).value||(n.value={})).useMarkdown)}}})}},import$(n,{"form-long-answer":r,"form-short-answer":r}),o=function(i){var r,o=this;return this.opt=i,this.viewing=i.viewMode,this.root=r="string"==typeof i.root?document.querySelector(i.root):i.root,this.hub=i.hub,this.view=this.root.view={},this.block=i.data,this.view.block=new ldView({root:r,action:{input:{title:function(e){var t;return t=e.node,e.evt,o.block.title=t.innerText,o.update()},desc:function(e){var t;return t=e.node,e.evt,o.block.desc=t.innerText,o.update()}},click:{switch:function(e){var t,n;return t=e.node,e.evt,t.classList.toggle("on"),((n=o.block).config||(n.config={}))[t.getAttribute("data-name")]=t.classList.contains("on"),o.update()},delete:function(e){return e.node,e.evt,o.delete()},clone:function(e){return e.node,e.evt,o.clone()}}},handler:{invalid:function(t){var n,i,r;return n=t.node,(i=!(null!=((r=o.block).valid||(r.valid={})).result)||o.block.valid.result)||e(n,o.block.valid.criteria.invalid),n.classList.toggle("d-none",i)},block:function(e){var t,n,i;return t=e.node,n=!(null!=((i=o.block).valid||(i.valid={})).result)||o.block.valid.result,t.classList.toggle("invalid",!n)},title:function(t){var n;if(n=t.node,e(n,o.block.title),o.viewing)return n.removeAttribute("editable")},desc:function(t){var n;if(n=t.node,e(n,o.block.desc),o.viewing)return n.removeAttribute("editable")},switch:function(e){var t,n;return(t=e.node).classList.toggle("on",!!((n=o.block).config||(n.config={}))[t.getAttribute("data-name")])},"edit-only":function(e){var t;if(t=e.node,o.viewing)return t.remove()},"list-input":function(e){return e.node.setAttribute("name","input-"+o.block.key)}}}),this.viewing||(this.view.criteria=new ldView({root:this.root,action:{click:{add:function(){var e;return((e=o.block).criteria||(e.criteria=[])).push({type:"number"}),o.view.criteria.render()}}},handler:{criteria:{list:function(){var e;return(e=o.block).criteria||(e.criteria=[])},action:{click:function(e){var t,n,i,r;if(t=e.node,n=e.data,i=e.evt,r=ld$.parent(i.target,".dropdown-item",t))return r.type&&(n.type=r.type),r.op&&(n.op=r.op),o.update(),t.view.render()}},init:function(n){var i,r,a,u;return i=n.node,r=n.data,a=function(){return r.type||t.support[o.block.name][0]||"number"},u=function(){var e,n,i;return e=t.ops[t.types[a()].ops],n=function(){var t,r=[];for(i in t=e)n=t[i],r.push(n);return r}()[0],e[r.op]||n||{name:""}},ld$.find(i,".dropdown .dropdown-toggle").map(function(e){return new Dropdown(e)}),i.view=new ldView({root:i,action:{input:{input1:function(e){var t;return t=e.node,r.input1=ld$.find(t,"input",0).value,o.update()},input2:function(e){var t;return t=e.node,r.input2=ld$.find(t,"input",0).value,o.update()},"input-invalid":function(e){var t;return t=e.node,r.invalid=t.value,o.update()}}},handler:{input1:function(e){var t;return t=e.node,ld$.find(t,"input",0).value=r.input1||""},input2:function(e){var t;return(t=e.node).classList.toggle("d-none",(u().field||1)<2),ld$.find(t,"input",0).value=r.input2||""},"input-invalid":function(e){var t;return t=e.node,t.value=r.invalid||""},type:function(n){var i;return i=n.node,e(i,t.types[a()].name)},op:function(e){var t;return t=e.node,t.innerHTML=u().name},types:{list:function(){return t.support[o.block.name]},handler:function(n){var i,r;return i=n.node,r=n.data,e(i,t.types[r].name),i.type=r}},ops:{list:function(){var e,n,i,r=[];for(e in n=t.ops[t.types[a()].ops])i=n[e],r.push([e,i]);return r},handler:function(e){var t,n;return t=e.node,n=e.data,t.innerHTML=n[1].name,t.op=n[0]}}}})},handler:function(e){var t;if(t=e.node,e.data,t.view)return t.view.render()}}}})),n[this.block.name]&&(this.moduleInit=n[this.block.name].moduleInit,this.moduleInit()),this},o.prototype=import$(Object.create(Object.prototype),{setData:function(e){return this.block=e},render:function(){if(this.view.block.render(),this.view.module&&this.view.module.render(),this.view.criteria)return this.view.criteria.render()},update:function(){return this.hub.update(this.block)},delete:function(){return this.hub.delete(this.block)},clone:function(){return this.hub.clone(this.block)}}),o});